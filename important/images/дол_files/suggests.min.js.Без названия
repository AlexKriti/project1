define("suggests/punto",[],function(){var a={"`":"ё",q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю"};for(_char in a)if(a.hasOwnProperty(_char)){_value=a[_char];if(!(_value in a)){a[_value]=_char}}var b=function(b){if(!b){return""}var c=String(b).toLowerCase().split("");var d="";var e;for(var f=0;f<c.length;f++){e=c[f];if(a[e]!==void 0){d+=a[e]}else{d+=e}}return d};return b});define("suggests/search-index",["jquery","suggests/punto"],function($,a){var b=function(){var b={ru:{"йе":"ye","йо":"yo","йу":"yu","йя":"ya","кс":"x","а":"a","б":"b","в":"v","г":"g","д":"d","е":["je","ye","e"],"ё":["jo","yo"],"ж":"zh","з":["s","z"],"и":"i","й":["jj","g","i","j","y"],"к":["c","k"],"л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":["ph","f"],"х":["kh","h"],"ц":["c","ts"],"ч":"ch","ш":["sch","sh"],"щ":["shch","sch","shh"],"ъ":'"',"ы":["i","y"],"ь":"'","э":"eh","ю":["u","ju","yu"],"я":["ja","ya","y"]},en:{shch:"щ",sch:["ш","щ"],shh:"щ",ch:"ч",ja:["йя","я"],je:"е",jo:"ё",ju:"ю",sh:"ш",ts:"ц",ya:["йя","я"],ye:"е",yo:"ё",yu:"ю",a:"а",b:"б",c:"к",v:"в",g:["г","й"],d:"д",e:"е",f:"ф",i:["и","й","ы"],j:"й",k:"к",l:"л",m:"м",n:"н",o:"о",p:"п",r:"р",s:["з","с"],t:"т",u:["у","ю"],x:"кс",y:["ий","й","ы","я"],z:"з"}};function c(c){var d,e=b["en"][c]||b["ru"][c]||(c=c.toLocaleLowerCase(),d=true)&&(b["en"][c]||b["ru"][c]),f=[],g,h;if(e){h=a(c);f=f.concat(e,c,h)}else if(c.length===1){h=a(c);f=f.concat(c,h)}for(g=f.length;g--;){c=f[g];if($.trim(c)){c=f[g]=String.preg_quote(c);if(d){c=c.charAt(0).toUpperCase()+c.substr(1,c.length);f[g]=c}}else{f[g]="\\s+"}}return f}function d(a,b){var c=a.join(b?"":"|");if(a.length>1){c="(?:"+c+")"}return c}function e(a){a=a==null?"":a+"";var b="";for(var e=0,f=a.length,g,h,i,j=[],k=[];e<f;e++){for(g=f;g>e;g--){i=c(a.substring(e,g));if(i.length){j.length=0;j.push(d(i,0));if(g-e>1){k.length=0;for(h=e;h<g;h++){k.push(d(c(a.charAt(h)),0))}j.push(d(k,1));e+=g-e-1}b+=d(j,0)}}}return b}function f(a){var b=e(a);return{name:new RegExp("(^|^(.*?[_\\-\\.\\s])?)"+b,"i"),email:new RegExp("(^|^([^@]+[_\\-\\.]|.*?@)?)"+b,"i"),group:new RegExp("(^|^(.*?[_\\-\\.\\s])?)"+b,"i")}}function g(a,b){if(typeof a!=="string"){return null}return b.test(a)?{start:RegExp.lastParen.length,end:RegExp.lastMatch.length}:null}return{createFindRegExp:f,matchSubsetByRegExp:g}}();function c(){var a=[];function c(b){a.push({data:b})}function d(){a.length=0}function e(c){var d=[];if(c){var e=b.createFindRegExp(c);for(var f=0,g=a.length,h,i,j;f<g;f++){for(h in e){if(e.hasOwnProperty(h)){if(i=b.matchSubsetByRegExp((j=a[f].data)[h],e[h])){d.push({data:j,field:h,position:i});break}}}}}else{d=a}return d}function f(b){return Array.find(a,function(a){return a.data.id==b})}return{add:c,fetch:e,clear:d,getGroup:f}}return c});define("toolkit-common/store/store",function(){function a(a,b){var c={};var d=a.document,e=b||window.patron&&patron.NoSaveLogin?"sessionStorage":"localStorage",f;c.disabled=false;c.set=function(a,b){};c.get=function(a){};c.remove=function(a){};c.clear=function(){};c.transact=function(a,b,d){var e=c.get(a);if(d==null){d=b;b=null}if(typeof e=="undefined"){e=b||{}}d(e);c.set(a,e)};c.getAll=function(){};c.forEach=function(){};c.serialize=function(a){return JSON.stringify(a)};c.deserialize=function(a){if(typeof a!="string"){return undefined}try{return JSON.parse(a)}catch(b){return a||undefined}};c.toString=function(){return"store"};function g(){try{return e in a&&a[e]}catch(a){return false}}if(g()){f=a[e];c.set=function(a,b){if(b===undefined){return c.remove(a)}f.setItem(a,c.serialize(b));return b};c.get=function(a){return c.deserialize(f.getItem(a))};c.remove=function(a){f.removeItem(a)};c.clear=function(){f.clear()};c.getAll=function(){var a={};c.forEach(function(b,c){a[b]=c});return a};c.forEach=function(a){for(var b=0;b<f.length;b++){var d=f.key(b);a(d,c.get(d))}}}else if(d.documentElement.addBehavior){var h,i;try{i=new ActiveXObject("htmlfile");i.open();i.write("<s"+"cript>document.w=window</s"+'cript><iframe src="/favicon.ico"></frame>');i.close();h=i.w.frames[0].document;f=h.createElement("div")}catch(a){f=d.createElement("div");h=d.body}function j(a){return function(){try{var b=Array.prototype.slice.call(arguments,0);b.unshift(f);h.appendChild(f);f.addBehavior("#default#userData");f.load(e);var d=a.apply(c,b);h.removeChild(f);return d}catch(a){}}}var k=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function l(a){return a.replace(/^\d/,"___$&").replace(k,"___")}c.set=j(function(a,b,d){b=l(b);if(d===undefined){return c.remove(b)}a.setAttribute(b,c.serialize(d));a.save(e);return d});c.get=j(function(a,b){b=l(b);return c.deserialize(a.getAttribute(b))});c.remove=j(function(a,b){b=l(b);a.removeAttribute(b);a.save(e)});c.clear=j(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(e);for(var c=0,d;d=b[c];c++){a.removeAttribute(d.name)}a.save(e)});c.getAll=function(a){var b={};c.forEach(function(a,c){b[a]=c});return b};c.forEach=j(function(a,b){var d=a.XMLDocument.documentElement.attributes;for(var e=0,f;f=d[e];++e){b(f.name,c.deserialize(a.getAttribute(f.name)))}})}try{var m="__storejs__";c.set(m,m);if(c.get(m)!=m){c.disabled=true}c.remove(m)}catch(a){c.disabled=true}c.enabled=!c.disabled;c.disabled&&function(a,b){a.get=function(a){return b[a]};a.set=function(a,c){b[a]=c};a.remove=function(a){delete b[a]};a.getAll=function(){return b};a.clear=function(){b={}}}(c,{});return c}var b;(function(c){b=c.store=a(c);b.session=a(c,true)})(Function("return this")());return b});define("suggests/data-source",["jquery","suggests/search-index","toolkit-common/store/store"],function($,a,b){function c(a){var b=[];if(Array.isArray(a)){if(!(a.length>=4&&a[3])){Array.forEach(a[1],function(c){b.push({name:$.trim(a[0]),email:c,id:a[2],fromInbox:!!a[4]})})}}else if(Object.isObject(a)){if(Array.isArray(a.emails)){var c=a.nick||"";if(a.display_name){c=a.display_name}else if(Object.isObject(a.name)){if(a.name.first||a.name.last){c=(a.name.first||"")+" "+(a.name.last||"")}}c=$.trim(c);Array.forEach(a.emails,function(a){b.push({name:c,email:a})})}}return b}function d(a,b,d){Array.forEach(b,function(b){Array.forEach(c(b),function(b){if(!(b.email in d)){d[b.email]=null;a.add(b)}})})}function e(a,b,d,e,f){var g={};b.forEach(function(a){c(a).forEach(function(a){if(!(a.id in g)){g[a.id]=[]}g[a.id].push(a)})});d.forEach(function(b){b={group:$.trim(b[0]),count:b[1],id:b[2]};b.contacts=[];var c=e.find(function(a){return a.id==b.id});if(c&&Array.isArray(c.contacts)){c.contacts.forEach(function(a){if(g[a]){b.contacts=b.contacts.concat(g[a])}})}b.count=b.contacts.length;if(b.count){a.add(b)}})}function f(a,b){return a.name===b.name?a.email>b.email?1:-1:a.name>b.name?1:-1}function g(a,b,d){var e=[],g=false;Array.forEach(b,function(b){var f=false;Array.forEach(a,function(a){Array.forEach(c(a),function(c){if(c.email===b.email){if(c.name!==b.name){if(d){a[0]=b.name}else{a.nick=b.name;delete a.name;delete a.display_name}g=true}f=true}})});if(!f){e.push(b)}});if(e.length){g=true;e=e.sort(f);Array.prototype.splice.apply(a,[0,0].concat(Array.map(e,function(a){return d?[a.name,[a.email]]:{nick:a.name,emails:[a.email]}})))}return g}var h={radar:function(a){try{patron.radar("ab_s_v2",a+"=1",1)}catch(a){}}};var i;var j=function(){var a=2,b,c={stack:[]};return function(d,e){function f(a){var b={name:null,nick:null,emails:null,id:null};Array.forEach(a.body,function(a){Object.forEach(a,function(c){if(!(c in b)){delete a[c]}})})}function g(){if(g.tid){clearTimeout(g.tid)}g.tid=setTimeout(function(){g.tid=b=null},12e4)}function h(){e.remove(":version");e.remove("")}function i(){var b=e.get(":version");if(b==null){return null}if(b!=a){h()}return e.get("")}function j(b){f(b);try{e.set(":version",a);e.set("",b)}catch(a){}}function k(a,b){var c=a.body,d=b.body.deleted,e=b.body.modified,f={},g={},h,i;if(!(d&&d.length)){d=null}if(!(e&&e.length)){e=null}if(d||e){if(d){for(h=d.length;h--;){f[d[h]]=null}}if(e){for(h=e.length;h--;){g[e[h].id]=e[h]}}for(h=c.length;h--;){if((i=c[h].id)in f){c.splice(h,1)}else if(i in g){c[h]=g[i];delete g[i]}}Object.forEach(g,function(a){c.push(a)});f=g=d=e=null}else{return false}a.body=c;c=a;c.last_modified=b.last_modified;j(c);return c}function l(a){var b={body:a.body,last_modified:a.last_modified};j(b);return b}function m(){if(b){while(c.stack.length){var a=c.stack.shift();a.resolve(b.body)}}}function n(){var a=new $.Deferred,e=new $.Deferred,f;if(!b){b=i()}if(b){g();f=b.last_modified}c.stack.push(e);if(c.loaded){m()}else if(!c.loading){c.loading=true;a.done(function(a){c.loaded=true;var d;if(Array.isArray(a.body)){d=l(a)}else if(Object.isObject(a.body)&&b){d=k(b,a)}if(d){b=d;m()}});d.getCommonContacts.call(a,f)}return e.promise()}return{fetch:n}}}();function k(a){function b(){var b=new $.Deferred,c=new $.Deferred;b.done(function(a){c.resolve(a.body)});a.getContacts.call(b);return c.promise()}return{fetch:b}}function l(a){a=$.extend({},a);var c=(a.prefix?a.prefix:"")+"|ab/contacts/common";var d=function(a){return c+(a?a:"")};return{set:function(a,c){return b.set(d(a),c)},get:function(a){return b.get(d(a))},remove:function(a){return b.remove(d(a))}}}var m=function(){var a,b={stack:[]};return function(c){function d(){if(a){while(b.stack.length){var c=b.stack.shift();c.resolve(a.body)}}}function e(){var e=new $.Deferred,f=new $.Deferred;b.stack.push(f);if(b.loaded){d()}else if(!b.loading){b.loading=true;e.done(function(c){b.loaded=true;if(c){a=c;d()}});e.fail(function(){b.loading=false});c.getGroups.call(e)}return f.promise()}return{fetch:e}}}();function n(b,c){var f=new l(c),g=new k(b,f),n=new j(b,f),o=new m(b),p=new a;function q(){var a=new $.Deferred,c={},f={find:function(a){return p.fetch(a)},all:function(){return p.fetch()},getGroup:function(a){return p.getGroup(a)}};p.clear();var j=g.fetch().done(function(g){if(!i&&(!Array.isArray(g)||g.length===0)&&window.patron&&!patron.abjsDataEmpty){i=true;h.radar("empty_after")}d(p,g,c);a.resolve(f);var j=Array.filter(g,function(a){return a.length==4&&a[3]&&a[1]});if(j.length&&b.getGroups){o.fetch().done(function(a){e(p,g,j,a,c)}).fail(function(){h.radar("group_fail")})}});n.fetch().done(function(a){j.done(function(){d(p,a,c)})});return a.promise()}return{get:q}}n.contactToPlainItems=c;n.addContactsToIndex=d;n.updateContacts=g;return n});define("toolkit/b-contact-utils/b-contact-utils",["jquery","toolkit/b-toolkit/b-toolkit"],function($,a){"use strict";var b=200;var c=window.$Scroll;function d(a){var b=[],d,e;a.each(function(a,f){d=$(f);e=d.offset();b.push({$contact:d,x:e.left-(c&&c.normal?0:$(window).scrollLeft()),y:e.top-(c&&c.normal?0:$(window).scrollTop()),w:d.outerWidth(),h:d.outerHeight()})});return b}a["b-contact-utils"]=a["b-toolkit"].extend({classNames:{contact:"",selected:""},$lastSelectedContact:null,browser:$.browser,active:false,init:function(){this._mousedown=this._mousedown.bind(this);this._keydown=this._keydown.bind(this);this._blur=this._blur.bind(this);this.$xerox=$('<input type="text"/>').attr({tabindex:-1}).css({overflow:"hidden",position:"absolute",marginLeft:-1e4,width:"auto"})},wrap:function(a){this.$el=a=$(a);this.el=this.$el[0];this.$el.append(this.$xerox).attr("tabindex",b++).addClass("b-contact-container");this._initEvents()},getAll:function(){return this.$("."+this.classNames.contact)},getSelected:function(){return this.$("."+this.classNames.contact+"."+this.classNames.selected)},getPrev:function(a){var b="."+this.classNames.contact+":visible",c=a.prev(b);if(!c.length){c=a.prevUntil(b).last().prev()}return c},getNext:function(a){var b="."+this.classNames.contact+":visible",c=a.next(b);if(!c.length){c=a.nextUntil(b).last().next()}return c},select:function(a,b){if(!b){this.deselectAll()}this.$lastSelectedContact=a.toggleMod("selected",true);this.onSelect(a,b);this.active=true;if(this.browser.safari){this.prepareForCopy(this.getSelected())}},deselect:function(a){a.toggleMod("selected",false)},selectRange:function(a,b){if(b){this.$lastSelectedContact=b}if(!this.$lastSelectedContact){this.select(a,true);return}var c=this.getAll(),d=false,e=false,f;for(var g=0;g<c.length;g++){f=c[g];if(f==a[0]||f==this.$lastSelectedContact[0]){e=d;d=!d}if(d||e)$(f).toggleMod("selected",true);if(e)break}this.$lastSelectedContact=a;this.active=true;if(this.browser.safari){this.prepareForCopy(this.getSelected())}},deselectRange:function(a){if(!this.$lastSelectedContact){this.deselect(a);return}var b=this.getAll(),c=false,d=false,e,f;for(var g=0,h=b.length;g<h;g++){e=b[g];if(e==a[0]||e==this.$lastSelectedContact[0]){d=c;c=!c;if(c){f=e==a[0]}}if(c||d)this.deselect($(e));if(d)break}var i=f?this.getPrev(a):this.getNext(a);this.$lastSelectedContact=i.hasMod("selected")?i:null},selectAll:function(){this.getAll().toggleMod("selected",true).last().focus();this.active=true;if(this.browser.safari){this.prepareForCopy(this.getSelected())}},deselectAll:function(){this.getAll().toggleMod("selected",false);this.$lastSelectedContact=null},onSelect:function(){},onMousedown:function(){return true},onMousemove:function(){},onMouseup:function(){this.$el.focus()},onSelectionStart:function(){},onBlur:function(){return true},onBeforeCopy:function(){return true},getText:function(){return""},prepareForCopy:function(a){var b=this.getText(a);this.$xerox.val(b).focus().select()},_initEvents:function(){this.$el.bind("mousedown",this._mousedown).bind("keydown",this._keydown);$(document.body).bind("mousedown",this._blur)},_mousedown:function(a){if(this.onMousedown(a)&&a.which<2&&!a.ctrlKey){a.preventDefault();var b={x:a.pageX,y:a.pageY},c=this.getAll(),e=d(c),f=false;this.deselectAll();$(document).bind("mousemove.selection",function(a){var c,d,g;this.onMousemove(a);if(b.y<=a.pageY){c={x0:b.x,y0:b.y,x1:a.pageX,y1:a.pageY}}else{c={x0:a.pageX,y0:a.pageY,x1:b.x,y1:b.y}}e.forEach(function(a){if(!d){if(a.y+a.h<c.y0){this.deselect(a.$contact)}else if(a.y<c.y0&&a.x<c.x0){if(a.y+a.h>=c.y1&&a.x+a.w>=c.x1){c={x0:c.x1,y0:c.y1,x1:c.x0,y1:c.y0};d=a.$contact}else if(a.x+a.w>=c.x0){d=a.$contact}else{this.deselect(a.$contact)}}else if(a.y+a.h<c.y1||a.y<c.y0&&a.x<c.x1){d=a.$contact}else{this.deselect(a.$contact)}}else{if(a.y+a.h>=c.y1&&a.x>c.x1||a.y>c.y1){this.deselect(a.$contact)}else{g=a.$contact}}}.bind(this));if(d){if(!f){f=true;this.onSelectionStart(a)}this.$lastSelectedContact=null;this.selectRange(d,g)}}.bind(this)).bind("mouseup.selection",function(a){$(document).unbind("mousemove.selection mouseup.selection");this.onMouseup(a,f);var b=this.getSelected();this.$lastSelectedContact=b.first().focus();if(f&&this.browser.safari){this.prepareForCopy(b)}}.bind(this))}},_keydown:function(a){var b=a.keyCode,c=a.ctrlKey||a.metaKey;if(c&&(b===67||b===88)){if(this.onBeforeCopy(a)){this.prepareForCopy(this.getSelected())}}},_blur:function(a){if(this.onBlur(a)&&this.active&&this.el!==a.target&&!this.$el.has(a.target).length){this.active=false;this.deselectAll()}},destroy:function(){a["b-toolkit"].fn.destroy.apply(this,arguments);$(document.body).unbind("mousedown",this._blur);this.$xerox=null}});return a["b-contact-utils"]});define("suggests/group",["jquery","toolkit/b-dropdown/b-dropdown"],function($,a){var b={radar:function(a){try{patron.radar("composelabels_v2",a+"=1",1)}catch(a){}}};var c={onExpand:$.noop,onChange:$.noop};function d(a,b,d,e,f){this.$label=a;this.data=b;this.suggest=d;this.opts=e;$.extend(this,c,f);this.init()}d.prototype={constructor:d,init:function(){var a=this.$label;var b=this.data;var c=b.name;var d=this.suggest.getGroup(b.id);var e=d?d.data.contacts:[];a.toggleMod("group",true);a.css("display","");var f=this.opts.blockMaxWidth||350,g=Math.round(f*1.2/5);if(c.length>g){c=c.slice(0,g)}a.attr("data-text",b.contactsPlain);a.find(".js-label-text").text(c);b.contacts=b.contacts||e.map(function(a){return{contact:a,enabled:true}});this._createTooltip();this._createDropdown();a.data("group",this);setTimeout(function(){this.checkValidity();this.updateCounter();this.onChange(1)}.bind(this))},updateContactsPlain:function(){this.data.contactsPlain=this.data.contacts.map(function(a){return a.enabled?this.suggest._plainContactToString(a.contact,this.suggest.opts.suggestSeparator):""}.bind(this)).filter(function(a){return a.length}).join(", ");this.$label.attr("data-text",this.data.contactsPlain);this.checkValidity()},checkValidity:function(){var a=false;this.data.contacts.forEach(function(b){if(b.enabled){var c=this.suggest._plainContactToString(b.contact,this.suggest.opts.suggestSeparator);var d=require("suggests/labels").validateContact(c);if(!d.valid){a=true}}}.bind(this));this.$label.toggleClass("compose__labels__label_invalid",a)},updateCounter:function(a){if(!this.$label.find(".js-excluded").length){this.$label.find(".js-label-text").after($('<span class="compose__labels__label__text js-excluded"></span>'))}if(a===undefined){a=this.data.contacts.filter(function(a){return a.enabled}).length}var b=0;if(a===this.data.contacts.length){this.$label.find(".js-excluded").display(0)}else{this.$label.find(".js-excluded").display(1).html("<b>"+(a-this.data.contacts.length)+"</b>");b=this.$label.find(".js-excluded").width()}this.$label.find(".js-label-text").css("max-width",this.opts.blockMaxWidth-b)},_createTooltip:function(){var a={group:this.data.name,count:this.data.contacts.length,contacts:[]};this.$label.data("tooltip",this.suggest.opts.template(null,{data:a}))},_createDropdown:function(){var c=this.$label;this.dropdown=new a({el:c,$ctrl:c,$list:$('<div style="display:none"></div>').attr("class","b-dropdown__list b-dropdown__list_contacts-info b-dropdown__list_suggest").attr("data-group",this.data.name).display(0).appendTo("body"),__itemSelector:".js-dropdown-item",unselectable:true,onExpand:function(){var a=c.offset();var d=this.opts.margin||7;this.dropdown.$list.css({top:a.top+c.height()+d,left:a.left});this.onExpand();this.opts.groupExpanded=true;b.radar("s_group_expand")}.bind(this),onCollapse:function(){this.opts.groupExpanded=false}.bind(this),onClick:function(a,c){var d=$(c.currentTarget);var e=d.attr("data-name");var f=0;this.data.contacts.forEach(function(a){if(a.contact.email===e){a.enabled=!a.enabled;var c=$.extend({},a.contact,{enabled:a.enabled});setTimeout(function(){if(this.suggest){var a=d.hasMod("selected");var b=$(this.suggest.opts.template(null,{data:c}));d.replaceWith(b);b.toggleMod("selected",a)}}.bind(this));b.radar(a.enabled?"s_group_include":"s_group_exclude")}if(a.enabled){f++}}.bind(this));this.updateCounter(f);this.updateContactsPlain();this.onChange(f)}.bind(this)});var d=this.data.contacts.map(function(a){var b=$.extend({},a.contact,{enabled:a.enabled});return this.suggest.opts.template(null,{data:b})}.bind(this));this.dropdown.$list.html('<div class="b-dropdown__group b-dropdown__group_scroll">'+d.join("")+"</div>").width(this.suggest.opts.width||250).find(".b-dropdown__group").css("max-height","280px")},destroy:function(){this.dropdown.hide();this.dropdown.$list.remove();this.dropdown.destroy();this.dropdown=null;this.$label=null;this.data=null;this.suggest=null;this.opts=null}};return d});define("suggests/labels",["jquery","toolkit/b-contact-utils/b-contact-utils","ajs","suggests/group"],function($,a,b,c){var d="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",e=new RegExp("([\\-\\w.+!#$%&'*=/?\\^_`|~{}]+)@([\\w.а-яё\\-"+d+"]+)\\.[\\wа-яё\\-"+d+"]+"),f=new RegExp("[\"']?(.*?)[\"']?\\s*(?:<|&lt;)("+e.source+")(?:>|&gt;)$"),g=new RegExp("[\"']?(.*?)[\"']?\\s+(?:<|&lt;)("+e.source+")(?:>|&gt;)$");var h=window["Counter"]&&window["Counter"].d&&window["Counter"].sb?window["Counter"]:{d:function(){},sb:function(){}};var i=function(){var a=navigator.userAgent,b=/(webkit)[ \/]([\w.]+)/,c=/(opera)(?:.*version)?[ \/]([\w.]+)/,d=/(msie) ([\w.]+)/,e=/(mozilla)(?:.*? rv:([\w.]+))?/,f={};function g(a){a=a.toLowerCase();var f=b.exec(a)||c.exec(a)||d.exec(a)||a.indexOf("compatible")<0&&e.exec(a)||[];return{browser:f[1]||"",version:f[2]||"0"}}var h=g(a);if(h.browser){f[h.browser]=true;f.version=h.version}if(f.webkit){f.safari=true}return f}();var j={startSearchTS:0,startSelectionTS:0,waitSelection:null,waitFail:null,requestValue:"",suggestValue:"",sourceSize:0,suggestsList:[],log:function(a,b){if(this.startSearchTS){clearTimeout(this.waitSelection);clearTimeout(this.waitFail);try{patron.Utils.suggestLog("email",{start_ts:this.startSearchTS,sel_ts:this.startSelectionTS,val:this.requestValue,sel:a,data:this.suggestsList||[],idx:b,abjs:this.sourceSize})}catch(a){}delete this.requestValue;delete this.startSearchTS;delete this.startSelectionTS;delete this.suggestsList}},autoLog:function(a,b){this[a]=setTimeout(function(){this.log("")}.bind(this),b)},radar:function(a){try{patron.radar("composelabels_v2",a+"=1",1)}catch(a){}}};var k=[];var l={disabled:false,margin:6,focusWhileDisabled:false,dragNDropEnabled:true,blockMaxWidth:150,popularSuggestsListLength:16,showSuggestsOnClick:true,labelsOneClick:true};function m(a){return a.ctrlKey||a.metaKey}function n(a){return a==32||a>=48&&a<=90||a>=96&&a<=111||a>=186&&a!=224}function o(a){return!!a.match(e)}function p(a){if(!a){return""}var b=a.match(f);return b?b[2]:a}function q(a){if(!a){return""}var b=a.match(f);return b?b[1]:a}function r(a){if(!a){return""}var b=a.match(f);return b?{name:b[1],email:b[2]}:a}function s(a){if(p(a)==a&&a.match(e)){if(!~a.indexOf("<"))a="<"+a;if(!~a.indexOf(">"))a=a+">";a=a.match(e)[1]+" "+a}return a}function t(a){return""+(a.attr("data-text")||"")}function u(){try{j.radar("invalidblock_abjsdata_"+(patron.abjsData&&patron.abjsData.length?"1":"0"))}catch(a){}}function v(a,b){this.suggest=a;this.opts=$.extend({},l,b);this.namespace="composeLabels";var c=a.input==document.activeElement;if(c&&this.opts.disabled){this.opts.focusWhileDisabled=true;setTimeout(function(){this.opts.focusWhileDisabled=false}.bind(this),5e3)}this._prepareContainer(a.input);this._initSuggests();this._initHandlers();this._initHistory();this._initWidget();this._initLabels();this._initDragNDrop();if(c){this._prepareInput()}this.originalContacts={};this.changedContacts={};this.timeoutIds={}}v.prototype={_prepareContainer:function(a){var b=this;this.$source=$('<input type="hidden">').attr({name:a.attr("name"),id:a.attr("id"),class:"js-source"}).val(a.val());this.source=this.$source[0];this.$input=$("<textarea></textarea>").attr({tabindex:a.attr("tabindex"),"data-original-name":a.attr("name"),class:"js-input compose__labels__input",wrap:"off"});this.input=this.$input[0];this.$inputPlaceHolder=$();if(this.opts.placehold_on_suggest){this.$inputPlaceHolder=this.$input.clone().attr({tabindex:-1,class:"compose__labels__input_suggest"}).removeAttr("data-original-name").focus(function(){setTimeout(function(){b.$input.focus()},0)}).hide()}var c=this.opts.compose2?41:17;var d=window.fest["suggests"]({block:"b-contact-label"}),e=$(d).attr({tabindex:-1,style:"display: none;"+(this.opts.blockMaxWidth?" max-width: "+(this.opts.blockMaxWidth+c)+"px;":"")}).find(".js-label-text").attr("style",this.opts.blockMaxWidth?"max-width: "+this.opts.blockMaxWidth+"px;":"").end();a.replaceWith(this.$container=$("<div></div>").attr({class:a.attr("class")+" compose__labels"+(this.opts.placehold_on_suggest?" compose__labels_placehold-on-suggest":""),style:"height: auto;"}).addClass("js-compose-labels"));this.$container.append(e,this.$inputPlaceHolder,this.$input,this.$source);this.suggest.applyToInput(this.$input)},applyToInput:function(a){this._prepareContainer(a);this._initHandlers();this._prepareInput()},_initLabels:function(){this.$input.val(this.$source.val());var a=this.suggest.getSuggestWords();if(a.length){if(this.opts.disabled&&!o(a[a.length-1])){var b=a.pop()}a.forEach(function(a){this._createLabel(a,true)}.bind(this));this._updateSource();if(b){this.$input.val(b)}}},_initSuggests:function(){var a=this;$.extend(this.suggest.opts,{getContainer:function(){return a.$container},afterSelect:function(b,c,d,e,f,g){j.log(b,c);a._removeDuplicate(a.$input.val());if(f){a._createGroup(f)}else{var h=a._createLabel(b);if(g){h.attr("data-from-inbox",true);j.radar("s_select_from_inbox")}}a._prepareInput();return""},afterRebuild:function(b,c){var d=a.$container.offset();var e=c.offset();var f=a.suggest.getOffset();d.left+=a.opts.inputIndent;var g=d.left+a.$container.width()+a.opts.suggestMaxExcess;if(e.left+c.width()>g){c.css({left:Math.max(g-c.width(),d.left)-f.left})}}})},_initHandlers:function(){var c=this,d=$(window);this.suggest.ajsSuggest.addTrigger("suggests:mark",function(a){c._updatePlaceholder(a.newSuggestData,a.findValue)}).addTrigger("suggests:activeIn",function(a){c.$container.addClass("compose__labels_focused")}).addTrigger("suggests:activeOut",function(a){if(c.opts.noblur){c.opts.noblur=false}else{if(!c.opts.disabled&&!c.opts.focusWhileDisabled){if(!c.opts.isActive){c._createLabel(c.input.value);c.input.value=""}}else if(c.input.value){setTimeout(function(){c.suggest.ajsSuggest.show()},10)}}c.$container.removeClass("compose__labels_focused")}).addTrigger("suggests:hide",function(a){c._updatePlaceholder(null,null,false)}).addTrigger("suggests:show",function(a){j.radar("s_show"+(a&&a.findValue?"":"_popular"));c._updatePlaceholder(null,null,true)}).addTrigger("suggests:select",function(a){j.radar("s_select"+(a&&a.findValue?"":"_popular"))}).addTrigger("suggests:getData:after",function(a){var b=a["data"];if(!b||b.length===0)return;j.requestValue=a["suggestValue"];j.suggestsList=b;j.sourceSize=c.suggest.localData?c.suggest.localData.all().length:0;clearTimeout(j.waitSelection);clearTimeout(j.waitFail);if(b.length==0){j.autoLog("waitFail",500)}else{j.startSelectionTS=$.now();j.autoLog("waitSelection",15e3)}});this.$input.bind("blur",function(a,b){if(b){c._createLabel(this.value);this.value="";if(c.suggest.isExpanded()){c.suggest.hide()}if(c.opts.focusWhileDisabled)c.opts.focusWhileDisabled=false}}).bind("keydown",function(a){var d=a.keyCode,e=b.$.getCaretPosition(this);if(d==13||d==27){if(!c.suggest.isExpanded()){if(c._checkTextValidity(this.value).valid){c._createLabel(this.value);c._prepareInput()}}}else if((d==37||d==8)&&(!e.start&&!e.end)){var f=c.contactUtils.getPrev(c._getInputWrap());if(f.length){if(c.opts.labelsOneClick&&d==8){c._removeLabel(f)}else{$(this).trigger("blur",true);c.contactUtils.select(f,a.shiftKey)}}a.preventDefault()}else if(d==39&&e.start==this.value.length){var g=c.contactUtils.getNext(c._getInputWrap());if(g.length){$(this).trigger("blur",true);c.contactUtils.select(g,a.shiftKey);a.preventDefault()}else if(this.value!=""&&c._checkTextValidity(this.value).valid){c._createLabel(this.value);c._prepareInput();a.preventDefault()}}else if(d==9){setTimeout(function(){c._createLabel(this.value)}.bind(this),0)}else if(m(a)&&d==65&&this.value==""){c.contactUtils.selectAll();a.preventDefault()}else if(m(a)&&this.value==""&&(d==90||d==89)){var h=d==90?c.history.undo():c.history.redo();if(h!==null){c.$source.val(h);c._removeAllLabels();c._initLabels();c._prepareInput()}a.preventDefault()}else if(o(this.value)&&(d==32||this.value.slice(-1)==">")){if(e.start==this.value.length&&n(d)){c._createLabel(this.value);c._prepareInput();if(d==32)a.preventDefault()}}c._hideTooltip(true);clearTimeout(j.waitSelection);if(!j.startSearchTS){j.startSearchTS=$.now()}}).bind("keyup",function(a){if(c.suggest.opts.ignoreUsedData){c.suggest.ignoreUsed(c._getSuggestWords())}if(this.value==""&&c.$input.closest(".js-input-wrap").length){c._prepareInput()}if(a.keyCode==9){c._prepareInput()}c._updateInputWidth()}).bind("input",function(){if(/\n|\r|\t/.test(this.value)){this.value=this.value.replace(/,(\n|\r|\t)+/g,",").replace(/(\n|\r|\t)+/g,",")}if(new RegExp(c.suggest.opts.suggestSeparator.source).test(this.value)){var a=c.suggest.getSuggestWords().filter(function(a){return!!a});if(a.length>1||new RegExp(c.suggest.opts.suggestSeparator.source).test(this.value.slice(-1))){this.value="";a.forEach(function(a){if(a){c._createLabel(a,true)}});c._prepareInput();c._updateSource()}}c._updateInputWidth()}).bind("focus",function(){if(!c.opts.inputMaxWidth){c.$container.trigger("change")}c.$container.trigger("inputfocus");if(!c.addressbookData){c._setDataSource()}});this.contactUtils=new a({classNames:{contact:"js-compose-label",selected:"compose__labels__label_selected"},browser:i,getAll:function(){return this.$("."+this.classNames.contact).not(":first")},getText:this._getText,onSelect:this.onSelect.bind(this),onMousedown:this.onMousedown.bind(this),onMousemove:this.onMousemove.bind(this),onMouseup:this.onMouseup.bind(this),onBlur:this.onBlur.bind(this),onBeforeCopy:this.onBeforeCopy.bind(this)});this.contactUtils.wrap(this.$container);this.$container.on("tap",".js-compose-toggler",function(a){c.$container.data(c.namespace).togglePrehide(false)});this.$container.bind("click",function(a){if(a.which<2){var b=$(a.target),d=b.closest(".js-compose-label");if(b.is(".js-remove-label")&&!m(a)&&!a.shiftKey){c._removeLabel(d);c._prepareInput();a.preventDefault()}else if(d.length){if(m(a)||a.shiftKey){if(d.hasClass("compose__labels__label_selected")){a.shiftKey?c.contactUtils.deselectRange(d):c.contactUtils.deselect(d)}else{a.shiftKey?c.contactUtils.selectRange(d):c.contactUtils.select(d,true)}}else{c.contactUtils.select(d)}a.preventDefault()}}});this.$container.bind("keydown",function(a){if(a.target==c.input)return;var b=a.keyCode,d=c.contactUtils.getSelected(),e;if(b==37||b==39){var f=a.shiftKey,g=b==39;d=g?d.first():d.last();if(f)d=c.contactUtils.$lastSelectedContact||d;e=g?c.contactUtils.getNext(d):c.contactUtils.getPrev(d);if(e.length){if(f&&e.hasClass("compose__labels__label_selected")){c.contactUtils.deselect(d);c.contactUtils.$lastSelectedContact=e}else{c.contactUtils.select(e,f)}a.preventDefault()}else if(g){c._prepareInput();a.preventDefault()}}else if(a.shiftKey&&(b==38||b==40)){a.preventDefault()}else if(b==8||b==46){if(d.length){c._removeLabel(d);c._prepareInput()}a.preventDefault()}else if(b==27){c.contactUtils.deselectAll();c._prepareInput();a.preventDefault()}else if(b==13){d=c.contactUtils.$lastSelectedContact||d.last();if(d.length){if(d.hasMod("group")){c.contactUtils.select(d)}else{c._prepareInput(d)}}a.preventDefault()}else if(b==9){c.contactUtils.deselectAll()}else if(m(a)&&b==65){c.contactUtils.selectAll();a.preventDefault()}else if(m(a)&&(b==67||b==88)){if(b==88){c._removeLabel(d)}}else if(m(a)&&b==86){c._removeLabel(d,true);c._prepareInput(null,true)}else if(m(a)&&(b==90||b==89)){var h=b==90?c.history.undo():c.history.redo();if(h!=null){c.$source.val(h);c._removeAllLabels();c._initLabels();a.preventDefault();c._prepareInput()}}else if(n(b)){c._prepareInput()}});this.$container.bind("mousedown",function(a){var b=$(a.target);if(b.is(".js-remove-label")&&b.closest(".js-input-wrap").length){c.opts.noblur=true}});if(!c.opts.labelsOneClick){this.$container.delegate(".js-compose-label","dblclick",function(a){c._prepareInput($(a.target).closest(".js-compose-label"));a.preventDefault()})}if(i.msie){this.$container.delegate(".js-compose-label","selectstart",function(a){a.preventDefault()})}if(c.opts.showSuggestsOnClick){var e=function(){var a=c.opts.popularSuggestsListLength,b=window.patron&&patron["MaxRecipients"]||30,d=c.suggest.localData.all().slice(0,b);if(c.suggest.opts.ignoreUsedData){c.suggest.ignoreUsed(c._getSuggestWords());d=c.suggest.opts.filterUsed(d,c.suggest.usedMap)}d=d.slice(0,a);d.__nooverride=true;c.suggest.ajsSuggest.showSuggests("",false,d,true)};this.$container.bind("mouseup",function(a){var b=$(a.target),d=b.closest(".js-compose-label");if(!d.length&&!c.$input.val()&&!c.suggest.isExpanded()){c.timeoutIds["showSuggestsOnClick"]=setTimeout(e,200)}})}this.$container.delegate(".js-compose-label","mouseenter",function(a){c._showTooltip($(a.target).closest(".js-compose-label"))}).delegate(".js-compose-label","mouseleave",function(){c._hideTooltip()});this._resizeObserver=c._updateInputWidth.debounce(500,c);this.$container.bind("change",function(a){if(!$(a.target).is(":visible"))return;c.opts.inputMaxWidth=c.$container.width()-11;var b=c.$container.find(".js-compose-label:visible:eq(0)").add(c.$input).first();c.opts.inputIndent=b.offset().left-c.$container.offset().left;c._updateInputWidth(true);c._resizeObserver()}).bind("inputfocus",function(a){c.opts.isActive=true}).trigger("change");d.bind("hide.layer",function(a,b){c._updateInputWidth(true)});$(document.body).bind("mousedown",function(a){if(!c.$container.has(a.target).length&&!c.suggest.block.has(a.target).length&&c.opts.isActive){if(c.opts.focusWhileDisabled){c.opts.focusWhileDisabled=false}c._updateSource();c.contactUtils.deselectAll();c.opts.isActive=false}});if(!i.msie){d.bind("blur.composelabels",function(){c.$input.trigger("blur",true)})}if(i.msie||i.opera){$(document.body).bind("keydown",function(a){if(c.opts.lockKeyboard&&c.opts.isActive){a.preventDefault()}})}this.$source.bind("focus",function(a){a.preventDefault();if(c.opts.disabled)c.opts.focusWhileDisabled=true;if(c.input!=document.activeElement)c._prepareInput()}).bind("clearPreviousValue change",function(){c._removeAllLabels();c._initLabels()})},_initHistory:function(){this.history={stack:[],pointer:-1,checkpoint:function(a){var b=this.stack,c=this.pointer,d=this._getState(c);a=a.replace(/,\s*$/,"");if(d!==null){if(a!=d){c=++this.pointer;b.splice(c,b.length-c,a)}}else{b.push(a);this.pointer++}},undo:function(){var a=this._getState(this.pointer-1);if(a!==null){this.pointer--}return a},redo:function(){var a=this._getState(this.pointer+1);if(a!==null){this.pointer++}return a},clear:function(){this.stack=[];this.pointer=-1},_getState:function(a){var b=this.stack;if(a>-1&&a<b.length)return b[a];else return null}};this.history.checkpoint(this.$source.val())},_initWidget:function(){var a=this;this.$container.data(this.namespace,{togglePrehide:function(b){var c=a.$container.find(".js-compose-label");if(b){if(c.length>3){c.slice(4).display(0);a._updateToggler(true,c.length-3)}}else{c.slice(1).display(1);a._updateToggler(false)}},getUsed:function(b){return a._getSuggestWords(b)},setInvalid:function(b){a.$container.find('[data-text="'+b+'"]').toggleClass("compose__labels__label_invalid",true)},getSelected:function(){var b,c;return Array.map(a.contactUtils.getSelected(),function(a){b=t($(a));c=r(b);return c.email?c:{name:"",email:c}})},getSelectedText:function(){return a._getText(a.contactUtils.getSelected())},deselectAll:function(){a.contactUtils.deselectAll()},select:function(b,c){a.contactUtils.select(b,true)},clear:function(){a._removeAllLabels();a.$source.val("")},redraw:function(){a._removeAllLabels();a.history.clear();a._initLabels();this.invalidLabelCounted=false},isValid:function(){return!a.contactUtils.getAll().filter(".compose__labels__label_invalid").length},blur:function(){a.$input.trigger("blur",true)},disable:function(b){a.opts.disabled=b},getChangedContacts:function(){return a.changedContacts},clearChangedContacts:function(){a.changedContacts={}},clearOriginContacts:function(){a.originalContacts={}},hasGroups:function(){var b=false;Array.some(a.contactUtils.getAll(),function(a){if($(a).hasMod("group")){b=true}return b});return b},hasFromInbox:function(){var b=false;Array.some(a.contactUtils.getAll(),function(a){if($(a).attr("data-from-inbox")){b=true}return b});return b},hasSelectedGrouds:function(){var b=false;Array.some(a.contactUtils.getSelected(),function(a){if($(a).hasMod("group")){b=true}return b});return b},destroy:function(){a.destroy();a.$container.removeData(a.namespace)}})},destroy:function(){this.$source.unbind();this.$container.unbind();this.$input.unbind();this.history.clear();this._removeAllLabels();this.$source.val("");Object.forEach(this.timeoutIds,function(a){clearTimeout(a)});this.timeoutIds={}},_updatePlaceholder:function(a,b,c){var d="";var e=this.$input.val();if(this.opts.placehold_on_suggest&&b){var f=a.data[a.field],g=a.position;if(f){while(e[d.length]===" "){d+=" "}d+=b+f.substring(g.end);var h=this.$input.position();this.$inputPlaceHolder.attr("style",this.$input.attr("style")).css({top:h.top,left:h.left})}}if(arguments.length===3){this.$inputPlaceHolder[c?"show":"hide"]()}this.$inputPlaceHolder.val(d)},_updateSource:function(){var a=this._getText(this.contactUtils.getAll());this.$source.val(a);this.$source.trigger("composeLabelsChange");this.history.checkpoint(a)},_getText:function(a){var b=[];var c;Array.forEach(a,function(a){c=$(a);if(c.length)b.push(t(c))});b=b.filter(function(a){return $.trim(a).length>0});if(b.length==1){b[0]+=","}return b.join(", ")},_setDataSource:function(){},_getSuggestWords:function(a){var c=[],d=this.suggest.opts,e;Array.forEach(this.contactUtils.getAll(),function(a){e=$(a);if(e.length){if(e.hasMod("group")){var f=t(e);var g=b.ui.suggest.getSuggestWords(f,d.suggestSeparator,d.suggestEscapeStart,d.suggestEscapeEnd);c=c.concat(g)}else{c.push(t(e))}}});return a?c.filter(function(a){return $.trim(a).length>0}):this._getSuggestWords_after(c)},_getSuggestWords_after:function(a){return a.map(function(a){return p(a)}).filter(function(a){return $.trim(a).length>0})},_checkTextValidity:function(a){var b={valid:false,str:a,name:"",email:"",newLabel:null};var c=a.match(e),d=c?c[0]:a,f=a;if(o(a)){if(p(a)==a&&a!=d&&a.match(/\s|"/)){var h=a.length,i=Math.max(a.lastIndexOf(" "),a.lastIndexOf('"'))+1,j=false;while(!j){if(a.substring(i,h).match(e)){j=true}else{if(a.charAt(i-1)==" ")h=i;i=a.substring(0,i-1).lastIndexOf(" ")+1}if(h<=0){break}}if(j){var k=a.substring(0,i).replace(/(^\s+|\s+$)/g,"");if(k.length>0||h<a.length){if(h<a.length){b.newLabel=a.substring(h)}b.str=a=k+" <"+a.substring(i,h).replace(/[<>\s]/g,"")+">"}}}if(d!=a){f=q(a).replace(/(^\s+|\s+$)/g,"");if(f.length>0&&f!=a){d=p(a);b.valid=true;b.name=f;b.email=d;if(!a.match(g)){if(a.match(/^\s*"/)){b.str='"'+f+'" <'+d+">"}else{b.str=f+" <"+d+">"}}}else if(f.length==0){b.valid=true;b.str=b.email=d;b.name=""}else{var l=a.replace(e,"");if(l.match(/^["'<>()]+$/)){b.valid=true;b.str=b.email=d;b.name=""}else{b.str=a;b.name=b.email="";b.valid=false}}}else{b.valid=true;b.str=b.email=d;b.name=""}if(b.valid){}}return b},_validateLabelText:function(a,b){var c=this._checkTextValidity(b),d=!c.valid?c.str:c.name?c.name:c.email;a.attr("data-text",c.str).find(".js-label-text").text(d);if(c.newLabel){setTimeout(function(){this._createLabel(c.newLabel)}.bind(this),1)}if(!c.valid){a.addClass("compose__labels__label_invalid");if(!this.invalidLabelCounted){j.radar("s_show_invalid");this.invalidLabelCounted=true}u()}return d},_prepareInput:function(a,c){var d=this.$input,e=d.closest(".js-input-wrap"),f;this.opts.lockKeyboard=true;if(a==undefined){if(!this.opts.focusWhileDisabled)d.val("");this.$container.append(d);if(e.length){this._removeLabel(e,true)}var g=this.contactUtils.getAll().last();if(g.length&&g.hasMod("invalid")&&!g.hasMod("group")){d.val(t(g));this._removeLabel(g,true)}}else{if(e.length&&d.val()){this._createLabel(d.val())}var h=a.find(".js-label-text");f=t(a)||h.text();d.val(f);h.hide().before(d);a.removeClass().addClass("js-input-wrap compose__labels__label compose__labels__label_edit");this._destroyFilin(a);var i=a[0].style["max-width"]||a[0].style["maxWidth"];if(i){a.attr("data-max-width",i).css("max-width",8e3+"px")}var j=r(f);if(this.originalContacts[j.email]===undefined){this.originalContacts[j.email]=j.name}a.removeAttr("data-from-inbox");this.$source.trigger("composeLabelsEditStart")}this.opts.noblur=true;this.contactUtils.deselectAll();d.show();this._updateInputWidth();this._hideTooltip(true);if(c&&a===null){this.opts.noblur=false;d.focus();this.opts.lockKeyboard=false}else{setTimeout(function(){this.opts.noblur=false;d.focus();if(this.opts.labelsOneClick&&f){if(o(f)){var a,c,e;a=q(f);c=f.indexOf(a);e=c+a.length;b.$.setCaretPosition(this.input,c,e)}else{b.$.setCaretPosition(this.input,0,f.length)}}else{f=d.val();b.$.setCaretPosition(this.input,f.length,f.length)}this.opts.lockKeyboard=false}.bind(this),10)}},_updateInputWidth:function(a){var b=this.$input,c=6,d,e;if(!this.$inputClone){this.$inputClone=$("<span/>").attr({tabindex:-1,class:b.attr("class"),style:b.attr("style")}).css({overflow:"hidden",position:"absolute",marginLeft:-1e4,marginTop:-1e4,"max-width":"",width:"auto"}).appendTo(this.$container)}var f=this.opts.inputMaxWidth;if(b.closest(".js-input-wrap").length){f-=18}b.css("max-width",f);this.$inputClone.text(this.$input.val());d=this.$inputClone[0].scrollWidth;e=d+c;if(!a&&!this.$input.closest(".js-input-wrap").length){b.width(e);var g=b.offset().left,h=this.$container.offset().left,i=this.$container.width(),j=17-this.opts.inputIndent;e=Math.max(e,i-g+h-j)}b.width(e);if(b.closest(".js-input-wrap").length&&e>f){var k=d-f;if(k<=5||!(b[0].style["margin-right"]||b[0].style["marginRight"])){b.css("margin-right",Math.min(k,5)+"px")}}else if(b[0].style["margin-right"]||b[0].style["marginRight"]){b.css("margin-right","")}},_getInputWrap:function(){return this.$input.closest(".js-input-wrap").length?this.$input.closest(".js-input-wrap"):this.$input},_createLabel:function(a,b){a=a.replace(/(^\s+|\s+$)/g,"").replace(/(^,*|,*$)/g,"");if(a.length){this.opts.noblur=true;var c=this.$input.closest(".js-input-wrap"),d;if(c.length){d=true;var e=t(c);c.removeClass().addClass("js-compose-label compose__labels__label");c.attr("data-text",a).find(".js-label-text").text(a).show();if(c.attr("data-max-width"))c.css("max-width",c.attr("data-max-width"));if(e!=a){j.radar("s_edit")}}else{c=this.$container.find(".js-compose-label:first").clone();c.css("display","");this.$input.before(c)}var f=this._validateLabelText(c,a);a=t(c);this._removeDuplicate(a,c[0]);if(d){var g=r(a);if(this.originalContacts[g.email]!==g.name){this.changedContacts[g.email]=g.name}else{delete this.changedContacts[g.email]}}var h=this.opts.blockMaxWidth||350,i=Math.round(h*1.2/5);if(f.length>i){f=f.slice(0,i);c.find(".js-label-text").text(f)}this._createTooltip(c);this.$input.val("").width(1);this.$container.append(this.$input);if(b===undefined)this._updateSource();this.opts.noblur=false;if(d){this.$source.trigger("composeLabelsEditEnd")}}else if(this.$input.closest(".js-input-wrap").length){var k=this.$input.closest(".js-input-wrap");this.$container.append(this.$input);this._removeLabel(k,true)}if(this.opts.focusWhileDisabled&&!b){this.opts.focusWhileDisabled=false}return c},_createGroup:function(a){var b=this.$container.find(".js-compose-label:first").clone();new c(b,a,this.suggest,this.opts,{onExpand:function(){this._hideTooltip()}.bind(this),onChange:function(a){this._updateSource();if(!a){this._removeLabel(b)}else{this._updateInputWidth()}}.bind(this)});this.$input.val("").width(1);this.$container.append(this.$input);this.$input.before(b);this._updateSource();j.radar("s_create_group")},_removeLabel:function(a,b){if(!a.length){return}var c=this;var d=p(t(a)).email;if(c.changedContacts[d]){delete c.changedContacts[d]}var e=a.data("group");if(e){e.destroy()}if(b){a.remove();c._updateSource()}else{var f=a.length;if(i.msie)a.find(".js-remove-label").hide();a.removeClass("js-compose-label");a.fadeOut("fast",function(){$(this).remove();if(--f<1){c._updateSource();c._updateInputWidth()}c._hideTooltip(true)})}},_removeAllLabels:function(){this.contactUtils.getAll().remove();this._hideTooltip(true)},_removeDuplicate:function(a,b,c){if(a){this.contactUtils.getAll().filter(":visible").each(function(){if(this!=b&&!$(this).hasMod("group")){var d=t($(this));if(p(d)==p(a)){if(c){$(this).fadeOut("slow",function(){$(this).remove()})}else{$(this).remove()}}}})}},_updateToggler:function(a,b){this.$toggler.find(".js-label-text").text("и еще "+b+" отправителей");this.$toggler.display(a);this.$toggler.insertBefore(this.$input)},onSelect:function(a,b){if(!b&&!a.hasMod("group")&&(this.opts.labelsOneClick||a.hasMod("invalid"))){this._prepareInput(a)}else{a.focus()}},onMousedown:function(a){var b=$(a.target),c=b.closest(".js-compose-label"),d=!c.length&&!this.$input.val();this.opts.blurred=false;if(d){this.opts.preventTooltips=true;if(document.activeElement!=this.input){this._prepareInput()}}return d},onMousemove:function(a){if(!this.opts.blurred){if(k){k.forEach(function(a){if(a.is(":visible")){var b=a.data(this.namespace);if(b)b.blur()}}.bind(this))}else{this.$input.trigger("blur",true)}this.opts.blurred=true}},onMouseup:function(a,b){this.opts.preventTooltips=false;if(!b&&document.activeElement!=this.input){this._prepareInput()}},onBlur:function(a){return false},onBeforeCopy:function(a){return a.target!=this.input},_createFilin:function(a,b){var c=a.find(".compose__labels__label__avatar"),d=String.sprintf("//filin.mail.ru/pic?width=45&height=45&email=%s&name=%s",b.email,b.name);c.attr("src",d);c.display(1)},_destroyFilin:function(a){var b=a.find(".compose__labels__label__avatar");b.display(0)},_createTooltip:function(a){if(a.hasClass("compose__labels__label_invalid")){this._destroyFilin(a);return}var b=t(a);b=s(b);var c={name:b,email:""};var d=b.match(f);if(d){c.name=d[1];c.email=d[2];if(this.opts.compose2){this._createFilin(a,c)}}else{this._destroyFilin(a)}a.data("tooltip",this.suggest.opts.template(null,{data:c}))},_showTooltip:function(a){if(~this.opts.toolTipShowTimeout){clearTimeout(this.opts.toolTipShowTimeout);this.opts.toolTipShowTimeout=-1}if(this.opts.preventTooltips||this.opts.groupExpanded||this.suggest.isExpanded()||!a.data("tooltip")){return}this.opts.toolTipShowTimeout=setTimeout(function(){this.opts.toolTipShowTimeout=-1;var b=this.suggest.block,c=this.suggest.list;c.empty();c.append(a.data("tooltip")).show();this.opts.hasTooltip=true;this.suggest.block.unbind("mouseenter.tooltip").bind("mouseenter.tooltip",function(a){this.suggest.block.stop(true).css("opacity","1").show();if(i.msie&&!this.$input.val())this.$input.blur()}.bind(this)).unbind("mouseleave.tooltip").bind("mouseleave.tooltip",function(a){this._hideTooltip()}.bind(this));if(a.hasMod("group")){this.suggest.block.unbind("click.tooltip").bind("click.tooltip",function(a){var b=a.data("group");if(b.dropdown){b.dropdown.expand()}}.bind(this,a))}var d=a.offset(),e=this.suggest.getOffset(),f=typeof this.suggest.opts.width=="string"||this.suggest.opts.width>0?this.suggest.opts.width:Math.max(a.width(),100),g=typeof this.suggest.opts.width=="string"?parseInt(f)||parseInt(f.slice(0,-2)):f,h=this.opts.margin?this.opts.margin:7,j=this.$container.offset().left+this.$container.width()+this.opts.suggestMaxExcess;b.css({width:f,top:d.top+a.height()+h-e.top,left:(d.left+g>j?Math.max(j-g,this.$container.offset().left):d.left)-e.left,zIndex:66e3}).stop(true).css("opacity","1").fadeIn("fast");this.$source.trigger("composeLabelsTooltipShow")}.bind(this),500)},_hideTooltip:function(a){if(~this.opts.toolTipShowTimeout){clearTimeout(this.opts.toolTipShowTimeout);this.opts.toolTipShowTimeout=-1}if(this.opts.hasTooltip){if(a){this.opts.hasTooltip=false;this.suggest.block.stop(true,true).unbind("mouseenter.tooltip").unbind("mouseleave.tooltip").unbind("click.tooltip").hide();this.$source.trigger("composeLabelsTooltipHide")}else{this.suggest.block.fadeOut(function(){this.opts.hasTooltip=false;this.suggest.block.unbind("mouseenter.tooltip").unbind("mouseleave.tooltip").unbind("click.tooltip");this.$source.trigger("composeLabelsTooltipHide")}.bind(this))}}},_initDragNDrop:function(){var a=this,b=".js-compose-labels",c=".js-compose-label",d=".drag",e=".dragstart",f=$(document.body),g=$(document),h,i=null,j=function(){var a=document.createElement("x"),b=document.documentElement,c=window.getComputedStyle,d;if(!c||!("pointerEvents"in a.style)){return false}a.style.pointerEvents="auto";a.style.pointerEvents="x";b.appendChild(a);d=c&&c(a,"").pointerEvents==="auto";b.removeChild(a);return!!d}();if(window.$Scroll){if(window.$ScrollElement){f=$Scroll.normal?$(document.body):$ScrollElement}else{jsCore.wait("patron.ready",function(){f=$Scroll.normal?$(document.body):$ScrollElement})}}function l(b){var c=q(b);g.bind("mousemove"+d,function(a){a.preventDefault();var d=Math.min(a.pageX,$(window).width()-c.width()+$(window).scrollLeft());var e=Math.min(a.pageY,$(window).height()-c.height()+$(window).scrollTop());c.css({left:d-b.mousePosition.left+$(window).scrollLeft()+"px",top:e-b.mousePosition.top+$(window).scrollTop()+"px"})}).bind("mouseup"+d,function(a){f.css("pointer-events","auto");if(h){h=f.find(".js-drag-area-background");h.display(0).remove();h=null}a.preventDefault();g.unbind("mousemove"+d).unbind("mouseup"+d).unbind("dragstart"+d+" drag"+d);m(r(a),b)}).bind("dragstart"+d+" drag"+d,function(a){a.preventDefault()});if(!j&&!h){h=$('<div class="js-drag-area-background"></div>').css({position:"absolute",left:0,top:0,width:100+"%",height:100+"%",zIndex:49999,"background-color":"#000",opacity:.001})}if(h){f.append(h)}f.css("pointer-events","none").append(c);a._hideTooltip(true);return c}function m(c,d){i=f.find(".js-drag-item");i.display(0).remove();i=null;var e=c.closest(b);if(!e.length||$.contains(e[0],d[0])){}else{d=a.contactUtils.getSelected();e.data(a.namespace).drop(d);a._removeLabel(d)}}function n(a){g.bind("mousemove"+e,function(b){b.preventDefault();var c=o(b,a),d=3;if(Math.abs(c.left-a.mousePosition.left)>d||Math.abs(c.top-a.mousePosition.top)>d){s();g.unbind("mousemove"+e);g.unbind("mouseup"+e);g.unbind("selectstart"+e);i=l(a)}}).bind("mouseup"+e,function(a){s();g.unbind("mousemove"+e);g.unbind("mouseup"+e);g.unbind("selectstart"+e)}).bind("selectstart"+e,function(a){a.preventDefault()})}function o(a,b){var c=b.offset();return{left:a.pageX+$(window).scrollLeft()-c.left||0,top:a.pageY+$(window).scrollTop()-c.top||0}}function p(a){var b,c=a.clone().addClass("compose__labels__drag").css({position:"absolute",top:"-10000px",left:"-10000px"});b=c.appendTo("body").outerWidth();c.remove();return b}function q(b){var c;a.contactUtils.select(b,true);var d=a.contactUtils.getSelected();if(d.length>1){var e=a.opts.compose2?"+"+(d.length-1):d.length;var f={height:"19px",top:2,left:4,right:4,zIndex:99,margin:0,padding:0},g={zIndex:98},h=$('<div class="compose__labels__label compose__labels__drag"/>');if(a.opts.compose2){f.backgroundColor=g.backgroundColor="#fff";f.top=5;f.right=3;f.left=3;g.top=7;g.right=6;g.left=6}h.css(f);if(d.length>2){h=h.add(h.clone().css(g))}c=$("<div/>").width(p(b)).append(b.clone().addClass("compose__labels__drag").css({top:0,left:0,"z-index":100,margin:0})).append(h).append($('<div class="compose__labels__drag__cnt"/>').text(e)).attr("data-text",a._getText(d))}else{c=b.clone()}var i=b.offset();c.addClass("js-drag-item").css({position:"absolute",left:i.left+"px",top:i.top+"px",zIndex:5e4,"pointer-events":"none"});return c}function r(a){var b=$(a.target);if(j){b=$(document.elementFromPoint(a.pageX-(window.$Scroll&&$Scroll.normal?$(window).scrollLeft():0),a.pageY-(window.$Scroll&&$Scroll.normal?$(window).scrollTop():0)))}else{k.forEach(function(c){if(c.is(":visible")){var d=c.offset(),e=d.left-$(window).scrollLeft(),f=d.top-$(window).scrollTop();if(a.pageX>=e&&a.pageY>=f&&a.pageX<=e+c.width()&&a.pageY<=f+c.height()){b=c;return false}}})}return b}function s(){k.forEach(function(b){if(b.is(":visible")){var c=b.data(a.namespace);if(c)c.blur()}})}this.$container.data(this.namespace,$.extend({},a.$container.data(this.namespace),{drop:function(b){Array.forEach(b,function(b){var c=$(b);var d=c.hasMod("group");if(d){var e=c.data("group");a._createGroup({id:e.data.id,name:e.data.name,contactsPlain:e.data.contactsPlain,contacts:e.data.contacts})}else{a._createLabel(c.attr("data-text"))}});a._prepareInput()},toggleDragNDrop:function(b){a.opts.dragNDropEnabled=!!b}}));this.$container.delegate(c,"mousedown",function(b){if(a.opts.dragNDropEnabled&&!i&&b.which==1){b.preventDefault();var d=$(b.target).closest(c);d.mousePosition=o(b,d);n(d)}});k.push(this.$container)}};v.suggestToEmail=p;v.suggestToName=q;v.normalizeContact=s;v.validateContact=function(a){return v.prototype._checkTextValidity.call(this,a)};return v});define("suggests/template",function(){(function(){var a=Function("return this")();if(!a.fest)a.fest={};a.fest["suggests"]=function(a){"use strict";var b=this,c=[],d=[],e,f=[],g,h,i,j,k,l=[],m={},n,o,p="",q="",r="",s=/[&<>"]/g,t=/[&<>"]/,u={area:true,base:true,br:true,col:true,command:true,embed:true,hr:true,img:true,input:true,keygen:true,link:true,meta:true,param:true,source:true,wbr:true},v=[],w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},x=/[\\'"\/\n\r\t\b\f<>]/g,y=/[\\'"\/\n\r\t\b\f<>]/,z={'"':'\\"',"\\":"\\\\","/":"\\/","\n":"\\n","\r":"\\r","\t":"\\t","\b":"\\b","\f":"\\f","'":"\\'","<":"\\u003C",">":"\\u003E"},A;if(typeof __fest_error==="undefined"){A=typeof console!=="undefined"&&console.error?function(){return Function.prototype.apply.call(console.error,console,arguments)}:function(){}}else{A=__fest_error}function B(a){A(a+'\nin block "'+r+'" at line: '+q+"\nfile: "+p)}function C(a){return w[a]}function D(a){return z[a]}function E(a,b){for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c]}function F(a){a.param=true;return a}function G(a,c,d){if(d)for(var e in c)if(typeof c[e]=="function"&&c[e].param)c[e]=c[e]();return a.call(b,c)}function H(a){if(typeof a==="string"){if(y.test(a))return a.replace(x,D)}else if(typeof a==="undefined")return"";return a}function I(a){if(typeof a==="string"){if(t.test(a))return a.replace(s,C)}else if(typeof a==="undefined")return"";return a}var J=a;(function(a){m["b-contact-label"]=function(a){var b=[];b.push('<span class="js-compose-label compose__labels__label"><span class="compose__labels__label__ico">');g="ico";n={};try{n={mods:["contact-label"]}}catch(a){B(a.message)}k=m[g];if(k)b.push(G(k,n,false));b.push('</span><img src="" alt="" class="compose__labels__label__avatar"/><span class="compose__labels__label__text js-label-text"></span><i class="icon icon_compose_label_close js-remove-label"></i></span>');return b.join("")}})(a);(function(a){m["b-userpic"]=function(a){var b=[];try{f[0]=I(a.pic)}catch(a){f[0]="";B(a.message)}b.push('<div class="b-userpic b-userpic_small" style="'+f[0]+'"></div>');return b.join("")}})(a);(function(a){m.ico=function(a){var b=[];b.push('<i data-bem="ico" class="ico');try{h=a.mods}catch(a){h=false;B(a.message)}if(h){b.push(" ");try{b.push(I("ico_"+a.mods.join(" ico_")))}catch(a){B(a.message+"11")}}try{h=a.classes}catch(a){h=false;B(a.message)}if(h){b.push(" ");try{b.push(I(a.classes.join(" ")))}catch(a){B(a.message+"16")}}b.push('"');try{h=a.attrs}catch(a){h=false;B(a.message)}if(h){g="attributes";n={};try{n=a.attrs}catch(a){B(a.message)}k=m[g];if(k)b.push(G(k,n,false))}b.push("></i>");return b.join("")}})(a);(function(a){m["b-correspondent"]=function(a){var b=[];b.push("<div");try{var c=["b-correspondent","js-dropdown-item"];if(window.patron&&patron.ContactInformerInLetter){c.push("js-contact-informer")}if(a.enabled===false){c.push("b-correspondent_disabled")}}catch(a){B(a.message)}b.push(' class="');try{b.push(I(c.join(" ")))}catch(a){B(a.message+"20")}b.push('"');try{h=a.attributes}catch(a){h=false;B(a.message)}if(h){try{var d=[];Object.keys(a.attributes).forEach(function(b){d.push({name:b,value:a.attributes[b]})})}catch(a){B(a.message)}var e,f,i,j;try{j=d||[];i=j.length}catch(a){j=[];i=0;B(a.message)}for(e=0;e<i;e++){f=j[e];try{g=f.name}catch(a){g="";B(a.message)}if(g!==""){b.push(" "+g+'="');try{b.push(I(f.value))}catch(a){B(a.message+"32")}b.push('"')}}}b.push('><div class="b-correspondent__pic">');try{h=a.group}catch(a){h=false;B(a.message)}if(h){g="ico";n={};try{n={mods:["suggest_group"]}}catch(a){B(a.message)}k=m[g];if(k)b.push(G(k,n,false))}else{g="b-userpic";n={};try{n=a}catch(a){B(a.message)}k=m[g];if(k)b.push(G(k,n,false))}b.push('</div><div class="b-correspondent__info ');try{h=!a.name&&!a.group}catch(a){h=false;B(a.message)}if(h){b.push("b-correspondent__info_center")}b.push('"');try{h=a.title}catch(a){h=false;B(a.message)}if(h){b.push(' title="');try{b.push(I(a.title))}catch(a){B(a.message+"60")}b.push('"')}b.push(">");try{h=a.group}catch(a){h=false;B(a.message)}if(h){b.push('<div class="b-correspondent__name">');try{b.push(a.group)}catch(a){B(a.message+"66")}b.push("</div>");try{h=a.count}catch(a){h=false;B(a.message)}if(h){b.push('<div class="b-correspondent__text">');try{b.push(I(i18n.plural(a.count,["контактов","контакт","контакта"]," ")))}catch(a){B(a.message+"69")}b.push("</div>")}}else{try{h=a.name}catch(a){h=false;B(a.message)}if(h){b.push('<div class="b-correspondent__name">');try{b.push(a.name)}catch(a){B(a.message+"74")}b.push('</div><div class="b-correspondent__text">');try{b.push(a.email)}catch(a){B(a.message+"76")}b.push("</div>")}else{b.push('<div class="b-correspondent__name">');try{b.push(a.email)}catch(a){B(a.message+"81")}b.push("</div>")}}b.push("</div>");try{h=a.enabled!==undefined}catch(a){h=false;B(a.message)}if(h){b.push('<div class="b-correspondent__state"><div class="b-correspondent__state-inner">');g="ico";n={};try{n={mods:["suggest_state",a.enabled?"suggest_disable":"suggest_enable"]}}catch(a){B(a.message)}k=m[g];if(k)b.push(G(k,n,false));b.push("</div></div>")}b.push("</div>");return b.join("")}})(a);try{g=J.block}catch(a){g="";B(a.message)}n={};try{n=J.params||J}catch(a){B(a.message)}d.push(c.join(""),{name:g,params:n,cp:false});c=[];j=d.length;if(j){i=0;for(;i<j;i++){e=d[i];if(typeof e==="string"){l.push(e)}else{k=m[e.name];if(k)l.push(G(k,e.params,e.cp))}}l.push(c.join(""));return l.join("")}else{return c.join("")}};if(a.jsLoader!==undefined&&a.jsLoader.loaded!==undefined&&typeof a.jsLoader.loaded==="function"){a.jsLoader.loaded("{festTemplate}suggests")}})()});define("ajs/__pager/ajs__pager",["ajs"],function(a){var b=function(a,b,c,d,e){c=parseInt(c)||1;e=e!==undefined?e:a.length;var f=$.noop;function g(){return{from:(c-1)*b,to:Math.min(c*b,e)}}function h(){return Math.ceil(e/b)}return{setUrlCreator:function(a){f=a},doesNeedWidget:function(){return!d&&h()>1},widgetParams:function(){var a=h();var b=[];var d=Math.max(c-(a-c<3?5-(a-c):3),0);var e=Math.min(d+5,a);for(var g=d+1;g<=e;g++){b.push(g)}return{prevPage:c>1?c-1:null,nextPage:c<a?c+1:null,lastPage:a,currentPage:c,doesNeed:{prevHellip:c>4&&a>6,nextHellip:a>6&&a-c>3,prevPage:c>1,nextPage:c<a,firstPage:a>5&&c>3,lastPage:a>5&&a-c>2},getUrl:function(a){return f(a)},pages:b}},setList:function(b){a=b},all:function(){return a},total:function(){return e},pageBorders:g,pagesCount:h,visible:function(){var b=g();return a.slice(d?0:b.from,b.to)},slice:function(){var b=g();return a.slice(b.from,b.to)},isNeedLoadNextSlice:function(d){return this.hasNext()&&a.length<e&&(d||a.length<=Math.min(c*b,e))},hasNext:function(){return c*b<e},hasPrev:function(){return c>1},next:function(){c++},prev:function(){c--}}};a.Pager=b;return b});define("ajs/__ui/ajs__ui",["ajs"],function(a){"use strict";var $=a["$"];var b=1;var c=$["_random_string_"],d="uuid"+c,e=$.own,f="noprop_"+d,g=["target","preventDefault","isDefaultPrevented","stopImmediatePropagation"],h=Object.isPlainObject,i=$.extend,j=$.__processHandler;function k(){this._asynchMarkers={}}i(k.prototype,{constructor:k,buildClassName:function(a,b){b=b||this.$Elm;var c,d,e;if((e=a.indexOf("&"))!=-1){if((c=b["selector"])&&((d=c.charAt(0))==="."||d==="#")){a=(e>0?a.substr(0,e):"")+c.substr(1)+a.substr(e+1)}else{a=""}}return a},findSub:function(a){var b=this.$Elm,c;if(typeof a==="string"){if((c=a.charAt(0))&&c!=="."&&c!=="#"&&c!=="["){a="."+a}a=this.buildClassName(a)}return new $(a,b)},hasTrigger:function(a){var b=this["_"],c,d;if(b&&(c=b["__events__"])){a=a.toUpperCase().split(" ");while(d=a.pop()){if(d in c){return true}}}return false},addTrigger:function(a,e){var f=this["_"],g,h,i;if(e){if(!f){f=this["_"]={}}a=a.toUpperCase().split(" ");g=f["__events__"];if(!g){g=f["__events__"]={}}while(i=a.pop()){if(!g[i]){h=g[i]={}}else{h=g[i]}if(!e[d]&&(e[d]=c+ ++b)||!(e[d]in h)){h[e[d]]=e}}}return this},removeTrigger:function(a,b){var c=this["_"],e,f;if(!c||!b||!b[d]||!(e=c["__events__"])){return this}a=a.toUpperCase().split(" ");while(f=a.pop()){if(!(f=e[f])||!(b[d]in f)){continue}delete f[b[d]]}return this},fireTrigger:function(a){var b=this,c=b["_"],d,k,l,m=a&&typeof a=="object",n=m&&a["type"]||a,o,p=false,q=false,r,s=true,t=!c||!(d=c["__events__"])||(!n||!(d=d[n.toUpperCase()]));if(r=this._nextTriggerOptions){if(n in r){if(m){i(a,r[n])}delete r[n]}}if(t){return s}if(!m){a={type:a}}if(a["name"]===void 0||a["namespace"]===void 0){r=n.split(":");if(!a["name"]){a["name"]=r[1]||r[0]}if(!a["namespace"]){a["namespace"]=r.length?r[0]:""}}r=Array.reduce(g,function(b,c){b[c]=c in a?a[c]:f;return b},{});a["currentTarget"]=a["target"]=this;o=a.preventDefault;a.preventDefault=function(){if(o)o.apply(this.context,arguments);p=true};a["isDefaultPrevented"]=function(){return p};a.stopImmediatePropagation=function(){if(r["stopImmediatePropagation"])r["stopImmediatePropagation"].apply(this.context,arguments);else if(this.stopPropagation)this.stopPropagation();q=true};for(k in d)if(e(d,k)){l=d[k];if(typeof l==="object"){b=l}l=j(l);if(l&&(s=l.call(b,a))===false){a.preventDefault()}if(q)break}if(s!==false&&a["isDefaultPrevented"]()){s=false}Array.reduce(g,function(b,c){if(b[c]===f){delete a[c]}else{a[c]=b[c]}return b},r);if(h(c=a["nextTriggerOptions"])){if(!(r=this._nextTriggerOptions)){r=this._nextTriggerOptions={}}for(k in c)if(e(c,k)&&h(b=c[k])){if(!r[k]){r[k]={}}i(r[k],b)}}r=a=l=b=q=p=n=m=d=c=null;return s!==false},_callAfterTrigger:function(a){return this.fireTrigger(a,a["type"]+":AFTER")},disable:function(){this.__disabled=true},enable:function(){this.__disabled=false},_callTriggerFunctionAsync:function(){var a=this,b=a["currentTarget"];if(a["result"]===false||a["async"]!==true||!b._asynchMarkers||a["_asynchMarker"]!==b._asynchMarkers[a.type]){return}if(!(b instanceof k))return;b._asynchMarkers[a.type]=null;if(a.type in b){b[a.type](a)}}});if(!a["ui"]){a["ui"]={}}a["ui"]["ajsUIComponent"]=k;return a["ui"]});define("ajs/__ui__suggest/ajs__ui__suggest",["ajs","ajs/__ui/ajs__ui"],function(a,b){"use strict";var $=a["$"];var c=document;var d=encodeURIComponent,e=String.prototype.split,f="1_1".split(/(_)/).length!=3?function(a,b){var c=this;if(!(a instanceof RegExp)){if(a===void 0&&b===0)return[];return e.call(c,a,b)}var d=[],f=(a["ignoreCase"]?"i":"")+(a["multiline"]?"m":"")+(a["extended"]?"x":"")+(a["sticky"]?"y":""),g=0,h,i,j;a=new RegExp(a.source,f+"g");c+="";b=b===void 0?-1>>>0:b>>>0;if(!b){return[]}while(h=a.exec(c)){i=h.index+h[0].length;if(i>g){d.push(c.slice(g,h.index));if(h.length>1&&h.index<c.length){d.push.apply(d,h.slice(1))}j=h[0].length;g=i;if(d.length>=b){break}}if(a.lastIndex===h.index){a.lastIndex++}}if(g===c.length){if(j||!a.test("")){d.push("")}}else{d.push(c.slice(g))}return d.length>b?d.slice(0,b):d}:e,g=a.HTML.escape,h=a["ui"]["ajsUIComponent"],i=Object.isObject;function j(a){return String(a||"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function k(){}k.prototype={constructor:k,cnInput:"js-input",cnSuggest:"js-suggest",cnList:"&__suggest__inner",cnItem:"&__suggest__item",cnItemTick:"&__suggest__item__tick",cnSelected:"&__suggest__item_selected",cnInternetCont:"&__suggest__item_internet",cnInternet:"&__suggest__item_internet-link",cdGroupHeader:"&__suggest__group-header",cdSuggestHint:"&__suggest__item__hint",getData:function(a){var b=a&&a["data"]||a;return b&&b[1]=="OK"&&b[2]},template:function(a,b){var c=(i(b)&&(b["suggest"]||b["text"]||b["word"])||b||"")+"",d=(i(b)&&(b["text"]||b["word"])||b||"")+"";d=g(d);c=g(c);a=g(a);d=d.replace(new RegExp(a,"i"),'<b class="'+this.opts["cnItemTick"]+'">$&</b>');return'<div data-suggest="'+c+'" class="'+this.opts["cnItem"]+'">'+d+"</div>"},groupHeaderTemplate:function(a){return'<div class="'+this.opts["cdGroupHeader"]+'">'+a+"</div>"},templateInternetVal:function(a){return g(a)},request:function(a,b,c){$.get(a,b)},multiSuggests:false,suggestSeparator:/\s/g,suggestEscapeStart:null,suggestEscapeEnd:null,getSuggest:function(a){return a.trim()},setSuggest:$.noop,minLength:1,maxLength:0,timeout:300,expire:0,autosubmit:true,ajaxUrl:void 0,searchUrl:"http://go.mail.ru/search?q=#query#",encodeBeforeSend:true,showInternet:true,showAdvanced:false,ondraw:$.noop,grouping:false,fetching:false,fetchCount:30,markByMouseOver:true,autoMarked:-1,undeterminedStage:true,selectInputDiff:false,selectByTab:false,hideInactive:true,useCache:true,searchLast:false,findLastWord:/^.*\s+/,ondata:$.noop,onprint:null,onexpand:$.noop,onsearch:$.noop,onselect:$.noop};function l(a,b){b["data"]=a.call(this,b["data"],b["findValue"],b)}function m(a,b,c){var d=c["searchLast"],e=c["findLastWord"];if(!d)return a;if(typeof e==="function"&&!e.test&&e.call)a=e.call(this,b,this);else a=b.replace(e,"");return a}function n(a,b,c){var d=c["searchLast"],e=c["findLastWord"],f;if(!d)return b;f=this.__prevSuggest;b=$["trim"](b.replace(new RegExp(j(f&&f.val||"")+"$"),"")+this.__val).replace(/\S+$/,"")+""+(f.val=a);if(b!="")b+="";return b}function o(a,b){if(!(this instanceof o)){return new o(a,b)}o.superclass.apply(this);a=$(a,void 0);if(a.size()>1){this.__others=Array.reduce(a,function(a,c,d){if(d){a.push(new o(c,b))}return a},[this])}this.__prevSuggest={};this.__expandedState=false;var c=b["suggestSeparator"],d=b["multiSuggests"],e=b["suggestEscapeStart"],f=b["suggestEscapeEnd"];if(c!=null){c=b["suggestSeparator"]=new RegExp(c instanceof RegExp?c.source:c+"",(c["ignoreCase"]?"ig":"g")+(c["multiline"]?"m":""))}if(d===void 0){if(b["searchLast"]){b["getSuggest"]=m;b["setSuggest"]=n}}if(e&&f){if(!(e instanceof RegExp)){b["suggestEscapeStart"]=new RegExp("(?:[^\\\\]|^)"+e)}if(!(f instanceof RegExp)){b["suggestEscapeEnd"]=new RegExp("(?:[^\\\\]|^)"+f)}}else{b["suggestEscapeStart"]=b["suggestEscapeEnd"]=null}if(b["getData"]){this.addTrigger("suggests:getData",l.bind(this,b["getData"]))}if(b["afterGetData"]){this.addTrigger("suggests:getData:after",b["afterGetData"])}if(b["multiSuggests"]&&!b["setSuggest"]){b["setSuggest"]=function(a,b){return b}}this.opts=b=$.extend(new k,b);this._cache={};this.$Elm=a;this.$Input=null;this["applyToInput"](this.findSub(b["cnInput"]));this.$SuggestMouseDownClick=this.$SuggestMouseDownClick.bind(this);this.$Suggest=this.findSub(b["cnSuggest"]).bind("click mousedown",this.$SuggestMouseDownClick);this.hide=this.hide.bind(this);this.$InternetCont=this.findSub(b["cnInternetCont"]).bind("click",this.hide);this.$Internet=this.findSub(b["cnInternet"]);this.$InternetWrapper=this.findSub(b["cnInternetWrapper"]);this.$Advanced=this.findSub(b["cnAdvanced"]);this._onScroll=this._onScroll.bind(this);this._selectByClick=this._selectByClick.bind(this);this.$List=this.findSub(b["cnList"]).bind("click",this._selectByClick).bind("scroll",this._onScroll).bind("mousewheel DOMMouseScroll",this._onMouseWheel);if(b["markByMouseOver"]){this._suggestNodeMouseover=this._suggestNodeMouseover.throttle(100,this);this.$List.bind("mouseover",this._suggestNodeMouseover)}if(b["fetching"]){this._fetchOnScroll=this._fetchOnScroll.throttle(250,this);this.__$List_onscroll=function(a){a.preventDefault();a.stopPropagation();this._fetchOnScroll()}.bind(this);this.$List.bind("scroll",this.__$List_onscroll)}if(b["expire"]){this.__prevRequestTime=+new Date}$(window).bind("hashchange popstate",this);Array.forEach(["cnItem","cnItemTick","cnSelected","cdGroupHeader","cdSuggestHint"],function(a){var b=this.opts[a];if(b){this.opts[a]=this.buildClassName(b)}},this);this._timeoutHandler=function(){var a=this._timeoutFunction,b=this._timeoutArguments;this._timeoutFunction=this._timeoutArguments=null;if(a){if(Array.isArray(b)){a.apply(this,b)}else if(b!=null){a.call(this,b)}else{a.call(this)}}}.bind(this);b=null}$.inherits(o,h,{destroy:function(){var a=this["opts"];this["hide"]();this["applyToInput"](null,true);this.$Suggest.unbind("click mousedown",this.$SuggestMouseDownClick);this.$InternetCont.unbind("click",this.hide);this.$List.unbind("click",this._selectByClick).unbind("scroll",this._onScroll).unbind("mousewheel DOMMouseScroll",this._onMouseWheel);if(a["markByMouseOver"]){this.$List.unbind("mouseover",this._suggestNodeMouseover)}if(a["fetching"]){this.$List.unbind("scroll",this.__$List_onscroll)}this.$List.html("");$(window).unbind("hashchange popstate",this)},handleEvent:function(b,d){if(this.__disabled)return;var e=b.keyCode,f=this.opts,g=f["hideInactive"],h,i,j,k,l,m,n,o,p=true;if(d===void 0){d=d||b.type}h=+this.$Input.attr("data-prevent-event-"+d);if(h){--h;if(!h){this.$Input[0].removeAttribute("data-prevent-event-"+d)}else{this.$Input.attr("data-prevent-event-"+d,h)}return}this.blurred=c.activeElement!=this.$Input[0];if(this.blurred&&d!=="blur"){return}switch(d){case"hashchange":case"popstate":case"blur":if(!this._down||d!=="blur"){if(this._fireActiveEvent(false)!==false){this.blurred=true;if(g){n=this.__currentMarkedChangeValue;if(this.hide()!==false){if(n){this._onselect(b,n)}o=true}}}}else if(this._down){p=false;this._down=false;if(c.activeElement!==this.$Input[0]){this.$Input.attr("data-prevent-event-focus",1);this.$Input[0].focus();if(n=this.__bluredCaret){a.$.setCaretPosition(this.$Input[0],n["start"],n["end"])}this._findValue()}}break;case"keyup":case"keydown":k=this.isExpanded();if((e==38||e==40)&&k){if(d=="keydown"){this._mark(e==38?-1:0)}b.preventDefault();b.stopPropagation()}else if(e==39&&this.__currentMarkedChangeValue){this._onselect(b,this.__currentMarkedChangeValue)}else if(e==13||e==9&&f["selectByTab"]){if(e==9&&b&&b.ctrlKey){return}if(d=="keydown"&&k){if(this.__currentMarked){if(this._onselect(b,this.__currentMarked,true,f["autosubmit"],false,e==9||e==39)===false){}}else{this.hide()}}}else if(e==27){if(d=="keyup"){if(this.hide(b)!==false){this._findValue(null);b.preventDefault();o=true}}}else{d=d=="keyup"?"onprint":null;this.handleEvent(b,d);return}break;case"onprint":default:if(d==="focus"){if(this._fireActiveEvent(true)===false){return}}this._down=false;o=false;if((j=this._checkSomethingIsChanges())!==false){this.__currentMarkedChangeValue=this.__currentMarked=null;if(!f["useCache"]){this._cache={};l=null}else{l=this._cache[j]||null}m=f["expire"]&&this.__prevRequestTime>+new Date+f["expire"]*1e3;i={type:"suggests:find",originalEvent:b,findValue:f.maxLength>0?j.substr(0,f.maxLength):j,data:l,expire:m};i["val"]=i["findValue"];if(this.fireTrigger(i)!==false){this._loadVal=null;this._internetVal(j);j=j!=i["val"]?i["val"]:i["findValue"];if(l=i["data"]){this._cache[j]=l}if(d=="onprint"&&f["onprint"]){f["onprint"].call(this,j,this)}if(i["expire"]){this["reset"]();l=null}if(this._tid){clearTimeout(this._tid);this._tid=this._timeoutFunction=this._timeoutArguments=null}if(l){delete i["expire"];this._timeoutFunction=this._rebuild;this._timeoutArguments=i;this._tid=setTimeout(this._timeoutHandler)}else if(this._checkPrevResultIsNotEmpty(j,f)){this._timeoutFunction=this["find"];this._timeoutArguments=j;this._tid=setTimeout(this._timeoutHandler,f["timeout"])}}}}if(o&&this._tid){clearTimeout(this._tid);this._tid=this._timeoutFunction=this._timeoutArguments=null}if(p){this._delayedHideEnd()}},applyToInput:function(a,b){if(this.$Input){this.$Input.unbind("blur focus click keyup keydown",this)}if(a){this.$Input=$(a).attr("autocomplete","off").bind("blur focus click keyup keydown",this)}if(!b&&this.$Suggest&&this.isExpanded()){this._rebuild(this.__val)}},$SuggestMouseDownClick:function(a){this._down=a.type=="mousedown";if(this._down){this.__bluredCaret=$.getCaretPosition(this.$Input[0])}this._delayedHideStart()},_checkSomethingIsChanges:function(){var a=this._findValue(),b,c;if(c=this.__currentMarkedChangeValue){b=c.getAttribute("data-suggest");if(b==a){return false}}this.__prevSuggest.caret=this.__prevSuggest.val=null;return this._findValue()},_checkPrevResultIsNotEmpty:function(a,b){if(!b["useCache"]){return true}var c=a.length-1,d,e=this._cache;for(;c>=b["minLength"];c--){d=a.substr(0,c);if(e[d]!==void 0){return(d=e[d])&&d.length>0}}return true},_closest:function(a,b){var c=this.$List[0];do{if(a.nodeType==1&&"getAttribute"in a){b=a.getAttribute("data-suggest-idx");if(b>0){return a}}}while(a&&(a=a.parentNode)&&a!==c)},_suggestNodeMouseover:function(a){if(this.__disabled)return;var b=a.target,c;if(b.parentNode){c=this._closest(a.target)}if(c){this._mark(void 0,c,void 0,false,a)}},_selectByClick:function(a){if(this.__disabled)return;var b=this.opts,c=this._closest(a.target);if(c){if(this._mark(null,c,true,void 0,a)!==false){this._onselect(a,c,true,b["autosubmit"])}}return false},setSelIndex:function(a){return this._mark(void 0,void 0,void 0,false,null,a)},_mark:function(a,b,c,d,e,f){if(b!==void 0&&this.__currentMarked===b&&!!this.__currentMarkedChangeValue==d||this.__inFetching){return}var g=this.opts,h=this.$List,i=this.__currentMarked||this.__currentMarkedChangeValue,j,k,l,m=this.__ListItems,n,o,p,q,r,s,t,u,v;if(d===void 0){d=true}if(m){o=i&&i.getAttribute("data-suggest")||null;n=m.size();j=k=(i&&~~i.getAttribute("data-suggest-idx")||0)-1;if(!b){if(i){k+=a<0?-1:1}else{k=a<0?n-1:0}k=k>=n?-1:k;if(f){k=f}while(!b&&k<n&&k>=0){b=m[k];if(b&&b.style.display!="none"){}else{b=null;if(a<0){k--}else{k++}}}if(!b||k<0){k=-1;b=null}}else{k=~~b.getAttribute("data-suggest-idx")-1}u=this.__val;l=u!=null&&this._cache[u];if(!b&&a>-1&&j>-1&&g["fetching"]&&!l["EOF"]){if(this._fetchMore(a,this._mark.bind(this,a))!==false){return}}if(k>=n||k<0){if(!g["undeterminedStage"]){k=a<0?n-1:0;b=m[k]}}if(b){p=b.getBoundingClientRect();q=h[0].getBoundingClientRect();if(k==0){h[0].scrollTop=0}else if(p.top<q.top){h[0].scrollTop+=p.top-q.top}else if(p.bottom>q.bottom){h[0].scrollTop+=p.bottom-q.bottom}}r={type:"suggests:mark",oldSuggestIndex:j,oldSuggestData:j>=0&&l&&l[j]||null,oldSuggestNode:i,oldSuggest:o,newSuggestIndex:k,newSuggestData:k>=0&&l&&l[k]||null,newSuggestNode:b,newSuggest:o=b&&b.getAttribute("data-suggest")||null,updateInputValue:d,findValue:u,originalEvent:e||null};v=g["selectInputDiff"];if(d&&v){if(s=this.__prevSuggest.caret){s=s["end"]}else{s=u.length}t=s+(o||"").length}else{t=s=-1}r["caretPositionStart"]=s;r["caretPositionEnd"]=t;if(this.fireTrigger(r)!==false){o=r["newSuggest"];t=r["caretPositionEnd"];s=r["caretPositionStart"];void this._cancelMark();if(b){$.addClass(b,this.opts["cnSelected"]);this.__currentMarked=b;if(d!=(d=r["updateInputValue"])&&d&&v&&t===-1&&s===t){if(s=this.__prevSuggest.caret){s=s["end"]}else{s=u.length}t=s+(o||"").length}if(d=r["updateInputValue"]){this.__currentMarkedChangeValue=this.__currentMarked}}else{this.__currentMarkedChangeValue=this.__currentMarked=null}}else{return false}}else{o=i.attr("data-suggest")}if(d){this._findValue(o,null,d&&s>-1?s:void 0,d&&t>-1?t:void 0)}},_onselect:function(a,b,c,d,e,f){var g=this.opts,h=b.getAttribute("data-suggest"),i=b.getAttribute("data-suggest-idx")-1,j=this._cache[this.__val],k=this.$Input,l=this._getSuggestReplacement(),m=l?l.inputValue:k.val(),n={type:"suggests:select",newSuggest:h,newSuggestData:j&&j[i],newSuggestIndex:i,newSuggestNode:b,findValue:this.__val,inputValue:m,inputValueLeftPart:l?l.leftPart:"",inputValueRightPart:l?l.rightPart:"",inputSelectionStart:-1,inputSelectionEnd:-1,changeInputValue:!e,originalEvent:a||null,submitForm:d||false},o,p;if(!c||!d){$.removeClass(b,g["cnSelected"])}o=g["onselect"].call(this,n,this);if(o!==false){if((o=this.fireTrigger(n))!==false){this.__currentMarkedChangeValue=this.__currentMarked=null;if(n["changeInputValue"]){this._findValue(n["newSuggest"],l,(i=n["inputSelectionStart"])!=-1?i:void 0,(i=n["inputSelectionEnd"])!=-1?i:void 0)}if(a&&!f){a.stopPropagation();a.preventDefault()}if(n["submitForm"]){var q;if(q=k.closest("form")[0]){var r=q.length,s;while(r--)if((s=q[r])&&s.type=="submit"){s.click();break}}}p=true}if(!f)this.$Input[0].focus();if(p)this.hide()}this.__prevSuggest.caret=this.__prevSuggest.val=null;return o},_cancelMark:function(){var a=this.opts["cnSelected"],b=this.$List,c=b.find("."+a);if(c.length){c.removeClass(a)}return c},_loaded:function(a,b,d){if(!b&&c.activeElement!=this.$Input[0]){return}var e=this["opts"],f=e["hideInactive"],g={data:d,findValue:a,type:"suggests:getData"};g["suggestValue"]=a;if(this.fireTrigger(g)!==false){g["type"]+=":after";this.fireTrigger(g);this._cache[a]=d=g["data"];e["ondata"].call(this,a,d,this);if(b||this._loadVal==a&&(!f||!this.blurred)){this._rebuild(a,void 0,void 0,void 0,b===true)}}},_rebuild:function(a,b,c,d,e){if(b==null)b=-1;var f=this.opts,g=i(a),h=g?a["findValue"]:a,k=h!=null&&typeof h=="string",l=k&&this._cache[h]||[],m=l&&!!(l.length||l.toArray),n=b>-1?b+(c!=void 0?c:f["fetchCount"]):-1,o,p,q,r,s,t=f["grouping"],u,v,w={type:"suggests:rebuild",showContainer:e||m&&k,showList:m,showInternet:f["showInternet"],showAdvanced:f["showAdvanced"],data:l,findValue:h,dataFrom:b,dataTo:n,markedItem:f["autoMarked"]};v=g?$.extend(a,w):w;v["suggest"]=h;l=v["data"];if(!Array.isArray(l)&&l.toArray){l=l.toArray()}v["showList"]=m;v["showContainer"]=v["showContainer"]&&(v["showList"]||v["showInternet"]);if(v["showContainer"]){if(this.fireTrigger(v)!==false){b=v["dataFrom"];if(b===-1){}else{if(b===Infinity){b=this.__ListItems&&this.__ListItems.length-1}if(!d){d=this.__ListItems&&this.__ListItems[b]}}n=v["dataTo"];if(n===-1&&b!==-1){n=b>-1?b+(c!=void 0?c:f["fetchCount"]):-1}if(d||this.__val!==(h=v["findValue"]!=h?v["findValue"]:v["suggest"])){this.__inFetching=false;this.__currentMarked=d||null;this.__val=h;if(v["showList"]){o=b>-1?b+1:0;p=n>-1&&l.length>n?n+1:l.length;q=[];r=j(h);for(;o<p;o++){if(u=l[o]){if(t&&i(u)&&u["groupHeader"]){q.push($.trim(f["groupHeaderTemplate"].call(this,u["groupHeader"],r,u)))}q.push($.trim(f.template.call(this,r,u,o,l,h)))}}if(q.length){if(b>-1&&d){q=$(q.join(""));$(d).after(q);q=q.filter("."+f["cnItem"]);this.__ListItems.add(q);Array.forEach(q,function(a,c){a.setAttribute("data-suggest-idx",c+b+2)})}else{this.__ListItems=this.$List.html(q.join("")).find("."+f["cnItem"]).each(function(a,b){b.setAttribute("data-suggest-idx",a+1)});if(q=this.$List[0]){q.scrollTop=0}}}}f["ondraw"].call(this,h,l,this)}}}delete v["dataFrom"];delete v["dataTo"];if(this._onExpand(v["showContainer"],v)!==false||(v["details"]||v["data"])&&this.opts._advancedShowed!=v["showAdvanced"]){this.$List.toggle(v["showList"]);this.$Suggest.toggle(v["showContainer"]);this.$InternetCont.toggle(v["showInternet"]);this.$InternetWrapper.toggle(v["showInternet"]);this.$Advanced.toggle(v["showAdvanced"]);this.opts._advancedShowed=v["showAdvanced"]}if(!this.__currentMarked&&v["showContainer"]&&v["showList"]&&Number.isInteger(s=v["markedItem"])&&s>=0){this._mark(s,void 0,void 0,false)}v["type"]="suggests:afterRebuild";this.fireTrigger(v);v["data"]=null},_request:function(a,b,c){this.opts["request"](a,b,c)},_internetVal:function(a){var b=this.opts,c;a=g(a);if(b["showInternet"]){this["$InternetCont"].attr("href",b["searchUrl"].replace("#query#",b["encodeBeforeSend"]?d(a):a));if((a=b["templateInternetVal"].call(this,a,this["$InternetCont"],this["$Internet"]))!==false){c=this["$Internet"];if(c.length){c.html("")[0].innerHTML=a}}}},_onExpand:function(a,b,c){if(this.__expandedState!==a){this.opts["onexpand"].call(this,a,this);b=b||{};b["type"]="suggests:"+(a?"show":"hide");if(c){b["originalEvent"]=c}if(this.fireTrigger(b)===false){return false}this.__expandedState=a}else{return false}},val:function(a){if(a!==void 0){this._internetVal(a);this.$Input.val(a);if(a==""&&!this._cache[a]){this.hide()}return this}return this._findValue()},getFindWords:function(){var a=this.opts,b=a["multiSuggests"],c=a["suggestSeparator"],d=this.$Input[0],e=d.value,f=a["suggestEscapeStart"],g=f&&a["suggestEscapeEnd"],h,i="suggests:getSuggestWords",j,k=this.hasTrigger(i+" "+i+":AFTER");if(k){h={type:i,input:d,inputValue:e,data:null};if(this.fireTrigger(h)===false){return[]}else{e=h["inputValue"]}}if(b){j=this._getWords(e,c,f,g)}else{j=[e]}if(k){h["data"]=j;h["type"]=i+":AFTER";if(this.fireTrigger(h)!==false){j=h["data"]}}return j},_getWords:function(a,b,c,d){var e,g,h,i,j,k,l,m;e=f.call(a,b);g=[];b=new RegExp(b.source,(b["global"]?"g":"")+(b["ignoreCase"]?"i":"")+(b["multiline"]?"m":""));h=e.length;for(i=0;i<h;++i){j=e[i];(k=b.exec(a))&&(k=k[0]);if(c){if(j){if(m!=null){if((l=j.search(d))!==-1){e[m]=g.slice(m,i).join("")+j;for(m++;m<=i;m++){e[m]=null}m=null}}else{if((l=j.search(c))!==-1){l=j.substr(l+1).search(d);if(l===-1){m=i}}}}}if(c){g[i]=e[i]+(k||"")}}return Array.filter(e,function(a){return!!a})},_getSuggestReplacement:function(a){var b=this.opts,c=b["multiSuggests"],d,e,g,h,i=this.$Input,j=i.val(),k,l,m,n,o,p,q,r,s,t=null,u,v,w,x,y;if(c){e=this.__prevSuggest.caret||$["getCaretPosition"](i[0]);if(!e){return}g=e["start"];h=e["end"];if(!this.__prevSuggest.caret){d=b["suggestSeparator"];m=0;v=b["suggestEscapeStart"];w=v&&b["suggestEscapeEnd"];n=f.call(j,d);d=new RegExp(d.source,(d["global"]?"g":"")+(d["ignoreCase"]?"i":"")+(d["multiline"]?"m":""));o=n.length;for(p=0;p<o;++p){q=n[p];(s=d.exec(j))&&(s=s[0]);if(v){if(q){if(t!==null){if((u=q.search(w))!==-1){m=n.slice(0,t).join("").length;q=n.slice(t,p+1).join("");t=null}}else{if((u=q.search(v))!==-1){u=q.substr(u+1).search(w);if(u===-1){t=p}}}}}r=q.length;if((m+=r)>=g){if(t===null){g=m-r;h=m;break}else if(x===void 0){x=m-r;y=m}}if(s){m+=s.length}if(v&&s){n[p]+=s}}if(t!==null&&x!==void 0){g=x;h=y}e["start"]=g;e["end"]=h;this.__prevSuggest.caret=e}if(!a){k=j.substring(0,g);l=j.substring(h,j.length)}else{e=null}return{position:e,start:g,end:h,value:j,leftPart:k,rightPart:l}}return null},_findValue:function(a,b,c,d){var e=a===void 0,f=this.opts,g=this.$Input,h,i,j,k,l,m;if(!b){b=this._getSuggestReplacement(e)}if(a===null){a=this.__val;if(a==null)return}if(b){h=b.value;k=b.position;l=b.start;m=b.end;if(e){a=h.substring(l,m)}else{i=b.leftPart;j=b.rightPart;h=i+a+j;m=k["end"]=k["start"]+a.length}}else{if(e){a=g.val()}else if(!f["searchLast"]){h=a}}h=f[e?"getSuggest":"setSuggest"].call(this,a,h,f,l,m);if(e){this.__prevSuggest.val=h;return h}this.val(h);if(m==void 0){m=h.length}if(c==Infinity){c=h.length}if(d==Infinity){d=h.length}$["setCaretPosition"](g[0],c!=void 0?c:m,d!=void 0?d:m)},find:function(a,b){var c=this.opts,e=c["ajaxUrl"];if(c.needUpdateValue){c.needUpdateValue=false;a=this._findValue()}if(!b&&(!e||!a&&c["minLength"]>0)){this.hide()}else if(this._loadVal!=a||this._loadUrl!=e){this._loadUrl=e;this._loadVal=a;c["onsearch"].call(this,a,this);this._request(e.replace("#query#",c["encodeBeforeSend"]?d(a):a)+"&"+Math.random(),this._loaded.bind(this,a,b),a)}},set:function(a,b,c){this.opts[a]=b;if(a=="ajaxUrl"){this._cache=[];this.__val=""}if(!c){this.find(this.val())}return this},get:function(a){return this.opts[a]},reset:function(){var a=this._loadVal,b=this._cache[a];this.__val=this._loadVal=void 0;this._cache={};if(this.isExpanded()&&b){this._cache[a]=b}},show:function(a){this._rebuild(a||this.val())},hide:function(a){this._down=false;if(this._onExpand(false,null,a)===false){return false}this.__currentMarkedChangeValue=null;this.$Suggest.hide();this._delayedHideEnd();clearTimeout(this._tid)},showSuggests:function(a,b,c,d){if(b&&a!=void 0){this.val(a)}if(a===void 0){a=this.val()}if(c===void 0){c=this._cache[a]}if(d){this.$Input[0].focus();this.val();this.blurred=false}clearTimeout(this._tid);if(c){this._loaded(a,true,c)}else{this._tid=setTimeout(this["find"].bind(this,a,true),this.opts["timeout"])}},isExpanded:function(){return this.__expandedState===true},_fetchMore:function(a,b){if(!this.opts["fetching"]||!this.__val){return false}if(a===void 0){a=1}var c=this.__val,d=this._cache[c],e=(d&&d.length||0)-1,f=e>=0?this.__ListItems[e]:null;if(!f||!d||d["EOF"]){return false}var g=d.length,h={type:"suggests:fetch",fetchFrom:e,fetchCount:this.opts["fetchCount"],fetchDirection:a<0?"UP":"DOWN",data:d,findValue:c,EOF:false,async:false,currentDataLength:g,insertAfter:f},i;h["val"]=c;h["suggestValue"]=c;if((i=this.fireTrigger(h))!=false){if(h["async"]!==true){this[h.type](h,b);this.__inFetching=false}else if(!this._asynchMarkers[h.type]){if(!this._asynchMarkers)this._asynchMarkers={};h["_asynchMarker"]=this._asynchMarkers[h.type]=+new Date;h["_next_callback"]=b;h["next"]=this._callTriggerFunctionAsync;this.__inFetching=!h["EOF"]}else{h["async"]=false}}return i},_fetchOnScroll:function(){if(!this.isExpanded()||this.__inFetching)return;var a=this["$List"][0],b=a.offsetHeight+a.scrollTop+20>a.scrollHeight;if(b){this._fetchMore()}},"suggests:fetch":function(a,b){var c=a["currentDataLength"],d=a["insertAfter"],e=a["suggestValue"],f,g;b=b||a["_next_callback"];f=this._cache[e]=a["data"];if(f.length==c||a["EOF"]){a["EOF"]=f["EOF"]=true}if(f["EOF"]||!d&&!(d=this.__ListItems[a["fetchFrom"]])){g=a["result"]=false}if(g!==false){this._rebuild(e,a["fetchFrom"],a["fetchCount"],d);if(b){b()}}this.__inFetching=false;return g},getCurrentFindValue:function(){return this.__val},_hideIfNotActiveInput:function(){this._down=false;if(c.activeElement!=this.$Input[0]){this.hide()}},_delayedHideStart:function(){this.__delayedHide=setTimeout(this._hideIfNotActiveInput.bind(this),500)},_delayedHideEnd:function(){if(this.__delayedHide){clearTimeout(this.__delayedHide);this.__delayedHide=null}},_onMouseWheel:function(a){var b=a.wheelDelta||a.detail*-1;if(!b)return;var c=a.currentTarget,d=c.scrollTop,e=c.scrollHeight,f=c.clientHeight,g=b>0;if(g?d==0:e<=f+d){a.preventDefault();a.stopPropagation()}},_onScroll:function(){this._down=false;this._delayedHideEnd()},_fireActiveEvent:function(a){var b={type:"suggests:active"+(a?"In":"Out")};return this.fireTrigger(b)}});o.prototype["getSuggestWords"]=o.prototype["getFindWords"];o["getSuggestWords"]=function(a,b,c,d){return o.prototype["_getWords"].apply(this,arguments)};a["ui"]["suggest"]=o});define("suggests/suggests",["jquery","toolkit/b-userpic/b-userpic","suggests/data-source","suggests/labels","suggests/template","ajs","ajs/__pager/ajs__pager","ajs/__array/ajs__array","ajs/__string/ajs__string","ajs/__ui/ajs__ui","ajs/__ui__suggest/ajs__ui__suggest","jquery","toolkit-common/jquery/__fest/jquery__fest"],function($,a,b,c,d,e,f){function g(a){return b.contactToPlainItems(a)}function h(a,b){var c=a.email,d=a.name,e=new RegExp((b||/,/).source);return d?e.test(d)?'"'+d+'" <'+c+">":d+" <"+c+">":c}function i(a,b){b=b.split(/"?]?(?:\.|\["?|\])/);var c=0;for(c;c<b.length;++c){var d=b[c];if(d==="")break;if(d in a)a=a[d];else return}return a}var j=40,k=30,l={width:250,searchLast:true,autosubmit:false,showInternet:false,timeout:0,multiSuggests:true,suggestEscapeStart:'"',suggestEscapeEnd:'"',suggestSeparator:/,\s*/g,selectByTab:true,cnSuggest:"b-dropdown__list b-dropdown__list_contacts-info b-dropdown__list_suggest",cnList:"b-dropdown__group b-dropdown__group_scroll",cnItem:"b-correspondent",cnSelected:"b-correspondent_selected",cnItemTick:"b-dropdown__list__item__tick",cnInput:"js-input",fetching:true,ignoreUsedData:true,undeterminedStage:false,autoMarked:0,isLayer:false,zIndex:1e3,templateInternetVal:function(){return false},filterUsed:function(a,b){if(Object.keys(b).length){a=Array.filter(a,function(a){var c=a.data.email;return b[c]===undefined})}return a},template:function(b,c){var d=e.HTML.escape,f=function(a){var b=g[a];var e=d(b);if(c.field===a){var f=c.position;var h=b.substring(0,f.start);var i=b.substring(f.start,f.end);var j=b.substring(f.end);e=d(h)+'<span class="b-dropdown__list__item__tick">'+d(i)+"</span>"+d(j)}return e},g=c.data,i=a.getAvatarSrc(g.email,g.name,32,null),j=this.suggestSeparator||this.opts&&this.opts.suggestSeparator,k=h(g,j);var l;if(g.group){l={group:f("group"),count:g.count,attributes:$.extend({"data-suggest":Array.map(g.contacts,function(a){return h(a,j)}).join(", "),"data-group":g.group,"data-group-id":g.id},c.attributes)}}else{l={pic:'background-image: url("'+i+'")',name:f("name"),email:f("email"),enabled:g.enabled,attributes:$.extend({"data-suggest":k,"data-name":g.email||""},c.attributes)};if(g.fromInbox){l.attributes["data-from-inbox"]=true}}return window.fest["suggests"]({block:"b-correspondent",params:l})},afterSelect:function(a){return a},internalSource:true};function m(a,d){this.input=$(a);this.opts=$.extend({},l,d);this.viewport=$(this.opts.viewport||document.body);this.parent=$(this.opts.appendTo||this.viewport);this.DataSource=new b(d["loader"],d["storage"]);this.setData([]);this.ignoreUsed([]);this._initResultsList();this._initAjsSuggest();if(d["labels"]){this.labels=new c(this,$.extend({suggestMaxExcess:k},d["labels"]))}this.updateDataSource();$(window).bind("abjs:updated",this.updateDataSource.bind(this))}m.prototype={updateDataSource:function(){this.DataSource.get().done(function(a){this.setData(a)}.bind(this))},_initResultsList:function(){var a=this.opts||{},b=i(a,"labels.labelPosition")||"absolute";var c=this.input.attr("name")||this.input.attr("data-original-name")||"";this.block=$('<div style="display: none; position: '+b+';" data-original-name="'+c+'" class="'+a.cnSuggest+'"></div>');this.list=$('<div class="'+a.cnList+'"></div>');this.block.append(this.list);this.block.appendTo(this.parent);if(typeof a.cnInput==="string"){this.input.addClass(a.cnInput)}},_initAjsSuggest:function(){var a=this,b=this.opts,c=this.input,d=this.block,f=this.viewport,g=b.fetching,h;if(b.internalSource&&!b.request){b.request=function(a,b,c){b()};b.ajaxUrl="#"}b=$.extend(b,{fetching:g,expire:g,cnSuggest:d[0],cnList:this.list[0]});this.ajsSuggest=e.ui.suggest(c.parent()[0],b);if(Object.isObject(h=b["events"])){Object.forEach(h,function(a,b){if(b.contains("suggests:")){this.addTrigger(b,a)}},this.ajsSuggest);delete b["events"];h=null}this.ajsSuggest.addTrigger("suggests:getData",function(c){var d=c["data"],f=c["suggestValue"];if(d&&d["__nooverride"]){return}if(b.internalSource&&a.localData){d=a._getData(f)}if(d.length){d=b.filterUsed(d,a.usedMap);if(this.opts.fetching){a.pager=e.Pager(d,this.opts.fetchCount);d=a.pager.slice()}else{delete a.pager;if(b.limit){d=d.slice(0,b.limit)}}}c["data"]=d}).addTrigger("suggests:mark",function(a){var b=this.opts;a["updateInputValue"]=a["updateInputValue"]&&b.updateOnMark}).addTrigger("suggests:select",function(a){var c=function(b){var c=null;if(b){var d=$(b);var e=d.attr("data-group-id");if(e){c={id:e,name:d.attr("data-group"),contactsPlain:a["newSuggest"]}}}return c};var d=a["originalEvent"];if(d&&d.type=="blur"){a["updateInputValue"]=false;return}var e=a["newSuggest"];if(e){a["newSuggest"]=b.afterSelect(e,a["newSuggestIndex"],a.inputValueLeftPart,a.inputValueRightPart,c(a.newSuggestNode),$(a.newSuggestNode).attr("data-from-inbox"))}a["inputSelectionStart"]=Infinity;a["inputSelectionEnd"]=Infinity;setTimeout(function(){this.change()}.bind(jQuery(this["$Input"])))}).addTrigger("suggests:afterRebuild",function(c){var d=$(c.currentTarget.$Input),e=$.isFunction(b.getContainer)?b.getContainer():d,g=$(c.currentTarget.$List),h=$(c.currentTarget.$Suggest),i=$(document),l=7;h.css({top:-1e4,left:-1e4});var m=d.offset(),n=e.offset(),o=a.getOffset(),p=f.is("body"),q={width:b.width,height:j*7},r={left:m.left,top:n.top+e[0].offsetHeight},s=p?{height:i.height()}:{height:f.height()},t={top:0};r.left=Math.min(n.left+e[0].offsetWidth+k-q.width,Math.max(r.left,n.left));var u=$.extend({},r);if(a.opts.isLayer){u.top=d[0].getBoundingClientRect().top+d.height()+l}else{u.top=d.offset().top+d.height()+l}u.left-=o.left;if(!p){var v=f.offset();t.top+=v.top}var w=t.top+s.height-(r.top+q.height);if(w<0){q.height=Math.max(j*7,q.height+w-2)}h.css({width:q.width,top:u.top,left:u.left,zIndex:a.opts.isLayer?66e3:a.opts.zIndex});g.css("maxHeight",q.height)});if(g){this.ajsSuggest.addTrigger("suggests:fetch",function(b){var c=b["data"];if(c&&a.pager&&a.pager.hasNext()){a.pager.next();c.splice.bind(c,b["fetchFrom"]+1,0).apply(null,a.pager.slice())}})}if(b.internalSource){this.ajsSuggest.addTrigger("suggests:find",function(a){a.expire=true;if(b.startFindSuggest&&a.originalEvent&&a.originalEvent.type=="focus"){if(b.startFindSuggest()===false){return false}}})}if(typeof b.afterGetSuggestWords=="function"){this.ajsSuggest.addTrigger("suggests:getSuggestWords:after",function(a){var b;b=(b=a.target)&&(b=b.opts)&&b.ignoreAfterGetSuggestWords;if(!b){a["data"]=this(a["data"])}}.bind(b.afterGetSuggestWords))}},_getData:function(a){return a?this.localData.find(a):this.localData.all()},getGroup:function(a){return"getGroup"in this.localData?this.localData.getGroup(a):null},setData:function(a){if(a&&"find"in a&&"all"in a&&$.isFunction(a.find)&&$.isFunction(a.all)){this.localData=a}else if(Array.isArray(a)){this.localData={type:"fromArray",all:function(){return[]},find:function(){return[]}}}else{throw new Error("Undefined type of data")}},getOffset:function(){var a=this.block,b=a.css("display");a.css("display","block");var c=a.offsetParent();a.css("display",b);var d={top:0,left:0};if(!c.is("body")){d=c.offset()}return d},isExpanded:function(){return this.ajsSuggest.isExpanded()},hide:function(){this.ajsSuggest.hide()},ignoreUsed:function(a){this.usedMap={};Array.forEach(a,function(a){this.usedMap[a]=true},this)},showWholeList:function(){if(this.opts.internalSource){this.ajsSuggest.reset()}this.ajsSuggest.showSuggests("",false,this.data,true)},getSuggestWords:function(a){var b;if(a){this.ajsSuggest.opts.ignoreAfterGetSuggestWords=true}b=this.ajsSuggest.getSuggestWords();if(a){delete this.ajsSuggest.opts.ignoreAfterGetSuggestWords}return b},getCurrentFindValue:function(){return this.ajsSuggest.getCurrentFindValue()},rebuildSuggestsList:function(){if(this.opts.internalSource){this.ajsSuggest.reset()}this.ajsSuggest.showSuggests(this.getCurrentFindValue(),false)},applyToInput:function(a){this.ajsSuggest.applyToInput(a,true);this.input=a},_plainContactToString:h};function n(a,b){var d=new m(a,b);return{updateDataSource:function(){d.updateDataSource.apply(d,arguments)},on:function(a,b){if(a==="change"){if(d.labels){d.labels.$source.bind("composeLabelsChange",b)}else{this.on("activeOut",b)}}else if(a==="tooltip_show"||a==="tooltip_hide"){if(d.labels){if(a==="tooltip_show"){d.labels.$source.bind("composeLabelsTooltipShow",b)}else{d.labels.$source.bind("composeLabelsTooltipHide",b)}}}else if(a==="label_edit_start"||a==="label_edit_end"){if(d.labels){if(a==="label_edit_start"){d.labels.$source.bind("composeLabelsEditStart",b)}else{d.labels.$source.bind("composeLabelsEditEnd",b)}}}else{d.ajsSuggest.addTrigger("suggests:"+a,b)}},off:function(a,b){if(a==="change"){if(d.labels){d.labels.$source.unbind("composeLabelsChange",b)}else{this.off("activeOut",b)}}else if(a==="tooltip_show"||a==="tooltip_hide"){if(d.labels){if(a==="tooltip_show"){d.labels.$source.unbind("composeLabelsTooltipShow",b)}else{d.labels.$source.unbind("composeLabelsTooltipHide",b)}}}else if(a==="label_edit_start"||a==="label_edit_end"){if(d.labels){if(a==="label_edit_start"){d.labels.$source.bind("composeLabelsEditStart",b)}else{d.labels.$source.bind("composeLabelsEditEnd",b)}}}else{d.ajsSuggest.removeTrigger("suggests:"+a,b)}},clearItems:function(){this.setValue("")},addItems:function(a){Array.forEach(a,function(a){this.addItem(a)},this)},setValue:function(a){if(d.labels){d.labels.$source.val(a).change()}else{d.input.val(a).change()}},addItem:function(a){var b=this.getItems(),c=g(a),e=this.opts.suggestSeparator;Array.forEach(c,function(a){b.push(h(a,e))});if(d.labels){d.labels.$source.val(b.join(", ")).change()}else{d.input.val(b.join(", "))}},removeItems:function(a){Array.forEach(a,function(a){this.removeItem(a)},this)},removeItem:function(a){var b=this.getItems(),c=g(a),e=d.opts.suggestSeparator;b=Array.filter(b,function(a){return!Array.some(c,function(b){return a===h(b,e)})});if(d.labels){d.labels.$source.val(b.join(", ")).change()}else{d.input.val(b.join(", "))}},setItems:function(a){this.clearItems();this.addItems(a)},getItems:function(){if(d.labels){return d.labels._getSuggestWords()}else{return d.getSuggestWords()}},getEmails:function(){var a=this.getItems(),b=[],d;Array.forEach(a,function(a){if(d=c.suggestToEmail(a)){b.push(d)}});return b},isExpanded:function(){return d.ajsSuggest.isExpanded()},applyToInput:function(a){if(d.labels){d.labels.applyToInput(a)}else{d.applyToInput(a)}},destroy:function(){if(d.labels){d.labels.destroy()}d.ajsSuggest.destroy()}}}n.template=l.template;e.ui.suggest=e.ui.suggest||{};return e.ui.suggest.ab=n});