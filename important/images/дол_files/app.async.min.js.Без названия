!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define("dompurify",b):(a=a||self).DOMPurify=b()}(this,function(){"use strict";var a=Object.hasOwnProperty,b=Object.setPrototypeOf,c=Object.isFrozen,d=Object.freeze,e=Object.seal,f=Object.create,g="undefined"!=typeof Reflect&&Reflect,h=g.apply,i=g.construct;h||(h=function(a,b,c){return a.apply(b,c)}),d||(d=function(a){return a}),e||(e=function(a){return a}),i||(i=function(a,b){return new(Function.prototype.bind.apply(a,[null].concat(function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(b))))});var j,k=w(Array.prototype.forEach),l=w(Array.prototype.indexOf),m=w(Array.prototype.pop),n=w(Array.prototype.push),o=w(Array.prototype.slice),p=w(String.prototype.toLowerCase),q=w(String.prototype.match),r=w(String.prototype.replace),s=w(String.prototype.indexOf),t=w(String.prototype.trim),u=w(RegExp.prototype.test),v=(j=TypeError,function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i(j,b)});function w(a){return function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return h(a,b,d)}}function x(a,d){b&&b(a,null);for(var e=d.length;e--;){var f=d[e];if("string"==typeof f){var g=p(f);g!==f&&(c(d)||(d[e]=g),f=g)}a[f]=!0}return a}function y(b){var c=f(null),d=void 0;for(d in b)h(a,b,[d])&&(c[d]=b[d]);return c}var z=d(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),A=d(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"]),B=d(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),C=d(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),D=d(["#text"]),E=d(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns"]),F=d(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),G=d(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),H=d(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),I=e(/\{\{[\s\S]*|[\s\S]*\}\}/gm),J=e(/<%[\s\S]*|[\s\S]*%>/gm),K=e(/^data-[\-\w.\u00B7-\uFFFF]/),L=e(/^aria-[\-\w]+$/),M=e(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),N=e(/^(?:\w+script|data):/i),O=e(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function Q(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}var R=function(){return"undefined"==typeof window?null:window},S=function(a,b){if("object"!==(void 0===a?"undefined":P(a))||"function"!=typeof a.createPolicy)return null;var c=null;b.currentScript&&b.currentScript.hasAttribute("data-tt-policy-suffix")&&(c=b.currentScript.getAttribute("data-tt-policy-suffix"));var d="dompurify"+(c?"#"+c:"");try{return a.createPolicy(d,{createHTML:function(a){return a}})}catch(a){return console.warn("TrustedTypes policy "+d+" could not be created."),null}};return function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R(),c=function(b){return a(b)};if(c.version="2.1.0",c.removed=[],!b||!b.document||9!==b.document.nodeType)return c.isSupported=!1,c;var e=b.document,f=!1,g=b.document,h=b.DocumentFragment,i=b.HTMLTemplateElement,j=b.Node,w=b.NodeFilter,T=b.NamedNodeMap,U=void 0===T?b.NamedNodeMap||b.MozNamedAttrMap:T,V=b.Text,W=b.Comment,X=b.DOMParser,$=b.trustedTypes;if("function"==typeof i){var Y=g.createElement("template");Y.content&&Y.content.ownerDocument&&(g=Y.content.ownerDocument)}var Z=S($,e),_=Z&&Fa?Z.createHTML(""):"",aa=g,ba=aa.implementation,ca=aa.createNodeIterator,da=aa.getElementsByTagName,ea=aa.createDocumentFragment,fa=e.importNode,ga={};try{ga=y(g).documentMode?g.documentMode:{}}catch(a){}var ha={};c.isSupported=ba&&void 0!==ba.createHTMLDocument&&9!==ga;var ia=I,ja=J,ka=K,la=L,ma=N,na=O,oa=M,pa=null,qa=x({},[].concat(Q(z),Q(A),Q(B),Q(C),Q(D))),ra=null,sa=x({},[].concat(Q(E),Q(F),Q(G),Q(H))),ta=null,ua=null,va=!0,wa=!0,xa=!1,ya=!1,za=!1,Aa=!1,Ba=!1,Ca=!1,Da=!1,Ea=!1,Fa=!1,Ga=!0,Ha=!0,Ia=!1,Ja={},Ka=x({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","plaintext","script","style","svg","template","thead","title","video","xmp"]),La=null,Ma=x({},["audio","video","img","source","image","track"]),Na=null,Oa=x({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),Pa=null,Qa=g.createElement("form"),Ra=function(a){Pa&&Pa===a||(a&&"object"===(void 0===a?"undefined":P(a))||(a={}),a=y(a),pa="ALLOWED_TAGS"in a?x({},a.ALLOWED_TAGS):qa,ra="ALLOWED_ATTR"in a?x({},a.ALLOWED_ATTR):sa,Na="ADD_URI_SAFE_ATTR"in a?x(y(Oa),a.ADD_URI_SAFE_ATTR):Oa,La="ADD_DATA_URI_TAGS"in a?x(y(Ma),a.ADD_DATA_URI_TAGS):Ma,ta="FORBID_TAGS"in a?x({},a.FORBID_TAGS):{},ua="FORBID_ATTR"in a?x({},a.FORBID_ATTR):{},Ja="USE_PROFILES"in a&&a.USE_PROFILES,va=!1!==a.ALLOW_ARIA_ATTR,wa=!1!==a.ALLOW_DATA_ATTR,xa=a.ALLOW_UNKNOWN_PROTOCOLS||!1,ya=a.SAFE_FOR_TEMPLATES||!1,za=a.WHOLE_DOCUMENT||!1,Ca=a.RETURN_DOM||!1,Da=a.RETURN_DOM_FRAGMENT||!1,Ea=a.RETURN_DOM_IMPORT||!1,Fa=a.RETURN_TRUSTED_TYPE||!1,Ba=a.FORCE_BODY||!1,Ga=!1!==a.SANITIZE_DOM,Ha=!1!==a.KEEP_CONTENT,Ia=a.IN_PLACE||!1,oa=a.ALLOWED_URI_REGEXP||oa,ya&&(wa=!1),Da&&(Ca=!0),Ja&&(pa=x({},[].concat(Q(D))),ra=[],!0===Ja.html&&(x(pa,z),x(ra,E)),!0===Ja.svg&&(x(pa,A),x(ra,F),x(ra,H)),!0===Ja.svgFilters&&(x(pa,B),x(ra,F),x(ra,H)),!0===Ja.mathMl&&(x(pa,C),x(ra,G),x(ra,H))),a.ADD_TAGS&&(pa===qa&&(pa=y(pa)),x(pa,a.ADD_TAGS)),a.ADD_ATTR&&(ra===sa&&(ra=y(ra)),x(ra,a.ADD_ATTR)),a.ADD_URI_SAFE_ATTR&&x(Na,a.ADD_URI_SAFE_ATTR),Ha&&(pa["#text"]=!0),za&&x(pa,["html","head","body"]),pa.table&&(x(pa,["tbody"]),delete ta.tbody),d&&d(a),Pa=a)},Sa=function(a){n(c.removed,{element:a});try{a.parentNode.removeChild(a)}catch(b){a.outerHTML=_}},Ta=function(a,b){try{n(c.removed,{attribute:b.getAttributeNode(a),from:b})}catch(a){n(c.removed,{attribute:null,from:b})}b.removeAttribute(a)},Ua=function(a){var b=void 0,c=void 0;if(Ba)a="<remove></remove>"+a;else{var d=q(a,/^[\r\n\t ]+/);c=d&&d[0]}var e=Z?Z.createHTML(a):a;try{b=(new X).parseFromString(e,"text/html")}catch(a){}if(f&&x(ta,["title"]),!b||!b.documentElement){var h=(b=ba.createHTMLDocument("")).body;h.parentNode.removeChild(h.parentNode.firstElementChild),h.outerHTML=e}return a&&c&&b.body.insertBefore(g.createTextNode(c),b.body.childNodes[0]||null),da.call(b,za?"html":"body")[0]};c.isSupported&&function(){try{var a=Ua("<x/><title>&lt;/title&gt;&lt;img&gt;");u(/<\/title/,a.querySelector("title").innerHTML)&&(f=!0)}catch(a){}}();var Va=function(a){return ca.call(a.ownerDocument||a,a,w.SHOW_ELEMENT|w.SHOW_COMMENT|w.SHOW_TEXT,function(){return w.FILTER_ACCEPT},!1)},Wa=function(a){return!(a instanceof V||a instanceof W)&&!("string"==typeof a.nodeName&&"string"==typeof a.textContent&&"function"==typeof a.removeChild&&a.attributes instanceof U&&"function"==typeof a.removeAttribute&&"function"==typeof a.setAttribute&&"string"==typeof a.namespaceURI)},Xa=function(a){return"object"===(void 0===j?"undefined":P(j))?a instanceof j:a&&"object"===(void 0===a?"undefined":P(a))&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName},Ya=function(a,b,d){ha[a]&&k(ha[a],function(a){a.call(c,b,d,Pa)})},Za=function(a){var b=void 0;if(Ya("beforeSanitizeElements",a,null),Wa(a))return Sa(a),!0;if(q(a.nodeName,/[\u0080-\uFFFF]/))return Sa(a),!0;var d=p(a.nodeName);if(Ya("uponSanitizeElement",a,{tagName:d,allowedTags:pa}),!Xa(a.firstElementChild)&&(!Xa(a.content)||!Xa(a.content.firstElementChild))&&u(/<[!/\w]/g,a.innerHTML)&&u(/<[!/\w]/g,a.textContent))return Sa(a),!0;if(!pa[d]||ta[d]){if(Ha&&!Ka[d]&&"function"==typeof a.insertAdjacentHTML)try{var e=a.innerHTML;a.insertAdjacentHTML("AfterEnd",Z?Z.createHTML(e):e)}catch(a){}return Sa(a),!0}return"noscript"!==d&&"noembed"!==d||!u(/<\/no(script|embed)/i,a.innerHTML)?(ya&&3===a.nodeType&&(b=a.textContent,b=r(b,ia," "),b=r(b,ja," "),a.textContent!==b&&(n(c.removed,{element:a.cloneNode()}),a.textContent=b)),Ya("afterSanitizeElements",a,null),!1):(Sa(a),!0)},$a=function(a,b,c){if(Ga&&("id"===b||"name"===b)&&(c in g||c in Qa))return!1;if(wa&&u(ka,b));else if(va&&u(la,b));else{if(!ra[b]||ua[b])return!1;if(Na[b]);else if(u(oa,r(c,na,"")));else if("src"!==b&&"xlink:href"!==b&&"href"!==b||"script"===a||0!==s(c,"data:")||!La[a]){if(xa&&!u(ma,r(c,na,"")));else if(c)return!1}else;}return!0},_a=function(a){var b=void 0,d=void 0,e=void 0,f=void 0,g=void 0;Ya("beforeSanitizeAttributes",a,null);var h=a.attributes;if(h){var i={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ra};for(g=h.length;g--;){var j=b=h[g],k=j.name,n=j.namespaceURI;if(d=t(b.value),e=p(k),i.attrName=e,i.attrValue=d,i.keepAttr=!0,i.forceKeepAttr=void 0,Ya("uponSanitizeAttribute",a,i),d=i.attrValue,!i.forceKeepAttr){if("name"===e&&"IMG"===a.nodeName&&h.id)f=h.id,h=o(h,[]),Ta("id",a),Ta(k,a),l(h,f)>g&&a.setAttribute("id",f.value);else{if("INPUT"===a.nodeName&&"type"===e&&"file"===d&&i.keepAttr&&(ra[e]||!ua[e]))continue;"id"===k&&a.setAttribute(k,""),Ta(k,a)}if(i.keepAttr)if(u(/\/>/i,d))Ta(k,a);else{ya&&(d=r(d,ia," "),d=r(d,ja," "));var q=a.nodeName.toLowerCase();if($a(q,e,d))try{n?a.setAttributeNS(n,k,d):a.setAttribute(k,d),m(c.removed)}catch(a){}}}}Ya("afterSanitizeAttributes",a,null)}},ab=function a(b){var c=void 0,d=Va(b);for(Ya("beforeSanitizeShadowDOM",b,null);c=d.nextNode();)Ya("uponSanitizeShadowNode",c,null),Za(c)||(c.content instanceof h&&a(c.content),_a(c));Ya("afterSanitizeShadowDOM",b,null)};return c.sanitize=function(a,d){var f=void 0,g=void 0,i=void 0,k=void 0,l=void 0;if(a||(a="\x3c!--\x3e"),"string"!=typeof a&&!Xa(a)){if("function"!=typeof a.toString)throw v("toString is not a function");if("string"!=typeof(a=a.toString()))throw v("dirty is not a string, aborting")}if(!c.isSupported){if("object"===P(b.toStaticHTML)||"function"==typeof b.toStaticHTML){if("string"==typeof a)return b.toStaticHTML(a);if(Xa(a))return b.toStaticHTML(a.outerHTML)}return a}if(Aa||Ra(d),c.removed=[],"string"==typeof a&&(Ia=!1),Ia);else if(a instanceof j)1===(g=(f=Ua("\x3c!--\x3e")).ownerDocument.importNode(a,!0)).nodeType&&"BODY"===g.nodeName||"HTML"===g.nodeName?f=g:f.appendChild(g);else{if(!Ca&&!ya&&!za&&-1===a.indexOf("<"))return Z&&Fa?Z.createHTML(a):a;if(!(f=Ua(a)))return Ca?null:_}f&&Ba&&Sa(f.firstChild);for(var m=Va(Ia?a:f);i=m.nextNode();)3===i.nodeType&&i===k||Za(i)||(i.content instanceof h&&ab(i.content),_a(i),k=i);if(k=null,Ia)return a;if(Ca){if(Da)for(l=ea.call(f.ownerDocument);f.firstChild;)l.appendChild(f.firstChild);else l=f;return Ea&&(l=fa.call(e,l,!0)),l}var n=za?f.outerHTML:f.innerHTML;return ya&&(n=r(n,ia," "),n=r(n,ja," ")),Z&&Fa?Z.createHTML(n):n},c.setConfig=function(a){Ra(a),Aa=!0},c.clearConfig=function(){Pa=null,Aa=!1},c.isValidAttribute=function(a,b,c){Pa||Ra({});var d=p(a),e=p(b);return $a(d,e,c)},c.addHook=function(a,b){"function"==typeof b&&(ha[a]=ha[a]||[],n(ha[a],b))},c.removeHook=function(a){ha[a]&&m(ha[a])},c.removeHooks=function(a){ha[a]&&(ha[a]=[])},c.removeAllHooks=function(){ha={}},c}()});define("clipboard/dist/clipboard",["module","exports"],function(a,exports){"use strict";var b=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};(function c(d,e){if((typeof exports==="undefined"?"undefined":b(exports))==="object"&&(typeof a==="undefined"?"undefined":b(a))==="object")a.exports=e();else if(typeof define==="function"&&define.amd)define([],e);else if((typeof exports==="undefined"?"undefined":b(exports))==="object")exports["ClipboardJS"]=e();else d["ClipboardJS"]=e()})(undefined,function(){return function(){var a={134:function a(c,d,e){"use strict";e.d(d,{default:function a(){return E}});var f=e(279);var g=e.n(f);var h=e(370);var i=e.n(h);var j=e(817);var k=e.n(j);function l(a){"@babel/helpers - typeof";if(typeof Symbol==="function"&&b(Symbol.iterator)==="symbol"){l=function a(c){return typeof c==="undefined"?"undefined":b(c)}}else{l=function a(c){return c&&typeof Symbol==="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c==="undefined"?"undefined":b(c)}}return l(a)}function m(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function n(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}function o(a,b,c){if(b)n(a.prototype,b);if(c)n(a,c);return a}var p=function(){function a(b){m(this,a);this.resolveOptions(b);this.initSelection()}o(a,[{key:"resolveOptions",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=b.action;this.container=b.container;this.emitter=b.emitter;this.target=b.target;this.text=b.text;this.trigger=b.trigger;this.selectedText=""}},{key:"initSelection",value:function a(){if(this.text){this.selectFake()}else if(this.target){this.selectTarget()}}},{key:"createFakeElement",value:function a(){var b=document.documentElement.getAttribute("dir")==="rtl";this.fakeElem=document.createElement("textarea");this.fakeElem.style.fontSize="12pt";this.fakeElem.style.border="0";this.fakeElem.style.padding="0";this.fakeElem.style.margin="0";this.fakeElem.style.position="absolute";this.fakeElem.style[b?"right":"left"]="-9999px";var c=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top="".concat(c,"px");this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;return this.fakeElem}},{key:"selectFake",value:function a(){var b=this;var c=this.createFakeElement();this.fakeHandlerCallback=function(){return b.removeFake()};this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||true;this.container.appendChild(c);this.selectedText=k()(c);this.copyText();this.removeFake()}},{key:"removeFake",value:function a(){if(this.fakeHandler){this.container.removeEventListener("click",this.fakeHandlerCallback);this.fakeHandler=null;this.fakeHandlerCallback=null}if(this.fakeElem){this.container.removeChild(this.fakeElem);this.fakeElem=null}}},{key:"selectTarget",value:function a(){this.selectedText=k()(this.target);this.copyText()}},{key:"copyText",value:function a(){var b;try{b=document.execCommand(this.action)}catch(a){b=false}this.handleResult(b)}},{key:"handleResult",value:function a(b){this.emitter.emit(b?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function a(){if(this.trigger){this.trigger.focus()}document.activeElement.blur();window.getSelection().removeAllRanges()}},{key:"destroy",value:function a(){this.removeFake()}},{key:"action",set:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"copy";this._action=b;if(this._action!=="copy"&&this._action!=="cut"){throw new Error('Invalid "action" value, use either "copy" or "cut"')}},get:function a(){return this._action}},{key:"target",set:function a(b){if(b!==undefined){if(b&&l(b)==="object"&&b.nodeType===1){if(this.action==="copy"&&b.hasAttribute("disabled")){throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute')}if(this.action==="cut"&&(b.hasAttribute("readonly")||b.hasAttribute("disabled"))){throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes')}this._target=b}else{throw new Error('Invalid "target" value, use a valid Element')}}},get:function a(){return this._target}}]);return a}();var q=p;function r(a){"@babel/helpers - typeof";if(typeof Symbol==="function"&&b(Symbol.iterator)==="symbol"){r=function a(c){return typeof c==="undefined"?"undefined":b(c)}}else{r=function a(c){return c&&typeof Symbol==="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c==="undefined"?"undefined":b(c)}}return r(a)}function s(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function t(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}function u(a,b,c){if(b)t(a.prototype,b);if(c)t(a,c);return a}function v(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function")}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:true,configurable:true}});if(b)w(a,b)}function w(a,b){w=Object.setPrototypeOf||function a(b,c){b.__proto__=c;return b};return w(a,b)}function x(a){var b=A();return function c(){var d=B(a),e;if(b){var f=B(this).constructor;e=Reflect.construct(d,arguments,f)}else{e=d.apply(this,arguments)}return y(this,e)}}function y(a,b){if(b&&(r(b)==="object"||typeof b==="function")){return b}return z(a)}function z(a){if(a===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return a}function A(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(a){return false}}function B(a){B=Object.setPrototypeOf?Object.getPrototypeOf:function a(b){return b.__proto__||Object.getPrototypeOf(b)};return B(a)}function C(a,b){var c="data-clipboard-".concat(a);if(!b.hasAttribute(c)){return}return b.getAttribute(c)}var D=function(a){v(c,a);var b=x(c);function c(a,d){var e;s(this,c);e=b.call(this);e.resolveOptions(d);e.listenClick(a);return e}u(c,[{key:"resolveOptions",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=typeof b.action==="function"?b.action:this.defaultAction;this.target=typeof b.target==="function"?b.target:this.defaultTarget;this.text=typeof b.text==="function"?b.text:this.defaultText;this.container=r(b.container)==="object"?b.container:document.body}},{key:"listenClick",value:function a(b){var c=this;this.listener=i()(b,"click",function(a){return c.onClick(a)})}},{key:"onClick",value:function a(b){var c=b.delegateTarget||b.currentTarget;if(this.clipboardAction){this.clipboardAction=null}this.clipboardAction=new q({action:this.action(c),target:this.target(c),text:this.text(c),container:this.container,trigger:c,emitter:this})}},{key:"defaultAction",value:function a(b){return C("action",b)}},{key:"defaultTarget",value:function a(b){var c=C("target",b);if(c){return document.querySelector(c)}}},{key:"defaultText",value:function a(b){return C("text",b)}},{key:"destroy",value:function a(){this.listener.destroy();if(this.clipboardAction){this.clipboardAction.destroy();this.clipboardAction=null}}}],[{key:"isSupported",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:["copy","cut"];var c=typeof b==="string"?[b]:b;var d=!!document.queryCommandSupported;c.forEach(function(a){d=d&&!!document.queryCommandSupported(a)});return d}}]);return c}(g());var E=D},828:function a(b){var c=9;if(typeof Element!=="undefined"&&!Element.prototype.matches){var d=Element.prototype;d.matches=d.matchesSelector||d.mozMatchesSelector||d.msMatchesSelector||d.oMatchesSelector||d.webkitMatchesSelector}function e(a,b){while(a&&a.nodeType!==c){if(typeof a.matches==="function"&&a.matches(b)){return a}a=a.parentNode}}b.exports=e},438:function a(b,c,d){var e=d(828);function f(a,b,c,d,e){var f=h.apply(this,arguments);a.addEventListener(c,f,e);return{destroy:function b(){a.removeEventListener(c,f,e)}}}function g(a,b,c,d,e){if(typeof a.addEventListener==="function"){return f.apply(null,arguments)}if(typeof c==="function"){return f.bind(null,document).apply(null,arguments)}if(typeof a==="string"){a=document.querySelectorAll(a)}return Array.prototype.map.call(a,function(a){return f(a,b,c,d,e)})}function h(a,b,c,d){return function(c){c.delegateTarget=e(c.target,b);if(c.delegateTarget){d.call(a,c)}}}b.exports=g},879:function a(b,exports){exports.node=function(a){return a!==undefined&&a instanceof HTMLElement&&a.nodeType===1};exports.nodeList=function(a){var b=Object.prototype.toString.call(a);return a!==undefined&&(b==="[object NodeList]"||b==="[object HTMLCollection]")&&"length"in a&&(a.length===0||exports.node(a[0]))};exports.string=function(a){return typeof a==="string"||a instanceof String};exports.fn=function(a){var b=Object.prototype.toString.call(a);return b==="[object Function]"}},370:function a(b,c,d){var e=d(879);var f=d(438);function g(a,b,c){if(!a&&!b&&!c){throw new Error("Missing required arguments")}if(!e.string(b)){throw new TypeError("Second argument must be a String")}if(!e.fn(c)){throw new TypeError("Third argument must be a Function")}if(e.node(a)){return h(a,b,c)}else if(e.nodeList(a)){return i(a,b,c)}else if(e.string(a)){return j(a,b,c)}else{throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}}function h(a,b,c){a.addEventListener(b,c);return{destroy:function d(){a.removeEventListener(b,c)}}}function i(a,b,c){Array.prototype.forEach.call(a,function(a){a.addEventListener(b,c)});return{destroy:function d(){Array.prototype.forEach.call(a,function(a){a.removeEventListener(b,c)})}}}function j(a,b,c){return f(document.body,a,b,c)}b.exports=g},817:function a(b){function c(a){var b;if(a.nodeName==="SELECT"){a.focus();b=a.value}else if(a.nodeName==="INPUT"||a.nodeName==="TEXTAREA"){var c=a.hasAttribute("readonly");if(!c){a.setAttribute("readonly","")}a.select();a.setSelectionRange(0,a.value.length);if(!c){a.removeAttribute("readonly")}b=a.value}else{if(a.hasAttribute("contenteditable")){a.focus()}var d=window.getSelection();var e=document.createRange();e.selectNodeContents(a);d.removeAllRanges();d.addRange(e);b=d.toString()}return b}b.exports=c},279:function a(b){function c(){}c.prototype={on:function a(b,c,d){var e=this.e||(this.e={});(e[b]||(e[b]=[])).push({fn:c,ctx:d});return this},once:function a(b,c,d){var e=this;function f(){e.off(b,f);c.apply(d,arguments)}f._=c;return this.on(b,f,d)},emit:function a(b){var c=[].slice.call(arguments,1);var d=((this.e||(this.e={}))[b]||[]).slice();var e=0;var f=d.length;for(e;e<f;e++){d[e].fn.apply(d[e].ctx,c)}return this},off:function a(b,c){var d=this.e||(this.e={});var e=d[b];var f=[];if(e&&c){for(var g=0,h=e.length;g<h;g++){if(e[g].fn!==c&&e[g].fn._!==c)f.push(e[g])}}f.length?d[b]=f:delete d[b];return this}};b.exports=c;b.exports.TinyEmitter=c}};var c={};function d(b){if(c[b]){return c[b].exports}var e=c[b]={exports:{}};a[b](e,e.exports,d);return e.exports}(function(){d.n=function(a){var b=a&&a.__esModule?function(){return a["default"]}:function(){return a};d.d(b,{a:b});return b}})();(function(){d.d=function(exports,a){for(var b in a){if(d.o(a,b)&&!d.o(exports,b)){Object.defineProperty(exports,b,{enumerable:true,get:a[b]})}}}})();(function(){d.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)}})();return d(134)}().default})});define("clipboard",["clipboard/dist/clipboard"],function(a){return a});!function(a,b){if("object"==typeof exports&&"object"==typeof module)module.exports=b();else if("function"==typeof define&&define.amd)define("@mail/text-analyzer/dist/main",[],b);else{var c=b();for(var d in c)("object"==typeof exports?exports:a)[d]=c[d]}}(window,function(){return function(a){var b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=a,c.c=b,c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:d})},c.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c.t=function(a,b){if(1&b&&(a=c(a)),8&b)return a;if(4&b&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(c.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&b&&"string"!=typeof a)for(var e in a)c.d(d,e,function(b){return a[b]}.bind(null,e));return d},c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="",c(c.s=0)}([function(a,b,c){var d;void 0===(d=function(a){var b=c(1),d=/(?:(?:[^\/\.\?\%\=;\!&-_A-z]|^)(?:attachments?|attach(?:[^a-z]|$)|attached)|аттач|в прицепе?|в скрепк(?:е|у)|во? вложени(?:и|е)|(?:см(?:отри|\.|) ?|проверь )(?:вложен|приложен|прикреплен|скрепк|файл(?:|ы|ики?)[^А-я])|во вложенн?..|вложенн?.. файл(?:|ы|ики?)[^А-я]|(?:высылаю|лови|направляю|кидаю|скидываю|бросаю|сбрасываю) файл(?:|ы|ики?)[^А-я]|(?:вкладываю|прикладываю|прикрепляю|прилагаю)[^А-я]|(?:прикрепила?|приложила?)(?:[^А-я]|$)|в приложении|в приложенн?[оы].)/gi;function e(a){var c=(a=a.toLowerCase()).match(d);if(null===c)return!1;var e=(c=c[0]).match(/[A-zА-я\. ]+/gi);return null!==e&&(c=e[0].trim(),c=b.clearText(c),!b.isLink(a,c)&&(!b.isQuestion(a,c)&&(!a.match(new RegExp("^[^'\"«»]*['\"«][^'\"«»]*"+c+"(?:[^\"'«»]*\n){0,}[^'\"«»]*['\"»][^'\"«»]*$","ig"))&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?|(см(?:отри|\.|) ?|проверь )(?:вложен|приложен|прикреплен|скрепк|файл(?:|ы|ики?)[^А-я]))/gi,/(?:[^А-я]|^)(?:забыл.?|прошл.{2,3}|вчера.{0,}|предыдущ.{2,3}|ранее|в первом|первого|бы(?:л.?|ть)|нету?|отсутству[ею]т|пуст.{0,2}|только|ничего|будет)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:attachments?|attach(?:ed)?)/gi,/(?:[^A-z]|^)(?:previou?s|last|recent|first letter|already|below)(?:[^A-z]|$)/gi)&&(!b.isNegRegexNear(a,/(?:аттач|во? вложени[ие]|во вложенн..|в приложении|в приложенн?[оы].|(?:при(?:(?:лага|крепля)ю|(?:лож|креп)ила?)|(?:в|при)кладываю)|прилага[ею]тся|(?:высылаю|лови|направляю|кидаю|скидываю|бросаю|сбрасываю) файл(?:ы|ики?)?[^А-я])/gi,/(?:(?:[^А-я]|^)ссылк.|https?:)/gi,75,100,1,1)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?|прилагаю|прикладываю|прикрепляю)/gi,/(?:[^А-я]|^)(?:он[аи]?|[твм]ы|мне|меня|теб[ея]|е[йеё]|не[йм]|е(?:му|го)|ва[мшс]|и[хм]|[вн]ашим|на[шмс]|мной|тобой|(?:в|н)ами|ними?|тво[йяиеё]|у?же|там|сначала|затем|опять|есть)(?:[^А-я]|$)/gi,25,25)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?)/gi,/(?:[^А-я]|^)(?:она?|[тв]ы|тво[йя]|теб[ея]|ва[мшс]|у?же)(?:[^А-я]|$)/gi,15,15)&&(!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|(?:при(?:(?:лага|крепля)ю|(?:лож|креп)ила?)|прикладываю))/gi,/(?:[^А-я]|^)(?:ответ.?|письм[оа]|переписк.|ниже|бы)(?:[^А-я]|$)/gi,35,35)&&(!b.isNegRegexNear(a,new RegExp(c,"ig"),/(?:[^А-я]|^)не(?:[^А-я]|$)/gi,35,35)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепке|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].)/gi,/(?:[^А-я]|^)[А-я]{1,7}[аеиуйь](?:ть|вь|те)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?|(?:в|при)кладываю|прикрепляю|прилага(?:е|ю)тся|(?:высылаю|лови|направляю|кидаю|скидываю|бросаю|сбрасываю) файл(?:|ы|ики?)[^А-я])/gi,/(?:[^А-я]|^)(?:как..|так..|(?:не)?котор..|чем|как|так|если|(?:все|ино|ко|то)гда|где|что(?:б|бы)?|почему|зачем|вместо|вообще|наконец)(?:[^А-я]|-|$)/gi,35,35)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе|в скрепке|во? вложении|во вложенн..|в приложении|в приложенн?[оы].)/gi,/(?:[^А-я]|^)не (?:вижу|найду|нахожу)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:приложила?|прилагаю|прикладываю)/gi,/(?:[^А-я]|^)(?:сил[ыу]|усили[яей]|труд.{0,2})(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)(?:android|appstore|iphone|ios|google play|аппстор|авториз|андро[ий]д.*|айфон.*|верси|обнов(?:лен)?и|приложени[ея]|мобильн.{2,3}|разработ[чк]|smartphone|смартфон|регистраци.|(?:за)регистрир.*|пользовател[а-я]{1,2})/gi,1e4,1e4,1,1)&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)(?:(?:в|за)ход|вой[дт]и|групп.|веб|нельзя)/gi)&&(!b.isNegRegexNear(a,/(?:в приложении|(?:см(?:отри|\.|) ?|проверь )(?:вложен|приложен))/gi,/(?:номер|№|\d|[A-z]+)/gi,0,6)&&(null===a.match(new RegExp("в приложении [\"'].{1,30}[\"']","ig"))&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)[кмг]б|(?:кило|мега|гига)байт(?:[^А-я]|$)/gi,30,30)&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)(?:п\\.?|пункт)(?:[^А-я]|$)/gi,20,20)&&(!b.isNegRegexNear(a,/в приложении/gi,/ [а-зa-z](?:[^А-яA-z]|$)/gi,0,3)&&(!b.isNegRegexNear(a,/вкладываю/gi,/(?:[^А-я]|^)(?:смысл|деньги|инвестици|средства)/gi,30,30)&&(!b.isNegRegexNear(a,/(?:прилага(?:е|ю)тся|прилагаю|приложила?|прикрепила?|прикрепляю|прикладываю)/gi,/(?:[^А-я]|^)(?:информаци(?:я|ю)|инфо|контакты|номер)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:прилага(?:е|ю)тся|во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/[\'\"«][^\'\"«»]{100,}[\'\"»]/gi,0,1e4,0,1)&&(!b.isNegRegexNear(a,/attach(?:ed)?/gi,/to (?:you|her|him|me)/gi,0,10)&&(!b.isNegRegexNear(a,/attached/gi,/(?:am|was|were|had|did)/gi,10,0)&&(!b.isNegRegexNear(a,/attach(?:ed)?/gi,/(?:[^A-z]|^)(?:we|your?|s?he|they|his|her|him)(?:[^A-z]|$)/gi,17,0)&&(!b.isNegRegexNear(a,/(?:attachments?|attach[^me]|attached)/gi,/(?:[^A-z]|^)(?:don'?t|not?|any|link|with ?out|forg(?:e|o)t)(?:[^A-z]|$)/gi,30,30)&&(!b.isNegRegexNear(a,/(?:attachments?|attach[^me]|attached)/gi,/(?:[^A-z]|^)(?:these|this|that|those)(?:[^A-z]|$)/gi,15,0)&&((!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)к /gi,0,20)||null!==a.match(/в приложении к [а-я]{0,10} ?письму/gi))&&((!b.isNegRegexNear(a,/(?:прилагаю|прилага[ею]тся|приложила?|прикрепила?|прикладываю)/gi,/(?:[^А-я]|^)к /gi)||null!==a.match(/(?:прилагаю|прилага[ею]тся|приложил(?:а|[^А-я]|$)|прикрепил(?:а|[^А-я]|$)|прикладываю)[а-я ]{0,}к [а-я]{0,10} ?письму/gi)||null!==a.match(/(?:[^А-я]|^)к [а-я]{0,10} ?письму (?:прилагаю|прилага[ею]тся|приложил(?:а|[^А-я]|$)|прикрепил(?:а|[^А-я]|$)|прикладываю)/gi))&&((!b.isNegRegexNear(a,/вкладываю/gi,/(?:[^А-я]|^)в /gi)||null!==a.match(/вкладываю [а-я ]{0,} ?в [а-я]{0,10} ?письмо/gi)||null!==a.match(/в [а-я]{0,10} ?письмо вкладываю[^т]/gi))&&((!a.match(/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю) [а-я ]{0,30} ?реквизиты/gi)&&!a.match(/реквизиты [а-я ]{0,30} ?(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi)||!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/(?:[^A-z]|^)(?:бик|инн|номер|получател.|сч[её]т|кпп|о[ао]о|зао|огрн|окпо|ип|рнн|иин|иик)(?:[^A-z]|$)/gi,0,1e4,0,1))&&((!a.match(/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю) [а-я ]{0,25} ?(?:список|данные)/gi)&&!a.match(/(?:список|данные) [а-я ]{0,25} ?(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi)||!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/(?:.{0,3}(?:\d|-).*\n){2,}/gi,0,1e4,0,1))&&(!a.match(/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю) .{0,15} ?чек/gi)&&!a.match(/чек .{0,15} ?(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi)||!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/(?:[^A-z]|^)(?:сумма|номер заказа|платеж.?|получател.|ип|дата|время)(?:[^A-z]|$)/gi,0,1e4,0,1))))))))))))))))))))))))))))))))))))}var f="natural",g="noreply",h=/^(?:(?:(?:do)?[._-]?no?t?[._-]?(?:reply|answer))|(?:bez|net)[._-]?ot[vw]eta)$/i,i=/не (?:(?:нужно|следует) отвечать|отвеча)|отвечать на него не (?:нужно|следует)|не требует ответа/i,j=/do(?:n'| no)t (?:reply|respond|answer)/i,k=/e-mail|письмо|сообщение|уведомление/i,l=/автоматическ/i,m=/e-mail|message|letter/i,n=/automat|system|generated?/i;return{TYPE_NATURAL:f,TYPE_NOREPLY:g,haveAttach:e,hasAttachment:e,getType:function(a,b){return b&&!h.test(b.split("@")[0])||!(i.test(a)||j.test(a)||k.test(a)&&l.test(a)||m.test(a)&&n.test(a))?f:g}}}.call(b,c,b,a))||(a.exports=d)},function(a,b,c){var d;void 0===(d=function(a,b){b.isNegRegexNear=function(a,b,c,d,e,f,g){var h,i,j,k,l,m;if(void 0===f&&(f=0),void 0===g&&(g=0),k=(a=a.toLowerCase()).match(b),h=null!==a.match(b),null===k)return!1;j=k[0];var n=a.indexOf(j),o=n+j.length;j=this.clearText(j),m=null===(k=a.match(new RegExp("(?:[.?!\n]|^)[^.?!\n]*"+j,"ig")))?0:a.indexOf(k[0]);var p=a.substr(o,a.length);return l=null===(k=p.match(/[\.\!\?\n].*/gi))?p.length:p.indexOf(k[0]),d||0===d?((d=n-d)<m&&0===f&&(d=m),d<0&&(d=0)):d=m,e=(e||0===e)&&(e>l&&1===g||e<l)?o+e:o+l,i=null!==a.substr(d,e-d).match(c),h&&i},b.clearText=function(a){return a.replace(/[\/\(\)\[\]\&]/g,"").replace(/\\/,"\\\\")},b.isQuestion=function(a,b){var c=a.toLowerCase().match(new RegExp(b,"ig"));if(null===c)return!1;b=c[0];var d,e=a.indexOf(b),f=a.substr(e,a.length),g=f.match(/[\.\!\?)\n].*/i);return d=g&&g.length>0?f.indexOf(g[0]):f.length,null!==(f=a.substr(e,d+1)).match(/\?$/)},b.isLink=function(a,b){return null!==a.match(new RegExp("<a.*>[^<>]*"+b+"[^<>]*</a>","ig"))||null!==a.match(new RegExp("<[^<>]*"+b+"[^<>]*>","ig"))}}.call(b,c,b,a))||(a.exports=d)}])});define("@mail/text-analyzer",["@mail/text-analyzer/dist/main"],function(a){return a});(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?b(exports):typeof define==="function"&&define.amd?define("@mail/amp-viewer",["exports"],b):(a=typeof globalThis!=="undefined"?globalThis:a||self,b(a["@mail/amp-viewer"]={}))})(this,function(exports){"use strict";var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};function b(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}var c=function(){c=Object.assign||function a(b){for(var c,d=1,e=arguments.length;d<e;d++){c=arguments[d];for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f))b[f]=c[f]}return b};return c.apply(this,arguments)};function d(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function e(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}function f(a,b){return b={exports:{}},a(b,b.exports),b.exports}var g=f(function(a,exports){Object.defineProperty(exports,"__esModule",{value:true});var b="initial";function c(a,b,c){if(typeof b==="function"){return new d(a,void 0,b)}return new d(a,b,c)}var d=function(){function a(a,b,c){this.state=a;this.signal=b;this.implementation=c}a.prototype.onConditionsMet=function(a){};a.prototype.onConditionsUnmet=function(a){};return a}();var e=function(){function a(a){this.transitions=a;this.currentState=b;this.possibleTransitions=[]}Object.defineProperty(a.prototype,"state",{get:function(){return this.currentState},enumerable:true,configurable:true});a.prototype.transition=function(a){var b=[];for(var c=1;c<arguments.length;c++){b[c-1]=arguments[c]}var d=this.findTransitions(a);var e=this.state;for(var f=0,g=d;f<g.length;f++){var h=g[f];this.doTransition.apply(this,[h.implementation].concat(b));if(e!==this.state){return}}};a.prototype.reset=function(){this.doTransition(b)};a.prototype.doTransition=function(a){var b=this;var c=[];for(var d=1;d<arguments.length;d++){c[d-1]=arguments[d]}this.possibleTransitions.forEach(function(a){return a.onConditionsUnmet(b)});if(typeof a==="function"){this.currentState=a.apply(void 0,[this].concat(c))}else{this.currentState=a}this.possibleTransitions=this.getPossibleTransitions();this.possibleTransitions.forEach(function(a){return a.onConditionsMet(b)})};a.prototype.getPossibleTransitions=function(){var a=this;return this.transitions.filter(function(b){return b.state===a.state})};a.prototype.findTransitions=function(a){return this.getPossibleTransitions().filter(function(b){return b.signal===a||b.signal===void 0})};return a}();function f(a){return new e(a)}var g=function(a,b){g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c]};return g(a,b)};function h(a,b){g(a,b);function c(){this.constructor=a}a.prototype=b===null?Object.create(b):(c.prototype=b.prototype,new c)}var i=function(a){h(b,a);function b(c,d,e){var f=a.call(this,c,b.signal(e),d)||this;f.ms=e;return f}b.signal=function(a){return"_$timer"+a};b.prototype.onConditionsMet=function(b){a.prototype.onConditionsMet.call(this,b);this.timer=setTimeout(this.handleTimer.bind(this,b),this.ms)};b.prototype.onConditionsUnmet=function(b){a.prototype.onConditionsUnmet.call(this,b);clearTimeout(this.timer)};b.prototype.handleTimer=function(a){a.transition(b.signal(this.ms))};return b}(d);function j(a,b,c){return new i(a,c,b)}var k=function(a){h(b,a);function b(b,c,d){return a.call(this,b,c,function(){var a=[];for(var c=0;c<arguments.length;c++){a[c]=arguments[c]}d.apply(void 0,a);return b})||this}return b}(d);function l(a,b,c){if(typeof b==="function"){c=b;b=void 0}return new k(a,b,c)}function m(a){var b=function(c){if(typeof c==="function"){return b({})(c)}return function(b){var d=function(b){h(d,b);function d(){var d=[];for(var e=0;e<arguments.length;e++){d[e]=arguments[e]}var f=b.apply(this,d)||this;a.onConstruct(f,c);return f}return d}(b);a.onPatch(d,c);return d}};return b}function n(a,b,c){var d=a.prototype[b];var e=typeof d==="function";a.prototype[b]=function a(){c.apply(this,arguments);if(e){return d.apply(this,arguments)}}}var o="create";var p="mount";var q="update";var r="unmount";var s="catch";var t=function(a){h(b,a);function b(b){var c=a.call(this,b.transitions||[])||this;c.component=b;c.handlers={};return c}b.prototype.signal=function(a){var b=this;var c=String(a);if(!this.handlers[c]){this.handlers[c]=function(c){b.transition(a,c)}}return this.handlers[c]};b.prototype.transition=function(b){var c=[];for(var d=1;d<arguments.length;d++){c[d-1]=arguments[d]}var e;a.prototype.transition.apply(this,[b].concat(c));if(typeof this.mapToState!=="string"){return}if(this.component.state[this.mapToState]!==this.state){this.component.setState((e={},e[this.mapToState]=this.state,e))}};b.prototype.doTransition=function(b){var c=this;var d=[];for(var e=1;e<arguments.length;e++){d[e-1]=arguments[e]}if(typeof b!=="function"){return a.prototype.doTransition.call(this,b)}a.prototype.doTransition.call(this,function(){return b.apply(void 0,[c.component].concat(d))},d)};return b}(e);var u={onPatch:function(a,b){var c=b.catching;n(a,"componentDidMount",function(){this.automaton.transition(p)});n(a,"componentDidUpdate",function(a,b){this.automaton.transition(q,a,b)});n(a,"componentWillUnmount",function(){this.automaton.transition(r);this.automaton.reset()});c&&n(a,"componentDidCatch",function(a,b){this.automaton.transition(s,a,b)})},onConstruct:function(a,b){a.automaton=new t(a);a.automaton.transition(o,a);if(typeof b.mapToState==="string"){if(!a.state){a.state={}}a.state[b.mapToState]=a.automaton.state;a.automaton.mapToState=b.mapToState}}};var v=m(u);function w(a){return a.automaton}function x(a,b){return w(a).signal(b)}exports.INITIAL=b;exports.transition=c;exports.automaton=f;exports.Automaton=e;exports.Transition=d;exports.timer=j;exports.sideEffect=l;exports.CATCH=s;exports.CREATE=o;exports.MOUNT=p;exports.UNMOUNT=r;exports.UPDATE=q;exports.withAutomaton=v;exports.automatonOf=w;exports.asSignal=x});e(g);var h=g.INITIAL;var i=g.transition;var j=g.automaton;var k=g.Automaton;var l=g.Transition;var m=g.timer;var n=g.sideEffect;var o=g.CATCH;var p=g.CREATE;var q=g.MOUNT;var r=g.UNMOUNT;var s=g.UPDATE;var t=g.withAutomaton;var u=g.automatonOf;var v=g.asSignal;var w=function(){function a(){this.handlers={}}a.prototype.on=function(a,b){this.handlers[a]=this.handlers[a]||[];this.handlers[a].push(b)};a.prototype.off=function(a,b){if(!this.handlers[a]){return}this.handlers[a]=this.handlers[a].filter(function(a){return b!==a})};a.prototype.emit=function(a,b){(this.handlers[a]||[]).forEach(function(a){return a(b)})};return a}();var x="ready";var y="content";var z="resize";var A="configure";var B="configured";var C="error";var D="navigate";var E="radar";var F="#?__mrg_frame_id=";var G="timeout";var H=/^(https?:\/\/)?(.*\.)?(imgs|dev)?mail\.ru$/;var I=/^(https?:\/\/)?localhost:?/;var J="@@mail-amp-postMessage$";var K=function(a){b(d,a);function d(b){var e=a.call(this)||this;e.id=d.lastId++;e.options=c({},b);e.id=b.id||e.id;e.handleMessage=e.handleMessage.bind(e);return e}d.prototype.setup=function(){this.options.selfWindow.addEventListener("message",this.handleMessage)};d.prototype.teardown=function(){this.options.selfWindow.removeEventListener("message",this.handleMessage)};d.prototype.sendMessage=function(a){var b=a.type;if(this.options.debug){console.warn("[SEND]",b,a)}var c=this.id+J;this.options.targetWindow.postMessage(c+JSON.stringify(a),this.options.targetOrigin||"*")};d.prototype.setDebug=function(a){this.options.debug=a};d.prototype.setTargetWindow=function(a){this.options.targetWindow=a};d.prototype.setTargetOrigin=function(a){this.options.targetOrigin=a};d.prototype.setId=function(a){this.id=a};d.prototype.getId=function(){return this.id};d.prototype.handleMessage=function(a){var b=this.options.originRegexp;if(b&&!b.test(a.origin)){if(this.options.debug){console.error("[RECEIVE] Received message from prohibited origin:",a.origin)}return}var c;try{var d=String(a.data);var e=""+this.id+J;if(d.startsWith(e)){c=JSON.parse(a.data.slice(e.length))}else{return}}catch(a){console.error(a);return}if(this.options.debug){console.warn("[RECEIVE]",c.type,c)}this.emit(c.type,c)};d.lastId=0;return d}(w);function L(a){return Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&")}var M="initial";var N="creation";var O="loading";var P="error";var Q="configuring";var R="ready";var S="event-error";var T="ready";var U="error";var V="warning";var W="resize";var X="navigate";var Y="radar";var Z=function(a){b(e,a);function e(b){var d=a.call(this)||this;d.options=c({},b);var e=H;if(I.test(window.location.href)){e=undefined}d.transport=new K(c({selfWindow:window,originRegexp:e,debug:b.debug},b.transport));return d}e.prototype.setup=function(){this.initializeController();this.transport.setup();this.transport.on(x,this.asSignal(x));this.transport.on(B,this.asSignal(B));this.transport.on(z,this.asSignal(z));this.transport.on(D,this.asSignal(D));this.transport.on(E,this.asSignal(E));this.transport.on(C,this.asSignal(C));this.automaton.transition(undefined)};e.prototype.teardown=function(){this.automaton.reset();this.transport.teardown()};e.prototype.loadLetter=function(a){this.letter=a;if(this.automaton.state===R){this.transport.sendMessage({type:y,data:this.letter})}};e.prototype.errorReporter=function(a,b){var c=this;return function(){var d={data:{type:a,error:b}};c.emit(U,d.data);return P}};e.prototype.asSignal=function(a){var b=this;return function(c){b.automaton.transition(a,c)}};e.prototype.initializeController=function(){var a=this;this.automaton=j(d([i(M,"create",N),i(N,function(){var b=a.options.iframeSrc;a.iframe=a.options.iframe||document.createElement("IFRAME");var c=["xhrInterceptor","viewerRenderTemplate"];a.iframe.setAttribute("scrolling","no");a.iframe.setAttribute("allowfullscreen","false");a.iframe.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin");a.iframe.setAttribute("allow","accelerometer 'none';autoplay 'none';"+"camera 'none';document-domain 'none';encrypted-media 'none';fullscreen 'none';"+"geolocation 'none';gyroscope 'none';magnetometer 'none';microphone 'none';midi 'none';"+"payment 'none';picture-in-picture 'none';sync-xhr 'none';usb 'none';xr-spatial-tracking 'none';");a.iframe.src=b+F+a.transport.getId()+"&"+L({origin:window.location.origin,prerenderSize:0,visibilityState:"visible",viewportType:a.options.mobileSafari?"natural":"natural-ios-embed",paddingTop:0,history:1,p2r:0,storage:0,development:0,log:1,cap:c.join(","),csi:0});if(/^https?:\/\//.test(b)){var d=b.split("/");var e=d[0]+"//"+d[2];a.transport.setTargetOrigin(e)}a.iframe.onerror=a.asSignal(S);return O}),m(O,this.options.timeout,this.errorReporter(G,"Iframe loading timed out")),i(O,x,function(){a.transport.setTargetWindow(a.iframe.contentWindow);a.transport.sendMessage({type:A,data:a.options});return Q}),m(Q,this.options.timeout,this.errorReporter(G,"Iframe configuring timed out")),i(Q,B,function(){if(a.letter){a.transport.sendMessage({type:y,data:a.letter})}a.emit(T,undefined);return R}),n(R,z,function(b,c){a.iframe.style.height=c.data.height+"px";a.emit(W,c.data)}),n(R,D,function(b,c){a.emit(X,c.data)})],[M,O,Q,R,P].map(function(b){return n(b,E,function(b,c){a.emit(Y,c.data)})}),[M,O,Q,R].map(function(b){return i(b,C,function(c,d){if(d.data.type==="timeout"||d.data.type==="validation"||d.data.type==="lib_untrusted"){a.emit(U,d.data);return P}a.emit(V,d.data);return b})})));this.automaton.transition("create")};return e}(w);function _(a){return new Z(a)}exports.createAmpViewer=_;Object.defineProperty(exports,"__esModule",{value:true})});(function(){"use strict";var a=Function("return this")();var b,c={},d={16:false,18:false,17:false,91:false},e="all",f={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},g={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},h=function(a){return g[a]||a.toUpperCase().charCodeAt(0)},i=[];for(b=1;b<20;b++)g["f"+b]=111+b;function j(a,b){var c=a.length;while(c--)if(a[c]===b)return c;return-1}function k(a,b){if(a.length!=b.length)return false;for(var c=0;c<a.length;c++){if(a[c]!==b[c])return false}return true}var l={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function m(a){for(b in d)d[b]=a[l[b]]}function n(a){o(a);var b,e,g,h,k,l;b=a.keyCode;if(j(i,b)==-1){i.push(b)}if(b==93||b==224)b=91;if(b in d){d[b]=true;for(g in f)if(f[g]==b)s[g]=true;return}m(a);if(!s.filter.call(this,a))return;if(!(b in c))return;l=z();h=c[b].length;while(h--){e=c[b][h];if(e.scope==l||e.scope=="all"||p(e.scope)){k=e.mods.length>0;for(g in d)if(!d[g]&&j(e.mods,+g)>-1||d[g]&&j(e.mods,+g)==-1)k=false;if(e.mods.length==0&&!d[16]&&!d[18]&&!d[17]&&!d[91]||k){if(e.method(a,e)===false){a.preventDefault();a.stopPropagation()}if(a.isImmediatePropagationStopped()){return true}}}}}function o(a){var b=false,c=false,d=a.stopImmediatePropagation;!a.target&&(a.target=a.srcElement);!a.isDefaultPrevented&&(a.isDefaultPrevented=function(){return b});!a.isImmediatePropagationStopped&&(a.isImmediatePropagationStopped=function(){return c});!a.preventDefault&&(a.preventDefault=function(){b=true;a.returnValue=false});!a.stopPropagation&&(a.stopPropagation=function(){a.cancelBubble=false});a.stopImmediatePropagation=function(){c=true;a.stopPropagation();d&&d.call(a)}}function p(a){if(a&&a.nodeType===1){do{if(a===document.body){return true}}while(a=a.parentNode)}return false}function q(a){var b=a.keyCode,c,e=j(i,b);if(e>=0){i.splice(e,1)}if(b==93||b==224)b=91;if(b in d){d[b]=false;for(c in f)if(f[c]==b)s[c]=false}}function r(){for(b in d)d[b]=false;for(b in f)s[b]=false}function s(a,b,d){var e,f,g;e=B(a);if(d===undefined){d=b;b="all"}for(var i=0;i<e.length;i++){f=[];a=e[i].split("+");if(a.length>1){f=C(a);a=[a[a.length-1]]}a=a[0];a=h(a);if(!(a in c))c[a]=[];g=u(a,b,d,f);if(g>-1){c[a].push(c[a].splice(g,1)[0])}else{c[a].push({shortcut:e[i],scope:b,method:d,key:e[i],mods:f})}}}function t(a,b,d){var e,f,g=[],i,j;e=B(a);if(!b||typeof b==="function"){d=b;b="all"}for(i=0;i<e.length;i++){f=e[i].split("+");if(f.length>1){g=C(f)}a=f[f.length-1];a=h(a);if(b===undefined){b=z()}do{j=u(a,b,d,g);if(j>-1){c[a].splice(j,1)}}while(j!=-1)}}function u(a,b,d,e){var f,g,h=c[a];if(h){for(f=0;f<h.length;f++){g=h[f];if(g.scope===b&&(d===undefined||g.method===d)&&k(g.mods,e)){return f}}}return-1}function v(a){if(typeof a=="string"){a=h(a)}return j(i,a)!=-1}function w(){return i.slice(0)}function x(a){var b=a.target.tagName;return!(b=="INPUT"||b=="SELECT"||b=="TEXTAREA")}for(b in f)s[b]=false;function y(a){e=a||"all"}function z(){return e||"all"}function A(a){var b,d,e;for(b in c){d=c[b];for(e=0;e<d.length;){if(d[e].scope===a)d.splice(e,1);else e++}}}function B(a){var b;a=a.replace(/\s/g,"");b=a.split(",");if(b[b.length-1]==""){b[b.length-2]+=","}return b}function C(a){var b=a.slice(0,a.length-1);for(var c=0;c<b.length;c++)b[c]=f[b[c]];return b}function D(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else if(a.attachEvent)a.attachEvent("on"+b,function(){c(window.event)})}D(document,"keydown",function(a){if(n(a)!==true){var b=key.listeners,c=0,d=b.length;for(;c<d;c++){b[c](a);if(a.isImmediatePropagationStopped()){return true}}}});D(document,"keyup",q);D(window,"focus",r);var E=a.key;function F(){var b=a.key;a.key=E;return b}a.key=s;a.key.setScope=y;a.key.getScope=z;a.key.deleteScope=A;a.key.filter=x;a.key.isPressed=v;a.key.getPressedKeyCodes=w;a.key.noConflict=F;a.key.unbind=t;a.key.on=s;a.key.off=t;a.key.listeners=[];if(typeof module!=="undefined")module.exports=s;define("@mail/keymaster",[],function(){return s})})(this);(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?b(exports):typeof define==="function"&&define.amd?define("@mail/release-detect",["exports"],b):(a=typeof globalThis!=="undefined"?globalThis:a||self,b(a["@mail/release-detect"]={}))})(this,function(exports){"use strict";var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c]};return a(b,c)};function b(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}var c=function(){c=Object.assign||function a(b){for(var c,d=1,e=arguments.length;d<e;d++){c=arguments[d];for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f))b[f]=c[f]}return b};return c.apply(this,arguments)};var d=function(a){b(c,a);function c(b){var c=a.call(this,"Assertion error: "+b)||this;c.name="AssertionError";return c}return c}(Error);function e(a,b){if(a&&typeof a=="object"){return}throw new d(b+" is not an object")}function f(a,b){if(typeof a!=="string"){throw new d(b+" is not a string")}}function g(a,b){if(!(a instanceof Date)||isNaN(+a)){throw new d(b+" is not a valid Date")}}function h(a,b){e(a,b);f(a["name"],b+".name");f(a["branch"],b+".branch");g(a["date"],b+".date");f(a["dateStr"],b+".dateStr")}function i(a,b){if(a){var c=a.split("."),e=c[0],f=c[1];if(e&&f){var g=new Date(f.replace(/_/g,":"));var i={name:a,branch:e,date:g,dateStr:f};h(i,b);return i}}throw new d(b+" is not a valid build string")}function j(a,b){e(a,b);if(a["build"]!==undefined){f(a["build"],b+".build")}}function k(a,b){j(a,b);return a}function l(a){return!!a&&typeof a==="object"&&typeof a["status"]==="number"}function m(a){return!!a.body&&typeof a.body==="object"&&a.status>=200&&a.status<300}var n=function(a){b(c,a);function c(b,c){var d=a.call(this,"XHRError on url "+c+": status "+b)||this;d.name="XHRError";d.status=b;d.url=c;return d}return c}(Error);function o(a,b){return new Promise(function(c,d){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===4){if(e.status>=200&&e.status<300){c(e.responseText)}else{d(new n(e.status,a))}}};e.open("GET",a,true);e.timeout=b;e.send()})}var p=function(){function a(a,b){var d=this;if(b===void 0){b=3e4}this._data={};this._initialData={};this.shadowReloadPage=function(a,b){var e;d._initialData=c(c({},d._initialData),d._data);b("deploy_shadow",{i:(e={},e[d.config.name]=1,e)})};this.config=a;this.timeout=b;if(a.initialData){this._data=a.initialData;this._initialData=a.initialData}}Object.defineProperty(a.prototype,"data",{get:function(){return this._data},enumerable:false,configurable:true});a.prototype.update=function(){var a=this;var b=this._initialData;var c=typeof this.config.endpoint==="function"?this.config.endpoint():this.config.endpoint;return o(c,this.timeout).then(function(d){var e,f;var g=JSON.parse(d);var h={};if(l(g)){if(!m(g)){throw new n(g.status,c)}h=g.body}else{h=k(g,a.config.name)}var i=a.config.comparator(b,h);a._data=h;(f=(e=a.config).ondata)===null||f===void 0?void 0:f.call(e,h,a.config);if(a.config.shadow&&i.changed){i.reloadPage=a.shadowReloadPage}return i})};return a}();var q=["code","errno","syscall"];function r(a){if(!a||typeof a!=="object"){return a}if(typeof a.toJSON==="function"){return a.toJSON()}var b=c(c({},a),{name:a.name,message:a.message,stack:a.stack});for(var d=0,e=q;d<e.length;d++){var f=e[d];b[f]=a[f]}return b}function s(a){return Number.isNaN(a[0])||Number.isNaN(a[1])}function t(a,b){return b[0]<a[0]}function u(a,b){return b[1]<a[1]}function v(a){var b=a[0],c=a[1];return Math.floor(Math.random()*(c-b))+b}var w=function(){function a(a){var b=this;this._onError=function(a){var c;var d=false;if(a&&typeof a==="object"){if(a.name==="AssertionError"){b._radar(["deploy_fail","upd"])}if(a.name==="XHRError"){b._radar(["deploy_fail","xhr"],{i:(c={},c["status_"+a.status]=1,c)});d=true}}b._radar("deploy_fetch-error",!d?{rlog:"deploy_fetch-error",rlog_message:a instanceof Error?r(a):{error:"unknown"}}:undefined)};this._reload=function(a){location.href=a};this._config=c({},a);this._models=this._config.sources.map(function(b){return new p(b,a.xhrTimeout)});this._config.router.on("route-end",function(){b._fetchAndProcessConfig()});this._data=this._currentData()}a.prototype._currentData=function(){var a={};for(var b=0,c=this._models;b<c.length;b++){var d=c[b];var e=d.data;var f=Object.keys(e);for(var g=0,h=f;g<h.length;g++){var i=h[g];a[i]=e[i]}}return a};a.prototype._updateAll=function(){var a=this;return Promise.all(this._models.map(function(b){return b.update().catch(a._onError)})).then(function(a){var b={changed:false,reloadTimeRange:[NaN,NaN]};for(var c=0,d=a;c<d.length;c++){var e=d[c];if(!e||!e.changed){continue}b.changed=true;b.reloadPage=e.reloadPage;if(e.reason!==undefined){b.reason=e.reason}var f=s(b.reloadTimeRange);var g=t(b.reloadTimeRange,e.reloadTimeRange);var h=u(b.reloadTimeRange,e.reloadTimeRange);if(f||g&&h){b.reloadTimeRange=e.reloadTimeRange}}return b})};a.prototype._fetchAndProcessConfig=function(){var a=this;this._updateAll().then(function(b){var c;if(!b.changed){return}var d=a._currentData();var e=i((c=d.build)!==null&&c!==void 0?c:"","next");a._scheduleReload(e,b);a._radar("deploy_upd")}).catch(this._onError)};a.prototype._scheduleReload=function(a,b){var c=this;var d=v(b.reloadTimeRange);var e=d*1e3*60;if(this._reloadTid){return}this._reloadTid=setTimeout(function(){c._reloadTid=undefined;c._config.router.one("before-route",function(a){var d,e;if(a.target.activeRequest){var f=(d=b.reloadPage)!==null&&d!==void 0?d:c._reload;var g=a.target.activeRequest.href;if(c._config.location){g=c._config.location(g)}f(g,(e=c._config.xraySend)!==null&&e!==void 0?e:function(){return undefined})}});c._radar("deploy_switch");c._radar(["deploy_"+a.branch,a.dateStr]);if(b.reason!==undefined){c._radar("deploy_"+b.reason)}},e);this._radar("deploy_switch_reload_timeout",{v:d})};a.prototype._radar=function(a,b){if(this._config.xraySend){this._config.xraySend(a,b)}};return a}();var x=function(a,b){var c=Object.keys(a);var d=Object.keys(b);var e=c.length===d.length&&c.every(function(c){if(a[c]===""||b[c]===""){return true}return a[c]===b[c]});return{changed:!e,reason:e?undefined:this.name,reloadTimeRange:this.reloadTimeRange}};var y=function(a,b){if(!a.build&&!b.build){return{changed:false,reloadTimeRange:this.reloadTimeRange}}if(!a.build||!b.build){return{changed:true,reason:"upd_empty",reloadTimeRange:this.reloadTimeRange}}var c=i(a.build,"current");var d=i(b.build,"next");var e=c.name===d.name;return{changed:!e,reason:e?undefined:"upd_"+(d.date>c.date?"up":"down"),reloadTimeRange:this.reloadTimeRange}};function z(a,b){return function(c){var d=encodeURIComponent(a)+"="+encodeURIComponent(b);var e=c.indexOf("?")>=0;return""+c+(e?"&":"?")+d}}function A(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}return function(b){for(var c=0,d=a;c<d.length;c++){var e=d[c];b=e(b)}return b}}function B(a){return new w(a)}exports.appendQuery=z;exports.buildComparator=y;exports.combine=A;exports.createReleaseDetectClient=B;exports.hashComparator=x;Object.defineProperty(exports,"__esModule",{value:true})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("temporary/fix-signature",["require","exports","@mail/features","@mail/flags","@mail/xray","cfgUser","service/auth"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fixSignature=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);var f=/[\x00-\x1F\x22\x3C\x3E\x3A\xAD]/g;function g(a){return a&&typeof a==="object"}function h(a){if(typeof a==="string"){var b=a.replace(f,"");if(b.length){return b}}return""}function i(a){return{body:a.body,status:a.status,requestID:a.requestID,uuid:a.uuid}}function j(a){if(!g(a)){try{return{notAnObject:JSON.stringify(a)}}catch(a){return{notAnObject:"JSON.stringify error"}}}if(a.status===406){if(g(a.data)){delete a.data.token}return __assign(__assign({},i(a)),{data:a.data})}if(typeof a.status==="number"){return i(a)}return{name:a.name,message:a.message,stack:a.stack}}function k(){var a=d.default.get("initialUser.signs");if(!Array.isArray(a)){c.default.send("sign-fix_emptysigns");return Promise.resolve({hasBroken:false})}if(a.length===0){c.default.send("sign-fix_zerosigns");return Promise.resolve({hasBroken:false})}var b=false;var f=a.map(function(a){if(!g(a)){c.default.send("sign-fix_emptysign");return{}}a.name=h(a.name);var d=a.sign,e=a.sign_html;if(d&&!e){c.default.send("sign-fix_nohtml");return a}var f=d;try{var i=document.createElement("div");i.style.cssText="position: fixed; top: -9999px; left: -9999px;";i.setAttribute("contenteditable","true");document.body.appendChild(i);i.innerHTML=e;f=i.innerText;document.body.removeChild(i)}catch(a){b=true;c.default.send("sign-fix_reparserr",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_parseerr",error:a}})}return __assign(__assign({},a),{sign:f})});if(f.some(function(a){var b=a.name;return!b})){c.default.send("sign-fix_noname");return Promise.resolve({hasBroken:true})}return e.default.login().then(function(a){return a.save({signs:f}).catch(function(a){c.default.send("sign-fix_save_err",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_save_err",e:j(a)}});return{hasBroken:true}}).then(function(){return{hasBroken:b}})},function(a){c.default.send("sign-fix_userget_err",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_userget_err",e:a}});return{hasBroken:false}})}function l(){var d=b.default.get("user-signature-fix");var e=a.default.has("user-signature-fixer-enabled");var f=d.state;if(!e||f){return}k().then(function(a){var b=a.hasBroken;d.save({state:true,time:true,hit:b}).then(function(){c.default.send("sign-fix_success")},function(a){c.default.send("sign-fix_helpersave_err",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_helpersave_err",e:a}})})})}exports.fixSignature=l});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/page-title",["require","exports","cfg","default-values","Emitter","feast","helpers/browser","pilotjs","service/calls","service/mailbox/on-status/unread-messages-notifications"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getNextBlinkingTitle=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importStar(g);h=__importDefault(h);var i=document.title||i18n("Почта Mail.ru");var j=function(){function a(a,b){this._switched=false;var c=document.querySelector(a);var d=c&&c.getAttribute("href");this._el=c;this._href=d;this._defaultHref=d;this._switchedHref=b;this._switched=false}a.prototype._createIconElement=function(a){var b=this._el;if(!b){return}var c=document.createElement("LINK");for(var d=0,e=b.attributes;d<e.length;d++){var f=e[d];if(f.name==="href"){c.setAttribute("href",a)}else{c.setAttribute(f.name,f.value)}}return c};a.prototype.switch=function(a){if(!b.DYNAMIC_FAVICON){return}if(this._switched===a){return}this._switched=a;this._href=this._switched?this._switchedHref:this._defaultHref;this._el.parentNode&&this._el.parentNode.removeChild(this._el);this._el=this._createIconElement(this._href);if(this._el){document.head.appendChild(this._el)}};return a}();var k=function(b){__extends(c,b);function c(){var c=b.call(this)||this;c._blinkingInterval=null;c._timeoutId=null;c._blinkingInProcess=false;c._titles={original:"",custom:""};c._iconSwitchers=[new j('link[rel="icon"][sizes="16x16"]',a.default.get("faviconURL")+"/16-fav_mail_unread.png"),new j('link[rel="icon"][sizes="24x24"]',a.default.get("faviconURL")+"/24-fav_mail_unread.png"),new j('link[rel="icon"][sizes="32x32"]',a.default.get("faviconURL")+"/32-fav_mail_unread.png"),new j('link[rel="icon"][sizes="48x48"]',a.default.get("faviconURL")+"/48-fav_mail_unread.png")];return c}c.prototype.start=function(a){this._titles.original=a.originalTitle;this._titles.custom=a.customTitle;this._blinkingInterval=a.timeout;this._blinkingInProcess=true;if(a.enableIconSwitch){this._iconSwitchers.forEach(function(a){return a.switch(true)})}this._blinkingStep()};Object.defineProperty(c.prototype,"blinkingInProcess",{get:function(){return this._blinkingInProcess},enumerable:false,configurable:true});c.prototype.update=function(a){this._titles.original=a.originalTitle;this._titles.custom=a.customTitle;this._blinkingInterval=a.timeout;this._iconSwitchers.forEach(function(b){return b.switch(!!a.enableIconSwitch)})};c.prototype.stop=function(){this._blinkingInProcess=false;this._iconSwitchers.forEach(function(a){return a.switch(false)});this.emit("update",{title:this._titles.original});clearTimeout(this._timeoutId)};c.prototype._getTitleToShow=function(){return document.title===this._titles.original?this._titles.custom:this._titles.original};c.prototype._blinkingStep=function(){this.emit("update",{title:this._getTitleToShow()});this._timeoutId=window.setTimeout(this._blinkingStep.bind(this),this._blinkingInterval)};return c}(c.default);var l={calls:null,message:null,folder:null};var m=function(a){var b=[a.calls,a.message];return b.find(function(a){return a!==null})||null};exports.getNextBlinkingTitle=m;exports.default=d.default.Mediator.create("page-title",{defaults:function(){this.register(this.blinker=new k);this.register(g.default);this.updateFolderTitle=this.updateFolderTitle.bind(this)},components:{router:{class:f.default,events:["route"],handleEvent:"handleRoute"},"unread-notifier":{class:h.default,events:["update"],handleEvent:"handleNotifier"},blinker:{class:k,events:["update"],handleEvent:"setTitle"},callsService:{class:g.CallsService,events:["update"],handleEvent:"handleCall"}},updateFolderTitle:function(a){if(!a||!a.target){return}var b=a.target;var c=b.get("messages_unread")?i18n("({unreadCount}) {folderName} - {defaultTitle}",{unreadCount:b.get("messages_unread"),folderName:b.get("name"),defaultTitle:i}):i18n("{folderName} - {defaultTitle}",{folderName:b.get("name"),defaultTitle:i});l.folder={title:c};this.setNextTitle()},handleRoute:function(a){if(a===void 0){a=null}if(a){l.folder={title:this.getTitleFromEvent(a)};this.setNextTitle()}},handleNotifier:function(a){if(a){var b=a.timeout,c=a.count;var d=this.getTitleByUnreadMessages(c);l.message={title:d,timeout:b}}else{l.message=null}this.setNextTitle()},handleCall:function(a){var c=a.action,d=a.text;if(!b.CALL_TITLE_BLINK_INTERVAL){return}if(c==="start"){var e=d+i18n(" - {defaultTitle}",{defaultTitle:i});l.calls={title:e,timeout:b.CALL_TITLE_BLINK_INTERVAL}}else if(c==="end"){l.calls=null}this.setNextTitle()},setNextTitle:function(){var a=exports.getNextBlinkingTitle(l);if(e.default.isSafari&&a&&a===l.calls){this.blinker.stop();this.setTitle({title:a.title});return}if(a){var b={timeout:a.timeout,customTitle:a.title,enableIconSwitch:a===l.message,originalTitle:l.folder.title||i};this.blinker.blinkingInProcess?this.blinker.update(b):this.blinker.start(b);return}if(this.blinker.blinkingInProcess){this.blinker.stop()}if(l.folder){this.setTitle({title:l.folder.title});return}this.setTitle({title:i})},setTitle:function(a){var b=a.title;document.title=b},getTitleFromEvent:function(a){if(this.folder){this.folder.off("change",this.updateFolderTitle);this.folder=null}if(!a.target||!a.target.model){return i}var b=a.target.model;var c;switch(b.route.id){case"#letters":if(b.folder){c=b.folder.get("messages_unread")?i18n("({unreadCount}) {folderName}",{unreadCount:b.folder.get("messages_unread"),folderName:b.folder.get("name")}):b.folder.get("name");b.folder.on("change",this.updateFolderTitle);this.folder=b.folder}break;case"#search":c=i18n("Поиск");break;case"#attachment":c=b.attachment&&b.attachment.get("name");break}return c?i18n("{title} - {defaultTitle}",{"unsafe-title":c,defaultTitle:i}):i},getTitleByUnreadMessages:function(a){return i18n.plural(a,[i18n("{count} новых писем",{count:a}),i18n("{count} новое письмо",{count:a}),i18n("{count} новых письма",{count:a})])}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/calendar-manager",["require","exports","@mail/xray","cfg","default-values","feast","feast-mod/correspondents","helpers/opener","mail/Message","mail/Thread","pilotjs","service/fishing","ui-block/calendar-button/calendar-button","ui-block/compose-dropdown/compose-dropdown","ui-block/contextmenu-message/contextmenu-message","ui-block/dropdown-actions/dropdown-actions","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CalendarManager=void 0;a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);var p=1500;var q=100;var r=255;var s=4096;var t=["calendar:create","calendar:createnew"];var u=function(d){__extends(u,d);function u(){return d!==null&&d.apply(this,arguments)||this}u.prototype.getComponentsSpec=function(){return{router:{class:i.default},letter:{lazy:o.lazyUILetter,events:t},"calendar-button":{class:k.default,events:t},"contextmenu-message":{class:m.default,events:t},"dropdown-actions":{class:n.default,events:t},"compose-dropdown":{class:l.default,events:t}}};u.prototype.handleEvent=function(a){var b=a.type;var c=a.details,d=c.model,e=c.createContent;var f={type:b};var h=f.type.split(":").pop();if(h==="createnew"){return this.doAction(h,g.default.getSafe(),e)}var i=this.get("router.model.letter");return this.doAction(h,d||i,e)};u.prototype.doAction=function(a,d,e){if(!d){return}if(d instanceof h.default&&d.get("messages.length")){d=d.getExpandMessage()}if(c.USE_X_CALENDAR){this.createEventInXCalendar(a,d,e);return}if(a==="create"){var g=this.constructForm(d);document.body.appendChild(g);j.default.go(g);document.body.removeChild(g)}else if(a==="createnew"){var i=b.default.get("urls.calendarUrl")||"//calendar.mail.ru";f.default(i+"?action=eventCreate")}return false};u.prototype.createEventInXCalendar=function(a,c,d){var e=b.default.get("urls.xCalendarUrl")||"//x.calendar.mail.ru";var g=this.getCategory(c);var h=a==="create"?{action:"createEvent",title:this.getSummary(c,r),emails:!g?this.getAttendees(c,q):null,description:this.getDescription(c,1e3),createContent:d}:{action:"createEvent",createContent:d};f.default(e+"?"+this.getCalendarCreateQueryParamsString(e,h))};u.prototype.getCalendarCreateQueryParamsString=function(b,c){var d=s-(b+"?").length;return Object.entries(c).filter(function(a){var b=a[1];return b}).reduce(function(b,c){var e;var f=c[0],g=c[1];var h=b+"&"+i.default.queryString.stringify((e={},e[f]=g,e));if(h.length>d){a.default.send("clnd_create_"+f+"_limit");return b}return h},"")};u.prototype.constructForm=function(a){var c=document.createElement("form");c.setAttribute("method","post");c.setAttribute("target","_blank");c.setAttribute("action",b.default.get("urls.calendarUrl")||"//calendar.mail.ru");c.setAttribute("style","position: absolute;left: -1000px;top: -1000px;width: 0px;height: 0px;");var d=this.constructFormData(a);Object.keys(d).forEach(function(a){var b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name",a);b.setAttribute("value",d[a]);c.appendChild(b)});return c};u.prototype.constructFormData=function(a){return{description:this.getDescription(a),summary:this.getSummary(a),attendees:this.getAttendees(a),category:this.getCategory(a),dtfrom:this.getPriorityDate(a)}};u.prototype.getSummary=function(a,b){var c=(a.get("subject")||i18n("<Без темы>")).replace(/(((Fwd|Re)[?[\d]*]?:[\s]*)+)/i,"").trim();if(c.length>b){return c.slice(0,b-3)+"..."}return c};u.prototype.getDescription=function(a,b){if(b===void 0){b=p}var c=(a.get("body.text")||a.get("snippet")||"").trim();if(c.length>b){c=c.slice(0,b-3)+"..."}return c};u.prototype.getAttendees=function(a,b){return e.getAllCorrespondentsEmailsFromMessage(a).slice(0,b).join(",")};u.prototype.getCategory=function(a){var b=a.get("transaction_category");var c=a.getFolder();var d=c.isMetathread()&&c.get("type");return b||d||""};u.prototype.getPriorityDate=function(a){return a.get("dates_metadata.priority_date.timestamp",void 0)};return u}(d.default.Mediator);exports.CalendarManager=u;exports.default=d.default.Mediator.createFromClass("calendar-manager",u)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/calls-manager",["require","exports","feast","mail/Message","mail/Thread","pilotjs","service/calls","service/compose","service/notify","ui-block/compose-dropdown/compose-dropdown","ui-block/contextmenu-message/contextmenu-message","ui-block/dropdown-actions/dropdown-actions","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CallsManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);var l=["calls:invite","calls:invitenew"];var m=function(a){__extends(m,a);function m(){return a!==null&&a.apply(this,arguments)||this}m.prototype.getComponentsSpec=function(){return{router:{class:d.default},letter:{lazy:k.lazyUILetter,events:l},"contextmenu-message":{class:i.default,events:l},"dropdown-actions":{class:j.default,events:l},"compose-dropdown":{class:h.default,events:l}}};m.prototype.handleEvent=function(a){var c=a.type;var d=a.details.model;var e=this.get("router.model.letter");var f={type:c};var g=f.type.split(":").pop();if(g==="invitenew"){return this.doAction(g,b.default.getSafe())}return this.doAction(g,d||e)};m.prototype.doAction=function(a,b){if(!b){return false}if(b instanceof c.default&&b.get("messages.length")){b=b.getExpandMessage()}var d=a==="invitenew"?{mode:"new",subject:e.default.getSubject()}:{mode:"replyall",model:b};f.default.open(d);e.default.createRoom().then(function(a){var b=e.default.getTemplate(a);if(f.default.isComposeActive()){f.default.insertHtml(b)}else{f.default.open(__assign(__assign({},d),{body:b,additionalOptions:{prefilledBody:true}}))}}).catch(function(a){if(a==="ratelimit"){g.default.error({text:i18n("Достигнут лимит создания звонков. Попробуйте позже.")},"compose-notify")}else{g.default.error({text:i18n("Не удалось создать ссылку на звонок")},"compose-notify")}});return false};return m}(a.default.Mediator);exports.CallsManager=m;exports.default=a.default.Mediator.createFromClass("calls-manager",m)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/welcome-block-manager",["require","exports","@mail/flags","default-values","feast","helpers/getCurrentTimestamp","helpers/opener","helpers/rb","mail/Folder","models/welcome-block-letter/welcome-block-letter","pilotjs","service/radars/index","ui-block/dataset/dataset","ui-block/dataset-letters/dataset-letters","ui-block/list-letter-welcome/list-letter-welcome","ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions","ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WelcomeBlockManager=void 0;a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importStar(l);m=__importStar(m);n=__importStar(n);o=__importStar(o);var p="welcome-block";function q(a){return a.details&&a.details.hasOwnProperty("skill")}var r=function(c){__extends(r,c);function r(){var a=c!==null&&c.apply(this,arguments)||this;a.pollingWeatherPid=null;a.canShowChecked=false;return a}r.prototype.getComponentsSpec=function(){return{router:{class:i.default,events:["routeend"],handleEvent:"handleRouteEvent"},"dataset-letters":{class:l.default,events:[l.DatasetLettersEvents.NewRange]},dataset:{class:k.default},"list-letter-welcome":{class:m.default,events:[m.Events.MOUNT,m.Events.HIDE]},"list-letter-welcome-suggestions":{class:o.default,events:[o.Events.SuggestionClick],handleEvent:"handleMarusiaEvent"},"list-letter-welcome-dropdown-actions":{class:n.default,events:[n.Events.PIN,n.Events.SELECT_GEO,n.Events.SNOOZE]}}};r.prototype.handleMarusiaEvent=function(a){if(!q(a)){return false}switch(a.details.skill){case"music":{break}}return false};r.prototype.handleRouteEvent=function(){var a=this.get("router");if(!a||!this.isVisible()){return}var b=a.route.is("#letters")||a.model.uiLayout.type==="3pane"&&a.model.uiLayout.support3pane&&a.route.is("#read-letter");if(!b||a.route.params.folder!==g.default.INBOX){this.hide();j.default(["ll-wlcm","hide-on","route"])}};r.prototype.handleEvent=function(a){var c,d,f,h;var i=this.get("router");switch(a.type){case l.DatasetLettersEvents.NewRange:var k=a.details.start;if(this.isVisible()&&((c=i===null||i===void 0?void 0:i.route)===null||c===void 0?void 0:c.params.folder)===g.default.INBOX&&k>b.WELCOME_BLOCK_SCROLL_HIDE_THRESHOLD){this.hide();j.default(["ll-wlcm","hide-on","scroll"])}break;case m.Events.MOUNT:if(!this.canShowChecked){this.canShowChecked=true;if(this.canShow()){this.show();j.default(["ll-wlcm","can-show"])}else{j.default(["ll-wlcm","cannot-show"])}}if((d=this.getModel())===null||d===void 0?void 0:d.is("visible")){this.startPollingWeather()}if((f=this.getModel())===null||f===void 0?void 0:f.is("withGreeting")){this.delayedHideGreeting()}break;case m.Events.SHOW:if((h=this.getModel())===null||h===void 0?void 0:h.is("visible")){this.startPollingWeather()}break;case m.Events.HIDE:this.stopPollingWeather();break;case n.Events.PIN:break;case n.Events.SELECT_GEO:e.default(b.SELECT_GEO_URL+"?from=mailwelcome");break;case n.Events.SNOOZE:this.hide(true);j.default(["ll-wlcm","hide-on","snooze"]);break}return false};r.prototype.startPollingWeather=function(){var a=this;if(!this.pollingWeatherPid){this.fetchWeather();this.pollingWeatherPid=window.setInterval(function(){a.fetchWeather()},b.WELCOME_BLOCK_UPDATE_WEATHER_INTERVAL*1e3)}};r.prototype.stopPollingWeather=function(){window.clearInterval(this.pollingWeatherPid);this.pollingWeatherPid=null};r.prototype.delayedHideGreeting=function(){var a=this;window.setTimeout(function(){var b;(b=a.getModel())===null||b===void 0?void 0:b.set("withGreeting",false)},b.WELCOME_BLOCK_HIDE_GREETING_TIMEOUT*1e3)};r.prototype.fetchWeather=function(){var a=this;f.default.getSlot("t1189").then(function(b){var c=a.getModel();c===null||c===void 0?void 0:c.set("weatherData",b)})};r.prototype.getFlag=function(){return a.default.get(p)};r.prototype.isSnoozed=function(){return this.getFlag().getCount("show")%2===1};r.prototype.getModel=function(){return h.default.all[0]};r.prototype.updateDataset=function(){var a=this;setTimeout(function(){var b;(b=a.get("dataset"))===null||b===void 0?void 0:b.updateItems()})};r.prototype.canShow=function(){var a=this.getFlag();var c=a.getTime();var e=this.isSnoozed()?b.WELCOME_BLOCK_SNOOZE_INTERVAL:b.WELCOME_BLOCK_SHOW_INTERVAL;var f=d.getCurrentTimestamp();return f>c+e};r.prototype.isVisible=function(){var a;return(a=this.getModel())===null||a===void 0?void 0:a.is("visible")};r.prototype.show=function(){var a;var b=this.isVisible();(a=this.getModel())===null||a===void 0?void 0:a.set("visible",true);this.updateDataset();if(!b){var c=this.getFlag();var d=this.isSnoozed();c.save({time:true,hit:d})}};r.prototype.hide=function(a){var b;if(a===void 0){a=false}if(this.isVisible()){(b=this.getModel())===null||b===void 0?void 0:b.set("visible",false);this.updateDataset();var c=this.getFlag();var d=a&&!this.isSnoozed();c.save({time:true,hit:d})}};return r}(c.default.Mediator);exports.WelcomeBlockManager=r;exports.default=c.default.Mediator.createFromClass("welcome-block-manager",r)});define("helpers/logger",["exports","@mail/features","helpers/parse","logger","mail/Attachment","service/notify","service/radars/index","./create-message-form-data"],function(exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendLogs=y;var h=m(a);var i=m(c);var j=m(d);var k=m(e);var l=m(f);function m(a){return a&&a.__esModule?a:{default:a}}var n=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var o=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function p(a,b){var c=new Blob([a],{type:"text/plain"});c.name=b;return c}var q=h.default.getAsJSON("logger-config",{});var r={Body:true,Subject:true,body:true,"body.html":true,subject:true,name:true,signature:true,translate_query:true,token:true};if(q.ignoreKeys){Object.assign(r,q.ignoreKeys)}var s={"/api/v1/utils/translate":{query:true}};if(q.ignoreUrlKeys){Object.assign(s,q.ignoreUrlKeys)}var t={insert_success:{result:true},success:{jqXHR:true,direct:true,target:true}};var u=parseInt(q.maxDepth,10)||10;var v=function a(b){if(b&&(typeof b==="undefined"?"undefined":o(b))==="object"){return b.length}return void 0};var w=function a(b,c){var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var e=arguments.length>3&&arguments[3]!==undefined?arguments[3]:r;if(!b){return b}if((typeof b==="undefined"?"undefined":o(b))!=="object"){return b}if(b.toLogJSON){b=b.toLogJSON()}if(c&&t[c]){e=n({},e,t[c])}return Object.keys(b).reduce(function(c,f){var g=b[f];if(f==="url"&&s[g]){e=n({},e,s[g])}if((typeof g==="undefined"?"undefined":o(g))==="object"){if(e[f]){c[f]=v(g);return c}if(d<=u&&!(g&&g.nodeType)){c[f]=a(g,null,d+1,e);return c}}else{c[f]=e[f]?v(g):g}return c},{})};i.default.filterArguments=w;function x(){var a={in_code:window.__trackJS.__errors,external:window.__trackJS.__externalErrors};var c={errors:a,loadLog:window.loadlogSteps};try{var d=f.radarService.loadPerformanceLog();if(Array.isArray(d)){d.slice().sort(function(a,b){if(a.startTime&&b.startTime&&a.startTime!==b.startTime){return a.startTime-b.startTime}return a.endTime-b.endTime})}else{(0,l.default)("invalid_notarr_perflog")}if((0,b.parseStringToBoolean)(q.inlinePerfLog)){i.default.add(JSON.stringify(d))}else{c.perfLog=d}}catch(a){i.default.add(a);console.error(a)}c.logs=(0,b.parseStringToBoolean)(q.usePrint)?i.default.print(true):i.default.entries;var e=void 0;try{e=JSON.stringify(c)}catch(a){i.default.add(a);console.error(a)}var m=h.default.get("email_logs_to");if(m&&m.data){m=m.data.split(",")}else{m=["aleksandr.tsvetkov@corp.mail.ru"]}var n=m[0];var o=m.slice(1,m.length);var r=(0,g.createMessageFormData)({subject:"[octavius client logs]",priority:1,body:{text:"",html:""},correspondents:{to:[{email:n}],cc:o.map(function(a){return{email:a}})}});var s=void 0;try{s=j.default.from(p(e,"logs.json"))}catch(a){r.set("body.html",e);console.error(a);(0,l.default)("log_file_create_fail")}var t=s?r.addAttachment(s):Promise.resolve();t.then(function(){return r.send()}).then(function(){if(k.default.isReady()){k.default.add({qa:"sent-logs",text:i18n("Логи отправлены")})}}).catch(function(a){console.error(a);(0,l.default)("logs_send_fail");k.default.add({type:k.default.types.error,text:i18n("Логи не отправлены")})})}function y(){require(["default-values"],function(a){if(a.ENABLE_LOGGING){x()}})}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/visibility-watcher",["require","exports","@mail/xray","data-source/index","default-values","service/adv/config","service/smokescreen"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VisibilityAlertWatcher=void 0;a=__importDefault(a);b=__importDefault(b);e=__importDefault(e);var f=c.VISIBILITY_WATCHER_CONFIG.errThreshold,g=c.VISIBILITY_WATCHER_CONFIG.checkTimeout,h=c.VISIBILITY_WATCHER_CONFIG.disabled;var i={left:function(a,b){return b-a},right:function(a,b){return a-b},top:function(a,b){return b-a},bottom:function(a,b){return a-b}};var j={left:function(){return 0},top:function(){return 0},right:function(){var b=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--vkui--octavius_size_layout_width_min--regular"));if(isNaN(b)){a.default.send("visibility_check_width_nan");return window.innerWidth}return Math.max(window.innerWidth,b)},bottom:function(){return window.innerHeight}};var k=Object.keys(i);function l(){var a;var c=b.default.getData();return{adv:{hasBlocker:d.hasBlocker(),hasAdBlock:d.hasAdBlock(),smokescreenEnabled:e.default.isEnabled()},layout:c.uiLayout,route:{href:(a=c.request)===null||a===void 0?void 0:a.href}}}var m=function(){function b(b){var c=this;var d=b.name,e=b.timeout,f=e===void 0?g:e,h=b.once,i=h===void 0?true:h;this.alertIfNotVisible=function(){c.didCheck=true;var b=c.getElementDocumentOverflow();if(b.some(function(a){return a.hasWindowOverflow||a.hasDocumentOverflow})){a.default.send("visibility_check_"+c.name,{rlog:"octavius_vis-check_"+c.name,rlog_message:{directionsChecks:b,meta:l()}})}};this.name=d;this.timeout=f;this.once=i}b.prototype.schedule=function(a){if(h||this.once&&this.didCheck){return}this.getEl=a;this.timeoutID=window.setTimeout(this.alertIfNotVisible,this.timeout)};b.prototype.unschedule=function(){window.clearTimeout(this.timeoutID)};b.prototype.getElementDocumentOverflow=function(){var a=this.getEl().getBoundingClientRect();var b=document.documentElement.getBoundingClientRect();return k.map(function(c){var d=b[c];var e=a[c];var g=j[c]();var h=i[c](e,d);var k=i[c](e,g);var l=h>f;var m=k>f;return{direction:c,hasWindowOverflow:m,hasDocumentOverflow:l,documentOverflow:h,windowOverflow:k,elementSide:e,documentSide:d,windowSide:g}})};return b}();exports.VisibilityAlertWatcher=m});define("feast-tpl!app/feast-tpl!ui-block/drag-and-drop/drag-and-drop.html",["feast"],function(a){return a.smartParse("<div></div>\n","app/feast-tpl!ui-block/drag-and-drop/drag-and-drop.html")});define("feast-tpl!ui-block/drag-and-drop/drag-and-drop.html",["feast-tpl!app/feast-tpl!ui-block/drag-and-drop/drag-and-drop.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/create-message-with-attach",["require","exports","service/auth","service/compose","service/layer","service/radars/index","trackJS","./check-files-from-event","./create-message-form-data","./signature"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importStar(f);var i="<div><br/></div>";function j(){var b=g.createMessageFormData();b.set("features.subject_from_attachments",true);var c=h.getHTMLSignature(a.default.user);b.set("body.html",i+i+c);return{formData:b}}function k(a,c){var d=c.slice(0,a.MAX_ATTACHMENTS_COUNT);b.default.add(a,{isDragAndDrop:true,dragAndDropItem:{files:d}})}function l(a){return __awaiter(this,void 0,void 0,function(){var g,h,i,l,m,n;return __generator(this,function(o){switch(o.label){case 0:g=c.default.getInstance();if(g){g.onHide()}o.label=1;case 1:o.trys.push([1,3,,4]);h=j().formData;return[4,f.default({event:a,limit:h.MAX_ATTACHMENTS_COUNT})];case 2:i=o.sent(),l=i.files,m=i.error;if(m){if(m===f.CheckFilesError.MAX_FILES){c.default.open("max-attach-count",{onAttachClick:function(){return k(h,l)}},{})}return[2]}k(h,l);d.default("dnd_create_msg_success");return[3,4];case 3:n=o.sent();b.default.onFailSent({},n);if(n&&n.get){d.default("dnd_create_msg_err",n.status)}else{e.default.addErrorFromApp(n,"dnd-create-msg")}return[3,4];case 4:return[2]}})})}exports.default=l});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/save-file-to-yourself",["require","exports","default-values","service/auth","service/compose","service/layer","service/radars/index","trackJS","./check-files-from-event","./check-oversize-files","./create-message-form-data","./signature"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importStar(g);var k="<div><br/></div>";function l(){var a=i.createMessageFormData();var c=b.default.user.attributes.name,d=c.first,e=c.last;var f=j.getHTMLSignature(b.default.user);a.set("body.html",k+k+f);var g=b.default.user.getEmail();var h=d||"";if(e){h=h+" "+e}a.set("correspondents.to",[{email:g,name:h||g}]);a.set("features.subject_from_attachments",true);return{formData:a}}function m(b,d){var e=d.slice(0,b.MAX_ATTACHMENTS_COUNT);return h.checkOversizeFiles(e).then(function(d){var f=!(a.OVERSIZE_CLOUD_ATTACHES&&d);c.default.add(b,{autosend:f,isDragAndDrop:true,dragAndDropItem:{files:e}})})}function n(a){return __awaiter(this,void 0,void 0,function(){var b,h,i,j,k,n;return __generator(this,function(o){switch(o.label){case 0:b=d.default.getInstance();if(b){b.onHide()}o.label=1;case 1:o.trys.push([1,3,,4]);h=l().formData;return[4,g.default({event:a,limit:h.MAX_ATTACHMENTS_COUNT})];case 2:i=o.sent(),j=i.files,k=i.error;if(k){if(k===g.CheckFilesError.MAX_FILES){d.default.open("max-attach-count",{onAttachClick:function(){return m(h,j)}},{})}return[2]}m(h,j);e.default("dnd_to_yourself_success");return[3,4];case 3:n=o.sent();c.default.onFailSent({},n);if(n&&n.get){e.default("dnd_send_self_msg_err",n.status)}else{f.default.addErrorFromApp(n,"dnd-to-yourself")}return[3,4];case 4:return[2]}})})}exports.default=n});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/drag-and-drop/drag-and-drop",["require","exports","@mail/features","cfg","default-values","feast","feast-tpl!./drag-and-drop.html","helpers/create-message-with-attach","helpers/load-file-to-cloud","helpers/save-file-to-yourself","service/compose","service/layer","service/radars/index","service/smokescreen"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);exports.default=d.default.Block.extend({name:"drag-and-drop",template:e.default,_getContainer:function(){return document.querySelector("#drag-and-drop")},attrChanged:{"dark-mode":function(a){if(this.ui){this.ui.$set({darkMode:a})}}},didMount:function(){var a=this;require(["mediator/themes-manager"],function(b){var c=b.default;c.registerInstanceByName("drag-and-drop",a)});this.renderUI()},didUnmount:function(){this.unrenderUI()},renderUI:function(){var a=this;this.unrenderUI();new Promise(function(a,b){require(["cross.project.dnd"],a,b)}).then(__importStar).then(function(b){var c=b.default;a.ui=c(a.getParams())})},unrenderUI:function(){var a;(a=this.ui)===null||a===void 0?void 0:a.$destroy();this.ui=null},getParams:function(){var a={"unsafe-markOpen":"<mark>","unsafe-markClose":"</mark>","unsafe-br":"<br>"};var d=i18n("Перетащите файлы в эту область,{br}чтобы {markOpen}написать письмо{markClose}",a);var e=i18n("Отправить {markOpen}письмо себе{markClose}",a);var i=i18n("Загрузить {markOpen}в Облако{markClose}",a);var j=this.is("dark-mode");var l=!!b.default.qa;return{target:this._getContainer(),darkMode:j,isQA:l,zones:[{size:1.5,zones:[{size:1,text:d,radarFunction:function(){return k.default("dnd_drop_create_letter")},iconSize:"large",iconName:"mail",dropFunction:f.default,testId:"drop-zone-mail"}]},{size:1,zones:__spreadArrays([{size:1,text:e,radarFunction:function(){return k.default("dnd_drop_to_yourself")},iconSize:"small",iconName:"self-mail",dropFunction:h.default,testId:"drop-zone-self-mail"}],c.DND_CLOUD_ENABLED?[{size:1,text:i,radarFunction:function(){return k.default("dnd_drop_to_cloud")},iconSize:"small",iconName:"cloud",dropFunction:g.default,testId:"drop-zone-cloud"}]:[])}],showRule:this._getShowRule(),onShow:this.showRadar,imgsBaseUrl:b.default.urls.packagesUrl,imgsPath:c.DND_IMAGES_PATH}},showRadar:function(){k.default("dnd_show")},_getShowRule:function(){var b=this;var c=a.default.has("drag-and-drop");if(!c){return function(){return false}}return function(){var a;var c=j.default.getInstance();var d=document.querySelectorAll(l.selector('[data-test-id="popup-wrapper"]')).length!==0;var e=b.get("router").model.route&&b.get("router").model.route.is("#attachment #attachment-temporary #attachment-editor");var f=(a=window===null||window===void 0?void 0:window.__PH)===null||a===void 0?void 0:a.authForm.isVisible();return!i.default.isComposeActive()&&!c&&!d&&!e&&!f}}})});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("actions/autoreply",["require","exports","@mail/jssdk/next/action/global","RPC"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fetchAutoreply=exports.url=void 0;b=__importDefault(b);exports.url="filters/autoreply";function c(a){var c=a.emails,d=a.only_enabled,e=d===void 0?true:d;if(!c){return Promise.reject({emails:"required"})}if(!Array.isArray(c)){return Promise.reject({emails:"invalid"})}return b.default.call(exports.url,{emails:c,only_enabled:e})}exports.fetchAutoreply=a.createGlobalAction(exports.url,function(a){return __awaiter(void 0,void 0,Promise,function(){var b;return __generator(this,function(d){switch(d.label){case 0:return[4,c(a)];case 1:b=d.sent();return[2,b.body]}})})})});define("feast-tpl!app/feast-tpl!ui-block/compose-app/compose-app.html",["feast"],function(a){return a.smartParse('<div qa:id="{(attrs[\'window-mode\'] === \'collapsed\') ? \'\' : \'compose-app\'}"\n\t qa:state="extended:{attrs[\'support-extend\'] && attrs.extended}"\n\t message-uid="{attrs.form.uid}">\n\t<bem:mod name="fix"/>\n\t<bem:mod name="fullscreen" test="attrs.fullscreen"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="mobile-xxs" test="attrs[\'mobile-xxs\']"/>\n\t<bem:mod name="popup" test="!attrs.fullscreen"/>\n\t<bem:mod name="popup-extended" test="attrs[\'support-extend\'] && attrs.extended"/>\n\t<bem:mod name="window" test="attrs[\'window-mode\'] === \'window\'"/>\n\t<bem:mod name="collapsed" test="attrs[\'window-mode\'] === \'collapsed\' || attrs.hidden"/>\n\t<bem:mod name="adaptive" test="attrs.adaptive && !attrs.fullscreen"/>\n\t<bem:mod name="fixed" test="!attrs.adaptive && !attrs.fullscreen"/>\n\n\t<b:focus-zone\n\t\t\tfluid\n\t\t\tenabled="{attrs[\'window-mode\'] !== \'collapsed\' && !attrs[\'focusoff\'] && !attrs[\'hidden\']}"\n\t\t\tbem:block="compose-app"\n\t\t\tremit:first="focus-zone:first"\n\t\t\tremit:last="focus-zone:last">\n\t\t<fn:match name="content">\n\t\t\t\x3c!--<div bem:elem="wrapper" ref="wrapper">--\x3e\n\t\t\t\t<div\n\t\t\t\t\t\tbem:elem="compose"\n\t\t\t\t\t\tref="compose"\n\t\t\t\t>\n\t\t\t\t\t\x3c!-- COMPOSE.MAIL.RU --\x3e\n\t\t\t\t</div>\n\t\t</fn:match>\n\t</b:focus-zone>\n</div>\n',"app/feast-tpl!ui-block/compose-app/compose-app.html")});define("feast-tpl!ui-block/compose-app/compose-app.html",["feast-tpl!app/feast-tpl!ui-block/compose-app/compose-app.html"],function(a){return a});define("helpers/char-to-key",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=a;function a(a){return String.fromCharCode(a).toLowerCase()}});define("helpers/scrollbar-width",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=function a(){var b=document.createElement("div");b.style.overflowY="scroll";b.style.msOverflowStyle="scrollbar";b.style.width="50px";b.style.height="50px";b.style.visibility="hidden";document.body.appendChild(b);var c=b.offsetWidth-b.clientWidth;document.body.removeChild(b);return c}();exports.default=a});define("helpers/translation",["exports","default-values"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isCyrillic=b;function b(b){var c=b.length;var d=0;var e=0;for(var f=0;f<c;){var g=b.charCodeAt(f++);if(g>1040&&g<1103){d++;e++;continue}if(g>0&&g<64){continue}if((g&63488)==55296&&f<c){var h=b.charCodeAt(f++);if((h&64512)==56320){continue}}e++}return d*100/e>a.LETTER_CYRILLIC_PERCENT}});define("mail/actions/Schedule",function(require){"use strict";var a=require("Action"),b=require("RPC");var c=a.extend({operation:function(a){switch(a.method){case c.UPDATE:return this._update(a.data);case c.REMOVE:return this._remove(a.data);default:throw new Error("Действие не найдено",a.method)}},_update:function(a){return b.post("messages/schedule/update",a)},_remove:function(a){return b.post("messages/schedule/remove",a)}});c.UPDATE="UPDATE";c.REMOVE="REMOVE";a.register("mail.Schedule",c);c.version="0.2.0";return c});define("tab-indexes",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=exports.compose={LABEL_TO:-1,LABEL_CC:-1,LABEL_BCC:-1,INPUT_ATTACH_FILE:-1,INPUT_TO:100,INPUT_CC:200,INPUT_BCC:300,INPUT_SUBJECT:400,BUTTON_ATTACH_FILE:500,EDITOR:505,EDITOR_ADDLINK_HREF:510,EDITOR_ADDLINK_TEXT:515,EDITOR_ADDLINK_SAVE:520,EDITOR_ADDLINK_CANCEL:525,EDITOR_ADDLINK_DELETE:530,BUTTON_SEND:570,BUTTON_SAVE:580,BUTTON_CANCEL:590,BUTTON_COLLAPSE:600,BUTTON_EXTEND:650,BUTTON_CLOSE:700,HEAD_CONTROL_FROM:710,HEAD_CONTROL_CC:720,HEAD_CONTROL_BCC:730,BUTTON_CLOSE_CC:900,BUTTON_CLOSE_BCC:1100,BUTTON_MONEY_SEND:1300,BUTTON_ATTACH_CLOUD:1400,BUTTON_ATTACH_MAIL:1500,DROPDOWN_TEMPLATES:1600}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/compose-app/compose-app",["require","exports","@mail/contact-validation","@mail/features","@mail/flags","actions/autoreply","actions/checkContactsPossessing","cfg","cloud/Entry","default-values","Emitter","feast","feast-mod/file-count","feast-mod/file-size","feast-mod/letter-date","feast-tpl!./compose-app.html","helpers/browser","helpers/char-to-key","helpers/on-oversize-attach-add","helpers/opener","helpers/scrollbar-width","helpers/signature","helpers/translation","lazy.modules","logger","mail/actions/ContactSuggests","mail/actions/Schedule","mail/Alias","mail/Attachment","mail/Collector","mail/Folder","mail/Message","mail/MessageFormData","mrg-xray","RPC","service/addressbook/addressbook","service/auth","service/calls","service/cloud","service/compose","service/emoji","service/fishing","service/lastseenStrings","service/layer","service/mailbox/loader","service/notify","service/radars/decorator","service/radars/index","service/smokescreen","service/storage","service/viewer","tab-indexes","trackJS","ui-block/button-link/button-link","ui-block/button2/button2","ui-block/focus-zone/focus-zone","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importStar(a);b=__importDefault(b);c=__importDefault(c);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);T=__importStar(T);V=__importDefault(V);W=__importDefault(W);Y=__importDefault(Y);Z=__importDefault(Z);_=__importDefault(_);aa=__importDefault(aa);ba=__importDefault(ba);exports.default=j.default.Block.extend(S.default({events:[{name:"send",rename:function(a){return a.is("schedule")?"send_scheduled":"send"},data:function(a){return a.get("form")}},{name:"collapse"},{name:"mount",data:function(a){return a.get("form")}},{name:"close",data:function(a){return a.get("form")}}],explicit:true})({name:"compose-app",template:n.default,isolateEvents:false,performanceTrace:true,mods:{letterHours:m.letterHours},blocks:{button2:_.default,"button-link":Z.default,"focus-zone":aa.default,"react-async":ba.default},notVisualAttributes:{closing:true},defaults:{focusoff:false,form:null,"send-delay":0,"has-changes":false,"draft-on-close-enabled":true,"draft-timeout":h.AUTOSAVE_DRAFT_TIMEOUT_SECONDS,"template-enabled":false,saving:false,sending:false,fullscreen:false,mobile:h.TOUCH_MODE,ponymode:false,adaptive:false,hidden:false,"expand-status":false,closing:false,"translate-mode":false,darkMode:false,extended:false,"support-extend":true,autosend:false,"is-drag-and-drop":false,"drag-and-drop-item":null,errors:null,receipt:false,priority:3,schedule:false,scheduleDate:new Date,collectors:[],aliases:[]},events:{send:"onSend",save:"_updateComposeFields",shortcut:"onShortcut","nav:draft":"onNavDraft","nav:template":"onNavTemplate","focus-zone:first":"onRequestFirstFocus","focus-zone:last":"onRequestLastFocus","translation:use":"onTranslationSave","translation:cancel":"onTranslationCancel","translation:retry":"onTranslationRetry","first-render":"onFirstRender"},attrChanged:{errors:function(a){this.errors=a;this.composeRender()},priority:function(a){var b=this.get("form");b.set("priority",a);this.set("has-changes",true)},receipt:function(a){var b=this.get("form");b.set("receipt",a);this.set("has-changes",true)},sending:function(a,b){if(a!==b&&!a){this.get("form").set("finalized",false)}this.composeRender()},ponymode:function(){this.composeRender()},darkMode:function(){this.composeRender()},extended:function(){this.composeRender()},"mobile-xxs":function(){this.composeRender()},"support-extend":function(){this.composeRender()},"expand-status":function(){this._updateComposeVisuals()},"window-mode":function(){this.composeRender()},hidden:function(a){if(!a){this._setupFocus()}},sendDate:function(a){if(a){this.set({schedule:a,scheduleDate:new Date(a*1e3)})}this.composeRender()},schedule:function(a){var b=this.get("form");if(a){b.set("send_date",(this.get("scheduleDate").getTime()+"").slice(0,-3))}else{b.set("send_date","")}this.composeRender();this.set("has-changes",true)},scheduleDate:function(a){var b=this;new Promise(function(a,b){require(["ui-react"],a,b)}).then(__importStar).then(function(c){if(!b.isMounted()){return}var d=c.default;var e=b.get("form");if(b.get("schedule")){e.set("send_date",(a.getTime()+"").slice(0,-3));b.set("scheduleText",d.getFullMomentFormat(a))}b.set("has-changes",true);b.composeRender()})},remind:function(a){var b=this.get("form");b.set("remind",a);this.set("has-changes",true)},"draft-on-close-enabled":function(a){this.setAutosaveOnClose(a)}},tabIndexes:X.compose,constructor:function(a,b){j.default.Block.call(this,a,b);this.onWindowUnload=this.onWindowUnload.bind(this);this.composeRender=this.composeRender.bind(this);this._updateComposeVisuals=this._updateComposeVisuals.bind(this);this._setupFocus=this._setupFocus.bind(this);this._changeTranslateMode=this._changeTranslateMode.bind(this);this.emitter=new i.default;this.emitter.on("translate-mode",this._changeTranslateMode);this.emitter.on("translation-error",this.onTranslationError.bind(this));this.emitter.on("translation-ok",this.onTranslationOk.bind(this))},didMount:function(){T.default("on_route_compose");this.composeRender()},composeRender:function(){var i=this;var j=this.get("compose-options");var n=this.get("form");var p=I.default.user.get("signs");var r=I.default.user.getEmail();var t=I.default.user.get("name");var y=t.first+" "+t.last;var C=this.get("collectors").filter(function(a){return a.canSendLetters()});var F=this.get("aliases");var H=this.is("support-extend")?this.onExtend.bind(this):null;this.onClose=this.onClose.bind(this);this.onCollapse=this.onCollapse.bind(this);this.sendLetter=this.sendLetter.bind(this);this.onReadyToSave=this.onReadyToSave.bind(this);this.onFilesFromCloud=this.onFilesFromCloud.bind(this);this.onFilesFromMail=this.onFilesFromMail.bind(this);this.onCallsInvite=this.onCallsInvite.bind(this);this.onContactsFromMail=this.onContactsFromMail.bind(this);this.openAddressbook=this.openAddressbook.bind(this);this.onSignatureFromMail=this.onSignatureFromMail.bind(this);this.onTemplateSelect=this.onTemplateSelect.bind(this);this.onSaveAsTemplate=this.onSaveAsTemplate.bind(this);this.onExceedMaxSize=this.onExceedMaxSize.bind(this);this.onComposeCreateTo=this.onComposeCreateTo.bind(this);this.onSearchFrom=this.onSearchFrom.bind(this);this.onContactAdd=this.onContactAdd.bind(this);this.onOpenAddressbook=this.onOpenAddressbook.bind(this);this.updateMailboxQuotas=this.updateMailboxQuotas.bind(this);this.lastSeenUpdate=this.lastSeenUpdate.bind(this);this.onSend=this.onSend.bind(this);this.onTranslationSave=this.onTranslationSave.bind(this);this.onTranslationCancel=this.onTranslationCancel.bind(this);this.onChangePriority=this.onChangePriority.bind(this);this.onChangeReceipt=this.onChangeReceipt.bind(this);this.onClickRemind=this.onClickRemind.bind(this);this.onChangeRemind=this.onChangeRemind.bind(this);this.onClickSchedule=this.onClickSchedule.bind(this);this.onChangeSchedule=this.onChangeSchedule.bind(this);this.onTranslationRetry=this.onTranslationRetry.bind(this);Promise.all([v.lazyFileAPI(),v.lazyClipboard(),L.default.preload()]).then(function(t){var v=t[0],J=t[1],L=t[2].ui;if(!i.isMounted()){return}var O=C.concat(F);i.compose=new L.default(i.refs.compose);i.compose.injectDependencies({Attachment:A.default,cloud:K.default,Alias:z.default,Collector:B.default,CloudEntry:g.default,Message:D.default,MessageFormData:E.default,FileAPI:v,RPC:G.default,ContactSuggests:x.default,checkContactsPossessing:e.checkContactsPossessing,Phishing:N.default,Clipboard:J,TabIndex:X.compose,browser:o.default,features:{CKE_ATTACH_BASE64:h.CKE_ATTACH_BASE64,CKE_CLIPBOARD_FIX:h.CKE_CLIPBOARD_FIX,CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED:h.CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED,CKE_AUTOCORRECT_ALPHABET_LIST:h.CKE_AUTOCORRECT_ALPHABET_LIST,CKE_QUOTE_PARSE_FIX_DISABLE:h.CKE_QUOTE_PARSE_FIX_DISABLE,COMPOSE_EMOJI:h.COMPOSE_EMOJI,COMPOSE_EMOJI_FILTER:h.COMPOSE_EMOJI_FILTER,COMPOSE_EMOJI_RECENTLY_COUNT:h.COMPOSE_EMOJI_RECENTLY_COUNT,COMPOSE_SLIDER_LAST_STEP_DELTA:h.COMPOSE_SLIDER_LAST_STEP_DELTA,COMPOSE_TRANSLATOR:h.COMPOSE_TRANSLATOR,CORRESPONDENTS_LIMIT:h.CORRESPONDENTS_LIMIT,DISABLE_CALLS_COMPOSE_TIP:h.DISABLE_CALLS_COMPOSE_TIP,DISABLE_CLOUD:h.COMPOSE_DISABLE_CLOUD_ATTACHES,DISABLE_FROM_MAIL_ATTACHES:h.DISABLE_FROM_MAIL_ATTACHES,EMOJI_FALLBACK:h.EMOJI_FALLBACK,ENABLE_WYSIWYG_STICKY:h.ENABLE_WYSIWYG_STICKY,EXPIRED_ATTACHES_TOOLTIP:h.EXPIRED_ATTACHES_TOOLTIP,IS_NEW_ADDRESSBOOK:h.IS_NEW_ADDRESSBOOK,LETTER_TO_YOURSELF:h.LETTER_TO_YOURSELF,NEW_AB_SUGGEST:h.NEW_AB_SUGGEST,TRANSLATOR_REQUEST_TIMEOUT:h.TRANSLATOR_REQUEST_TIMEOUT,MAX_CLOUD_STOCK_SIZE_LIMIT:h.MAX_CLOUD_STOCK_SIZE_LIMIT,OVERSIZE_CLOUD_ATTACHES:h.OVERSIZE_CLOUD_ATTACHES,OVERSIZE_CLOUD_ATTACHES_FOLDER:h.OVERSIZE_CLOUD_ATTACHES_FOLDER,VK:h.VK,MESSAGES_ATTACHES_BLOBCLOUD:h.MESSAGES_ATTACHES_BLOBCLOUD,MESSAGES_ATTACHES_BLOBCLOUD_PATH:h.MESSAGES_ATTACHES_BLOBCLOUD_PATH,LASTSEEN_ONLINE_STATUS:h.LASTSEEN_ONLINE_STATUS,MOBILE_MODE:h.TOUCH_MODE,COMPOSE_FETCH_AUTOREPLY:h.COMPOSE_FETCH_AUTOREPLY},ContactValidation:a,radar:T.createConfiguredRadar({prefix:"cmps",data:n}),onError:function(a,b){Y.default.addErrorFromApp(a,b?"cmps_"+b:"cmps_internal_caught")},logger:w.default,scrollbarWidth:s.default,Storage:V.default,mods:{fileSize:l.fileSize,fileSizeRange:l.fileSizeRange,fileCount:k.fileCount,letterAttachLinkDate:m.letterAttachLinkDate},flags:c.default,emojiParser:M.default});var P=b.default.get("isNativeStickyDisabled");var Q=b.default.get("compose-expand-contacts");var R=i.get("router");i.compose.render({signatures:p,fromOptions:O,defaultEmail:r,userName:y,model:n,scrollTarget:i.refs.compose,templatesFetch:i.templatesFetch,lastSeenUpdate:i.lastSeenUpdate,suggestFinder:i.getSuggestFinder(),onFilesFromCloud:i.onFilesFromCloud,onFilesFromMail:i.onFilesFromMail,onCallsInvite:h.CALLS&&!h.CALLS_DISABLE_COMPOSE_BTN?i.onCallsInvite:null,onContactsFromMail:i.onContactsFromMail,onSignatureFromMail:i.onSignatureFromMail,onReadyToSave:i.onReadyToSave,onClose:i.onClose,onExtend:H,fetchAutoreply:d.fetchAutoreply,onComposeCreateTo:i.onComposeCreateTo,onSearchFrom:i.onSearchFrom,onTemplateSelect:i.onTemplateSelect,onSaveAsTemplate:i.onSaveAsTemplate,onExceedMaxSize:i.onExceedMaxSize,onCollapse:i.onCollapse,onContactAdd:i.onContactAdd,onOpenAddressbook:i.onOpenAddressbook,onOversizeAttachAdd:q.default,onAttachmentClick:function(a){if(h.DISABLE_COMPOSE_ATTACHMENT_CLICK){return}if(a.isCloudStock()||a.isCloud()){return}W.default.openTemporary({messageId:n.uid,formData:n,router:R,attachment:a})},updateMailboxQuotas:i.updateMailboxQuotas,isNativeStickyDisabled:P&&P.state,isNativeAttachThumbRotation:h.IS_COMPOSE_NATIVE_ATTACH_THUMB_ROTATION,isAllVisibleContactsFeature:Q&&Q.state,onChangeErrors:i.onChangeErrors,sendLetter:i.sendLetter,errors:i.errors||null,disableInterface:i.get("window-mode")==="collapsed"?true:i.get("sending"),eventEmitter:i.emitter,darkMode:i.get("darkMode"),extended:i.get("extended"),compressedMode:i.get("ponymode")&&!i.get("mobile-xxs"),mobileLayout:i.get("mobile"),mobilePhoneLayout:i.get("mobile-xxs"),qaParams:{enabled:f.default.get("qa")},additionalOptions:j,utils:{isCyrillic:u.isCyrillic},schedule:i.get("schedule"),scheduleText:i.get("scheduleText"),onSend:i.onSend.bind(i),onSave:i.onClickSave.bind(i),onTranslationUse:i.onTranslationSave,onTranslationCancel:i.onTranslationCancel,onChangePriority:i.onChangePriority,onChangeReceipt:i.onChangeReceipt,onClickRemind:i.onClickRemind,onChangeRemind:i.onChangeRemind,onClickSchedule:i.onClickSchedule,onChangeSchedule:i.onChangeSchedule,onTranslationRetry:i.onTranslationRetry,onFooterChooseTemplateClick:i.onFooterChooseTemplateClick.bind(i),translationHref:i.getPromtLogoHref(),avatarBaseUrl:f.default.get("urls.avatarUrl"),quotasEnabled:I.default.user.get("common_purpose_flags.enabled_mbox_quotas"),hideAvatar:h.COMPOSE_HIDE_AVATAR&&i.get("mobile-xxs"),unclickableLabels:h.COMPOSE_DISABLE_CLICKABLE_LABELS&&i.get("mobile-xxs"),hideToolbar:h.COMPOSE_DISABLE_TOOLBAR&&i.get("mobile-xxs"),shortAttachPanel:h.COMPOSE_SHORT_ATTACH_PANEL&&i.get("mobile-xxs"),hideChangeSignature:h.HIDE_CHANGE_SIGNATURE&&i.get("mobile-xxs"),hideCancelButton:h.HIDE_COMPOSE_CANCEL_BUTTON&&i.get("mobile-xxs"),hideWidgets:h.HIDE_COMPOSE_WIDGETS&&i.get("mobile-xxs"),footerDropdown:h.COMPOSE_FOOTER_DROPDOWN&&i.get("mobile-xxs")});if(!i.hasRendered){i.broadcast("first-render");i.hasRendered=true}})},onFirstRender:function(){var a=this;if(this.get("is-drag-and-drop")){var b=this.get("drag-and-drop-item");if(b){var c=b.files;if(this.compose.appComponent){this.compose.appComponent.addFilesToModel(c).then(function(b){if(a.get("autosend")){a.broadcast("send")}a.compose.appComponent.uploadFiles(b)}).catch(function(b){a.radar("dnd_err_"+b)})}}}},onContactAdd:function(a){a.scope="compose-notify";this.broadcast("addressbook:addcontact",a)},onOpenAddressbook:function(a){this.openAddressbook({"free-space":false,composeMode:false,openEmail:a.email},true)},onChangeErrors:function(a){this.errors=a},onSend:function(){var a=this.get("form");this._updateComposeFields();a.set("body.html",t.cleanHTMLSignature(a.get("body.html")),{silent:true});var b=this.get("autosend");var c=b?true:this.compose.appComponent.checkSend();if(c){this.sendLetter()}},getSuggestFinder:function(){if(h.NEW_AB_SUGGEST){return null}return H.default.lazyInit()},lastSeenUpdate:function(a){if(!h.LAST_SEEN_V2_ENABLE){return null}var b=this.get("getLastSeen");F.default.send("lastseen-v2-compose",{skipdwh:true});var c=h.LASTSEEN_COMPOSE_ALLOW_GARAGE;return b(a,{allowUseGarage:c}).then(function(b){var c=b.payload;var d=a.map(function(a){var b=c[a];return O.default(b).then(function(b){return{email:a,lastSeen:b}})});return Promise.all(d)})},sendLetter:function(){if(this.get("schedule")){this.broadcast("letter-schedule",{composeApp:this,scheduleText:this.get("scheduleText")})}else{this.broadcast("letter-send")}},templatesFetch:function(){return Q.default.load({folder:C.default.TEMPLATES,limit:25}).catch(function(){return{threads:[]}}).then(function(a){return a.threads.map(function(a){var b=a.subject||a.snippet;return{data:{folder:a.folder,id:a.expand,value:b.trim()?b:"<"+i18n("Без темы")+">"}}})})},onTemplateSelect:function(a){var b=this;var c=a.id,d=a.folder;var e=this.get("form");e.fetchTemplate({id:c,folder:d}).then(function(a){if(e.is("source.reply")||e.is("source.forward")){var c=e.mergeTemplate(a,{attachments:true});b.compose.applyTemplate(c)}else{b.broadcast("close",Object.assign(b,{noAnimate:true}));L.default.open({mode:"template",model:a})}})},didUnmount:function(){this.setAutosaveInterval(false);this.setAutosaveOnClose(false);try{this.compose.unmount()}catch(a){if(h.IS_DEBUG){console.error(a)}T.default({type:"compose_unmount_error",rlog:"octavius_jserror",rlog_message:JSON.stringify(a)})}},removeScheduleFromDatalist:function(a){var b=this.get("router");b.model.letters.filter(function(b){var c=b.getFolder();return c.isOutbox()&&b.get("last")===a}).forEach(function(a){b.model.letters.remove(a)})},removeSchedule:function(){var a=this;var b=this.get("form");var c=b.get("source.schedule");var d=b.get("source.draft");var e={id:c};if(d){e.source={draft:d}}y.default.execute({method:y.default.REMOVE,data:e}).then(function(){b.set("source.schedule","");b.set("source.draft",c);a.radar("remove_schedule");a.removeScheduleFromDatalist(c)}).catch(function(){a.radar("remove_schedule_error")})},onClickSave:function(){this._updateComposeFields();this.broadcast("letter-save")},onClickSchedule:function(a){var b=!this.get("schedule");var c=new Date(a);if(!b){c=new Date}this.set({schedule:b,scheduleDate:c});if(!b){this.removeSchedule()}this.composeRender()},onChangeSchedule:function(a){this.set({schedule:true,scheduleDate:new Date(a)})},onChangePriority:function(){this.set({priority:this.get("priority")===3?1:3})},onChangeReceipt:function(){this.set({receipt:!this.get("receipt")})},onClickRemind:function(a){var b=!!this.get("remind");this.set({remind:b?"":a})},onChangeRemind:function(a){this.set({remind:a})},onRequestFirstFocus:function(){var a=this.el.querySelector(U.selector('[tabindex="'+X.compose.INPUT_SUBJECT+'"]'));a&&a.focus()},onRequestLastFocus:function(){var a=this.el.querySelector(U.selector('[tabindex="'+X.compose.BUTTON_ATTACH_CLOUD+'"]'));a&&a.focus()},layerSingleton:function(a,b,c,d,e){var f=this;if(!this.activeLayer){this.activeLayer=new Promise(function(g,i){a.then(function(){if(!f.isMounted()){f.activeLayer=null;g();return}f.set("hidden",true);P.default.open(b,c,{dimmer:false,resolvable:true}).then(function(a){if(f.isMounted()){f.set("hidden",false)}return a}).then(function(a){if(e){return e(a)}return Promise.resolve(a)}).then(function(a){return g(a)}).catch(function(a){d(a);if(f.isMounted()){f.set("hidden",false)}if(h.IS_DEBUG){console.error(a)}f.activeLayer=null;i(a);return Promise.reject(a)}).then(function(){f.activeLayer=null})},i)})}return this.activeLayer},onFilesFromCloud:function(a){var b=a.attachments,c=a.selectLimit,d=a.freeSpace;T.default("compose_cloud_click");return this.layerSingleton(new Promise(function(a,b){require(["ui-block/layer-explorer-from-cloud/layer-explorer-from-cloud"],a,b)}).then(__importStar),"explorer-from-cloud",{attachments:b,"select-limit":c,"free-space":d},function(){return T.default("explorer-cloud_error")})},onFooterChooseTemplateClick:function(){var a="compose-template-select";var b={fetchTemplates:this.templatesFetch,onChoose:this.onTemplateSelect};require(["ui-block/layer-compose-template-select/layer-compose-template-select"],function(){P.default.open(a,b,{dimmer:false,resolvable:true,mobile:true})})},onContactsFromMail:function(a){var b=a.contacts,c=a.selectLimit,d=a.freeSpace;T.default("compose_contacts-search_click");var e=h.NEW_AB_COMPOSE_VIEW;return this.openAddressbook({contacts:b,"select-limit":c,"free-space":d,composeMode:e},h.NEW_AB_COMPOSE_VIEW)},openAddressbook:function(a){return this.layerSingleton(new Promise(function(a,b){require(["ui-block/layer-addressbook/layer-addressbook"],a,b)}).then(__importStar),"addressbook",__assign(__assign({},a),{router:this.get("router")}),function(){return T.default("new-addressbook-layer_error")})},onFilesFromMail:function(a){var b=a.attachments,c=a.selectLimit,d=a.freeSpace;T.default("compose_filesearch_click");return this.layerSingleton(new Promise(function(a,b){require(["ui-block/layer-explorer-from-filesearch/layer-explorer-from-filesearch"],a,b)}).then(__importStar),"explorer-from-filesearch",{attachments:b,"select-limit":c,"free-space":d},function(){return T.default("explorer-files_error")})},onCallsInvite:function(){return new Promise(function(a){J.default.createRoom().then(function(b){var c=J.default.getTemplate(b);a(c)}).catch(function(){R.default.error({text:i18n("Не удалось создать ссылку на звонок")},"compose-notify")})})},onSignatureFromMail:function(){T.default("compose_sign-edit_click");r.default(h.SIGNATURE_URL)},onWindowUnload:function(a){if(this.is("has-changes")||this.isUploadingAttachments()){var b=i18n("Текст письма будет потерян.");var c=Date.now();setTimeout(function(){var a=Date.now()-c;if(a<100){F.default("compose_unload_confirm_disabled&v="+a,{immediately:true});w.default.add("compose_unload_confirm_disabled",{unloadConfirmDuration:a})}},0);T.default("compose_try_leave_with_unsaved");w.default.add("try to leave compose with unsaved changes");a.returnValue=b;return b}},onClose:function(){this.set("closing",true);if(this.is("translate-mode")){this.broadcast("save")}this.broadcast("close")},onExtend:function(){this.broadcast("extend")},onCollapse:function(){this._updateComposeFields();this.broadcast("collapse")},_updateComposeFields:function(){this.compose.updateFields()},_updateComposeVisuals:function(){if(this.compose){this.compose.updateVisuals()}},_setupFocus:function(){if(this.compose){this.compose.setupFocus()}},onSaveAsTemplate:function(){var a=this;this._updateComposeFields();return new Promise(function(b){a.broadcast("savetemplate",{composeApp:a,resolve:b})})},onExceedMaxSize:function(){this.broadcast("exceedmaxsize")},onAutoSave:function(){if(!this.isMounted()){this.setAutosaveInterval(false);return}if(this.get("saving")){return}this._updateComposeFields();this.broadcast("autosave")},onReadyToSave:function(){this.set("has-changes",true);this.setAutosaveInterval(true)},onShortcut:function(a){var b=a.originalEvent;var c=false;var d=b;var e=d.metaKey||d.ctrlKey;if(e&&d.keyCode==13){T.default("compose_action_send_shortcut");this.broadcast("send")}if(e&&p.default(d.keyCode)==="s"){T.default("compose_action_save_shortcut");this.broadcast("save");c=true}c&&d.preventDefault();return!!c},onNavDraft:function(){this.broadcast("collapse");this.get("router").go("#letters",{folder:C.default.DRAFTS})},onNavTemplate:function(){this.broadcast("collapse");this.get("router").go("#letters",{folder:C.default.TEMPLATES})},onTranslationOk:function(){this.get("form").set({"translation-error":null,"translation-first-ok":true})},onTranslationError:function(a){var b="some-error";if(a.status===Number(G.default.statuses.many_requests)){b="many-requests"}var c=this.showTranslationNotify("error");this.emitter.one("translation-ok",function(){c===null||c===void 0?void 0:c.close()});this.get("form").set("translation-error",b)},onTranslationCancel:function(){this.compose.disableTranslate(false);this.get("form").clearTranslation()},onTranslationSave:function(){var a=this;this.compose.disableTranslate(true);var b=this.showTranslationNotify("saved");this.emitter.one("translate-mode",function(a){a&&(b===null||b===void 0?void 0:b.close())});b===null||b===void 0?void 0:b.on("action",function(){a.compose.revertTranslation();b.close()})},onTranslationRetry:function(){this.compose.translate()},showTranslationNotify:function(a){var b="";var c=R.default.types.default;var d=[];if(a==="ok"){b=i18n("Переведено")}if(a==="loading"){b=i18n("Переводим...")}if(a==="error"){b=i18n("Не удалось перевести текст");c=R.default.types.error}if(a==="saved"){b=i18n("Вы перевели письмо");d=[{text:i18n("Отменить")}]}var e={text:b,type:c,actions:d,unique:true};return R.default.add(e,"compose-notify")},_changeTranslateMode:function(a){this.get("form").set({"translate-mode":a,"translation-first-ok":false})},onComposeCreateTo:function(a){this._updateComposeFields();this.broadcast("collapse",Object.assign(this,{noAnimate:true}));L.default.open({correspondents:{to:[a]}})},onSearchFrom:function(a){this._updateComposeFields();this.broadcast("collapse");this.get("router").go("#search",{},{q_from:a})},setAutosaveInterval:function(a){if(!a){clearTimeout(this._saveDraftTimeoutId);this._saveDraftTimeoutId=void 0;if(h.IS_DEBUG){console.warn("[compose-app]","Таймер автосохранения остановлен.")}return}if(!this.isMounted()){if(h.IS_DEBUG){console.warn("[compose-app]","Не удалось запустить таймер автосохранения: компонент не в DOM!")}return}if(!this._saveDraftTimeoutId){var b=this.get("draft-timeout")*1e3;this._saveDraftTimeoutId=setInterval(this.onAutoSave.bind(this),b);if(h.IS_DEBUG){console.warn("[compose-app]","Запущен таймер автосохранения. Таймаут",b,"мс")}}},setAutosaveOnClose:function(a){if(!a){window.removeEventListener("beforeunload",this.onWindowUnload);return}window.addEventListener("beforeunload",this.onWindowUnload)},getDraftUrl:function(){return this.get("router").getUrl("#letters",{folder:C.default.DRAFTS})},getTemplateUrl:function(){return this.get("router").getUrl("#letters",{folder:C.default.TEMPLATES})},isUploadingAttachments:function(){var a=this.get("form");return a.isUploadingAttachments()},insertHtml:function(a){if(this.compose.appComponent){this.compose.appComponent.insertHtml(a)}},updateMailboxQuotas:function(a,b){I.default.user.set("mbox_quotas."+a,b);if(a==="attach"){this.get("form").resetSpaceLeft()}},getPromtLogoHref:function(){return h.PROMT_LOGO_HREF}}))});define("feast-tpl!app/feast-tpl!ui-block/compose-windows/compose-windows.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="visible" value="{attrs.items.length > 0}"/>\n\t<fn:var name="collapsedCnt" value="{attrs.items.length - (attrs.active ? 1 : 0)}"/>\n\t<fn:var name="rise" value="{attrs.rise}"/>\n\n\t<bem:mod name="hidden" test="!visible"/>\n\t<bem:mod name="fullscreen" test="attrs.fullscreen"/>\n\t<bem:mod name="rise" test="rise"/>\n\n\t<bem:mod name="animate-open" test="attrs[\'animate-open\']"/>\n\t<bem:mod name="animate-close" test="attrs[\'animate-close\']"/>\n\t<bem:mod name="animate-expand" test="attrs[\'animate-expand\']"/>\n\t<bem:mod name="animate-collapse" test="attrs[\'animate-collapse\']"/>\n\n\t<fn:if test="visible">\n\t\t<b:dimmer fn:if="attrs.active"\n\t\t\t\t  remit:click="window-collapse"\n\t\t\t\t  event:details="false"\n\t\t/>\n\n\t\t<fn:for data="attrs.items" as="item">\n\t\t\t<b:compose-app\n\t\t\t\t\tuse:mediator="compose-manager addressbook-manager themes-manager"\n\t\t\t\t\tkey="compose-{item.formData.uid}"\n\t\t\t\t\tid="{\'compose-\' + item.formData.uid}"\n\t\t\t\t\tform="{item.formData}"\n\t\t\t\t\twindow-mode="{attrs.active == item.formData.uid ? \'window\' : \'collapsed\'}"\n\t\t\t\t\texpand-status="{attrs.active == item.formData.uid && attrs[\'expand-status\']}"\n\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\tpriority="{item.formData.get(\'priority\')}"\n\t\t\t\t\treceipt="{item.formData.get(\'receipt\')}"\n\t\t\t\t\tremind="{item.formData.get(\'remind\')}"\n\t\t\t\t\tsendDate="{item.formData.get(\'send_date\')}"\n\t\t\t\t\tcollectors="{_this._getCollectors()}"\n\t\t\t\t\taliases="{_this._getAliases()}"\n\t\t\t\t\tadaptive="{attrs.adaptive}"\n\t\t\t\t\tfullscreen="{attrs.fullscreen}"\n\t\t\t\t\tmobile-xxs="{attrs[\'mobile-xxs\']}"\n\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t\tsupport-extend="{attrs[\'support-extend\']}"\n\t\t\t\t\textended="{attrs.extended}"\n\t\t\t\t\tcompose-options="{item.additionalOptions}"\n\t\t\t\t\tautosend="{item.autosend}"\n\t\t\t\t\tsaving="{item.formData.isSaving}"\n\t\t\t\t\tis-drag-and-drop="{item.isDragAndDrop}"\n\t\t\t\t\tdrag-and-drop-item="{item.dragAndDropItem}"\n\t\t\t\t\tremit:open="window-open"\n\t\t\t\t\tremit:close="window-close"\n\t\t\t\t\tremit:collapse="window-collapse"\n\t\t\t\t\tremit:extend="window-extend"\n\t\t\t\t\tremit:autosave="letter-autosave"\n\t\t\t\t\tremit:savetemplate="letter-savetemplate"\n\t\t\t\t\tremit:exceedmaxsize="letter-exceedmaxsize"\n\t\t\t/>\n\t\t</fn:for>\n\n\t\t<b:compose-collapsed\n\t\t\t\tfn:if="collapsedCnt"\n\t\t\t\titems="{_this.getCollapsed(attrs.items)}"\n\t\t\t\tmultiple="{false}"\n\t\t\t\tmobile="{attrs.active && attrs.overlap}"\n\t\t\t\tcompact="{_this.isCompactCollapsed()}"\n\t\t\t\tabove-paginator="{_this.isAbovePaginator() && !_this.isCompactCollapsed()}"\n\t\t/>\n\t</fn:if>\n\n\t<div bem:elem="notify"\n\t\t qa:id="compose-notify-stack"\n\t\t qa:state="rise:{rise}">\n\t\t<b:notify-stack ref="compose-notify" id="compose-notify" fixed />\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/compose-windows/compose-windows.html")});define("feast-tpl!ui-block/compose-windows/compose-windows.html",["feast-tpl!app/feast-tpl!ui-block/compose-windows/compose-windows.html"],function(a){return a});define("helpers/autocomplete",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(a,b){var c=document.createElement("iframe");c.setAttribute("name","autocomplete_iframe");c.style.display="none";document.body.appendChild(c);var d=document.createElement("form");d.setAttribute("target","autocomplete_iframe");d.setAttribute("action","about:blank");d.style.position="absolute";d.style.top="-9999px";d.setAttribute("tabindex","-1");document.body.appendChild(d);var e=document.createElement("input");e.setAttribute("name",a);e.setAttribute("value",b);e.setAttribute("type","text");d.appendChild(e);d.submit();var f=function a(){d.remove();c.removeEventListener("load",a);c.remove()};c.addEventListener("load",f)}});define("helpers/user-track",["exports","default-values"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}function c(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var e={Alt:1,AltGraph:2,CapsLock:3,Control:4,Fn:5,Shift:6,Enter:7,Tab:8,Space:9,ArrowDown:10,ArrowLeft:11,ArrowRight:12,ArrowUp:13,End:14,Home:15,PageDown:16,PageUp:17,Escape:18,Backspace:19,Clear:20,Delete:21};var f={" ":"Space",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Esc:"Escape",Del:"Delete"};var g={passive:true,capture:true};var h=function(){function h(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},d=b.limit,e=d===undefined?a.COMPOSE_SEND_USER_TRACK_CONF[0]:d,f=b.trackMouseInterval,g=f===undefined?a.COMPOSE_SEND_USER_TRACK_CONF[1]:f;c(this,h);this.limit=e;this.trackMouseInterval=g;this.reset();this.trackMouse=this.trackMouse.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.onClick=this.onClick.bind(this);this.onKeyDown=this.onKeyDown.bind(this)}d(h,[{key:"reset",value:function a(){this.composes={};this.active={};this.lastPointerSpeed=0;this.lastPointerPositionX=0;this.lastPointerPositionY=0;this.mouseTrackLastEventTimestamp=0;this.currentPointerPositionX=0;this.currentPointerPositionY=0;this.trackMouseIntervalObj=null;this.mouseCaptured=false;this.started=false}},{key:"addEvent",value:function a(c,d,e){var f=this.composes[c];if(!f||!this.active[c]){return}var g=Date.now();var h=Math.max(g-f.lastEventTimestamp,0);f.lastEventTimestamp=g;f.events.push([d,h].concat(b(e)).join("|"));if(f.events.length>this.limit){f.events.shift()}}},{key:"hasComposes",value:function a(){return Object.keys(this.active).reduce(function(a,b){return b?a+1:a},0)>0}},{key:"addEvents",value:function a(b,c){var d=this;Object.keys(this.active).forEach(function(a){d.addEvent(a,b,c)})}},{key:"serialize",value:function a(b){var c=this.composes[b];if(!c){return""}return c.events.join(";")}},{key:"trackMouse",value:function a(){var b=Date.now();if(this.mouseCaptured){var c=Math.max(b-this.mouseTrackLastEventTimestamp,1);var d=this.currentPointerPositionX-this.lastPointerPositionX;var e=this.currentPointerPositionY-this.lastPointerPositionY;this.lastPointerPositionX=this.currentPointerPositionX;this.lastPointerPositionY=this.currentPointerPositionY;var f=Math.ceil(Math.sqrt(d*d+e*e));var g=f/c;var h=(g-this.lastPointerSpeed)/c;this.lastPointerSpeed=g;g=Math.ceil(g);h=Math.ceil(h);if(f||g||h){this.addEvents("m",[f,g,h])}}this.mouseTrackLastEventTimestamp=b;this.trackMouseIntervalObj=window.setTimeout(this.trackMouse,this.trackMouseInterval)}},{key:"onMouseMove",value:function a(b){this.currentPointerPositionX=b.clientX;this.currentPointerPositionY=b.clientY;this.mouseCaptured=true}},{key:"onClick",value:function a(b){this.addEvents("c",[b.button,b.clientX,b.clientY])}},{key:"onKeyDown",value:function a(b){var c=b.key;if(f[c]){c=f[c]}if(e[c]){this.addEvents("k",[e[c]])}}},{key:"addCompose",value:function a(b){this.composes[b]={events:[],lastEventTimestamp:Date.now()}}},{key:"removeCompose",value:function a(b){delete this.composes[b];delete this.active[b];if(!this.hasComposes()){this.stopTracking()}}},{key:"startComposeTrack",value:function a(b){if(!this.composes[b]){this.addCompose(b)}this.active[b]=true;this.startTracking()}},{key:"pauseComposeTrack",value:function a(b){if(!this.composes[b]){this.addCompose(b)}this.active[b]=false;if(!this.hasComposes()){this.stopTracking()}}},{key:"startTracking",value:function a(){if(this.started){return}document.body.addEventListener("keydown",this.onKeyDown,g);document.body.addEventListener("click",this.onClick,g);document.body.addEventListener("mousemove",this.onMouseMove,g);this.trackMouse();this.started=true}},{key:"stopTracking",value:function a(){if(this.trackMouseIntervalObj){window.clearInterval(this.trackMouseIntervalObj)}document.body.removeEventListener("keydown",this.onKeyDown,g);document.body.removeEventListener("click",this.onClick,g);document.body.removeEventListener("mousemove",this.onMouseMove,g);this.reset()}}]);return h}();var i=new h;exports.default=i});var __spreadArrays=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/compose-validators",["require","exports","lazy.modules","mail/Message","service/smokescreen"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);var d={checkOnMissingAttach:function(b){if(b.get("source.forward")||b.attachments.length){return Promise.resolve(false)}return a.lazyMailTextAnalyzer().then(function(a){return a.hasAttachment(d.getEnteredText(b.get("body.html")))})},checkOnRettachToReply:function(a){var c=this;var d=a.get("source.reply");if(!d){return Promise.resolve({})}var e=a.get("folder_id");return b.default.findOne({id:d,folder_id:e}).then(function(b){var d=c._hasNewEmails(b,a);var e=c._hasAttachToReattach(b);return{hasNewAttach:d&&e,source:b}})},getEnteredText:function(a){var b=document.createElement("div");b.innerHTML=a;Array.prototype.forEach.call(b.querySelectorAll(c.selector("blockquote")),function(a){a.parentNode&&a.parentNode.removeChild(a)});Array.prototype.forEach.call(b.querySelectorAll(c.selector("br")),function(a){if(a.parentNode){a.parentNode.insertBefore(document.createTextNode("\n"),a);a.parentNode.removeChild(a)}});return b.innerHTML},_hasNewEmails:function(a,b){var c=a.get("correspondents");var d=__spreadArrays(c.from,c.to,c.cc,c.bcc).map(function(a){return a.email});var e=b.get("correspondents");var f=__spreadArrays(e.to,e.cc,e.bcc).map(function(a){return a.email});return f.some(function(a){return!d.includes(a)})},_hasAttachToReattach:function(a){var b=a.get("attaches.list");var c=["text/calendar","application/ics"];var d=new RegExp(/.ics$/);return b.some(function(a){return!c.includes(a.get("content_type"))&&!d.test(a.get("name"))})}};exports.default=d});define("feast-tpl!app/feast-tpl!ui-block/compose-collapsed/compose-collapsed.html",["feast"],function(a){return a.smartParse('<div qa:id="compose-collapsed">\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\n\t<bem:mod name="multiple" test="attrs.multiple"/>\n\t<bem:mod name="empty" test="!attrs.items.length"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="above-paginator" test="attrs[\'above-paginator\']"/>\n\n\t<fn:for data="attrs.items" as="item" key="formKey">\n\t\t<div bem:elem="item"\n\t\t\t key="compose-collapsed-{item.formData.uid}"\n\t\t\t remit:click="window-expand"\n\t\t\t event:details="item.formData"\n\t\t\t qa:id="compose-collapsed-item:{item.formData.uid}">\n\n\t\t\t<fn:var name="isLast" value="{formKey === attrs.items.length - 1}"/>\n\t\t\t<div bem:elem="content">\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="label"\n\t\t\t\t\tpromo:id="{isLast ? \'compose-collapsed-label\' : \'\'}"\n\t\t\t\t>\n\t\t\t\t\t<span promo:id="{isLast ? \'compose-collapsed-icon\' : \'\'}">\n\t\t\t\t\t\t\x3c!-- in_viewport не работает на svg, поэтому нужен враппер для плашки --\x3e\n\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\tname="compose"\n\t\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="title" qa:id="subject">\n\t\t\t\t\t\t<fn:value>\n\t\t\t\t\t\t\tattrs.multiple ?\n\t\t\t\t\t\t\t\ti18n(\'Черновики\') :\n\t\t\t\t\t\t\t\t(item.formData.get(\'subject\') || messages.draft(Object.fromEntries([[\'draftId\', formKey + 1]])))\n\t\t\t\t\t\t</fn:value>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\n\t\t\t\t<div bem:elem="ico-close">\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\tico="actions:close"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tsecondary\n\t\t\t\t\t\tshort\n\t\t\t\t\t\tremit:click="collapsed-item-close"\n\t\t\t\t\t\tevent:details="item.formData"\n\t\t\t\t\t\tqa:id="close"\n\t\t\t\t\t\tcentered\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/compose-collapsed/compose-collapsed.html")});define("feast-tpl!ui-block/compose-collapsed/compose-collapsed.html",["feast-tpl!app/feast-tpl!ui-block/compose-collapsed/compose-collapsed.html"],function(a){return a});define("ui-block/compose-collapsed/compose-collapsed",["exports","feast","feast-tpl!./compose-collapsed.html","service/radars/decorator","ui-block/button2/button2","ui-block/ico/ico"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,h.default)({events:[{name:"window-expand",rename:"expand"}]})({name:"compose-collapsed",blocks:{button2:i.default,ico:j.default},defaults:{compact:false,mobile:false},events:{},template:g.default,isolateEvents:false,getMessages:function a(){return{draft:function a(b){return i18n("Черновик {draftId}",b)}}}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-sent-page/layer-sent-page.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-sent-page">\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="messageAttachments" value="{_this.getAttachments()}"/>\n\t<fn:var name="isReady" value="{_this.isReady()}"/>\n\t<fn:var name="slim" value="{attrs.slim}"/>\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\t<fn:var name="timerValueText" value="{_this.get(\'delivery-cancel-timer-text\')}"/>\n\t<fn:var name="isNotifyVersion" value="{_this.get(\'is-notify-version\')}"/>\n\t<fn:var name="isDeliveryCancelVersion" value="{_this.get(\'is-delivery-cancel-version\')}"/>\n\t<fn:var name="cancellationResultText" value="{_this.get(\'cancellation-result-text\')}"/>\n\t<fn:var name="cancellationOver" value="{_this.get(\'is-cancellation-over\')}"/>\n\t<fn:var name="cancellationWithDraft" value="{_this.get(\'cancellation-with-draft\')}"/>\n\t<fn:var name="cancelShortcut" value="{_this.getCancelShortcut()}"/>\n\t<fn:var name="cancellationInProgress" value="{_this.get(\'is-cancellation-progress\')}"/>\n\t<fn:var name="isLetterCanceled" value="{_this.get(\'is-letter-canceled\')}"/>\n\t<fn:var name="openDraftFail" value="{_this.get(\'open-draft-fail\')}"/>\n\n\t<bem:mod name="slim" test="slim"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\n\t\x3c!-- Поле Кому --\x3e\n\t<fn:match name="correspondents" args="contactString, dir">\n\t\t<fn:var name="contacts" value="{_this.getContactList(contactString)}"/>\n\t\t<fn:var name="contactList" value="{contacts}"/>\n\n\t\t<fn:for data="contactList" as="contact" key="contactKey">\n\t\t\t<fn:var name="key" value="{_this.getContactKey(contactKey, dir)}"/>\n\n\t\t\t<span\n\t\t\t\ttitle="{contact.email}"\n\t\t\t\tdata-id="{key}"\n\t\t\t\tbem:elem="contact-item"\n\t\t\t\tkey="{key}">\n\n\t\t\t\t<fn:value mod="correspondent">contact</fn:value>\n\t\t\t\t<fn:value>contactKey === contactList.length - 1 ? \' \': \', \'</fn:value>\n\t\t\t</span>\n\t\t</fn:for>\n\t</fn:match>\n\n\t\x3c!-- Поле получателей --\x3e\n\t<fn:if test="!isDeliveryCancelVersion">\n\t\t<fn:match name="recipients" args="message, more, expanded">\n\t\t\t<div bem:elem="recipients">\n\t\t\t\t<bem:mod name="more" value="{more > 0}"/>\n\t\t\t\t<bem:mod name="expanded" value="{expanded}"/>\n\n\t\t\t\t<div bem:elem="recipients-container" ref="recipients">\n\t\t\t\t\t<span bem:elem="recipient" fn:if="message.get(\'correspondents.to.length\')">\n\t\t\t\t\t\t<span bem:elem="recipient-field">{i18n(\'Кому\')}: </span>\n\t\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'to\'), \'to\'"/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="recipient" fn:if="message.get(\'correspondents.cc.length\')">\n\t\t\t\t\t\t<span bem:elem="recipient-field">{i18n(\'Копия\')}: </span>\n\t\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'cc\'), \'cc\'"/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="recipient" fn:if="message.get(\'correspondents.bcc.length\')">\n\t\t\t\t\t\t<span bem:elem="recipient-field">{i18n(\'Скрытая\')}: </span>\n\t\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'bcc\'), \'bcc\'"/>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="recipients-more"\n\t\t\t\t\tfn:if="more > 0 && !expanded"\n\t\t\t\t\tremit:click="recipients-more:click">\n\t\t\t\t\t<fn:var name="contextMore" value="{Object.fromEntries([[\'more\', more]])}"/>\n\t\t\t\t\t<fn:value output="raw">messages.more(contextMore)</fn:value>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="recipient-more"\n\t\t\t\t\tfn:if="more > 0 && expanded"\n\t\t\t\t\tremit:click="recipients-more:click">\n\t\t\t\t\t<span class="layer__link">{i18n(\'Свернуть\')}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</fn:match>\n\t</fn:if>\n\n\t<fn:match name="controls" args="message, type" qa:id="controls">\n\t\t<div bem:elem="controls">\n\t\t\t<b:button2\n\t\t\t\tfn:if="type === \'error\'"\n\t\t\t\ttext="{i18n(\'Отправить ещё раз\')}"\n\t\t\t\tevent:details="message"\n\t\t\t\tremit:click="resend"\n\t\t\t\tqa:id="resend"\n\t\t\t/>\n\t\t\t<b:button2\n\t\t\t\tfn:if="type === \'error\'"\n\t\t\t\ttext="{i18n(\'Вернуться к письму\')}"\n\t\t\t\tevent:details="message"\n\t\t\t\tremit:click="compose-back"\n\t\t\t\tqa:id="compose-back"\n\t\t\t/>\n\n\t\t\t<fn:if test="isDeliveryCancelVersion">\n\t\t\t\t<div bem:elem="cancel">\n\t\t\t\t\t<fn:if test="!cancellationOver && !cancellationInProgress">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{timerValueText}"\n\t\t\t\t\t\t\ttitle="{i18n(\'Отменить отправку\')}"\n\t\t\t\t\t\t\tremit:click="cancel"\n\t\t\t\t\t\t\tshortcut="ctrl+z|command+z"\n\t\t\t\t\t\t\tqa:id="cancel"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<p bem:elem="cancel-combination">{cancelShortcut}</p>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationInProgress">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Идёт отмена отправки...\')}"\n\t\t\t\t\t\t\tqa:id="cancel-progress"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationOver && cancellationWithDraft && !openDraftFail">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Открываю черновик...\')}"\n\t\t\t\t\t\t\tqa:id="draft-progress"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationOver && cancellationWithDraft && openDraftFail">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Редактировать в черновике\')}"\n\t\t\t\t\t\t\tqa:id="draft-open-fail"\n\t\t\t\t\t\t\tremit:click="go-drafts"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationOver && !cancellationWithDraft">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Перейти во входящие\')}"\n\t\t\t\t\t\t\tremit:click="go-inbox"\n\t\t\t\t\t\t\tqa:id="go-inbox"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="!isDeliveryCancelVersion">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t\x3c!-- Шаблон сохраняется --\x3e\n\t\t\t\t\t<fn:when test="attrs[\'template-status\'] === \'saving\'">\n\t\t\t\t\t\t<b:spinner small color="gray"/>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\x3c!-- Шаблон сохранили --\x3e\n\t\t\t\t\t<fn:when test="attrs[\'template-status\'] === \'saved\'">\n\t\t\t\t\t\t<span bem:elem="template-saved">\n\t\t\t\t\t\t\t<b:ico name="status:doneround"/>\n\t\t\t\t\t\t\t<span>{i18n(\'Шаблон сохранён\')}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\x3c!-- Сохранение в шаблон не нажали --\x3e\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Сохранить в шаблон\')}"\n\t\t\t\t\t\t\tevent:details="message"\n\t\t\t\t\t\t\tremit:click="template"\n\t\t\t\t\t\t\tqa:id="template"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Ссылка на звонок --\x3e\n\t<fn:match name="calls" args="message, link">\n\t\t<div bem:elem="calls" qa:id="calls">\n\t\t\t<fn:var name="calls" value="{message.get(\'calls\')}"/>\n\n\t\t\t<fn:if test="calls.length === 1">\n\t\t\t\t<span>{i18n(\'Ссылка на видеозвонок:\')}</span>\n\t\t\t\t<a\n\t\t\t\t\tbem:elem="calls-link"\n\t\t\t\t\thref="{calls[0]}"\n\t\t\t\t\ttarget="_blank"\n\t\t\t\t\trel="noopener"\n\t\t\t\t\tremit:click="calls-link"\n\t\t\t\t\tqa:id="calls-link"\n\t\t\t\t>\n\t\t\t\t\t{calls[0]}\n\t\t\t\t</a>\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="calls-ico"\n\t\t\t\t\tqa:id="copy"\n\t\t\t\t\tremit:click="calls-copy"\n\t\t\t\t\tref="callsLinkCopy"\n\t\t\t\t\ttitle="{i18n(\'Скопировать ссылку\')}"\n\t\t\t\t>\n\t\t\t\t\t<b:ico secondary name="actions:copy" size="s"/>\n\t\t\t\t</span>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="calls.length > 1 && !!link">\n\t\t\t\t<span>{i18n(\'В письме есть несколько ссылок на звонки.\') }</span>\n\t\t\t\t<a\n\t\t\t\t\tbem:elem="calls-link"\n\t\t\t\t\tremit:click="calls-message-link"\n\t\t\t\t\thref="{link}"\n\t\t\t\t\trel="noopener"\n\t\t\t\t\tqa:id="calls-message-link"\n\t\t\t\t>\n\t\t\t\t\t{i18n(\'Перейти в письмо\')}\n\t\t\t\t</a>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Поле аттачей --\x3e\n\t<fn:if test="!isDeliveryCancelVersion">\n\t\t<fn:match name="attachments" args="attachments, more, expanded">\n\t\t\t<div bem:elem="attachments" qa:id="attachments:{attachments.length}">\n\t\t\t\t<bem:mod name="more" value="{more > 0}"/>\n\t\t\t\t<bem:mod name="expanded" value="{expanded}"/>\n\n\t\t\t\t<div bem:elem="attachments-container" ref="attachments">\n\t\t\t\t\t<fn:for data="attachments" as="attach" key="attachKey">\n\t\t\t\t\t\t<fn:var name="key" value="{_this.getAttachKey(attachKey)}"/>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tkey="{key}"\n\t\t\t\t\t\t\tbem:elem="attach-item"\n\t\t\t\t\t\t\tdata-id="{key}">\n\t\t\t\t\t\t\t<b:attach-filename model="{attach}"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:for>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="attachments-more"\n\t\t\t\t\tfn:if="more > 0 && !expanded"\n\t\t\t\t\tremit:click="attachments-more:click">\n\t\t\t\t\t<fn:var name="contextMore" value="{Object.fromEntries([[\'more\', more]])}"/>\n\t\t\t\t\t<fn:value output="raw">messages.more(contextMore)</fn:value>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="attachments-more"\n\t\t\t\t\tfn:if="more > 0 && expanded"\n\t\t\t\t\tremit:click="attachments-more:click">\n\t\t\t\t\t<span class="layer__link">{i18n(\'Свернуть\')}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</fn:match>\n\t</fn:if>\n\n\t\x3c!-- Рекламный баннер --\x3e\n\t<fn:match name="banner">\n\t\t<div bem:elem="banner" ref="banner" qa:id="banner"></div>\n\t</fn:match>\n\n\t\x3c!-- Лейер не рисуем, если нужен только notify --\x3e\n\t<fn:if test="!isNotifyVersion">\n\t\t<fn:if test="!attrs.mobile">\n\t\t\t<b:layer\n\t\t\t\t\tremit:close="close"\n\t\t\t\t\thiddenfooter="{attrs[\'hide-ads\']}"\n\t\t\t\t\tclose\n\t\t\t\t\theader\n\t\t\t\t\tmedia\n\t\t\t\t\tcompose\n\t\t\t\t\twide="{!slim}"\n\t\t\t\t\tsize="{slim ? \'m\' : \'\'}"\n\t\t\t\t\tcenter>\n\n\t\t\t\t<fn:match name="header">\n\t\t\t\t\t<fn:if test="!attrs.error">\n\t\t\t\t\t\t<fn:if test="!isReady">\n\t\t\t\t\t\t\t<div qa:id="is-in-progress">\n\t\t\t\t\t\t\t\t{i18n(\'Письмо отправляется...\')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t<fn:if test="isReady">\n\t\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\t<fn:when test="attrs.isLateSent">\n\t\t\t\t\t\t\t\t\t<div qa:id="is-schedule-sent">\n\t\t\t\t\t\t\t\t\t\t{messages.lateSent}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\tbem:elem="link"\n\t\t\t\t\t\t\t\t\t\t\thref="{attrs.link}"\n\t\t\t\t\t\t\t\t\t\t\tremit:click="link:click"\n\t\t\t\t\t\t\t\t\t\t\tqa:id="is-sent"\n\t\t\t\t\t\t\t\t\t\t\tfn:if="!isLetterCanceled"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{messages.sent}\n\t\t\t\t\t\t\t\t\t</a>\n\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\tbem:elem="link"\n\t\t\t\t\t\t\t\t\t\t\thref="{attrs.link}"\n\t\t\t\t\t\t\t\t\t\t\tremit:click="link:click"\n\t\t\t\t\t\t\t\t\t\t\tqa:id="is-canceled"\n\t\t\t\t\t\t\t\t\t\t\tfn:if="isLetterCanceled"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{cancellationResultText}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:if>\n\t\t\t\t\t<fn:if test="attrs.error">\n\t\t\t\t\t\t<div qa:id="error">\n\t\t\t\t\t\t\t{i18n(\'При отправке письма произошла ошибка\')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:match>\n\t\t\t\t<fn:match name="content">\n\t\t\t\t\t<fn:if test="!isReady && !attrs.error">\n\t\t\t\t\t\t<b:spinner/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="isReady || attrs.error">\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="recipients"\n\t\t\t\t\t\t\t\targs="message, attrs[\'recipients-more\'], attrs[\'recipients-expanded\']"/>\n\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="calls"\n\t\t\t\t\t\t\t\tfn:if="!attrs[\'hide-calls\'] && message.get(\'calls\') && message.get(\'calls\').length"\n\t\t\t\t\t\t\t\targs="message, attrs.link"/>\n\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="attachments"\n\t\t\t\t\t\t\t\tfn:if="messageAttachments && messageAttachments.length"\n\t\t\t\t\t\t\t\targs="messageAttachments, attrs[\'attachments-more\'], attrs[\'attachments-expanded\']"/>\n\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="controls"\n\t\t\t\t\t\t\t\targs="message, attrs.error ? \'error\': \'ok\'"/>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:match>\n\t\t\t\t<fn:match name="footer">\n\t\t\t\t\t<fn:apply-match name="banner"/>\n\t\t\t\t</fn:match>\n\t\t\t</b:layer>\n\t\t</fn:if>\n\n\t\t<fn:if test="attrs.mobile">\n\t\t\t<b:layer-mobile media>\n\t\t\t\t<fn:match name="header">\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="back"\n\t\t\t\t\t\tremit:click="layer:close">\n\t\t\t\t\t<b:button2 text="{i18n(\'Назад\')}"\n\t\t\t\t\t\t\t   ico="arrow-back"\n\t\t\t\t\t\t\t   pure\n\t\t\t\t\t\t\t   touch\n\t\t\t\t\t\t\t   short\n\t\t\t\t\t\t\t   text-center\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="attrs.isLateSent">\n\t\t\t\t\t\t\t\t{messages.lateSent}\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t{messages.sent}\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t</span>\n\t\t\t\t</fn:match>\n\n\t\t\t\t<fn:match name="content">\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tname="recipients"\n\t\t\t\t\t\t\targs="message, 0, true"/>\n\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tname="calls"\n\t\t\t\t\t\t\tfn:if="!attrs[\'hide-calls\'] && message.get(\'calls\') && message.get(\'calls\').length"\n\t\t\t\t\t\t\targs="message, attrs.link"/>\n\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tfn:if="messageAttachments.length"\n\t\t\t\t\t\t\tname="attachments"\n\t\t\t\t\t\t\targs="messageAttachments, 0, true"/>\n\t\t\t\t</fn:match>\n\n\t\t\t\t<fn:match name="footer">\n\t\t\t\t\t<fn:apply-match name="banner"/>\n\t\t\t\t</fn:match>\n\t\t\t</b:layer-mobile>\n\t\t</fn:if>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/layer-sent-page/layer-sent-page.html")});define("feast-tpl!ui-block/layer-sent-page/layer-sent-page.html",["feast-tpl!app/feast-tpl!ui-block/layer-sent-page/layer-sent-page.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/attach-filename/attach-filename.html",["feast"],function(a){return a.smartParse('<div>\n\t<span bem:elem="icon">\n\t\t<b:attach-icon name="{attrs.model.getExtension()}"/>\n\t</span>\n\t<span bem:elem="text">{attrs.model.get(\'name\')}</span>\n</div>\n',"app/feast-tpl!ui-block/attach-filename/attach-filename.html")});define("feast-tpl!ui-block/attach-filename/attach-filename.html",["feast-tpl!app/feast-tpl!ui-block/attach-filename/attach-filename.html"],function(a){return a});define("ui-block/attach-filename/attach-filename",["exports","feast","feast-tpl!./attach-filename.html","ui-block/attach-icon/attach-icon"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"attach-filename",template:e.default,blocks:{"attach-icon":f.default}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-sent-page/layer-sent-page",["require","exports","@mail/adman","data-source/index","default-values","feast","feast-mod/correspondents","feast-mod/utils","feast-tpl!./layer-sent-page.html","helpers/browser","lazy.modules","mail/Folder","mail/Message","service/adv/index","service/compose","service/notify","service/radars/decorator","service/radars/index","service/smokescreen","ui-block/attach-filename/attach-filename","ui-block/button2/button2","ui-block/ico/ico","ui-block/layer/layer","ui-block/layer-mobile/layer-mobile","ui-block/spinner/spinner"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importStar(d);g=__importStar(g);h=__importDefault(h);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);var x={ok:i18n("Вы отменили отправку письма"),fail:i18n("Не удалось отменить отправку"),openDraft:i18n("Отправка отменена, открываем черновик"),openDraftFail:i18n("Не удалось открыть черновик")};var y="command+z,ctrl+z";exports.default=d.Block.extend(o.default({events:["calls-link","calls-copy","calls-message-link"]})(q.withWelter({name:"layer-sent-page",template:g,clipboard:null,mods:{correspondent:e.correspondent},blocks:{layer:u.default,"attach-filename":r.default,button2:s.default,"layer-mobile":v.default,spinner:w.default,ico:t.default},events:{"attachments-more:click":"onAttachmentsToggle","recipients-more:click":"onRecipientsToggle","link:click":"onLinkClick","calls-message-link":"onLinkClick",close:"onClose",resend:"onResend","compose-back":"onComposeBack",template:"onTemplate","calls-copy":"onCallsCopyClick",cancel:"onCancel","go-inbox":"goToInboxFolder","go-drafts":"openDraft"},defaults:{mobile:false,visible:false,responsive:true,isLateSent:false,lateSentText:"",model:null,loading:false,error:false,"delay-visible":c.LAYER_SENT_PAGE_CONFIG.delayVisible,"hide-ads":c.HIDE_TOYS===c.BL_PROP_NAME,"hide-calls":c.DISABLE_CALLS_ON_SENT_PAGE,"loader-timeout-exceeded":false,"visibility-timeout-exceeded":false,"template-status":"idle","promo-disabled":false,"attachments-more":0,"attachments-expanded":false,"recipients-more":0,"recipients-expanded":false,"last-recipients-id":"","last-attachments-id":"","is-notify-version":false,"is-delivery-cancel-version":false,"delivery-cancel-timer-text":null,"cancellation-result-text":x.ok,"cancellation-interval":null,"is-cancellation-over":false,"cancellation-with-draft":false,"is-cancellation-progress":false,"is-letter-canceled":false,"timer-start":0,"prev-timer-value":0,"cancel-lifetime":0,"open-draft-fail":false},attrChanged:{visible:function(){this.isReady()&&this.redraw()},loading:function(){if(this.isMounted()){if(this.isReady()){this.redraw()}this.setVisibilityTimeout()}},error:function(a){if(a){this.is("visible")&&this.redraw();clearTimeout(this.visibleTimer)}},mobile:function(){this.isReady()&&this.redraw(true)},model:function(a){this._attachments=a.attachments.filter(function(a){return!a.isInline()})},"loader-timeout-exceeded":function(){this.isReady()&&this.redraw()},"visibility-timeout-exceeded":function(){if(this.isReady()){p.default("sent_close_timeout");this.onClose()}}},isReady:function(){return this.is("visible")&&!this.is("loading")&&!this.is("error")&&(this.is("loader-timeout-exceeded")||!this.loadingTimer)},redraw:function(a){var b=this;if(a===void 0){a=false}this.hideElements("attachments","layer-sent-page__attach-item",a);this.hideElements("recipients","layer-sent-page__contact-item",a);if(this.clipboard){this.clipboard.destroy()}var c=this.refs.callsLinkCopy;if(c){var d=this.get("model");var e=d===null||d===void 0?void 0:d.get("calls");if(!e||!e.length){return p.default([this.name,"calls","error","no-link-to-copy"])}c.setAttribute("data-clipboard-text",e[0]);i.lazyClipboard().then(i.uniqCallback(this,function(a){b.clipboard=b.isMounted()?new a(c):null}))}this.sendCallsRadar()},hideElements:function(a,b,c){if(c===void 0){c=false}var d=this.refs[a];if(!d){return}var e=d.offsetWidth;if((c||!this.get(a+"-more"))&&d.scrollWidth>e){var f=d.getElementsByClassName(b);var g=0;while(g<f.length&&f[g].offsetLeft+f[g].offsetWidth<e){g++}if(g!==f.length){this.set(a+"-more",f.length-g-1);this.set("last-"+a+"-id",this.get(a+"-more")>0?f[g].getAttribute("data-id"):"")}}p.default([this.name,a,"more",this.is(a+"-more").toString()])},onAttachmentsToggle:function(){this.set("attachments-expanded",!this.is("attachments-expanded"));p.default([this.name,"attachments","more","click"])},onRecipientsToggle:function(){this.set("recipients-expanded",!this.is("recipients-expanded"));p.default([this.name,"recipients","more","click"])},onLinkClick:function(){var a=this;p.default([this.name,"link"]);this.get("router").nav(this.get("link")).then(function(){a.onClose()})},onResend:function(){var a=this;var b=this.get("model");this.set({loading:true,error:false});p.default([this.name,"resend","click"]);b.send().then(function(b){a.broadcast("resent",{sentMessage:b});p.default([a.name,"resend","ok"])}).catch(function(){a.set("error",true);p.default([a.name,"resend","fail"])})},onComposeBack:function(){var a=this.get("model");a.set("finalized",false);m.default.add(a);p.default([this.name,"compose-back","click"]);this.broadcast("layer:close",{type:"compose-back"})},prepareModelForTemplate:function(){var a=this.get("model");return k.default.findOne(this.get("sent-id")).then(function(b){return a.reattach({sync_space_left:true,sync_attachments:true,reset_attachments:true,source_model:b,force:true})})},onTemplate:function(){var a=this;var c=this.name;p.default([c,"template","click"]);this.set("template-status","saving");this.clearTimeouts();var d=this.get("model");this.prepareModelForTemplate().then(function(){return d.save({template:true})}).then(function(){p.default([c,"template","ok"]);if(a.isMounted()){a.set("template-status","saved");a.setVisibilityTimeout()}else{n.default.add({text:i18n("Сохранено в шаблоны")})}b.default.updateAll()}).catch(function(){if(a.isMounted()){a.broadcast("layer:close");a.set("template-status","idle")}p.default([c,"template","fail"]);n.default.add({type:n.default.types.error,text:i18n("Что-то пошло не так")})})},clearCancellationInterval:function(){var a=this.get("cancellation-interval");if(a){clearInterval(a);this.set("cancellation-interval",null)}},forceDelivery:function(){var a=this.get("model");var b=a.get("delivery_forced");var c=a.get("delivery_canceled");var d=a.get("cancellation_token");if(!b&&!c&&d){a.forceDelivery().then(function(a){var b=a.success;var c=b?"suc":"err";p.default("del_force_"+c)}).catch(function(a){p.default({type:"del_force_fail",rlog:"del_force_fail",rlog_message:a})})}},onCancel:function(){var a=this;p.default({type:"del_cancel_click",value:this.get("time-difference")});this.set("is-cancellation-progress",true);var b=this.get("cancellation-notify");b===null||b===void 0?void 0:b.close();clearTimeout(this.visibleTimer);var c=this.get("model");c.cancelDelivery().then(function(b){var d=b.success,e=b.error;var f=!a.get("cancellation-interval");var g=d&&!f?[x.ok,"ok"]:[x.fail,"error_"+e],h=g[0],i=g[1];var j=d&&c.get("draft_id");a.set({"cancellation-result-text":h,"is-cancellation-over":true,"cancellation-with-draft":j,"is-cancellation-progress":false,"is-letter-canceled":true});if(a.get("is-notify-version")){n.default.add({text:d?x.openDraft:x.fail,qa:"cancellation-"+(d?"ok":"fail")+"-notify"})}a.clearCancellationInterval();p.default("del_cancel_"+i);if(j){a.openDraft()}}).catch(function(b){a.set({"cancellation-result-text":x.fail,"is-cancellation-progress":false,"is-letter-canceled":true});if(a.get("is-notify-version")){n.default.add({text:x.fail,qa:"cancellation-error-notify"})}p.default({type:"del_cancel_fail",rlog:"del_cancel_fail",rlog_message:b})}).finally(function(){a.setVisibilityTimeout()})},setTimerValues:function(a,b){var c=this.get("prev-timer-value");if(a>=c){return}if(this.get("is-notify-version")){var d=this.get("cancellation-notify");d&&n.default.setData(d,{actions:[{text:i18n("Отменить {timerValue}",{timerValue:a})}]});this.set({"time-difference":b,"prev-timer-value":a})}else{this.set({"delivery-cancel-timer-text":i18n("Отменить отправку {timerValue}",{timerValue:a}),"time-difference":b,"prev-timer-value":a})}},setCancellationTimer:function(){var a=this;var b=this.get("cancel-lifetime");var d=setInterval(function(){var d=a.get("timer-start");var e=Math.round((Date.now()-d)/1e3);var f=b-e;var g=f+c.CANCELLATION_RESERVE_TIME;f<=0?a.onCancelTimerOver():a.setTimerValues(f,e);if(g===0){a.clearCancellationInterval()}},200);this.set({"timer-start":Date.now(),"delivery-cancel-timer-text":i18n("Отменить отправку {timerValue}",{timerValue:b}),"cancellation-interval":d,"prev-timer-value":b})},onClose:function(){if((this===null||this===void 0?void 0:this.el)&&!this.get("is-cancellation-progress")){this.broadcast("layer:close")}},onBeforeHide:function(){this.clearTimeouts();var b=a.default.placement("sent");if(b){b.sleep()}l.default.wakeUp("sent");l.default.update();var d=(this===null||this===void 0?void 0:this.el)&&this.get("is-cancellation-progress");if(c.DELAY_FOR_CANCELLATION&&!d){this.forceDelivery()}if(d){return{stopHiding:true}}this.broadcast("layer:on-before-hide")},onCancelTimerOver:function(){var a=(this===null||this===void 0?void 0:this.el)&&this.get("is-cancellation-progress");if(!a){this.set("is-cancellation-over",true);this.forceDelivery();var b=this.get("cancellation-notify");b===null||b===void 0?void 0:b.close()}},showNotify:function(){var a=this.getMessages();var b=this.get("is-delivery-cancel-version");if(!b){n.default.add({text:this.get("isLateSent")?a.lateSent:a.sent,qa:(this.get("isLateSent")?"scheduled-":"")+"letter-sent-notify"});return}var c=n.default.add({text:a.sent,actions:[{text:i18n("Отменить {timerValue}",{timerValue:this.get("cancel-lifetime")})}],qa:"letter-cancellation-notify",duration:this.get("cancel-lifetime")});c.on("action",this.onCancel.bind(this));c.on("closed",this.onClose.bind(this));this.set("cancellation-notify",c)},didMount:function(){var b=this;if(a.default.placement("sent")){var c=a.default.placement("sent");c.attachToContainer(this.refs.banner);c.wakeUp();c.render(true).catch(function(){return null})}var d=this.get("is-delivery-cancel-version");var e=this.get("is-notify-version");if(e){this.showNotify();i.lazyMailKeymaster().then(function(a){if(b.mounted&&!b.keyLib){b.keyLib=a;a(y,function(){b.onCancel()})}})}if(!d){return}p.default("cancel_on");this.setCancellationTimer()},didUnmount:function(){this.clearTimeouts();if(a.default.placement("sent")){a.default.placement("sent").destroy()}if(this.clipboard){this.clipboard.destroy()}this.clearCancellationInterval();if(this.keyLib){this.keyLib.unbind(y)}},setVisibilityTimeout:function(){var a=this;this.visibleTimer=setTimeout(function(){a.set("visibility-timeout-exceeded",true)},this.get("delay-visible"))},clearTimeouts:function(){clearTimeout(this.loadingTimer);clearTimeout(this.visibleTimer)},getContactList:function(a){return e.correspondentsFull(a)},getContactKey:function(a,b){return"contact-"+b+"-"+a},getAttachKey:function(a){return"attach-"+a},getAttachments:function(){return this._attachments},getMessages:function(){var a=this;var b=!Object.values(f.TRANSLATE_STRINGS_TO_MOMENT).find(function(b){return a.attrs.lateSentText.includes(b)});return{more:function(a){return i18n("и {spanOpen}ещё {more}{spanClose}",__assign({"unsafe-spanOpen":'<span class="layer__link">',"unsafe-spanClose":"</span>"},a))},sent:i18n("Письмо отправлено"),lateSent:b?i18n("Ваше письмо будет отправлено {lateSentText}",{lateSentText:this.attrs.lateSentText}):i18n("Ваше письмо будет отправлено {lateSentTextWithoutPrefix}",{lateSentTextWithoutPrefix:this.attrs.lateSentText})}},onCallsCopyClick:function(){n.default.add({text:i18n("Ссылка скопирована")},"layer-window")},sendCallsRadar:function(){var a=this.get("model");var b=a===null||a===void 0?void 0:a.get("calls");var c=this.get("hide-calls");if(c||!b||!b.length){p.default([this.name,"show","no-calls"])}else if(b.length===1){p.default([this.name,"show","calls-one"])}else{p.default([this.name,"show","calls-many"])}},goToInboxFolder:function(){var a=this.get("router");a===null||a===void 0?void 0:a.go("#letters");this.broadcast("layer:close");p.default([this.name,"go","inbox"])},openDraft:function(){var a=this;p.default("cncl_draft_clk");var b=this.get("model");return k.default.fetchData({id:b.get("draft_id"),folder_id:j.default.DRAFTS},true,true).then(function(b){p.default("cncl_draft_ok");k.default.set([b]);a.set("open-draft-fail",false);a.broadcast("compose:draft",new k.default(b));a.onClose()}).catch(function(b){p.default({type:"cncl_draft_fail",rlog:"cncl_draft_fail",rlog_message:b});a.set({"open-draft-fail":true,"cancellation-result-text":x.openDraftFail})})},getCancelShortcut:function(){return h.default.mac?"CMD+Z":"CTRL+Z"}})))});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;Object.defineProperty(a,d,{enumerable:true,get:function(){return b[c]}})}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/compose-windows/compose-windows",["require","exports","@mail/adman","@mail/features","@mail/xray","cfg","data-source/actions","data-source/index","default-values","feast","feast-tpl!./compose-windows.html","helpers/autocomplete","helpers/email-length-postfix","helpers/user-track","logger","mail/Folder","mail/Message","mail/Thread","mediator/layout-manager","RPC","service/addressbook/addressbook","service/adv/index","service/auth","service/captcha","service/compose-validators","service/layer","service/mailbox/loader","service/notify","service/radars/decorator","service/radars/index","service/smokescreen","ui-block/compose-app/compose-app","ui-block/compose-collapsed/compose-collapsed","ui-block/dimmer/dimmer","ui-block/layer-sent-page/layer-sent-page","ui-block/notify-stack/notify-stack","../../feast-mod/utils"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);h=__importStar(h);i=__importStar(i);j=__importDefault(j);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importStar(s);t=__importStar(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);var J=100;var K=100;var L=350;var M=350;var N="too_long";var O=m.default.getScope("compose.mail.ru");var P=function(){t.default.wakeUp.apply(t.default,t.SLOTS_EXCEPT_SENT);t.default.updateOnAction()};exports.default=h.Block.extend(A.default({explicit:"radar"})({name:"compose-windows",blocks:{dimmer:F.default,"compose-app":D.default,"compose-collapsed":E.default,"notify-stack":H.default,"layer-sent-page":G.default},events:{"collapsed-item-close":"onCollapsedItemClose","window-close":"onClose","window-collapse":"onCollapse","window-expand":"onExpand","letter-send":"onLetterSend","letter-schedule":"onLetterSchedule","letter-save":"onLetterSave","letter-autosave":"onLetterAutosave","letter-savetemplate":"onLetterSaveTemplate","letter-exceedmaxsize":"onExceedSize"},defaults:{adaptive:false,fullscreen:false,compact:false,overlap:false,ponymode:false,mobile:g.TOUCH_MODE,"mobile-layout":false,"expand-status":false,"has-right-column":false,"right-column-compact":false,rise:false,"support-extend":true,extended:false,"close-on-error":false,autosend:false},template:i,isolateEvents:false,constructor:function(){h.Block.prototype.constructor.apply(this,arguments);this.onLayoutUpdate=this.onLayoutUpdate.bind(this);this.onDataSourceChange=this.onDataSourceChange.bind(this)},didMount:function(){this._sending={};this._sendingCaptchaCallbacks={};z.default.setup(this.ids["compose-notify"],"compose-notify");f.default.on("change",this.onDataSourceChange);this.onLayoutUpdate();if(g.COMPOSE_INIT_ADDRESSBOOK){s.default.lazyInit()}},didUnmount:function(){f.default.off("change",this.onDataSourceChange)},animate:function(a,b,c){var d=this;if(g.COMPOSE_WINDOW_ANIMATION){var e="animate-"+a;setTimeout(function(){d.set(e,false);if(c){c()}},b);this.set(e,true)}else if(c){c()}},onCollapsedItemClose:function(a){var b=a.details;this.remove(b.uid);b.destroy();this.broadcast("window-collapsed-hide")},onClose:function(a){var b=this;var c=a.details;var d=c.get("form");var e=c.get("compose-options");var f=this.get("active");var g=function(){P();d.uid===f&&b.set("active",null);b.remove(d.uid);d.destroy();b.broadcast("window-hide")};if(!c.noAnimate){this.animate("close",K,g)}else{g()}if(e===null||e===void 0?void 0:e.templateName){B.default({type:"compose-templates_close",dwh:{template:e.templateName}})}return false},onCollapse:function(a){var b=this;var c=a.details;var d=c&&c.get("form");var e=this.ids["compose-"+this.get("active")];var f=c||e;if(f){f._updateComposeFields();this.saveDraft(f,{silent:true})}var g=function(){b.hide(d.uid);b.set("expand-status",false);P();b.broadcast("window-hide")};if(!c.noAnimate){this.animate("collapse",M,g)}else{g()}},onExpand:function(a){var b=this;var c=a.details;var d=c.get("form")||c;this.show(d.uid);this.animate("expand",L,function(){b.set("expand-status",true)})},onLetterAutosave:function(a){var b=a.details;B.default("compose_action_save_auto");O.add("autosave",{id:b.attrs.form.uid});this.saveDraft(b)},onLetterSave:function(a){var b=a.details;B.default("compose_action_save");var c=b.get("compose-options");this.saveDraft(b,{userAction:true});if(c===null||c===void 0?void 0:c.templateName){B.default({type:"compose-templates_save",dwh:{template:c.templateName}})}},onLetterSaveTemplate:function(a){var b=a.details,c=b.composeApp,d=b.resolve;B.default("compose_action_save_template");this.saveTemplate(c).then(d,d)},onLetterSchedule:function(a){var b=a.details,c=b.composeApp,d=b.scheduleText;var e=c.get("compose-options");this.letterSend({composeApp:c,scheduleText:d,schedule:true});if(e===null||e===void 0?void 0:e.templateName){B.default({type:"compose-templates_schedule",dwh:{template:e.templateName}})}},onExceedSize:function(){this.showExceedNotify()},onLetterSend:function(a){var b=a.details;var c=b.get("compose-options");this.letterSend({composeApp:b});if(c===null||c===void 0?void 0:c.templateName){B.default({type:"compose-templates_send",dwh:{template:c.templateName}})}},onDataSourceChange:function(a){var b=a.details;if(!b){return}var c=b.changes;if(!c){return}var d=c.some(function(a){var b=a.action;if(!b){return false}var c=b.type;return c===e.UPDATE_LAYOUT_SUPPORT_3_PANE});if(d){this.onLayoutUpdate()}},onLayoutUpdate:function(){var a;var b=this.get("layout");if(b){var c="default"in b&&"isLessThen"in b.default&&"isMoreThen"in b.default?b.default:b;var e=c.columnRight;var f=e>=40;var h=(c===null||c===void 0?void 0:c.isMoreThen("xs"))&&(c===null||c===void 0?void 0:c.isLessThen("l"))&&e<=40;var i=!!(((a=d.default.headline)===null||a===void 0?void 0:a.headlinePromoHeight)!==0&&document.querySelector(".vk-slides-iframe_show"));this.set({fullscreen:(c===null||c===void 0?void 0:c.isLessThen("s"))||g.TOUCH_MODE,adaptive:!i&&(c===null||c===void 0?void 0:c.isVertical("l")),mobile:(c===null||c===void 0?void 0:c.isLessThen("s"))||g.TOUCH_MODE,"mobile-xxs":c===null||c===void 0?void 0:c.isLessThen("xs"),overlap:(c===null||c===void 0?void 0:c.isLessThen("m"))||g.TOUCH_MODE,compact:h,rise:(c===null||c===void 0?void 0:c.isLessThen("xl"))||g.TOUCH_MODE,"3pane":(c===null||c===void 0?void 0:c.getType())==="3pane","has-right-column":f,"right-column-compact":f&&e<=40,"support-extend":(c===null||c===void 0?void 0:c.supportComposeExtend)&&!g.TOUCH_MODE})}},letterSend:function(a){var b=this;var c=a.composeApp,d=a.schedule,e=a.scheduleText;var f=c.get("form");w.default.checkOnRettachToReply(f).then(function(a){return!a.hasNewAttach?w.default.checkOnMissingAttach(f).then(function(b){return __assign(__assign({},a),{missingAttach:b})}):__assign(__assign({},a),{missingAttach:false})}).then(function(a){var g=a.hasNewAttach,h=a.source,i=a.missingAttach;if(!g){if(i){b.checkLostAttaches(c,d,e)}else{b.send(c,d,e)}return}B.default("reattach-to-reply_reattach-open");c.set("focusoff",true);x.default.open("reattach-to-reply",{mobile:q.default.isLessThen("xs")},{dimmer:true,compact:true,resolvable:true,mobile:q.default.isLessThen("xs")}).then(function(a){if(a==="skip"){return w.default.checkOnMissingAttach(f).then(function(b){return{type:a,missingAttach:b}})}return{type:a,missingAttach:false}}).then(function(a){var g=a.type,i=a.missingAttach;c.set("focusoff",false);if(g==="attach"){B.default("reattach-to-reply_reattach-attach");f.reattach({sync_space_left:true,sync_attachments:true,reset_attachments:false,source_model:h,force:true}).then(function(){b.send(c,d,e)},function(){B.default("reattach-to-reply_reattach-fail")})}else if(g==="skip"){B.default("reattach-to-reply_reattach-skip");if(i){b.checkLostAttaches(c,d,e)}else{b.send(c,d,e)}}else{B.default("reattach-to-reply_reattach-close");c.set("sending",false)}},function(){B.default("reattach-to-reply_open-fail");c.set("focusoff",false);b.send(c,d,e)})})},checkLostAttaches:function(a,b,c){var d=this;B.default("missing_attach_open");a.set("focusoff",true);x.default.open("missing-attach",{mobile:q.default.isLessThen("xs")},{dimmer:true,compact:true,resolvable:true,mobile:q.default.isLessThen("xs")}).then(function(e){a.set("focusoff",false);if(e==="skip"){B.default("missing_attach_skip");d.send(a,b,c)}else{B.default("missing_attach_back");a.set("sending",false)}},function(){a.set("focusoff",false);B.default("missing_attach_open-fail");d.send(a,b,c)})},getBodyCount:function(a){var b;try{var c=document.createElement("div");c.innerHTML=a;var d=c.querySelectorAll(C.selector("blockquote"));var e=d.length;for(var f=0;f<e;f++){if(d[f].parentNode){d[f].parentNode.removeChild(d[f])}}b=c.innerHTML.length}catch(a){this.radar(["body-count","error"])}return b},_getCountPostfix:function(a){return k.getEmailLengthPostfix(a)},send:function(a,b,c){var d=this;if(b===void 0){b=false}if(c===void 0){c=""}if(g.COMPOSE_INIT_ADDRESSBOOK){s.default.lazyInit().then(function(){d._send(a,b,c)})}else{this._send(a,b,c)}},_send:function(a,c,d){var e=this;if(c===void 0){c=false}if(d===void 0){d=""}if(!a.isMounted()){return}var f=a.get("form");var h=f.get("subject");if(g.COMPOSE_SUBJECT_AUTOCOMPLETE&&h){j.default("Subject",h)}if(g.COMPOSE_SEND_STAT){this._updateComposeStatsFields(f)}if(g.COMPOSE_SEND_USER_TRACK){this._updateComposeUserTrackFields(f)}f.set({"compose_stat.build":g.BUILD,"compose_stat.serverTime":g.SERVER_TIME},{silent:true});if(b.default.has("body-size-radars")){setTimeout(function(){var a=e.getBodyCount(f.get("body.html"));if(a!==void 0){e.radar(["send","body-count",e._getCountPostfix(a)],a);e.radar(["send","body-count"],a)}else{e.radar(["send","no-body-count"])}},0)}a.set("sending",true);v.default.retryUntilCaptchaSuccess(function(a){var b=a.capcha;var d={delay_for_cancellation:g.DELAY_FOR_CANCELLATION};if(b){d.capcha=b}f.set(d);return f.send(c)}).then(function(){var b=f.attachments.reduce(function(a,b){return a+(b.isCloudStock()?1:0)},0);if(b){e.radar(["send","has-cloud-stock"],b)}if(g.OVERSIZE_CLOUD_ATTACHES){var h=f.attachments.reduce(function(a,b){if(!b.isOverMaxLinkSize()){return a}var c=b.get("size");var d=a.total,e=a.max,f=a.count,g=a.extensions;g.push(b.get("content_type"));return{max:Math.max(c,e),total:d+c,count:f+1,extensions:g}},{total:0,max:0,count:0,extensions:[]}),i=h.total,j=h.max,k=h.count,l=h.extensions;if(k){B.default({type:"compose_oversize-cloud_send",dwh:{count:k,total:i,max:j,extensions:l.join()}})}}B.default("compose_send");var m=f.id,n=f.cid,o=f.uid;O.add("send",{id:m,cid:n,uid:o,schedule:c});e._sendEmailTypeRadar(f.get("correspondents.from.0.email"));e._sendTranslationTypeRadar(f.meta("lastSavedTranslation"));a.set("sending",false);e._openSentPage(a,{isLateSent:c,lateSentText:d});if(c){e.onLateSent(f)}else{e.onSent(f)}},function(b){B.default("compose_send_fail");a.set({sending:false,errors:b.body,capcha:null});e.onFailSent(f,b,a)}).catch(function(){a.set("sending",false)})},unsubscribeCaptchaCallback:function(a){if(this._sendingCaptchaCallbacks[a]){v.default.off("open-captcha-popup",this._sendingCaptchaCallbacks[a]);delete this._sendingCaptchaCallbacks[a]}},isCancelDeliveryTurnOn:function(a){if(!a){return false}var b=a.get("cancellation_token");var c=a.get("cancellation_button_lifetime");return b&&c},_openSentPage:function(b,c){var d=this;var e=this.get("router");var f=b.get("form");var h=this.isCancelDeliveryTurnOn(f);var i=!a.default.placement("sent")&&g.SENT_PAGE_NOTIFY;var j=f.uid;var k=c.isLateSent,l=c.lateSentText;this._sending[j]=true;this.hide(j);this.layerPromise=x.default.open("sent-page",{model:f,loading:false,link:e.getUrl("#letters",{folder:n.default.SENT}),router:e,"is-delivery-cancel-version":h,"is-notify-version":i,"cancel-lifetime":f.get("cancellation_button_lifetime"),isLateSent:k,lateSentText:l},{dimmer:!i,silent:i,"close-on-esc":!i,resolvable:false});this.layerPromise.then(function(a){a.on("resent",d.onSent.bind(d));a.on("layer:close",function(a){var b=a.details;if((b===null||b===void 0?void 0:b.type)!=="compose-back"){d.close(f.uid)}P();d.broadcast("window-hide")})})},saveDraft:function(a,b){var c=this;var d=b===void 0?{}:b,e=d.silent,g=e===void 0?false:e,h=d.userAction,i=h===void 0?false:h;var j=a.get("form");if(a.is("closing")){return j.save().then(function(){B.default("compose_save");return f.default.updateAll()}).then(function(){c.showDraftNotify(false,"default")}).catch(function(a){c.onFailDraft(a,false)})}a.set("saving",true);return j.save().then(function(){B.default("compose_save");var b=j.id,d=j.cid,e=j.uid;O.add("save",{id:b,cid:d,uid:e});a.set({saving:false,"has-changes":false});a.setAutosaveInterval(false);c.reloadFormData(j);if(!g){c.showDraftNotify()}}).then(function(){return f.default.updateAll()}).catch(function(b){var d=i;c.onFailDraft(b,false);var e=j.id,f=j.cid,g=j.uid;O.add("save failed",{id:e,cid:f,uid:g,error:b});a.set(__assign(__assign({},d&&{errors:b.body}),{saving:false,"has-changes":true}))})},onFailDraft:function(a,b,c){if(c===void 0){c=true}B.default("compose_save_"+(b?"template_":"")+"fail");try{var d=a.body;var e=d&&Object.keys(d).some(function(a){return/^attaches.list\[.*].id$/.test(a)&&d[a].error==="not_exists"});if(e){B.default("compose_save_"+(b?"template_":"")+"fail_badattach")}}catch(a){console.error(a);B.default("compose_save_"+(b?"template_":"")+"fail_unknown")}if(c){this.showDraftFailNotify(b)}},showDraftFailNotify:function(a,b){if(b===void 0){b="compose-notify"}var c=i18n("Не удалось сохранить в Черновики");if(a){c=i18n("Не удалось сохранить в Шаблоны")}z.default.add({type:z.default.types.error,text:c,qa:"message-save-fail"},b)},saveTemplate:function(a){var b=this;var c=a.get("form");return c.save({template:true}).then(function(){B.default("compose_save_template");return f.default.updateAll().then(function(){a.set({"template-enabled":false});b.showDraftNotify(true);b.reloadFormData(c,true)})}).catch(function(c){a.set({errors:c.body});b.onFailDraft(c,true,false);B.default("compose_save_template_fail")})},showDraftNotify:function(a,b){var c=this;if(a===void 0){a=false}if(b===void 0){b="compose-notify"}var d=new Date;var e=this.get("router");var f=z.default.add({text:a?i18n("Сохранено в шаблонах в {now}",{now:I.formatDate(d,[["hour","2-digit"],["minute","2-digit"]])}):i18n("Сохранено в черновиках в {now}",{now:I.formatDate(d,[["hour","2-digit"],["minute","2-digit"]])}),actions:[{text:i18n("Посмотреть"),event:a?"openTemplate":"openDraft"}]},b);f===null||f===void 0?void 0:f.on("action",function(a){var b=a.details;if(b==="openDraft"){if(c.get("active")){c.hide()}e.go("#letters",{folder:n.default.DRAFTS})}else if(b==="openTemplate"){if(c.get("active")){c.hide()}e.go("#letters",{folder:n.default.TEMPLATES})}})},showExceedNotify:function(a){if(a===void 0){a="compose-notify"}var b={text:i18n("Картинка прикреплена как вложение"),qa:"image-attached-as-file"};z.default.add(b,a)},removeDraft:function(a){var b=this.get("router");b.model.letters.filter(function(b){var c=b.getFolder();return c.isDrafts()&&!c.isTemplates()&&b.get("last")===a}).forEach(function(a){o.default.all.remove(a)})},onLateSent:function(a){this.close(a.uid);var b=a.get("source.draft");this.layerPromise.then(function(b){b.set({loading:false,"sent-id":a.id})}).catch(function(a){z.default.add({text:i18n("Письмо будет отправлено")});console.error(a)});if(b){this.removeDraft(b)}this.reloadFormData(a,false,true)},onSent:function(a){var b=this;var c;var d=a.get("source.reply")||a.get("source.forward");var e=a.get("source.draft");var f=p.default.getListByMessageId(d);var g=this.get("router");this.close(a.uid);var h=p.default.findOne(a.id);this.set("autosend",false);(c=this.layerPromise)===null||c===void 0?void 0:c.then(function(b){var c=g.getUrl("#read-letter",{folder:n.default.SENT,letter:a.id});b.set({link:c,loading:false,"sent-id":a.id});B.default("compose_sent-page")}).catch(function(a){z.default.add({text:i18n("Письмо отправлено")});B.default("compose_sent-page");B.default("compose_sent-page_layer-error");console.error(a)});h.then(function(){f.forEach(function(b){if(b.get("last")===d){a.get("source.reply")&&b.set("flags.reply",true,{silent:true});a.get("source.forward")&&b.set("flags.forward",true,{silent:true})}b.expire()&&b.fetch()});if(e){b.removeDraft(e)}b.reloadFormData(a,false,true)}).catch(function(a){B.default("compose_sent-page_thread-error");console.error(a)});if(a.get("calls")){this.radar(["send","calls"])}},onFailSent:function(a,b,c){var d=b.body,e=b.status;delete this._sending[a.uid];this.unsubscribeCaptchaCallback(a.uid);if(r.default.codes[e]==="invalid"&&d===N){z.default.add({type:z.default.types.error,text:i18n("Превышен лимит на размер письма")},"compose-notify");return}this.showSendFailNotify();if(this.get("close-on-error")){this.onClose({details:c})}},showSendFailNotify:function(a){if(a===void 0){a="compose-notify"}z.default.add({type:z.default.types.error,text:i18n("Не удалось отправить письмо"),qa:"message-send-fail"},a)},reloadFormData:function(a,b,c){if(!b){this.updateAffectedMessage(a,c)}y.default.invalidateCache();y.default.emit("any:reload")},updateAffectedMessage:function(a,b){var c=["reply","forward"];var d=c.find(function(b){return a.is("source."+b)});if(d){var e=o.default.all.get(a.get("source."+d));if(e){if(b){e.set("drafts."+d,"")}else{var f=[];["to","cc"].forEach(function(b){a.get("correspondents."+b).forEach(function(a){if(~a.email.indexOf("@")&&!f.includes(a.email)){f.push(a.email)}})});if(d==="reply"&&f.length>1){d="replyall"}var g={"drafts.last_type":d};g["drafts."+d]=a.get("source.draft");e.set(g)}}}},getCollapsed:function(a){var b=this;var c=this.get("active");return a.filter(function(a){var d=a.formData;return d.uid!==c&&!b._sending[d.uid]})},add:function(a,b){var c=this.get("items").find(function(b){var c=b.formData;if(c.uid===a.uid){return true}else{var d=c.get("source");var e=a.get("source");var f=d.draft&&!Object.keys(d).some(function(a){return d[a]!==e[a]});if(f){return true}}return false});if(c){this.animate("expand",L);this.show(c.formData.uid);return}this.animate("open",J);this.get("items").push({formData:a,autosend:b&&b.autosend,isDragAndDrop:b&&b.isDragAndDrop,dragAndDropItem:b&&b.dragAndDropItem,additionalOptions:b});this.show(a.uid);this.render()},show:function(a){this.set("active",a);if(g.COMPOSE_SEND_USER_TRACK){l.default.startComposeTrack(a)}t.default.sleep.apply(t.default,t.SLOTS_EXCEPT_SENT);this.broadcast("window-show")},hide:function(a){var b=this.get("active");if(!a&&b!==null){a=this.get("items").find(function(a){var c=a.formData;return c.uid==b}).formData.uid}if(a===b){this.set("active",null)}if(g.COMPOSE_SEND_USER_TRACK){l.default.pauseComposeTrack(a)}},close:function(a){var b=this.get("active");a===b&&this.set("active",null);this.remove(a)},remove:function(a){delete this._sending[a];this.unsubscribeCaptchaCallback(a);var b=this.get("items").filter(function(b){var c=b.formData;return c.uid!==a});this.set({items:b});if(g.COMPOSE_SEND_USER_TRACK){l.default.removeCompose(a)}},_updateComposeStatsFields:function(a){var b=s.default.getCachedAll();if(b){var d=a.get("correspondents");var e=[];["to","cc","bcc"].forEach(function(a){d[a].forEach(function(a){var c=a.email;if(s.isInAddressbook(b,c)){e.push(1)}else{e.push(0)}})});var f={is_in_ab:e.join(""),ab_size:String(b.length)};a.set("compose_stat",f,{silent:true});c.default.send("compose_stat&i=ab_size:"+f.ab_size,null)}},_updateComposeUserTrackFields:function(a){var b=l.default.serialize(a.uid);a.set("compose_stat.user_track",b,{silent:true});c.default.send("compose-user-track",{i:{size:b.length}})},_getCollectors:function(){return this.get("router").model.collectors},_getAliases:function(){return this.get("router").model.aliases},_sendEmailTypeRadar:function(a){var b="unknown-email";if(a===u.default.user.getEmail()){b="main-email"}if(this._getCollectors().some(function(b){return b.getEmail()===a})){b="collector"}if(this._getAliases().some(function(b){return b.getEmail()===a})){b="alias"}B.default(["send","email",b])},_sendTranslationTypeRadar:function(a){if(!a){return}B.default({type:"send_translated_languages",intervals:[["from",a.fromlang],["to",a.tolang]]});B.default("send_translated")},insertHtml:function(a){var b=this.ids["compose-"+this.get("active")];if(b){b.insertHtml(a)}}}))});define("feast-tpl!app/feast-tpl!ui-block/gallery/gallery.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="hasPreviousControl" value="{this.hasPreviousControl()}"/>\n\t<fn:var name="hasNextControl" value="{this.hasNextControl()}"/>\n\t<fn:var name="blockCount"/>\n\n\t<bem:mod name="arrows-bottom" test="~attrs.controls.indexOf(\'arrows_bottom\')"/>\n\n\t\x3c!-- Элементы списка --\x3e\n\t<div\n\t\t\tbem:elem="content-outer"\n\t\t\tref="contentOuter"\n\t>\n\t\t<div\n\t\t\t\tbem:elem="content-inner"\n\t\t\t\tref="content"\n\t\t>\n\t\t\t<bem:mod name="animated" test="attrs._animated"/>\n\n\t\t\t<fn:apply-match name="default" count="blockCount"/>\n\t\t</div>\n\t</div>\n\n\t<div bem:elem="controls">\n\t\t\x3c!-- Кнопка "Назад" --\x3e\n\t\t<div\n\t\t\t\tbem:elem="nav-button"\n\t\t\t\ttitle="{i18n(\'Назад\')}"\n\t\t\t\tremit:click="click:previous"\n\t\t\t\ttabindex="-1"\n\t\t>\n\t\t\t<bem:mod name="hidden" test="!hasPreviousControl"/>\n\n\t\t\t<b:ico name="navigation:arrow_list_previous" size="s"/>\n\t\t</div>\n\n\t\t\x3c!-- Текущая страница --\x3e\n\t\t<div bem:elem="pages" fn:if="~attrs.controls.indexOf(\'pages\')">\n\t\t\t{_this._findCurrentStartIndex() | formatPages:blockCount}\n\t\t</div>\n\n\t\t\x3c!-- Кнопка "Вперёд" --\x3e\n\t\t<div\n\t\t\t\tbem:elem="nav-button"\n\t\t\t\ttitle="{i18n(\'Вперёд\')}"\n\t\t\t\tremit:click="click:next"\n\t\t\t\ttabindex="-1"\n\t\t>\n\t\t\t<bem:mod name="hidden" test="!hasNextControl"/>\n\n\t\t\t<b:ico name="navigation:arrow_list_next"/>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/gallery/gallery.html")});define("feast-tpl!ui-block/gallery/gallery.html",["feast-tpl!app/feast-tpl!ui-block/gallery/gallery.html"],function(a){return a});define("helpers/animation-transition",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.animationTransition=void 0;function a(){var a;var b={transitionOnce:function(c,d){c();if(a){clearTimeout(a)}a=setTimeout(function(){if(b.onEnd){b.onEnd()}a=undefined},d)},stopAll:function(){if(a){clearTimeout(a);if(b.onEnd){b.onEnd()}}}};return b}exports.animationTransition=a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("helpers/touch-tracker",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.touchTracker=void 0;var a={mouse:false,touch:true,mouseDragThreshold:10};function b(b,c){if(c===void 0){c={}}var d=__assign(__assign({},a),c);var e=null;var f;var g;var h;var i;var j=false;var k=false;var l=function(a,b){f=a;g=b;h=f;i=g;k=false};var m=function(a,b){if(f===undefined||g===undefined){f=a;g=b}if(h===undefined||i===undefined){h=f;i=g}var c=f-a;var j=g-b;f=a;g=b;if(Math.abs(h-f)>=d.mouseDragThreshold||Math.abs(i-g)>=d.mouseDragThreshold){k=true}if(e.onMove){e.onMove(c,j)}};var n=function(){f=undefined;g=undefined;if(e.onMoveEnd){e.onMoveEnd()}};var o=function(a){var b=a.changedTouches[0];if(b){l(b.clientX,b.clientY)}};var p=function(a){j=true;l(a.clientX,a.clientY)};var q=function(a){var b=a.changedTouches[0];if(!b){return}m(b.clientX,b.clientY)};var r=function(a){if(j){m(a.clientX,a.clientY)}};var s=function(){n()};var t=function(){j=false;n()};var u=function(a){a.preventDefault()};var v=function(a){if(k){a.preventDefault()}};if(d.touch){b.addEventListener("touchstart",o,{passive:true});b.addEventListener("touchmove",q,{passive:true});b.addEventListener("touchend",s,{passive:true});b.addEventListener("touchcancel",s,{passive:true})}if(d.mouse){b.addEventListener("mousedown",p);b.addEventListener("mousemove",r);b.addEventListener("mouseup",t);b.addEventListener("mouseleave",t);b.addEventListener("dragstart",u);b.addEventListener("click",v)}e={stop:function(){if(d.touch){b.removeEventListener("touchstart",o);b.removeEventListener("touchmove",q);b.removeEventListener("touchend",s);b.removeEventListener("touchcancel",s)}if(d.mouse){b.removeEventListener("mousedown",p);b.removeEventListener("mousemove",r);b.removeEventListener("mouseup",t);b.removeEventListener("mouseleave",t);b.removeEventListener("dragstart",u);b.removeEventListener("click",v)}}};return e}exports.touchTracker=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/gallery/gallery",["require","exports","feast","feast-tpl!./gallery.html","helpers/animation-transition","helpers/resizer","helpers/touch-tracker","ui-block/ico/ico"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);f=__importDefault(f);var g=a.default.Block.extend({name:"gallery",template:b.default,blocks:{ico:f.default},mods:{formatPages:function(a,b){return i18n("{current} из {total}",{current:String(a+1),total:String(b)})}},defaults:{controls:"touch, arrows_middle",_offset:0,_width:window.innerWidth},attrChanged:{_width:function(a){var b=this;this.checkScrollEnd();if(!a){return}if(this.allBlocksVisibleTimeout){clearTimeout(this.allBlocksVisibleTimeout)}this.allBlocksVisibleTimeout=setTimeout(function(){if(b.isMounted()&&b._fitsInWidth(a)){b.broadcast("all-blocks-visible")}b.allBlocksVisibleTimeout=null});if(this.allBlocksRenderedTimeout){clearTimeout(this.allBlocksRenderedTimeout)}this.allBlocksRenderedTimeout=setTimeout(function(){if(b.isMounted()){b.handleAllBlocksRendered()}b.allBlocksRenderedTimeout=null},500)},_offset:function(){this.checkScrollEnd()}},events:{"click:previous":"onClickPrevious","click:next":"onClickNext","touchstart:content-inner":"onTouchStart","touchmove:content-inner":"onTouchMove"},constructor:function(){var b=this;a.default.Block.apply(this,arguments);this.onResize=this.onResize.bind(this);this._itemOffsets=[];this._itemsWidth=0;this._transition=c.animationTransition();this._transition.onEnd=function(){if(b.isMounted()){b.set("_animated",false)}}},didMount:function(){this._resizer=d.default();this._resizer.set(this.onResize);this._resizer.observe(this.refs.content,"content");this._resizer.observe(this.refs.contentOuter,"contentOuter");this._measureItemOffsets({});this.onResize();this.setupTouchTracker()},didUpdate:function(){this._measureItemOffsets({})},shouldUpdate:function(a){if(a._offset!==undefined){this.refs.content.style.marginLeft=-a._offset+"px";return Object.keys(a).length>1}if(a.controls!==undefined&&this._touchTracker){this._touchTracker.stop();this.setupTouchTracker()}return true},didUnmount:function(){this._resizer.unbind();this._touchTracker.stop();this._transition.stopAll()},setupTouchTracker:function(){var a=this;this._touchTracker=e.touchTracker(this.el,{touch:this.get("controls").includes("touch"),mouse:this.get("controls").includes("mouse")});this._touchTracker.onMove=function(b){a.set("_offset",Math.max(Math.min(a.get("_offset")+b,a._itemsWidth-a.get("_width")),0))};this._touchTracker.onMoveEnd=function(){a._transition.transitionOnce(function(){a.set({_offset:a._getItemOffset(a._findNearestStartIndex()),_animated:true})},200)}},onClickPrevious:function(){var a=this;if(this.hasPreviousControl()){var b=this._findCurrentStartIndex();this._transition.transitionOnce(function(){a.set({_offset:a._getItemOffset(b-1),_animated:true})},200)}},onClickNext:function(){var a=this;if(this.hasNextControl()){var b=this._findCurrentStartIndex();this._transition.transitionOnce(function(){a.set({_offset:a._getItemOffset(b+1),_animated:true})},200)}},onResize:function(a){var b=this._getOuterRectWidth(a!==null&&a!==void 0?a:{});this._measureItemOffsets(a!==null&&a!==void 0?a:{},false);this.set({_width:b,_offset:this._getItemOffset(this._findCurrentStartIndex(),b)})},hasPreviousControl:function(a){if(a===void 0){a=this.get("_offset")}return!this._fitsInWidth()&&a>0},hasNextControl:function(a){if(a===void 0){a=this.get("_offset")}return!this._fitsInWidth()&&this._itemsWidth-a>this.get("_width")&&this._findCurrentStartIndex()<this._itemOffsets.length-1},_getItemOffset:function(a,b){var c;if(b===void 0){b=this.get("_width")}var d=((c=this._itemOffsets[a])!==null&&c!==void 0?c:{offset:0}).offset;var e=this._fitsInWidth(b)?d:Math.max(b-(this._itemsWidth-d),0);return d-e},_findCurrentStartIndex:function(){var a=this.get("_offset");for(var b=0;b<this._itemOffsets.length;b++){var c=this._itemOffsets[b];if(Math.round(c.offset)>=Math.round(a)){return b}}return 0},_findNearestStartIndex:function(){var a=this.get("_offset");var b=0;var c=-1;for(var d=0;d<this._itemOffsets.length;d++){var e=this._itemOffsets[d];var f=Math.abs(a-e.offset);if(f<c||c===-1){b=d;c=f}}return b},_fitsInWidth:function(a){if(a===void 0){a=this.get("_width")}return this._itemsWidth<=a},_getOuterRectWidth:function(a){if(a.contentOuter){return a.contentOuter.width}var b=this.refs.contentOuter.getBoundingClientRect();return b?b.width:window.innerWidth},_measureItemOffsets:function(a,b){var c,d,e;if(b===void 0){b=true}if(!a.content){if(!this.refs.content){return}if(b){a.content=(c=this.refs.content.getBoundingClientRect())!==null&&c!==void 0?c:{width:window.innerWidth}}}this._itemsWidth=(e=(d=a.content)===null||d===void 0?void 0:d.width)!==null&&e!==void 0?e:this._itemsWidth;this._itemOffsets=[];var f;var g=0;var h=0;for(var i=0;i<this.refs.content.children.length;i++){var j=this.refs.content.children[i];var k=a[i];var l=this._itemOffsets[i];var m=this._getItemAbsoluteOffset(j,k,l),n=m[0],o=m[1];if(f===undefined){f=n}var p=n-f;var q=n-g-h;this._itemOffsets.push({offset:p,width:o,margin:q});g=n;h=0}},_getItemAbsoluteOffset:function(a){var b;var c=[];for(var d=1;d<arguments.length;d++){c[d-1]=arguments[d]}c=c.filter(function(a){return!!a});if(!c.length){c.push(a.getBoundingClientRect())}var e=c[0];return e?[(b=e.left)!==null&&b!==void 0?b:e.offset,e.width]:[0,0]},checkScrollEnd:function(){var a=this.hasNextControl();if(this._lastHasNextControl&&!a&&!this._fitsInWidth()){this.broadcast("scroll-end")}this._lastHasNextControl=a},getVisibleItemsCount:function(){var a=this.get("_width");var b=0;this._itemOffsets.forEach(function(c){if(c.offset+c.width<a){b++}});return b},handleAllBlocksRendered:function(){var a=this.getVisibleItemsCount();this.broadcast("all-blocks-rendered",{visibleItemsCount:a})}});exports.default=g});define("feast-tpl!app/feast-tpl!ui-block/unsubscribe/unsubscribe.html",["feast"],function(a){return a.smartParse('<div>\n\t<b:dropdown\n\t\t\tid="unsubscribe-dropdown"\n\t\t\tradar-id="unsubscribe"\n\t\t\ttext="{attrs[\'dropdown-button-text\']}"\n\t\t\tico="status_block"\n\t\t\tbase\n\t\t\tpure\n\t\t\ttouch="{attrs.touch}"\n\t\t\tshort="{attrs.touch || attrs.withoutText}"\n\t\t\tremit:dropdown-change-state="expanded"\n\t\t\texpand-left="{attrs[\'position-right\']}"\n\t\t\tauto-close="{false}"\n\t\t\tponymode="{attrs.ponymode}"\n\t>\n\t\t<fn:match name="items" args="data">\n\t\t\t<fn:if test="data.attrs.expanded">\n\t\t\t\t<b:react-async\n\t\t\t\t\t\tcomponent="UnsubscribeDropdown"\n\t\t\t\t\t\tonButtonClick="{_this.onUnsubscribeButtonClick.bind(_this)}"\n\t\t\t\t\t\tonClose="{data.hide}"\n\t\t\t\t\t\tsenderName="{attrs.senderFrom}"\n\t\t\t\t\t\tlettersCount="{attrs[\'sender-letters\']}"\n\t\t\t\t\t\tinProgress="{attrs[\'in-progress\']}"\n\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</fn:match>\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/unsubscribe/unsubscribe.html")});define("feast-tpl!ui-block/unsubscribe/unsubscribe.html",["feast-tpl!app/feast-tpl!ui-block/unsubscribe/unsubscribe.html"],function(a){return a});define("helpers/unsubscribe-actions",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=exports.EUnsubscribeAction={UNSUBSCRIBE:"unsubscribe_action",UNSUBSCRIBE_READ:"unsubscribe_read_action",UNSUBSCRIBE_REMOVE:"unsubscribe_remove_action"}});define("ui-block/unsubscribe/unsubscribe",["exports","default-values","feast","feast-mod/correspondents","feast-tpl!./unsubscribe.html","helpers/radar-utils","helpers/unsubscribe-actions","RPC","service/radars/decorator","service/radars/index","ui-block/dropdown/dropdown","ui-block/react-async/react-async"],function(exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var l=s(b);var m=s(d);var n=s(g);var o=s(h);var p=s(i);var q=s(j);var r=s(k);function s(a){return a&&a.__esModule?a:{default:a}}exports.default=l.default.Block.extend((0,o.default)({events:[{name:"unsubscribe",data:e.getModelData}]})({name:"unsubscribe",template:m.default,isolateEvents:false,mods:{correspondent:c.correspondent},blocks:{dropdown:q.default,"react-async":r.default},defaults:{"sender-letters":0,"dropdown-button-text":i18n("Отписаться от рассылки"),"is-component-visible":false,"actions-finished":false,"in-progress":false},events:{expanded:"handleExpandEvent"},attrChanged:{"actions-finished":function a(b){if(b){this.ids["unsubscribe-dropdown"].hide();this.set("in-progress",false)}},model:function b(){var c=this;(0,p.default)({type:"unsubscribe_button_show",intervals:[["button_position",this._getPositionString()]]});if(this.is("short")){this.set("dropdown-button-text",i18n("Отписаться"))}if(!a.UNSUBSCRIBE_COUNT_ALL){return}n.default.call("messages/count/all",{from:[this.get("senderFrom")],only_newsletters:true}).then(function(a){var b=a.body.count;if(!b){return}if(!c.is("is-component-visible")){c.set("sender-letters",b);(0,p.default)("unsubscribe_count_all-success")}}).catch(function(a){return(0,p.default)("unsubscribe_count_all-error",a)})}},onUnsubscribeButtonClick:function a(b){var c=this.get("letterId");var d=this.get("senderFrom");var e=this.get("insteadSpamButton");this.set("in-progress",true);(0,p.default)({type:"unsubscribe_button_click",intervals:[["action_type",b],["button_position",this._getPositionString()]],dwh:{position:e?"portal-menu":"default",action_type:b}});this.broadcast("unsubscribe",{ids:Array.isArray(c)?c:[c],position:e?"portal-menu":"default"});switch(b){case f.EUnsubscribeAction.UNSUBSCRIBE:return;case f.EUnsubscribeAction.UNSUBSCRIBE_REMOVE:this.broadcast("moveallfrom",{from:d});break;case f.EUnsubscribeAction.UNSUBSCRIBE_READ:this.broadcast("markallfrom",{from:d});break}},handleExpandEvent:function a(b){if(!b.details){return}var c=b.details.state;if(c){(0,p.default)({type:"unsubscribe_open_click",intervals:[["button_position",this._getPositionString()]]})}this.set("is-component-visible",c)},_getPositionString:function a(){return this.is("position-right")?"right":"left"}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html",["feast"],function(a){return a.smartParse('<div\n  ref="layer-cleanmaster-modal"\n>\n</div>\n',"app/feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html")});define("feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html",["feast-tpl!app/feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal",["require","exports","@mail/features","@mail/xray","default-values","feast","feast-tpl!./layer-cleanmaster-modal.html","mediator/unsubscribe-actions","service/notify"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);var h=function(a){var b=a.text,d=a.qa;g.default.add({text:b,qa:d,duration:c.SETTINGS_DOCK_CLEANMASTER_NOTIFY_DURATION,inline:false})};var i=function(a){var b=a.text,d=a.qa;g.default.error({text:b,qa:d,duration:c.SETTINGS_DOCK_CLEANMASTER_NOTIFY_DURATION,inline:false})};var j={remove:"@modal/senders/remove",unsubscribe:"@modal/senders/unsubscribe"};exports.default=d.default.Block.extend({name:"layer-cleanmaster-modal",template:e.default,blocks:{},_modalPage:null,defaults:{compact:false,isAvailable:false},events:{},_isValidAction:function(a){return a in j},didMount:function(){var c=this;var d=this.refs["layer-cleanmaster-modal"];var e=this.get("ponymode");var g=this.get("action");var k=this.get("from");var l=this.onClose.bind(this);if(!this._isValidAction(g)){this.set("isAvailable",false);return}window.require(["cleanmaster"],function(m){c._modalPage=m.createCleanmasterModal(d,{features:a.default,septima:false,app:false,touch:false,octavius:true,headerMode:"hidden",isDockSettings:false,compact:e});var n={"@stat/radar":function(a){var c=a.name,d=a.params,e=a.dwh,f=e===void 0?{}:e;b.default.send(c,{i:d,v:1,dwh:__assign(__assign({},f),{query:true})})},"@clean/clean/success":function(a){var b=a.senders,c=b===void 0?[]:b;f.default.deleteSenderFromUnsubscribeList(c.map(function(a){var b=a.emails;return b}))},"@notify/success":h,"@notify/info":h,"@notify/error":i,"@redux-popup/popup/CLOSE_ALL":l};Object.keys(n).forEach(function(a){c._modalPage.on(a,n[a])});c._modalPage.create();c._modalPage.store.dispatch({type:j[g],payload:{sendersEmailList:k}})});this.set("isAvailable",true)},onClose:function(){var a;var b=this.get("isAvailable");if(!b){return}(a=this._modalPage)===null||a===void 0?void 0:a.destroy();this.set("isAvailable",false);this.broadcast("layer:close")}})});define("feast-tpl!app/feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:match name="spinner">\n\t\t<div bem:elem="spinner-container">\n\t\t\t<b:spinner/>\n\t\t</div>\n\t</fn:match>\n\n\t<b:layer name="edit-settings-filter"\n\t\t\t remit:close="layer:close"\n\t\t\t center\n\t\t\t hiddenfooter\n\t\t\t standard>\n\n\t\t<fn:match name="content">\n\t\t\t<div class="layer-edit-settings-filter_content" ref="content">\n\t\t\t\t<fn:apply-match name="spinner"/>\n\t\t\t</div>\n\t\t</fn:match>\n\t</b:layer>\n</div>\n',"app/feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html")});define("feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html",["feast-tpl!app/feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("filters/actions/Edit",["require","exports","RPC","Action","filters/Filter"],function(require,exports,a,b,c){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=b.default.extend({url:c.default.url("edit"),prepare:function(a){return this._removeEmptyParams(a)},_removeEmptyParams:function(a){a.filters.forEach(function(a){if(a.actions.notify&&!a.actions.notify.length){delete a.actions.notify}if(a.actions.replace_category===null){delete a.actions.replace_category}});return a},operation:function(b){var c={};b.filters.forEach(function(a,b){if(!a.id){c["filters."+b+".id"]="required"}});if(Object.keys(c).length){return Promise.reject(c)}return a.default.call(this.url,b).then(function(a){return d.processResult(b,a)})}});d.processResult=function(a,b){return c.default.map(a.filters.map(function(a,c){a.id=b.get("body."+c);a.apply_folders=b.get("data.apply_folders");if(!a.conditions){a.conditions=[]}return a}))};b.default.register("filters.Edit",d);d.version="0.1.0";exports.default=d;return d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-edit-settings-filter/layer-edit-settings-filter",["require","exports","data-source/index","default-values","feast","feast-tpl!./layer-edit-settings-filter.html","filters/actions/Edit","filters/actions/SaveSeveral","filters/Filter","helpers/define-utils","mail/Folder","service/getModule","service/notify","service/radars/decorator","service/radars/index","service/secure-folder","ui-block/layer/layer","ui-block/spinner/spinner"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);exports.default=c.default.Block.extend(l.default()({name:"layer-edit-settings-filter",template:d.default,blocks:{layer:o.default,spinner:p.default},events:{close:"onClose",cancel:"onCancel"},defaults:{filterModel:{},applyFolders:[],expandExtendOptions:false},onLoad:function(){},onClose:function(){this.broadcast("layer:close")},onCancel:function(){},didUnmount:function(){this.editor.unmount()},load:function(){var a=this;return new Promise(function(b){Promise.all([j.default("blitz")]).then(function(){h.defineExternalForSyncUse("filters/actions/Edit",e.default);h.defineExternalForSyncUse("filters/Filter",g.default);h.defineExternalForSyncUse("filters/actions/SaveSeveral",f.default);j.default("filters.mail.ru").then(function(c){a.ui=c;require(["mediator/themes-manager"],function(c){var d=c.default;d.register(a);b()})})})})},didMount:function(){var c=this;this.load().then(function(){if(!c.isMounted()){return}var d=c.refs.content;c.editor=new c.ui(d);c.editor.mount({model:c.get("filterModel"),templateValues:c.get("templateValues"),expandExtendOptions:c.get("expandExtendOptions"),useBlackTheme:c.is("dark-mode"),useOctaviusTheme:true,autoreplyLink:b.SETTINGS_AUTOREPLY_LINK,config:{radar:{p:b.RADAR_PROJECT},popup:true},onClose:function(){c.onClose()},onCancel:function(){c.onClose()},successSave:function(){c.onClose();setTimeout(function(){a.default.updateAll()},b.FILTER_SAVE_UPDATE_TIMEOUT);k.default.add({text:i18n("Фильтр успешно создан")})},successApply:function(){setTimeout(function(){a.default.updateAll()},b.FILTER_SAVE_UPDATE_TIMEOUT)},onSendRadar:m.default,onFolderNeedOpen:function(a){return i.default.findOne({id:a}).then(function(a){return n.default(a)}).then(function(a){return!a&&Promise.reject()})}})})}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-create-folder/layer-create-folder.html",["feast"],function(a){return a.smartParse("<div/>\n","app/feast-tpl!ui-block/layer-create-folder/layer-create-folder.html")});define("feast-tpl!ui-block/layer-create-folder/layer-create-folder.html",["feast-tpl!app/feast-tpl!ui-block/layer-create-folder/layer-create-folder.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-create-folder/layer-create-folder",["require","exports","@mail/features","data-source/index","feast","feast-tpl!./layer-create-folder.html","mail/Folder","service/getModule","service/mailbox/loader","service/secure-folder"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);function i(a){var b;return((b=a)===null||b===void 0?void 0:b.moveLetters)===true}exports.default=c.default.Block.extend({name:"layer-create-folder",template:d.default,defaults:{mode:"new",model:null,selectMode:false},registerInMediators:function(){var a=this;return new Promise(function(b){require(["mediator/letters-selection"],function(c){var d=c.default;d.register(a);b()})})},didMount:function(){var c=this;var d=this.attrs,j=d.model,k=d.mode;this.registerInMediators().then(function(){if(!c.isMounted()){return}var d=false;var l=null;if(i(j)){d=j.moveLetters;l=j.letterCurrentFolder}var m=k==="edit"||d?null:j;var n=c.get("selectMode");var o=d?function(a){g.default.invalidateCache();c.broadcast("move",{id:a.id,selection:n})}:function(){g.default.invalidateCache();b.default.updateAll()};Promise.all([f.default("react"),f.default("blitz")]).then(function(b){var f=b[0],g=b[1],i=g.CreateFolder,n=g.LayerManager;if(!c.isMounted()){return}var p=c.layerManager||new n;p.setup(c.el,{popup:false,radarPrefix:"folders-lr"});var q={mode:k,folder:k==="edit"?j:new e.default({name:""}),parentFolder:m,folders:e.default.all,FEATURES:a.default,onClose:c.onClose.bind(c),handleFinal:o,isMoveLetters:d,letterCurrentFolder:l,openSecureFolder:h.default,layerManager:p};var r=p.openLayer(f.createElement(i,q),{noPanelWrap:true,responsive:"auto"}).id;c.layerManager=p;c.id=r})})},onClose:function(){this.broadcast("layer:close");if(this.layerManager){this.layerManager.destroyLayer(this.id)}}})});define("feast-tpl!app/feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-confirm-delete-folder">\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\n\t<bem:mod name="touch" test="attrs.mobile"/>\n\t<bem:mod name="full" test="!attrs.mobile"/>\n\t<bem:mod name="hidden" test="attrs.hidden"/>\n\n\t<b:layer\n\t\t\tremit:close="layer:close"\n\t\t\tmodel="{attrs.model}"\n\t\t\terror="{attrs.error}"\n\t\t\tmobile="{attrs.mobile}"\n\t\t\tprocessing="{attrs.processing}"\n\t\t\tname="confirm-clear-folder"\n\t\t\tclose\n\t\t\theader\n\t\t\tfooter\n\t\t\tcenter\n\t\t\tstandard\n\t\t\tresolvable\n\t>\n\n\t\t<fn:match name="header" args="attrs">\n\t\t\t{messages.confirm}\n\t\t</fn:match>\n\n\t\t<fn:match name="content" args="attrs">\n\t\t\t<fn:if test="attrs.error">\n\t\t\t\t<div bem:elem="error" qa:id="{attrs.error}">\n\t\t\t\t\t{messages[attrs.error]}\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t\t{i18n(\'Все письма будут перенесены в папку «Корзина».\')}\n\t\t</fn:match>\n\n\t\t<fn:match name="footer" args="attrs">\n\t\t\t<div bem:elem="submit-button">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tremit:click="layer:resolve"\n\t\t\t\t\t\tdisabled="{attrs.processing}"\n\t\t\t\t\t\ttext="{i18n(\'Удалить\')}"\n\t\t\t\t\t\tprimary\n\t\t\t\t\t\tfluid\n\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\tqa:id="submit"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="cancel-button">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tremit:click="layer:close"\n\t\t\t\t\t\tdisabled="{attrs.processing}"\n\t\t\t\t\t\ttext="{i18n(\'Отменить\')}"\n\t\t\t\t\t\tfluid\n\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t</b:layer>\n</div>\n',"app/feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html")});define("feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html",["feast-tpl!app/feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder",["require","exports","feast","feast-tpl!./layer-confirm-delete-folder.html","ui-block/button2/button2","ui-block/layer/layer"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend({name:"layer-confirm-delete-folder",template:b.default,blocks:{layer:d.default,button2:c.default},events:{"layer:resolve":"onConfirm"},defaults:{processing:false,error:null},getMessages:function(){return{confirm:i18n("Удалить папку «{folderName}»?",{folderName:this.attrs.model.get("name")}),isCollectorRoot:i18n("Нельзя удалить папку, так как в неё собирается почта из другого ящика"),systemFolder:i18n("Невозможно удалить системную папку"),folderNotExists:i18n("Папка больше не существует"),invalidFolder:i18n("Невозможно удалить папку"),unknownError:i18n("Произошла неизвестная ошибка")}},onConfirm:function(){if(this.is("processing")||this.is("error")){return}this.set("processing",true)}})});define("feast-tpl!app/feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-metathreads-settings" promo:id="layer-metathreads-settings">\n\t<b:react-async\n\t\tkey="{attrs.metathreadsData.length}"\n\t\tcomponent="MetathreadsSettingsContainer"\n\t\tlayer\n\t\tdarkMode="{attrs[\'dark-mode\']}"\n\t\tmetathreadsData="{attrs.metathreadsData}"\n\t\tonHelpClick="{_this.onHelpClick}"\n\t\tonSettingsEdit="{_this.onSettingsEdit}"\n\t\tonClose="{_this.onClose}"\n\t\tuse:mediator="settings-manager themes-manager folders-actions"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html")});define("feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html",["feast-tpl!app/feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-metathreads-settings/layer-metathreads-settings",["require","exports","data-source/actions","feast","feast-tpl!./layer-metathreads-settings.html","helpers/data-source-dispatch","service/radars/decorator","ui-block/layer/layer","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend(e.default({events:[{name:"help:open",rename:"help_open"}]})({name:"layer-metathreads-settings",template:c.default,defaults:{helpLink:"metathreads",metathreadsData:[]},blocks:{layer:f.default,"react-async":g.default},constructor:function(){b.default.Block.apply(this,arguments);this.onClose=this.onClose.bind(this);this.onSettingsEdit=this.onSettingsEdit.bind(this);this.onHelpClick=this.onHelpClick.bind(this)},onClose:function(){this.broadcast("layer:close")},onSettingsEdit:function(b){var c=this;return d.default({type:a.EDIT_METATHREADS_SETTINGS,settings:b}).then(function(a){c.broadcast("metathreads:settings:updated");return a})},onHelpClick:function(){this.broadcast("help:open",this.attrs.helpLink)}}))});!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define("@mail/e.mail.ru.feedback",[],b):"object"==typeof exports?exports.mailEMailRuFeedback=b():a.mailEMailRuFeedback=b()}(self,function(){return function(){var a={1581:function(a){"undefined"!=typeof self&&self,a.exports=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=0)}([function(a,b,c){a.exports=c(1)},function(a,b,c){"use strict";function d(a){return e(a)[0]||"application/octet-stream"}function e(a){return a=(a+"").toLowerCase(),b.extensions[a]||[]}function f(a){return a=(a+"").toLowerCase(),b.mimeTypes[a]||[]}function g(a){return f(a)[0]}function h(a,c){if(!c||!a)return!1;c=c&&c.toLowerCase&&c.toLowerCase();var d=k.cleanMimeType(c),e=c;if(a.includes(d)||a.includes(e))return!0;var f=i.default;if(f[d])return f[d].some(function(b){return a.includes(b)});var g=b.extensions[e];return!!g&&g.some(function(b){return a.includes(b)})}Object.defineProperty(b,"__esModule",{value:!0});var i=c(2),j=c(3),k=c(4),l=c(5);b.extensions=j.default(i.default),b.simpleExtensions=l.default(i.default),b.mimeTypes=i.default,b.getContentType=d,b.getContentTypes=e,b.getExtensions=f,b.getExtensionFromType=g,b.isIn=h},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma","es"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml","mml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/mrb-consumer+xml":["xdf"],"application/mrb-publish+xml":["xdf"],"application/msword":["doc","dot","wiz"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer","a","class","lha","lzh","o","obj","gem"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx","ogg"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/prs.cww":["cww"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/ttml+xml":["ttml"],"application/urc-ressheet+xml":["rsheet"],"application/vnd.1000minds.decision-model+xml":["1km"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["xfdf"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.keynote":["keynote"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.apple.numbers":["numbers"],"application/vnd.apple.pages":["pages"],"application/vnd.apple.pkpass":["pkpass"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.balsamiq.bmml+xml":["bmml"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.citationstyles.style+xml":["csl"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-apps.document":["gdoc"],"application/vnd.google-apps.presentation":["gslides"],"application/vnd.google-apps.spreadsheet":["gsheet"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.hydrostatix.sof-data":["sfd-hdstx"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw","xlb"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-outlook":["msg"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot","ppa","ppsx","pptx","pwz"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["mpp","mpt"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.ac+xml":["ac"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.n-gage.symbian.install":["n-gage"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm","otm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openblox.game+xml":["obgx"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openstreetmap.data+xml":["osm"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.software602.filler.form+xml":["fo"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.wadl+xml":["wadl"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.syncml.dmddf+xml":["ddf"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":["dmg"],"application/x-arj":["arj"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bdoc":["bdoc"],"application/x-bittorrent":["torrent"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-chrome-extension":["crx"],"application/x-cocoa":["cco"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["deb","udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-httpd-php":["php"],"application/x-install-instructions":["install"],"application/x-iso9660-image":["iso"],"application/x-java-archive-diff":["jardiff"],"application/x-java-jnlp-file":["jnlp"],"application/x-keepass2":["kdbx"],"application/x-latex":["latex"],"application/x-lua-bytecode":["luac"],"application/x-lzh-compressed":["lzh","lha"],"application/x-makeself":["run"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdos-program":["exe"],"application/x-msdownload":["exe","dll","com","bat","msi"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["wmf","wmz","emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-ns-proxy-autoconfig":["pac"],"application/x-nzb":["nzb"],"application/x-perl":["pl","pm"],"application/x-pilot":["prc","pdb"],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["rar"],"application/x-redhat-package-manager":["rpm"],"application/x-research-info-systems":["ris"],"application/x-sea":["sea"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl","tk"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["obj"],"application/x-ustar":["ustar"],"application/x-virtualbox-hdd":["hdd"],"application/x-virtualbox-ova":["ova"],"application/x-virtualbox-ovf":["ovf"],"application/x-virtualbox-vbox":["vbox"],"application/x-virtualbox-vbox-extpack":["vbox-extpack"],"application/x-virtualbox-vdi":["vdi"],"application/x-virtualbox-vhd":["vhd"],"application/x-virtualbox-vmdk":["vmdk"],"application/x-wais-source":["src"],"application/x-web-app-manifest+json":["webapp"],"application/x-x509-ca-cert":["der","crt","pem"],"application/x-xfig":["fig"],"application/x-xliff+xml":["xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-error+xml":["xer"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng","xpdl"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["3gpp"],"audio/adpcm":["adp"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/wav":["wav"],"audio/wave":["wav"],"audio/webm":["weba"],"audio/x-aac":["aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-m4a":["m4a"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-realaudio":["ra"],"audio/x-wav":["wav"],"audio/xm":["xm"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/png":["png"],"image/prs.btif":["btif"],"image/prs.pti":["pti"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.airzip.accelerator.azv":["azv"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dvb.subtitle":["sub"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.microsoft.icon":["ico"],"image/vnd.ms-dds":["dds"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.tencent.tap":["tap"],"image/vnd.valve.source.texture":["vtf"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/vnd.zbrush.pcx":["pcx"],"image/webp":["webp"],"image/wmf":["wmf"],"image/x-3ds":["3ds"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["ico"],"image/x-jng":["jng"],"image/x-mrsid-image":["sid"],"image/x-ms-bmp":["bmp"],"image/x-pcx":["pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml","nws"],"message/vnd.wfa.wsc":["wsc"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/stl":["stl"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["mts"],"model/vnd.opengex":["ogex"],"model/vnd.parasolid.transmit.binary":["x_b"],"model/vnd.parasolid.transmit.text":["x_t"],"model/vnd.usdz+zip":["usdz"],"model/vnd.valve.source.compiled-map":["bsp"],"model/vnd.vtu":["vtu"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini","diff","ksh","pl"],"text/prs.lines.tag":["dsc"],"text/richtext":["rtx"],"text/rtf":["rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms","mdoc"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/vtt":["vtt"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-component":["htc"],"text/x-fortran":["f","for","f77","f90"],"text/x-handlebars-template":["hbs"],"text/x-java-source":["java"],"text/x-lua":["lua"],"text/x-markdown":["mkd"],"text/x-nfo":["nfo"],"text/x-opml":["opml"],"text/x-org":["org"],"text/x-pascal":["p","pas"],"text/x-processing":["pde"],"text/x-sass":["sass"],"text/x-scss":["scss"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-suse-ymp":["ymp"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"text/xml":["xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/jpeg":["jpgv"],"video/jpm":["jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4","m4v"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v","mpa"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/webm":["webm"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"],"text/x-diff":["diff"],"application/x-gzip":["gz","tgz"],"application/x-killustrator":["kil"],"audio/x-mpeg":["mp3"],"application/x-font-otf":["otf"],"text/x-script.perl":["pl"],"text/x-python":["py"],"text/x-script.python":["py"],"application/x-python-code":["pyc","pyo"],"application/x-rpm":["rpm"],"text/vnd.wap.si":["si"],"application/vnd.wap.sic":["sic"],"text/vnd.wap.sl":["sl"],"application/vnd.wap.slc":["slc"],"application/vnd.arastra.swi":["swi"],"application/x-font-ttf":["ttc","ttf"],"application/vnd.hzn-3d-crossword":["x3d"],"image/x-targa":["tga"],"application/x-rar":["rar"],"application/x-zip":["zip"],"application/x-zip-compressed":["zip"],"application/x-compress":["zip"],"application/x-compressed":["zip"],"text/x-script.ruby":["gemspec","rake","rb","ru"],"text/x-script.perl-module":["pm"],"application/x-bzip-compressed-tar":["tbz"]}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(a){var b={};for(var c in a)!function(c){a[c].forEach(function(a){b[a]||(b[a]=[]),b[a].includes(c)||b[a].push(c)})}(c);return b}},function(a,b,c){"use strict";function d(a){return a.split(";")[0]}Object.defineProperty(b,"__esModule",{value:!0}),b.cleanMimeType=d},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(a){var b={};for(var c in a){var d=a[c];d[0]&&!b[d[0]]&&(b[d[0]]=c)}return b}}])},9562:function(a,b,c){"use strict";function d(a){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},d(a)}function e(a){return a&&"object"===d(a)&&"default"in a?a.default:a}var f=e(c(293)),g=e(c(1581));"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==c.g?c.g:"undefined"!=typeof self&&self;function h(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function i(a,b){return a(b={exports:{}},b.exports),b.exports}var j=i(function(a,b){var c;c=function(){return function(a){var b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=a,c.c=b,c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:d})},c.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c.t=function(a,b){if(1&b&&(a=c(a)),8&b)return a;if(4&b&&"object"===d(a)&&a&&a.__esModule)return a;var e=Object.create(null);if(c.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:a}),2&b&&"string"!=typeof a)for(var f in a)c.d(e,f,function(b){return a[b]}.bind(null,f));return e},c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="",c(c.s="./index.js")}({"./index.js":function(a,b,c){a.exports=c("./lib/axios.js")},"./lib/adapters/xhr.js":function(a,b,c){var d=c("./lib/utils.js"),e=c("./lib/core/settle.js"),f=c("./lib/helpers/cookies.js"),g=c("./lib/helpers/buildURL.js"),h=c("./lib/core/buildFullPath.js"),i=c("./lib/helpers/parseHeaders.js"),j=c("./lib/helpers/isURLSameOrigin.js"),k=c("./lib/core/createError.js"),l=c("./lib/defaults.js"),m=c("./lib/cancel/Cancel.js");a.exports=function(a){return new Promise(function(b,c){var n,o=a.data,p=a.headers,q=a.responseType;function r(){a.cancelToken&&a.cancelToken.unsubscribe(n),a.signal&&a.signal.removeEventListener("abort",n)}d.isFormData(o)&&delete p["Content-Type"];var s=new XMLHttpRequest;if(a.auth){var t=a.auth.username||"",u=a.auth.password?unescape(encodeURIComponent(a.auth.password)):"";p.Authorization="Basic "+btoa(t+":"+u)}var v=h(a.baseURL,a.url);function w(){if(s){var d="getAllResponseHeaders"in s?i(s.getAllResponseHeaders()):null,f={data:q&&"text"!==q&&"json"!==q?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:d,config:a,request:s};e(function(a){b(a),r()},function(a){c(a),r()},f),s=null}}if(s.open(a.method.toUpperCase(),g(v,a.params,a.paramsSerializer),!0),s.timeout=a.timeout,"onloadend"in s?s.onloadend=w:s.onreadystatechange=function(){s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))&&setTimeout(w)},s.onabort=function(){s&&(c(k("Request aborted",a,"ECONNABORTED",s)),s=null)},s.onerror=function(){c(k("Network Error",a,null,s)),s=null},s.ontimeout=function(){var b=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded",d=a.transitional||l.transitional;a.timeoutErrorMessage&&(b=a.timeoutErrorMessage),c(k(b,a,d.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",s)),s=null},d.isStandardBrowserEnv()){var x=(a.withCredentials||j(v))&&a.xsrfCookieName?f.read(a.xsrfCookieName):void 0;x&&(p[a.xsrfHeaderName]=x)}"setRequestHeader"in s&&d.forEach(p,function(a,b){void 0===o&&"content-type"===b.toLowerCase()?delete p[b]:s.setRequestHeader(b,a)}),d.isUndefined(a.withCredentials)||(s.withCredentials=!!a.withCredentials),q&&"json"!==q&&(s.responseType=a.responseType),"function"==typeof a.onDownloadProgress&&s.addEventListener("progress",a.onDownloadProgress),"function"==typeof a.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",a.onUploadProgress),(a.cancelToken||a.signal)&&(n=function(a){s&&(c(!a||a&&a.type?new m("canceled"):a),s.abort(),s=null)},a.cancelToken&&a.cancelToken.subscribe(n),a.signal&&(a.signal.aborted?n():a.signal.addEventListener("abort",n))),o||(o=null),s.send(o)})}},"./lib/axios.js":function(a,b,c){var d=c("./lib/utils.js"),e=c("./lib/helpers/bind.js"),f=c("./lib/core/Axios.js"),g=c("./lib/core/mergeConfig.js"),h=function a(b){var c=new f(b),h=e(f.prototype.request,c);return d.extend(h,f.prototype,c),d.extend(h,c),h.create=function(c){return a(g(b,c))},h}(c("./lib/defaults.js"));h.Axios=f,h.Cancel=c("./lib/cancel/Cancel.js"),h.CancelToken=c("./lib/cancel/CancelToken.js"),h.isCancel=c("./lib/cancel/isCancel.js"),h.VERSION=c("./lib/env/data.js").version,h.all=function(a){return Promise.all(a)},h.spread=c("./lib/helpers/spread.js"),h.isAxiosError=c("./lib/helpers/isAxiosError.js"),a.exports=h,a.exports.default=h},"./lib/cancel/Cancel.js":function(a,b,c){function d(a){this.message=a}d.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},d.prototype.__CANCEL__=!0,a.exports=d},"./lib/cancel/CancelToken.js":function(a,b,c){var d=c("./lib/cancel/Cancel.js");function e(a){if("function"!=typeof a)throw new TypeError("executor must be a function.");var b;this.promise=new Promise(function(a){b=a});var c=this;this.promise.then(function(a){if(c._listeners){var b,d=c._listeners.length;for(b=0;b<d;b++)c._listeners[b](a);c._listeners=null}}),this.promise.then=function(a){var b,d=new Promise(function(a){c.subscribe(a),b=a}).then(a);return d.cancel=function(){c.unsubscribe(b)},d},a(function(a){c.reason||(c.reason=new d(a),b(c.reason))})}e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(a){this.reason?a(this.reason):this._listeners?this._listeners.push(a):this._listeners=[a]},e.prototype.unsubscribe=function(a){if(this._listeners){var b=this._listeners.indexOf(a);-1!==b&&this._listeners.splice(b,1)}},e.source=function(){var a;return{token:new e(function(b){a=b}),cancel:a}},a.exports=e},"./lib/cancel/isCancel.js":function(a,b,c){a.exports=function(a){return!(!a||!a.__CANCEL__)}},"./lib/core/Axios.js":function(a,b,c){var d=c("./lib/utils.js"),e=c("./lib/helpers/buildURL.js"),f=c("./lib/core/InterceptorManager.js"),g=c("./lib/core/dispatchRequest.js"),h=c("./lib/core/mergeConfig.js"),i=c("./lib/helpers/validator.js"),j=i.validators;function k(a){this.defaults=a,this.interceptors={request:new f,response:new f}}k.prototype.request=function(a){"string"==typeof a?(a=arguments[1]||{}).url=arguments[0]:a=a||{},(a=h(this.defaults,a)).method?a.method=a.method.toLowerCase():this.defaults.method?a.method=this.defaults.method.toLowerCase():a.method="get";var b=a.transitional;void 0!==b&&i.assertOptions(b,{silentJSONParsing:j.transitional(j.boolean),forcedJSONParsing:j.transitional(j.boolean),clarifyTimeoutError:j.transitional(j.boolean)},!1);var c=[],d=!0;this.interceptors.request.forEach(function(b){"function"==typeof b.runWhen&&!1===b.runWhen(a)||(d=d&&b.synchronous,c.unshift(b.fulfilled,b.rejected))});var e,f=[];if(this.interceptors.response.forEach(function(a){f.push(a.fulfilled,a.rejected)}),!d){var k=[g,void 0];for(Array.prototype.unshift.apply(k,c),k=k.concat(f),e=Promise.resolve(a);k.length;)e=e.then(k.shift(),k.shift());return e}for(var l=a;c.length;){var m=c.shift(),n=c.shift();try{l=m(l)}catch(a){n(a);break}}try{e=g(l)}catch(a){return Promise.reject(a)}for(;f.length;)e=e.then(f.shift(),f.shift());return e},k.prototype.getUri=function(a){return a=h(this.defaults,a),e(a.url,a.params,a.paramsSerializer).replace(/^\?/,"")},d.forEach(["delete","get","head","options"],function(a){k.prototype[a]=function(b,c){return this.request(h(c||{},{method:a,url:b,data:(c||{}).data}))}}),d.forEach(["post","put","patch"],function(a){k.prototype[a]=function(b,c,d){return this.request(h(d||{},{method:a,url:b,data:c}))}}),a.exports=k},"./lib/core/InterceptorManager.js":function(a,b,c){var d=c("./lib/utils.js");function e(){this.handlers=[]}e.prototype.use=function(a,b,c){return this.handlers.push({fulfilled:a,rejected:b,synchronous:!!c&&c.synchronous,runWhen:c?c.runWhen:null}),this.handlers.length-1},e.prototype.eject=function(a){this.handlers[a]&&(this.handlers[a]=null)},e.prototype.forEach=function(a){d.forEach(this.handlers,function(b){null!==b&&a(b)})},a.exports=e},"./lib/core/buildFullPath.js":function(a,b,c){var d=c("./lib/helpers/isAbsoluteURL.js"),e=c("./lib/helpers/combineURLs.js");a.exports=function(a,b){return a&&!d(b)?e(a,b):b}},"./lib/core/createError.js":function(a,b,c){var d=c("./lib/core/enhanceError.js");a.exports=function(a,b,c,e,f){var g=new Error(a);return d(g,b,c,e,f)}},"./lib/core/dispatchRequest.js":function(a,b,c){var d=c("./lib/utils.js"),e=c("./lib/core/transformData.js"),f=c("./lib/cancel/isCancel.js"),g=c("./lib/defaults.js"),h=c("./lib/cancel/Cancel.js");function i(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new h("canceled")}a.exports=function(a){return i(a),a.headers=a.headers||{},a.data=e.call(a,a.data,a.headers,a.transformRequest),a.headers=d.merge(a.headers.common||{},a.headers[a.method]||{},a.headers),d.forEach(["delete","get","head","post","put","patch","common"],function(b){delete a.headers[b]}),(a.adapter||g.adapter)(a).then(function(b){return i(a),b.data=e.call(a,b.data,b.headers,a.transformResponse),b},function(b){return f(b)||(i(a),b&&b.response&&(b.response.data=e.call(a,b.response.data,b.response.headers,a.transformResponse))),Promise.reject(b)})}},"./lib/core/enhanceError.js":function(a,b,c){a.exports=function(a,b,c,d,e){return a.config=b,c&&(a.code=c),a.request=d,a.response=e,a.isAxiosError=!0,a.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},a}},"./lib/core/mergeConfig.js":function(a,b,c){var d=c("./lib/utils.js");a.exports=function(a,b){b=b||{};var c={};function e(a,b){return d.isPlainObject(a)&&d.isPlainObject(b)?d.merge(a,b):d.isPlainObject(b)?d.merge({},b):d.isArray(b)?b.slice():b}function f(c){return d.isUndefined(b[c])?d.isUndefined(a[c])?void 0:e(void 0,a[c]):e(a[c],b[c])}function g(a){if(!d.isUndefined(b[a]))return e(void 0,b[a])}function h(c){return d.isUndefined(b[c])?d.isUndefined(a[c])?void 0:e(void 0,a[c]):e(void 0,b[c])}function i(c){return c in b?e(a[c],b[c]):c in a?e(void 0,a[c]):void 0}var j={url:g,method:g,data:g,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:i};return d.forEach(Object.keys(a).concat(Object.keys(b)),function(a){var b=j[a]||f,e=b(a);d.isUndefined(e)&&b!==i||(c[a]=e)}),c}},"./lib/core/settle.js":function(a,b,c){var d=c("./lib/core/createError.js");a.exports=function(a,b,c){var e=c.config.validateStatus;c.status&&e&&!e(c.status)?b(d("Request failed with status code "+c.status,c.config,null,c.request,c)):a(c)}},"./lib/core/transformData.js":function(a,b,c){var d=c("./lib/utils.js"),e=c("./lib/defaults.js");a.exports=function(a,b,c){var f=this||e;return d.forEach(c,function(c){a=c.call(f,a,b)}),a}},"./lib/defaults.js":function(a,b,c){var d=c("./lib/utils.js"),e=c("./lib/helpers/normalizeHeaderName.js"),f=c("./lib/core/enhanceError.js"),g={"Content-Type":"application/x-www-form-urlencoded"};function h(a,b){!d.isUndefined(a)&&d.isUndefined(a["Content-Type"])&&(a["Content-Type"]=b)}var i,j={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(i=c("./lib/adapters/xhr.js")),i),transformRequest:[function(a,b){return e(b,"Accept"),e(b,"Content-Type"),d.isFormData(a)||d.isArrayBuffer(a)||d.isBuffer(a)||d.isStream(a)||d.isFile(a)||d.isBlob(a)?a:d.isArrayBufferView(a)?a.buffer:d.isURLSearchParams(a)?(h(b,"application/x-www-form-urlencoded;charset=utf-8"),a.toString()):d.isObject(a)||b&&"application/json"===b["Content-Type"]?(h(b,"application/json"),function(a,b,c){if(d.isString(a))try{return(b||JSON.parse)(a),d.trim(a)}catch(a){if("SyntaxError"!==a.name)throw a}return(c||JSON.stringify)(a)}(a)):a}],transformResponse:[function(a){var b=this.transitional||j.transitional,c=b&&b.silentJSONParsing,e=b&&b.forcedJSONParsing,g=!c&&"json"===this.responseType;if(g||e&&d.isString(a)&&a.length)try{return JSON.parse(a)}catch(a){if(g){if("SyntaxError"===a.name)throw f(a,this,"E_JSON_PARSE");throw a}}return a}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(a){return a>=200&&a<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};d.forEach(["delete","get","head"],function(a){j.headers[a]={}}),d.forEach(["post","put","patch"],function(a){j.headers[a]=d.merge(g)}),a.exports=j},"./lib/env/data.js":function(a,b){a.exports={version:"0.24.0"}},"./lib/helpers/bind.js":function(a,b,c){a.exports=function(a,b){return function(){for(var c=new Array(arguments.length),d=0;d<c.length;d++)c[d]=arguments[d];return a.apply(b,c)}}},"./lib/helpers/buildURL.js":function(a,b,c){var d=c("./lib/utils.js");function e(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}a.exports=function(a,b,c){if(!b)return a;var f;if(c)f=c(b);else if(d.isURLSearchParams(b))f=b.toString();else{var g=[];d.forEach(b,function(a,b){null!=a&&(d.isArray(a)?b+="[]":a=[a],d.forEach(a,function(a){d.isDate(a)?a=a.toISOString():d.isObject(a)&&(a=JSON.stringify(a)),g.push(e(b)+"="+e(a))}))}),f=g.join("&")}if(f){var h=a.indexOf("#");-1!==h&&(a=a.slice(0,h)),a+=(-1===a.indexOf("?")?"?":"&")+f}return a}},"./lib/helpers/combineURLs.js":function(a,b,c){a.exports=function(a,b){return b?a.replace(/\/+$/,"")+"/"+b.replace(/^\/+/,""):a}},"./lib/helpers/cookies.js":function(a,b,c){var d=c("./lib/utils.js");a.exports=d.isStandardBrowserEnv()?{write:function(a,b,c,e,f,g){var h=[];h.push(a+"="+encodeURIComponent(b)),d.isNumber(c)&&h.push("expires="+new Date(c).toGMTString()),d.isString(e)&&h.push("path="+e),d.isString(f)&&h.push("domain="+f),!0===g&&h.push("secure"),document.cookie=h.join("; ")},read:function(a){var b=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return b?decodeURIComponent(b[3]):null},remove:function(a){this.write(a,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},"./lib/helpers/isAbsoluteURL.js":function(a,b,c){a.exports=function(a){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(a)}},"./lib/helpers/isAxiosError.js":function(a,b,c){a.exports=function(a){return"object"===d(a)&&!0===a.isAxiosError}},"./lib/helpers/isURLSameOrigin.js":function(a,b,c){var d=c("./lib/utils.js");a.exports=d.isStandardBrowserEnv()?function(){var a,b=/(msie|trident)/i.test(navigator.userAgent),c=document.createElement("a");function e(a){var d=a;return b&&(c.setAttribute("href",d),d=c.href),c.setAttribute("href",d),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:"/"===c.pathname.charAt(0)?c.pathname:"/"+c.pathname}}return a=e(window.location.href),function(b){var c=d.isString(b)?e(b):b;return c.protocol===a.protocol&&c.host===a.host}}():function(){return!0}},"./lib/helpers/normalizeHeaderName.js":function(a,b,c){var d=c("./lib/utils.js");a.exports=function(a,b){d.forEach(a,function(c,d){d!==b&&d.toUpperCase()===b.toUpperCase()&&(a[b]=c,delete a[d])})}},"./lib/helpers/parseHeaders.js":function(a,b,c){var d=c("./lib/utils.js"),e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];a.exports=function(a){var b,c,f,g={};return a?(d.forEach(a.split("\n"),function(a){if(f=a.indexOf(":"),b=d.trim(a.substr(0,f)).toLowerCase(),c=d.trim(a.substr(f+1)),b){if(g[b]&&e.indexOf(b)>=0)return;g[b]="set-cookie"===b?(g[b]?g[b]:[]).concat([c]):g[b]?g[b]+", "+c:c}}),g):g}},"./lib/helpers/spread.js":function(a,b,c){a.exports=function(a){return function(b){return a.apply(null,b)}}},"./lib/helpers/validator.js":function(a,b,c){var e=c("./lib/env/data.js").version,f={};["object","boolean","number","function","string","symbol"].forEach(function(a,b){f[a]=function(c){return d(c)===a||"a"+(b<1?"n ":" ")+a}});var g={};f.transitional=function(a,b,c){function d(a,b){return"[Axios v"+e+"] Transitional option '"+a+"'"+b+(c?". "+c:"")}return function(c,e,f){if(!1===a)throw new Error(d(e," has been removed"+(b?" in "+b:"")));return b&&!g[e]&&(g[e]=!0,console.warn(d(e," has been deprecated since v"+b+" and will be removed in the near future"))),!a||a(c,e,f)}},a.exports={assertOptions:function(a,b,c){if("object"!==d(a))throw new TypeError("options must be an object");for(var e=Object.keys(a),f=e.length;f-- >0;){var g=e[f],h=b[g];if(h){var i=a[g],j=void 0===i||h(i,g,a);if(!0!==j)throw new TypeError("option "+g+" must be "+j)}else if(!0!==c)throw Error("Unknown option "+g)}},validators:f}},"./lib/utils.js":function(a,b,c){var e=c("./lib/helpers/bind.js"),f=Object.prototype.toString;function g(a){return"[object Array]"===f.call(a)}function h(a){return void 0===a}function i(a){return null!==a&&"object"===d(a)}function j(a){if("[object Object]"!==f.call(a))return!1;var b=Object.getPrototypeOf(a);return null===b||b===Object.prototype}function k(a){return"[object Function]"===f.call(a)}function l(a,b){if(null!=a)if("object"!==d(a)&&(a=[a]),g(a))for(var c=0,e=a.length;c<e;c++)b.call(null,a[c],c,a);else for(var f in a)Object.prototype.hasOwnProperty.call(a,f)&&b.call(null,a[f],f,a)}a.exports={isArray:g,isArrayBuffer:function(a){return"[object ArrayBuffer]"===f.call(a)},isBuffer:function(a){return null!==a&&!h(a)&&null!==a.constructor&&!h(a.constructor)&&"function"==typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)},isFormData:function(a){return"undefined"!=typeof FormData&&a instanceof FormData},isArrayBufferView:function(a){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(a):a&&a.buffer&&a.buffer instanceof ArrayBuffer},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isObject:i,isPlainObject:j,isUndefined:h,isDate:function(a){return"[object Date]"===f.call(a)},isFile:function(a){return"[object File]"===f.call(a)},isBlob:function(a){return"[object Blob]"===f.call(a)},isFunction:k,isStream:function(a){return i(a)&&k(a.pipe)},isURLSearchParams:function(a){return"undefined"!=typeof URLSearchParams&&a instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:l,merge:function a(){var b={};function c(c,d){j(b[d])&&j(c)?b[d]=a(b[d],c):j(c)?b[d]=a({},c):g(c)?b[d]=c.slice():b[d]=c}for(var d=0,e=arguments.length;d<e;d++)l(arguments[d],c);return b},extend:function(a,b,c){return l(b,function(b,d){a[d]=c&&"function"==typeof b?e(b,c):b}),a},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},stripBOM:function(a){return 65279===a.charCodeAt(0)&&(a=a.slice(1)),a}}}})},a.exports=c()}),k=h(j),l=Math.floor,m=Math.random;function n(){return l(65536*m()).toString(16)}function o(a){var b=n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n();return a&&(b=b.replace(/^(.*)([a-z])/i,"$2$1")||"a"),b}var p={},q=p.hasOwnProperty,r=q.toString,s=r.call(Object),t=Object.getPrototypeOf,u=p.toString,v=/%20/g,w=/\[\]$/,x=window.setTimeout,y=window.setImmediate||x;function z(a,b,c,e){var f;if(A.isArray(b))b.forEach(function(b,f){c||w.test(a)?e(a,f):z(a+"["+("object"===d(f)?b:"")+"]",f,c,e)});else if(c||"object"!==A.isObject(b))e(a,b);else for(f in b)z(a+"["+f+"]",b[f],c,e)}var A={extend:function(){var a,b,c,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[i]||{},i++),"object"===d(h)||A.isFunction(h)||(h={}),i===j&&(h=this,i--);i<j;i++)if(null!=(a=arguments[i]))for(b in a)c=h[b],h!==(e=a[b])&&(k&&e&&(A.isPlainObject(e)||(f=Array.isArray(e)))?(f?(f=!1,g=c&&Array.isArray(c)?c:[]):g=c&&A.isPlainObject(c)?c:{},h[b]=A.extend(k,g,e)):void 0!==e&&(h[b]=e));return h},serializeArray:function(a){var b=[];return Array.prototype.slice.call(a.elements).forEach(function(a){!a.name||a.disabled||["file","reset","submit","button"].indexOf(a.type)>-1||("select-multiple"!==a.type?["checkbox","radio"].indexOf(a.type)>-1&&!a.checked||b.push({name:a.name,value:a.value}):Array.prototype.slice.call(a.options).forEach(function(c){c.selected&&b.push({name:a.name,value:c.value})}))}),b},param:function(a,b){var c,d=[],e=function(a,b){void 0!==b&&(b=A.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b))};for(c in a)z(c,a[c],b,e);return d.join("&").replace(v,"+")},cloneJSON:function(a){return"object"===d(a)?JSON.parse(JSON.stringify(a)):a},cloneObject:function(a){var b,c={};if(a&&a instanceof Object)for(b in a)c[b]=a[b];return c},toCamelCase:function(a,b){b=b||"_";var c=new RegExp("(\\"+b+"\\w)","g");return a.replace(c,function(a){return a[1].toUpperCase()})},nextTick:function(a,b){if(b)return function(){var b=arguments,c=this;y(function(){a.apply(c,b)})};y(a)},urlToAbsolute:function(a){if(document){var b=document.createElement("a");return b.href=a,b.href}return a},debounce:function(a,b,c){var d=function d(){var e=arguments,f=e.length,g=c||this;clearTimeout(d.pid),d.pid=x(function(){0===f?a.call(g):1===f?a.call(g,e[0]):2===f?a.call(g,e[0],e[1]):3===f?a.call(g,e[0],e[1],e[2]):a.apply(g,e)},b)};return d.cancel=B,d},throttle:function(a,b,c){b=b||150;var d,e=!1,f=!1;return function(){e?(f=!0,d=arguments):(a.apply(c,arguments),e=!0,x(function(){e=!1,f&&(a.apply(c,d),f=!1,d=void 0)},b))}},bind:function(a,b,c,d){if(null==c)c=[];else if(!Array.isArray(c))throw"util.bind: `args` must be array or null";return function(){var e=c,f=d;if(null==f&&(f=arguments.length),f>0){e=c.slice();for(var g=0;g<f;g++)e.push(arguments[g])}return b.apply(a||this,e)}},bindWithoutArgs:function(a,b,c){return Array.isArray(b)?function(){return a.apply(c||this,b)}:function(){return a.call(c||this)}},range:function(a){for(var b=[],c=0;c<a;c++)b.push(c);return b},pluck:function(a,b){return Array.isArray(a)?a.map(function(a){return a[b]}):[]},object:function(a,b){return a=null==a?[]:[].concat(a),b=void 0===b?[]:[].concat(b),a.reduce(function(a,c,d){return Array.isArray(c)?(a[c[0]]=c[1],a):(a[c]=b[d],a)},{})},promisify:function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b||(b=this),new Promise(function(d,e){c.push(function(a,b){a?e(a):d(b)}),a.apply(b,c)})}},isNumber:function(a){return["number","string"].includes(d(a))&&""!==a&&!isNaN(+a)},isPlainObject:function(a){var b,c;return!(!a||"[object Object]"!==u.call(a))&&(!(b=t(a))||"function"==typeof(c=q.call(b,"constructor")&&b.constructor)&&r.call(c)===s)},isFunction:function(a){return"function"==typeof a&&"number"!=typeof a.nodeType},isObject:function(a){return null!=a&&"object"===d(a)},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},findIndex:function(a,b){for(var c=a.length>>>0,d=0;d<c;d++)if(b.call(a,a[d],d,a))return d;return-1},deepEqual:function(a,b){if(a==b)return!0;if(A.isObject(a)&&A.isObject(b)){if(Object.keys(a).length!==Object.keys(b).length)return!1;for(var c in a){if(!(c in b))return!1;if(!A.deepEqual(a[c],b[c]))return!1}return!0}return!1},isPositiveNumber:function(a){return A.isNumber(a)&&+a>0},calculateFullName:function(a){return[a.first,a.middle,a.last].filter(Boolean).join(" ")||""}};function B(){clearTimeout(this.pid)}A.version="0.8.0";var C=i(function(a){!function(){var b=/-/g,c=/\s+/,d=/-(.)/g,e=function(a,b){return b.toUpperCase()},f={}.hasOwnProperty,g=[];function h(a,c){var d=a.__emList;return c=c.toLowerCase().replace(b,""),void 0===d?(d=a.__emList={})[c]=[]:void 0===d[c]&&(d[c]=[]),d[c]}var i=function(){};function j(a){if(a instanceof j)return a;if(a.type){for(var c in a)f.call(a,c)&&(this[c]=a[c]);a=a.type}this.type=a.toLowerCase().replace(b,"")}i.fn=i.prototype={constructor:i,on:function(a,b){for(var d=(a=a.split(c)).length;d--;)h(this,a[d]).push(b);return this},off:function(a,b){if(void 0===a)this.__emList=a;else for(var d=(a=a.split(c)).length;d--;){var e=h(this,a[d]),f=e.length,g=-1;if(1===arguments.length)e.splice(0,1e5);else{if(e.indexOf)g=e.indexOf(b);else for(;f--;)if(e[f]===b){g=f;break}-1!==g&&e.splice(g,1)}}return this},one:function(a,b){return this.on(a,function c(){return this.off(a,c),b.apply(this,arguments)})},emit:function(a,b){var c,f,i,j,k,l=h(this,a),m=l.length;if((a="on"+a.charAt(0).toUpperCase()+a.substr(1)).indexOf("-")>-1&&(a=a.replace(d,e)),"function"==typeof this[a]&&(j=this[a].apply(this,[].concat(b))),m>0)for(k=(b=void 0===b?g:[].concat(b)).length;m--;)f=this,void 0!==(c=l[m])&&(void 0!==c.handleEvent&&(f=c,c=c.handleEvent),void 0!==(i=0===k?c.call(f):1===k?c.call(f,b[0]):2===k?c.call(f,b[0],b[1]):c.apply(f,b))&&(j=i));return j},trigger:function(a,b,c){var d=new j(a);return d.target=d.target||this,d.details=c,d.result=this.emit(a.type||a,[d].concat(b)),this}},j.fn=j.prototype={constructor:j,defaultPrevented:!1,propagationStopped:!1,isDefaultPrevented:function(){return this.defaultPrevented},preventDefault:function(){this.defaultPrevented=!0},stopPropagation:function(){this.propagationStopped=!0},isPropagationStopped:function(){return this.propagationStopped}},i.apply=function(a){return a.on=i.fn.on,a.off=i.fn.off,a.one=i.fn.one,a.emit=i.fn.emit,a.trigger=i.fn.trigger,a},i.version="0.4.0",i.Event=j,i.getListeners=h,a.exports?a.exports=i:window.Emitter=i}()}),D=/\b(fail|error|warn(ing)?|info|success|done)\b/i,E={fail:"#c00",error:"#c00",warn:"#a6a616",warning:"#a6a616",info:"#00f",success:"#060",done:"#060"};Error.prototype.toJSON=function(){return{name:this.name,message:this.message,stack:this.stack}};var F=1,G=C.getListeners,H=window.encodeURIComponent,I=/\s+/,J={},K=[];function L(a,b){return"[["+a.label.replace(/(:pending|^\[\[|\]\]$)/g,"")+":"+b+"]]"}var M={index:J,parentId:0,metaOffset:0,disabled:!1,entries:K,useUUID:!1,uuid:o,catchUncaughtException:function(a){a.onerror=function(a,b,c,d,e){return M.add("error",{type:e&&e.type,message:a,url:b,line:c,column:d,stack:e&&e.stack&&String(e.stack)||""}),!1}},add:function(a,b,c,d){return M.disabled?this:(M.metaOffset=1,this.addEntry("log",a,b,c,d))},filterArguments:function(a,b){return a},scope:function(a,b,c,d){return null==c&&(c=-2),c>=-99&&(c=M.meta(c)),M.metaOffset=1,this.addEntry("scope",a,b,d,c)},addEntry:function(a,b,c,d,e){M.metaOffset+=1;var f=a instanceof N?a:new N(a,b,c,d||this.parentId,e);return J[f.id]=f,f.idx=K.push(f)-1,this._emit(),f},closest:function(a,b){var c;for(a=a.id||a;(c=J[a])&&a;)if(a=c.parentId,c.label===b)return c;return null},chain:function(a,b){for(var c,d=[];(c=J[a])&&a;)a=c.parentId,d.push(c);return d.reverse(),b&&(d=d.map(function(a){return"["+a.id+"] "+a.label}).join(b)),d},getScope:function(a,b,c,d){return M.metaOffset+=1,"string"==typeof a?this.addEntry("scope",a,b,c,d):a},wrap:function(a,b,c,d,e){if(1===arguments.length?(c=a,a=J[M.parentId]):void 0===c&&(c=b,b=void 0),c&&!c.__logger__&&!this.disabled){if(M.metaOffset+=1,e=e||M.meta(),"function"==typeof c){var f=function(){var f,g=M.getScope(a,b,d,e),h=M.parentId;return M.parentId=g.id,M.metaOffset+=1,f=M.wrap(g,c.apply(this,arguments)),M.parentId=h,f};return c.__logger__=!0,f.__logger__=!0,f}c.then&&M.getScope(a,b,null,e).wrap(c)}return M.metaOffset=0,c},call:function(a,b,c){return M.metaOffset+=1,this.wrap(a,b,c)()},reset:function(){F=1,this.index=J={},this.entries=K=[],this.parentId=0},set:function(a){this.reset(),this.entries=K=a},print:function(a){var b={},c="";return K.forEach(function(a){var c=a.parentId;(b[c]=b[c]||[]).push(a)}),function d(e,f){for(var g,h,i,j,k=b[e]||[],l=0,m=k.length;l<m;l++)if(i=(g=k[l]).args,h="["+(j=g.ts,new Date(j).toISOString().slice(11,-1)+"] ")+g.label,a&&(h+=i?": "+JSON.stringify(i):""),b[g.id])if(a)c+=f+h+"\n",d(g.id,"  "+f);else{if(D.test(h)){var n="color: "+E[RegExp.lastMatch.toLowerCase()];console.group("%c"+h,n),i&&console.log("%c[details] ",n,i)}else console.group(h),i&&console.log("[details] ",i);d(g.id),console.groupEnd()}else a?c+=f+h+"\n":D.test(h)?console.log("%c"+h,"color: "+E[RegExp.lastMatch.toLowerCase()],i):console.log(h,i)}(0,""),a&&c},on:function(a,b){for(var c,d=(a=a.trim().split(I)).length;d--;)c=a[d].split(":"),G(this,c[1]||c[0]).push({fn:b,label:c[1]||c[0],parent:c[1]&&c[0]});return this},off:function(a,b){for(var c,d,e,f,g=(a=a.trim().split(I)).length;g--;)for(c=a[g].split(":"),e=(d=G(this,c[1]||c[0])).length;e--;)(f=d[e]).fn===b&&f.parent===(c[1]&&c[0])&&d.splice(e,1);return this},_emit:function(){for(var a,b,c,d,e,f=K.length;f--;)if(!(a=K[f]).emitted)for(a.emitted=!0,d=(c=G(this,a.label)).length;d--;)(e=c[d]).parent?(b=this.closest(a.id,e.parent))&&e.fn(b,a):e.fn(a)},last:function(){return K[K.length-1]},meta:function(){return{fn:"unknown",file:"unknown",line:0,column:0}},parseStackRow:function(a){var b,c=(a+="").match(/at\s+([^\s]+)(?:.*?)\(((?:http|file|\/)[^)]+:\d+)\)/);return c||((c=a.match(/at\s+(.+)/))?(c[0]="<anonymous>",c.unshift("")):c=a.match(/^(.*?)(?:\/<)*@(.*?)$/)||a.match(/^()(https?:\/\/.+)/)),c?(b=c[2].match(/^(.*?):(\d+)(?::(\d+))?$/)||[],c={fn:(c[1]||"<anonymous>").trim(),file:b[1],line:0|b[2],column:0|b[3]}):c=null,c},serialize:function(){return JSON.stringify(K)},mailTo:function(a){var b=document.createElement("a");b.href="mailto:"+a+"?subject="+H("[logger] "+new Date)+"&body="+H(this.serialize()),b.innerHTML="send",b.click()}};function N(a,b,c,d,e){this.id=c&&c.uuid||(M.useUUID?o():F++),this.ts=performance.now(),this.type=a,this.label=b+"";try{c=A.cloneJSON(M.filterArguments(c,this.label))}catch(a){c=a}this.args=c,this.parentId=d,this.linked=[],M.metaOffset+=1,this.meta=e||M.meta(),M.metaOffset=0}N.fn=N.prototype={constructor:N,add:function(a,b){return M.add(a,b,this.id,this.meta)},call:function(a,b,c){if("function"==typeof a){var d,e=M.parentId;return M.parentId=this.id,d=this.wrap(b?a.apply(null,b):a()),M.parentId=e,d}return M.wrap(a,b,c,this.id,this.meta)()},wrap:function(a){if("function"==typeof a)return M.wrap(this,a);if(a&&!a.__logger__&&a.then){var b=a.then,c=a.done,d=a.fail,e=a.always,f=this;a.__logger__=f,c&&(a.done=function(b){var d=a.__noLog,e=M.meta(-1-(0|a.metaOffset));return c.call(a,function(){(d?a.__logger__:M.addEntry("scope",L(f,"done"),null,a.__logger__.id,e)).call(b,arguments)})}),d&&(a.fail=function(b){var c=a.__noLog,e=M.meta(-1-(0|a.metaOffset));return d.call(a,function(){(c?a.__logger__:M.addEntry("scope",L(f,"fail"),null,a.__logger__.id,e)).call(b,arguments)})}),e&&(a.always=function(b){var c,d=M.meta(-1-(0|a.metaOffset));return a.__noLog=!0,c=e.call(a,function(){M.addEntry("scope",L(f,"always"),null,a.__logger__.id,d).call(b,arguments)}),a.__noLog=!1,c}),a.catch=function(b){return a.then(null,b,!0)},a.then=function(c,d,e){if(a.__noLog)return b.call(a,c,d);var g=M.meta(-1-(0|a.metaOffset)-!!e),h=e?"catch":"then",i=new N("scope","",null,f.id,g);return i.wrap(b.call(a,c?function(){return i.label=L(f,h+":resolved"),M.addEntry(i),i.call(c,arguments)}:null,d?function(){return i.label=L(f,h+":rejected"),M.addEntry(i),i.call(d,arguments)}:null))}}return a},scope:function(a,b,c){return M.scope(a,b,c||-3,this.id)},chain:function(a){return M.chain(this.id,a)},pluck:function(a){return this.chain().map(function(b){return b[a]})},parent:function(){return J[this.parentId]},toJSON:function(){return{id:this.id,dependId:this.dependId,linked:this.linked,type:this.type,label:this.label,args:this.args,meta:this.meta,parentId:this.parentId,ts:this.ts}},setArgs:function(a){this.args=M.filterArguments(a)}},Function.prototype.logger=function(a,b){return M.wrap(a,b,this,null,M.meta(-1))},M.Entry=N,window.setTimeoutLog=function(a,b,c){},window.setIntervalLog=function(a,b,c){},Promise.Log=function(a,b){return b?a="[["+a+"]]":(b=a,a="[[promise]]"),M.scope(a,null,-2).call(function(){return new Promise(b)})},M.version="0.9.0";var O=window.octolog=window.logger=M,P=i(function(a){!function(){var b=/\s+/,c=/[\[.\]]/,e=/(?:\.|['"]?]?\.?\[['"]?|['"]?])/;function f(a,c,d){var e,f,h,i,j,k;if(c)for(f=(c=(c+"").trim().split(b)).length;f--;)if(i=!1,"!"===(h=c[f]).charAt(0)&&(i=!0,h=h.substr(1)),-1!==h.indexOf(":")&&(j=(h=h.split(":"))[1],k=h[2],h=h[0]),e=g(a,h),void 0!==j&&(e=void 0===k?e==j:e>=j&&e<=k),(e=d?void 0!==e:!!e)^i)return!0;return!1}function g(a,b,d,f){var g=3===arguments.length;if(c.test(b)){for(var h,i=b.split(e),j=0,k=i.length,l=a,m=a;j<k;j++)if(""!==(b=i[j])){if(h=b,!l)return;m=l,l=l[b],!d||g||l||(m[b]=l={})}return d&&(g?delete m[h]:m[h]=f),l}return d&&(g?delete a[b]:a[b]=f),a[b]}var h=function a(b){if(!(this instanceof a))return new a(b);b&&this.set(b)};h.fn=h.prototype={constructor:h,is:function(a){return f(this,a)},has:function(a){return f(this,a,!0)},get:function(a,b){var c=g(this,a);return void 0===c?b:c},set:function(a,b){var c=a;if("object"!==d(a)&&((c={})[a]=b),c instanceof Object)for(var e in c)c.hasOwnProperty(e)&&g(this,e,!0,c[e]);return this},unset:function(a){for(var b=arguments,c=b.length;c--;)g(this,b[c],!0);return this}},h.apply=function(a){return a.is=h.is,a.has=h.has,a.get=h.get,a.set=h.set,a.unset=h.unset,a};var i,j=h({__version__:"0.1.0"});for(i in j)h[i]=j[i];h.version="0.1.0",a.exports?a.exports=h:window.config=window.__config__=h}()});var Q={done:function(a){return function(b){return a(b),b}},fail:function(a){return function(b){return a(b),Promise.reject(b)}},cast:function(a){var b=Promise.resolve(a);return a&&"function"==typeof a.then?b.then(function(){return a}):b},map:function(a){var b,c=[],d=0,e={};for(b in a)c.push(a[b]);return Promise.all(c).then(function(c){for(b in a)e[b]=c[d++];return e})}},R=i(function(a,b){"undefined"!=typeof self&&self,a.exports=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=0)}([function(a,b){function c(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}var d=1;a.exports=function(a){return new Promise(function(b,e){function f(){g&&(g.onload=g.onreadystatechange=g.onerror=null,g.parentNode&&g.parentNode.removeChild(g),g=null)}var g=document.createElement("script"),h=a.url;if(a.params){var i=c(a.params);i&&(h+=(h.indexOf("?")>=0?"&":"?")+i)}g.async=!0;var j="axiosJsonpCallback"+d++,k=window[j],l=!1;window[j]=function(a){window[j]=k,l||b({data:a,status:200})};var m={_:(new Date).getTime()};m[a.callbackParamName||"callback"]=j,h+=(h.indexOf("?")>=0?"&":"?")+c(m),g.onload=g.onreadystatechange=function(){g.readyState&&!/loaded|complete/.test(g.readyState)||f()},g.onerror=function(){f(),e(new Error("Network Error"))},a.cancelToken&&a.cancelToken.promise.then(function(a){g&&(l=!0,e(a))}),g.src=h,document.head.appendChild(g)})}}])}),S=h(R),T=(R.axiosJsonpAdapter,i(function(a,b){var c,e;self,a.exports=(c={63:function(a){a.exports=function a(b,c){if(b===c)return!0;if(b&&c&&"object"==d(b)&&"object"==d(c)){if(b.constructor!==c.constructor)return!1;var e,f,g;if(Array.isArray(b)){if((e=b.length)!=c.length)return!1;for(f=e;0!=f--;)if(!a(b[f],c[f]))return!1;return!0}if(b.constructor===RegExp)return b.source===c.source&&b.flags===c.flags;if(b.valueOf!==Object.prototype.valueOf)return b.valueOf()===c.valueOf();if(b.toString!==Object.prototype.toString)return b.toString()===c.toString();if((e=(g=Object.keys(b)).length)!==Object.keys(c).length)return!1;for(f=e;0!=f--;)if(!Object.prototype.hasOwnProperty.call(c,g[f]))return!1;for(f=e;0!=f--;){var h=g[f];if(!a(b[h],c[h]))return!1}return!0}return b!=b&&c!=c}},738:function(a){a.exports=function(a){return null!=a&&null!=a.constructor&&"function"==typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}},141:function(a,b,c){var d=c(555);function e(a,b){return{status:a[0],data:(c=a[1],d.isArrayBuffer(c)||d.isBuffer(c)||d.isStream(c)||d.isBlob(c)?c:d.isObjectOrArray(c)?JSON.parse(JSON.stringify(c)):c),headers:a[2],config:b,request:{responseURL:b.url}};var c}a.exports=function(a,b,c,f){var g=f.url||"";f.baseURL&&g.substr(0,f.baseURL.length)===f.baseURL&&(g=g.slice(f.baseURL.length)),delete f.adapter,a.history[f.method].push(f);var h=d.findHandler(a.handlers,f.method,g,f.data,f.params,f.headers,f.baseURL);if(h)if(7===h.length&&d.purgeIfReplyOnce(a,h),2===h.length)a.originalAdapter(f).then(b,c);else if("function"!=typeof h[3])d.settle(b,c,e(h.slice(3),f),a.delayResponse);else{var i=h[3](f);"function"!=typeof i.then?d.settle(b,c,e(i,f),a.delayResponse):i.then(function(g){g.config&&g.status?d.settle(b,c,e([g.status,g.data,g.headers],g.config),0):d.settle(b,c,e(g,f),a.delayResponse)},function(b){a.delayResponse>0?setTimeout(function(){c(b)},a.delayResponse):c(b)})}else switch(a.onNoMatch){case"passthrough":a.originalAdapter(f).then(b,c);break;case"throwException":throw d.createCouldNotFindMockError(f);default:d.settle(b,c,{status:404,config:f},a.delayResponse)}}},138:function(a,b,c){var d=c(141),e=c(555),f=["get","post","head","delete","patch","put","options","list","link","unlink"];function g(){return f.reduce(function(a,b){return a[b]=[],a},{})}function h(){i.call(this),j.call(this)}function i(){this.handlers=g()}function j(){this.history=g()}function k(a,b){if(h.call(this),!a)throw new Error("Please provide an instance of axios to mock");this.axiosInstance=a,this.originalAdapter=a.defaults.adapter,this.delayResponse=b&&b.delayResponse>0?b.delayResponse:null,this.onNoMatch=b&&b.onNoMatch||null,a.defaults.adapter=this.adapter.call(this)}function l(a,b,c){if("any"===a)f.forEach(function(a){b[a].push(c)});else{var d=function(a,b,c){for(var d=-1,f=0;f<b[a].length;f+=1){var g=b[a][f],h=7===g.length;(g[0]instanceof RegExp&&c[0]instanceof RegExp?String(g[0])===String(c[0]):g[0]===c[0])&&e.isEqual(g[1],c[1])&&e.isEqual(g[2],c[2])&&!h&&(d=f)}return d}(a,b,c);d>-1&&c.length<7?b[a].splice(d,1,c):b[a].push(c)}}k.prototype.adapter=function(){return function(a){var b=this;return new Promise(function(c,e){d(b,c,e,a)})}.bind(this)},k.prototype.restore=function(){this.axiosInstance&&(this.axiosInstance.defaults.adapter=this.originalAdapter,this.axiosInstance=void 0)},k.prototype.reset=h,k.prototype.resetHandlers=i,k.prototype.resetHistory=j,f.concat("any").forEach(function(a){var b="on"+a.charAt(0).toUpperCase()+a.slice(1);k.prototype[b]=function(b,c,d){var f=this;function g(e,g,h){var i=[b,c,d,e,g,h];return l(a,f.handlers,i),f}function h(e,g,h){var i=[b,c,d,e,g,h,!0];return l(a,f.handlers,i),f}return b=void 0===b?/.*/:b,{reply:g,replyOnce:h,passThrough:function(){var d=[b,c];return l(a,f.handlers,d),f},abortRequest:function(){return g(function(a){var b=e.createAxiosError("Request aborted",a,void 0,"ECONNABORTED");return Promise.reject(b)})},abortRequestOnce:function(){return h(function(a){var b=e.createAxiosError("Request aborted",a,void 0,"ECONNABORTED");return Promise.reject(b)})},networkError:function(){return g(function(a){var b=e.createAxiosError("Network Error",a);return Promise.reject(b)})},networkErrorOnce:function(){return h(function(a){var b=e.createAxiosError("Network Error",a);return Promise.reject(b)})},timeout:function(){return g(function(a){var b=e.createAxiosError(a.timeoutErrorMessage||"timeout of "+a.timeout+"ms exceeded",a,void 0,"ECONNABORTED");return Promise.reject(b)})},timeoutOnce:function(){return h(function(a){var b=e.createAxiosError(a.timeoutErrorMessage||"timeout of "+a.timeout+"ms exceeded",a,void 0,"ECONNABORTED");return Promise.reject(b)})}}}}),a.exports=k,a.exports.default=k},376:function(a){a.exports=function(a){return"undefined"!=typeof Blob&&(a instanceof Blob||"[object Blob]"===Object.prototype.toString.call(a))}},555:function(a,b,c){var e=c(63),f=c(738),g=c(376),h=Object.prototype.toString;function i(a,b){for(var c=a.length,d=0;d<c;d++){var e=a[d];if(b(e))return e}}function j(a){return"[object Function]"===h.call(a)}function k(a){return null!==a&&"object"==d(a)}function l(a,b){return a?a.replace(/\/+$/,"")+"/"+b.replace(/^\/+/,""):b}function m(a,b){return("/"===a[0]?a.substr(1):a)===("/"===b[0]?b.substr(1):b)}function n(a,b,c,d){if(["delete","get","head","options"].indexOf(a.toLowerCase())>=0){var e=d?d.data:void 0;return o(c,d?d.params:void 0)&&p(b,e)}return p(b,d)}function o(a,b){return void 0===b||("function"==typeof b.asymmetricMatch?b.asymmetricMatch(a):e(a,b))}function p(a,b){if(void 0===b)return!0;var c;try{c=JSON.parse(a)}catch(a){}return o(c||a,b)}function q(a,b,c,d){var e=new Error(a);return e.isAxiosError=!0,e.config=b,void 0!==c&&(e.response=c),void 0!==d&&(e.code=d),e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}a.exports={find:i,findHandler:function(a,b,c,d,e,f,g){return i(a[b.toLowerCase()],function(a){return"string"==typeof a[0]?(m(c,a[0])||m(l(g,c),a[0]))&&n(b,d,e,a[1])&&o(f,a[2]):a[0]instanceof RegExp?(a[0].test(c)||a[0].test(l(g,c)))&&n(b,d,e,a[1])&&o(f,a[2]):void 0})},purgeIfReplyOnce:function(a,b){Object.keys(a.handlers).forEach(function(c){var d=a.handlers[c].indexOf(b);d>-1&&a.handlers[c].splice(d,1)})},settle:function a(b,c,d,e){e>0?setTimeout(a,e,b,c,d):!d.config.validateStatus||d.config.validateStatus(d.status)?b(d):c(q("Request failed with status code "+d.status,d.config,d))},isStream:function(a){return k(a)&&j(a.pipe)},isArrayBuffer:function(a){return"[object ArrayBuffer]"===h.call(a)},isFunction:j,isObjectOrArray:k,isBuffer:f,isBlob:g,isBodyOrParametersMatching:n,isEqual:e,createAxiosError:q,createCouldNotFindMockError:function(a){var b="Could not find mock for: \n"+JSON.stringify(a,["method","url"],2),c=new Error(b);return c.isCouldNotFindMockError=!0,c.url=a.url,c.method=a.method,c}}}},e={},function a(b){var d=e[b];if(void 0!==d)return d.exports;var f=e[b]={exports:{}};return c[b](f,f.exports,a),f.exports}(138))})),U=(T.AxiosMockAdapter,null),V=[];V.active=0;var W=[],X="losswifiauth",Y={},$={},Z=JSON.stringify,_=k.create(),aa=new T(_,{onNoMatch:"passthrough"});function ba(a,b){return{rev:a.rev,url:a.url,data:A.cloneJSON(a.data),type:a.type,headers:a.options&&a.options.headers||a.headers,startTime:a.startTime,duration:a.duration,status:a.httpStatus||a.status,statusText:a.statusText,readyState:a.readyState,responseText:200!=a.status?a.responseText:void 0,requestID:a.requestID,host:a.host}}function ca(a){var b=W.indexOf(a);b>-1&&W.splice(b,1)}function da(a,b,c){var d,e,f=(c=A.extend({type:"POST",logger:"request",loggerMeta:c&&c.loggerMeta||O.meta(-1),headers:{},retries:da.setup("retries"),Request:ha,withoutRequestId:!1},c,{url:a,data:b})).Request;if(c.type=c.type.toUpperCase(),"GET"==c.type){if(e=a+"|"+Z(b)+"|"+Z(c&&c.headers),d=Y[e],void 0===c.cache&&(c.cache=!1),!d){d=new f(c),Y[e]=d;var g=function(){delete Y[e]};d.then(g,g)}}else d=new f(c);return d}function ea(a,b,c){var d=new Promise(function(d,e){c.push({req:a,opts:b,resolve:d,reject:e})});return a.batched?d.then(function(b){return("error"in b&&"data")in b?a.end(b.error||!1,b.data):a.end(!1,b)},function(b){return a.end(b)}):d}function fa(){if(V.length){var a=V.shift(),b=a.opts;V.active++,a.req.send(b).then(ga(a),ga(a)),"GET"===b.type&&V[0]&&"GET"===V[0].opts.type&&fa()}}function ga(a){return function(b){V.active--,a[b.isOK()?"resolve":"reject"](b),!V.active&&fa()}}function ha(a){var b,c=this;c.uuid=o(),c.url=a.url,c.type=a.type,c.data=a.data,c.options=a,c.startTime=performance.now(),!1===a.withoutRequestId&&(a.headers["X-Request-Id"]=c.uuid),da.trigger("start",c),a.force?b=c.send(a):!1!==a.batch&&U?(c.batched=!0,b=ea(c,a,U)):b=V.length||V.active||"POST"===a.type&&da.setup("safeMode")?ea(c,a,V):c.send(a),c.__logger__=b.__logger__,c._promise=b,b.metaOffset=1,1!==V.length||V.active||(W.length?Promise.all(W).then(function(){fa()},function(){fa()}):fa())}da.maxRev=Number.NEGATIVE_INFINITY,da.lastRev=Number.NEGATIVE_INFINITY,["call","get","post"].forEach(function(a){da[a]=function(b,c,d){var e=O.meta(-1);return e.fn="request."+a,(d=A.cloneObject(d)).type=d.type||("call"==a?"post":a),d.loggerMeta=d.loggerMeta||e,da(b,c,d)}}),da.setup=function(a,b){if("string"==typeof a){if(void 0===b)return $[a];$[a]=b}else{if(void 0===a)return $;A.extend($,a)}},da.setup({retries:1,batchUrl:"/batch",safeMode:!1,parseRev:null,locationReload:function(){(window.mockWindow||window).location.reload()},lossWiFiAuthDetect:function(a,b){var c=a.responseText;return"parsererror"==b&&/<meta[^>]+refresh/i.test(c)}}),ha.fn=ha.prototype={__resultLogEntry__:{},batched:!1,then:function(a,b){return this._promise.then(a,b)},catch:function(a){return this._promise.catch(a)},finally:function(a){return this._promise.finally(a)},send:function(a){var b,c,d=this,e=da.setup("beforeSend");return e&&e(d),d.endTime=null,d.duration=null,d.pending=!0,d.aborted=!1,d.retries=a.retries,d.responseText=null,d.body=null,d.status=null,d.error=null,d.xhr=b=this.createXhr(a),a.force||W.push(b),c=new Promise(function(c,d){b.then(function(){a.force||ca(b),c(b)}).catch(function(c){a.force||ca(b),d(c)})}),O.wrap("[["+a.logger+"]]",ba(a),c),this.__resultLogEntry__=O.addEntry("log",a.logger+":pending",null,c.__logger__.id),this.__resultLogEntry__.meta=c.__logger__.meta=a.loggerMeta,c.__noLog=!0,c.then(function(a){return("error"in a&&"data")in a?d.end(a.error||!1,a.data):d.end(!1,a)},function(a){return d.end(a)})},createXhr:function(a){var b,c,d,e=this,f=k.CancelToken.source(),g={getResponseHeader:function(a){if("string"==typeof a){var b=this.headers;for(var c in b)if(c.toLowerCase()===a.toLowerCase())return b[c]}return null},getAllResponseHeaders:function(){var a="",b=this.headers;for(var c in b)a+=c+": "+b[c]+"\n";return a},abort:function(){f.cancel("abort"),c(f.token.reason)}},h=function(b){return new window.Promise(function(c,d){if(aa.resetHistory(),a.transport)try{a.transport(a,function(a){a=A.extend({},a,{headers:{"Content-Type":a.contentType||"application/json"},data:a.responseText}),b.validateStatus(a.status)?c(a):d({message:"error",response:a})})}catch(a){d(a)}else"jsonp"===a.dataType?S(b).then(c).catch(d):(e.emit("beforesend",b),A.isPlainObject(b.data)&&(b.data=A.param(b.data)),!1===a.cache&&b.params&&(b.params._=Date.now()),k.defaults.adapter(b).then(c).catch(d))})},i=function(a){return new window.Promise(function(b,d){c=d,aa.originalAdapter=h,aa.adapter()(a).then(b).catch(d)})};return d=new Promise(function(c,e){var g=a.type||"POST",h=a.responseType,j={method:g,url:a.url,adapter:i,headers:a.headers,timeout:a.timeout,callbackParamName:a.jsonp,onUploadProgress:a.onUploadProgress,onDownloadProgress:a.onDownloadProgress,transformRequest:[],transformResponse:[],cancelToken:f.token};h&&"json"!==h&&"text"!==h&&(j.responseType=h),(a.withCredentials||a.xhrFields&&a.xhrFields.withCredentials)&&(j.withCredentials=!0),"GET"===g.toUpperCase()?j.params=a.data:j.data=a.data,a.timeout&&(b=setTimeout(function(){d.abort("timeout")},a.timeout));var l=function(b,f){A.extend(d,{status:b.status,statusText:b.statusText,readyState:4,headers:b.headers,responseText:b.data});var g="json"===(h||a.dataType),i=d.getResponseHeader.call(b,"Content-Type");if(!h&&i&&i.toLowerCase().includes("application/json")&&(g=!0),g)if("string"==typeof b.data)try{c({error:f,data:JSON.parse(b.data)})}catch(a){e("parsererror")}else c({error:f,data:b.data});else c({error:f,data:b.data})};_(j).then(function(a){clearTimeout(b),l(a)}).catch(function(a){if(clearTimeout(b),k.isCancel(a))A.extend(d,{status:0,statusText:a.message});else if(a.response)return void l(a.response,a.message);e(a.message)})}),Object.assign(d,g)},getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()},abort:function(){this.aborted=!0,this.xhr?this.xhr.abort():this.end(!1)},end:function(a,b){var c=this.options;this.status=null==this.status?this.xhr.status:this.status,this.statusText=this.statusText||this.xhr.statusText,this.readyState=this.xhr.readyState,this.responseText=this.xhr.responseText,this.endTime=performance.now(),this.duration=this.endTime-this.startTime,this.pending=!1;var d=da.setup("parseRev");if(d&&(this.rev=d(this,b),da.lastRev=this.rev,this.rev>da.maxRev&&(da.maxRev=this.rev)),this.requestID=this.getResponseHeader("x-mru-request-id"),this.host=this.getResponseHeader("x-host"),O.Entry.prototype.setArgs.call(this.__resultLogEntry__,ba(this)),da.setup("lossWiFiAuthDetect")(this,a)&&(a=X),c.postProcessing&&c.postProcessing(this,b),!1===a)this.body=b,this.__resultLogEntry__.label="[["+c.logger+":done]]";else{this.error=a,this.__resultLogEntry__.label="[["+c.logger+":fail]]";var e=new C.Event(a===X?a:"error");if(da.trigger(e,this),e.result&&e.result.then)return da.trigger("end",this),e.result;a!==X||e.isDefaultPrevented()||da.setup("locationReload")(this)}return da.trigger("end",this),this.trigger("end"),Promise[this.isOK()?"resolve":"reject"](Object.create(this,{then:{value:null}}))},isOK:function(){return(this.status>=200&&this.status<=202||206==this.status)&&!this.error},retry:function(a,b){var c=this,d=b?c.options:A.cloneObject(c.options);return d.retries>0?(d.retries--,d.logger="retry:"+d.logger,(a=a||Promise.resolve()).then||(a=new Promise(a)),a.then(function(){return b?c.send(d):da(c.url,c.data,d)},function(){return Promise.reject(c)})):Promise.reject(c)},is:P.is,has:P.has,get:P.get,map:function(a){if(a instanceof Function)return(a.map||a).call(a,this.get("body"));var b={};return Object.keys(a).map(function(c){var d=a[c];b[c]=(d.map||d).call(d,this.get("body."+c))},this),b},equals:function(a){return a&&this._promise===a._promise}},da.batch=function(a,b){var c,d=U||[];return null===U&&(U=d,d.promise=new Promise(A.nextTick(function(a,c){if(d.length>0){var e=da.post(b||da.setup("batchUrl"),{batch:Z(d.map(function(a){var b=a.opts;return{url:b.url,type:b.type,data:b.data,headers:b.headers}}))},{batch:!1});e.then(function(){e.body.forEach(function(a,b){d[b].req.xhr=e.xhr,d[b].resolve(a)}),a()}).catch(function(){d.forEach(function(a){a.req.xhr=e.xhr,a.reject(e)}),c(e)})}else a();U=null},!0))),c=a(),d.promise.then(function(){return c})},C.apply(da),da.from=function(a,b,c){var d=Object.create(this.Request.prototype,{then:{value:null}});return d.xhr=c,d.url=a,d.data=b,d.status=c.status,d.statusText=c.statusText,d.readyState=c.readyState,d.responseText=c.responseText,d.pending=!1,d.isOK()&&(d.body=JSON.parse(d.responseText)),d},da.smartParse=function(a){var b=function a(b,c,d){if(b[c])if("[object Object]"==={}.toString.call(d)&&"[object Object]"==={}.toString.call(b[c]))for(var e in d)a(b[c],e,d[e]);else Array.isArray(d)&&Array.isArray(b[c])?d.forEach(function(d,e){a(b[c],e,d)}):b[c]=d;else b[c]=d},c=function(a,c,d){var e=/(.+)\[(\d+)\]/;if(e.test(c)){var f=e.exec(c),g=f[1],h=f[2];a[g]||(a[g]=[]),b(a[g],h,d)}else a[c]=d},d=function a(b){var d;if("[object Object]"==={}.toString.call(b))for(var e in d={},b)if(/\./.test(e)){var f=e.split("."),g={};g[f.slice(1).join(".")]=b[e],c(d,f[0],a(g))}else c(d,e,a(b[e]));else d=Array.isArray(b)?b.map(function(b){return a(b)}):b;return d}(a);try{d.get=P.get}catch(a){}return d},da.workflow=function(a,b){return a.transport=b,this.call(a.url,a.data,a)},da.mock=function(a){var b=a.status||200,c=a.headers||{},d=a.data||{},e=a.responseTime||0,f=a.response,g=a.type,h=a.beforeSend,i=a.contentType,j=a.url;"string"==typeof j&&-1!==j.indexOf("*")&&(j=new RegExp(j.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".+"))),i&&(c["Content-Type"]=i);var k={status:b,responseText:a.responseText,headers:c},l=function(a){return a.data=A.extend(a.data,a.params),h&&h(k,a),new Promise(function(b){var c=function(a){b([k.status,void 0!==a?a:k.responseText,k.headers])};setTimeout(function(){if(f)if(2===f.length)f.call(k,a,function(a){c(a)});else{var b=f.call(k,a);c(b)}else c()},e)})},m=a.once?"replyOnce":"reply",n="onAny";g&&(n=A.toCamelCase("on_"+g.toLowerCase()));var o=A.extend({},d,{asymmetricMatch:function(a){var b=!0;if(a)for(var c in d)if(!(c in a)||!A.deepEqual(a[c],d[c])){b=!1;break}return b}});"onGet"===n?aa[n](j,{params:o})[m](l):aa[n](j,o)[m](l)},da.mock.once=function(a){a=A.extend({},a,{once:!0}),da.mock(a)},da.mock.clear=function(){aa.reset()},da.mock.queueClear=function(){(V=[]).active=0},da._isQueue=function(){return!!V.length},window.axiosMock=aa,da.all=function(a){return Promise.all(a)},da.Promise=Promise,da.Request=ha,da.active=W,C.apply(ha.fn),da.version="0.9.1";var ia=0,ja=[],ka={},la=0,ma=!1;function na(){return ma?la:da.maxRev}function oa(){return++la}function pa(){return"function"==typeof da.setup("parseRev")}var qa=function(){function a(){this.active=!1,this.supported=pa(),this.hasChanges=!1,this.models={},this.touchedAttrs={},this.outdated=[],this.startRev=ma?oa():na(),this.endRev=Number.NEGATIVE_INFINITY,this.supported&&(ia++,ja.push(this),this.active=!0,a.active=!0,1===ia&&a.trigger("queue:start",[]),a.trigger("start",[this]))}return a.useFakeRev=function(){return ma=!0,function(){return a.active?.1:++la}},a.start=function(){return new a},a.touch=function(a,b){ia>0&&ja[ia-1].touch(a,b)},a.dangerousReset=function(){if(ia>0)for(var b=ia;b--;)ja[b].commit();ia=0,ja.length=0,a.active=!1,ka={}},a.contains=function(a,b){return!!ka.hasOwnProperty(a.cid)&&ka[a.cid][b]>0},a.prototype.touch=function(a,b){var c=a.cid;this.hasChanges=!0,void 0===this.models[c]&&(this.models[c]=a,this.touchedAttrs[c]={}),void 0===ka[c]&&(ka[c]={}),void 0===this.touchedAttrs[c][b]&&(this.touchedAttrs[c][b]=!0,void 0===ka[c][b]?ka[c][b]=1:ka[c][b]++)},a.prototype.rollback=function(){this.commit()},a.prototype.commit=function(b){if(this.active){var c=this.models,d=this.outdated,e=b||(ma?oa():na());if(this.endRev=e,this.active=!1,ia--,a.active=ia>0,ja.splice(ja.indexOf(this),1),!this.hasChanges)return;for(var f in c)if(c.hasOwnProperty(f)){var g=c[f],h={},i=this.touchedAttrs[f],j=!1,k=!0;for(var l in i)if(i.hasOwnProperty(l)){var m=--ka[f][l],n=g.shadowRevs,o=g.shadowChanges;0==m?(delete ka[f][l],n&&n.hasOwnProperty(l)&&(e<=n[l]?(j=!0,h[l]=o[l]):k&&(k=!1,d.push(g)),delete n[l],delete o[l])):m<0&&a.trigger("error",[{reason:"negative-mutex"}])}j&&g.set(h,{clean:!0,rev:e}),0===Object.keys(ka[f]).length&&delete ka[f]}d.length&&a.trigger("outdated",[d]),a.trigger("end",[this]),0===ia&&a.trigger("queue:end",[])}else this.supported&&a.trigger("error",[{reason:"transaction-no-active"}])},a.active=!1,a.isSupported=pa,a.getMaxRev=na,a}();C.apply(qa);var ra=0,sa=0;O.printRevisions=function(a){var b=0,c=!1;console.group("Revisions"),O.entries.forEach(function(d){var e,f=d.args&&d.args.url&&d.args.rev;if(sa<d.idx)sa=d.idx;else if(!a)return;f&&(c=!0,console.log("%c[%s] rev: %c%d%c, %c%s%c <- %c%s %o","color: #333",(e=d.ts,new Date(e).toISOString().slice(11,-1)),f>b?"color: #b46af7; font-weight: bold;":f<1||f<b?"color: #FF1100":"color: #CA9CF4",f,"color: #333;  font-weight: normal;","color: #cc782a;",d.label,"color: #666","color: #005BD1;",d.args.url,function(a){var b=a.label,c=a.args.data;if(b.includes("/marks")){var d=JSON.parse(c.marks);return 1==d.length?d[0]:d}return b.includes("findOne")?{id:c.id}:b.includes("/status")?{offset:c.offset,limit:c.limit}:void 0}(d)),b=Math.max(b,f),ra=Math.max(ra,f))}),c||console.log("Last printed rev:",ra," (or use logger.printRevisions(true)"),console.groupEnd()};var ta=function(a,b){return ta=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},ta(a,b)};var ua=function(){return ua=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},ua.apply(this,arguments)},va=/^\/?v\d+/,wa=/\/$/,xa=/^\//,ya=/\/{2,}/g,za=/([^$\/])\/+/g,Aa=/^https?:\/\//i,Ba=JSON.stringify,Ca={102:"processing",200:"ok",202:"accepted",203:"non_authoritative",206:"partial",301:"move",304:"notmodified",400:"invalid",402:"payment_required",403:"denied",404:"notfound",406:"unacceptable",408:"timeout",409:"conflict",417:"expectation_failed",422:"unprocessable",423:"locked",424:"failed_dependency",426:"upgrade_required",429:"many_requests",449:"retry_with",451:"unavailable_for_legal_reasons",500:"fail",501:"not_implemented",503:"unavaliable",507:"insufficient"};var Da=Object.prototype.hasOwnProperty,Ea={};for(var Fa in Ca)Ea[Ca[Fa]]=Fa;var Ga=[];function Ha(a,b){return a.some(function(a){return a.status===b.status&&a.process===b.process})}function Ia(a){Ha(Ga,a)||Ga.push(a)}function Ja(){Ga.length=0}var Ka=function(){return this.lastModified=null,this.htmlencoded=null,this.email=null,this.statusName=null,da.Request.apply(this,arguments)};(Ka.prototype=Object.create(da.Request.prototype,{constructor:{value:Ka}})).end=function(a,b){var c=this,d=null,e=this.options,f=(e.owner||Ma).setup(),g="json"===(e.responseType||"json");this.status=this.status||this.xhr.status;var h=f.parseResponse?f.parseResponse({status:this.xhr.status,statusText:this.xhr.statusText,error:a,body:b,get headers(){return null===d&&(d=(c.getAllResponseHeaders()||"").trim().split("\n").reduce(function(a,b){var c=b.split(":");return a[c[0]]=c.slice(1).join(":").trim(),a},{})),d}}):b;if(this.httpStatus=this.status,this.parsedResponse=h,!a&&!this.aborted&&g){for(var i in h)Da.call(h,i)&&(this[A.toCamelCase(i)]=h[i]);this.statusName=Ca[h.status],h.session&&(f.session=h.session),h=h.body,a=a||!this.isOK()}return da.Request.fn.end.call(this,a,h)},Ka.prototype.is=function(a){for(var b,c,d,e=/\b(\w+)(?::(\w+))?\b/g;d=e.exec(a);)if(b=d[1],c=d[2],Ea[b]==this.status&&(!c||this.body==c))return!0;return da.Request.fn.is.call(this,a)};var La=function(a){function b(c){void 0===c&&(c={});var e=a.call(this)||this;return e.Class=b,e.attachBaseErrorHandler=Ia,e.clearBaseErrorHandlers=Ja,e.version="0.12.0",e.request=da,e.Request=Ka,e.all=function(a){return Promise.all(a)},e.Promise=Promise,e.errorHandler=[],e.statuses=Ea,e.codes=Ca,e.mock=function(a){function b(b,c){"object"===d(b)&&(b=(c=b).url);var e=(c=c||{}).data||{},f=c.responseText||{body:c.body||"",status:c.status||200,email:c.email||"",htmlencoded:c.htmlencoded||"",last_modified:c.last_modified||""};return c.rev&&(f.rev=c.rev),{url:a.url(b,e),once:c.once,contentType:"application/json",type:c.type,headers:c.headers||{},responseType:c.responseType,responseTime:c.responseTime||15,data:e,responseText:Ba(f),response:c.response}}var c=function(a,c){return da.mock(b(a,c))};return c.once=function(a,c){return da.mock.once(b(a,c))},c.clear=function(){return da.mock.clear()},c}(e),e.serialize=function(a){return e.settings.dataSerializer?e.settings.dataSerializer(a):a},e.normalizeUrl=function(a){var b=e.settings,c=b.apiBaseUrl,d=b.baseUrl,f=b.version,g=String(a||"");return Aa.test(g)?g:xa.test(g)?g.replace(za,"$1/"):(c?-1===g.indexOf(c)&&(g="".concat(c.replace(wa,"")).concat("/".concat(g).replace(ya,"/"))):-1===g.indexOf(d)&&(f&&!va.test(g)&&(g="/v".concat(f,"/").concat(g)),g="".concat(d.replace(wa,"")).concat("/".concat(g).replace(ya,"/"))),g)},e.url=function(a,b){return e.normalizeUrl(a)},e.call=function(a,b,c){return(c=Object.assign({},c)).timeout=c.timeout||e.settings.timeout,c.Request=Ka,c.dataType=c.dataType||"json",c.type=c.type?c.type.toUpperCase():"POST",c.loggerMeta=c.loggerMeta||O.meta(-1),!(b=Object.assign({},b||{})).email&&e.settings.email&&(b.email=e.settings.email),!b.access_token&&e.settings.access_token&&(b.access_token=e.settings.access_token),null!=e.settings.htmlencoded&&(b.htmlencoded=e.settings.htmlencoded),e.settings.token&&(b.token=e.settings.token),!b.utm&&e.settings.utm&&(b.utm=e.settings.utm),!b.referrer&&e.settings.referrer&&(b.referrer=e.settings.referrer),e.settings.emulateHTTP&&"GET"!==c.type&&"POST"!==c.type&&"PUT"!==c.type&&(c.type="POST"),e.settings.session&&(b.session=e.settings.session),c.logger=c.logger||a,c.owner=e,da(e.url(a,b),e.serialize(b),c)},e.get=function(a,b,c){return e.call(a,b,Object.assign({},c,{type:"GET"}))},e.post=function(a,b,c){return e.call(a,b,Object.assign({},c,{type:"POST"}))},e.batch=function(a){return da.batch(a,e.url("batch"))},e.attachErrorHandler=function(a){Ha(e.errorHandler,a)||e.errorHandler.push(a)},e.clearErrorHandlers=function(){e.errorHandler.length=0},e.hasSession=function(){return!!e.settings.session},e.hasToken=function(){return!!e.settings.token},e.resetToken=function(){e.settings.token=""},e.token=function(){return e.call("tokens").then(function(a){return e.settings.token=a.get("body.token"),e.settings.token})},e.from=function(a,b,c){var d=da.from(a,b,c);return d.isOK()&&(d.status=d.get("body.status"),d.body=d.get("body.body")),d},e.workflow=da.workflow,e.addXEmail=function(a){return/x-email=/.test(a)||(a+=(/\?/.test(a)?"&":"?")+"x-email="+encodeURIComponent(e.settings.email)),a},e.settings=Object.assign({version:1,sdcUrl:"//auth.mail.ru/sdc",baseUrl:"//api.mail.ru/",timeout:1e4,email:"",token:"",htmlencoded:!1,tokenRetries:2,emulateHTTP:!0,session:"",access_token:null,utm:null,referrer:null,getOauthToken:null},c),e.setup=e.setup.bind(e),e}return function(a,b){function c(){this.constructor=a}ta(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}(b,a),b.prototype.new=function(a){return new b(a)},b.prototype.setup=function(a,b){if(void 0===a)return this.settings;if(void 0!==b&&"string"==typeof a)this.settings[a]=b;else{if("string"==typeof a)return this.settings[a];Object.assign(this.settings,a)}},b.attachBaseErrorHandler=Ia,b.clearBaseErrorHandlers=Ja,b}(C);C.apply(La);var Ma=new La;function Na(a,b){return"function"==typeof a&&(a.parent=b),a}function Oa(a,b){if(1===arguments.length)return(a=(b=a).constructor).fn=a.prototype=b,Oa.apply(a);var c,d,e=Na(b.hasOwnProperty("constructor")?b.constructor:function(b,c,d){var e;switch(arguments.length){case 1:e=a.call(this,b);break;case 2:e=a.call(this,b,c);break;case 3:e=a.call(this,b,c,d);break;default:e=a.apply(this,arguments)}if(void 0!==e)return e},a);for(c in a)a.hasOwnProperty(c)&&(e[c]=a[c]);for(c in e.prototype=((d=function(){}).prototype=a.fn,new d),e.fn=e.prototype,b)e.fn[c]=Na(b[c],e.fn[c]);return e.fn.constructor=e,Oa.apply(e)}function Pa(a,b){if(a===b)return!1;var c,e=d(b);if("string"===e||"number"===e||"boolean"===e||null===a&&null!==b||null!==a&&null===b)return a!=b;if(d(a)===e)if(b instanceof Array){for(c=b.length;c--;)if(Pa(a[c],b[c]))return!0}else if(b instanceof Object)for(c in b)if(Pa(a[c],b[c]))return!0;return!1}function Qa(a,b){var c;if("function"==typeof a)c=b?function(c,d,e){return a.call(b,c,d,e)}:a;else{var d=Object.keys(a),e=d[0],f=d.length,g=a[e];(c=1===f?-1===e.indexOf(".")?function(a){return!Pa(a[e],g)}:function(a,b){return!Pa(b.get(e),g)}:function(b,c){for(var g=f;g--;)if(Pa(-1===(e=d[g]).indexOf(".")?b[e]:c.get(e),a[e]))return!1;return!0}).keys=d,c.isWhere=!0}return c}function Ra(a,b,c){if(!a)return[];var d=[],e=0,f=a.length;if(f>0)for(b=Qa(b,c);e<f;e++)b(a[e],e,a)&&d.push(a[e]);else if(a instanceof Object)for(e in b=Qa(b,c),a)a.hasOwnProperty(e)&&b(a[e],e,a)&&d.push(a[e]);return d}da.on("error",function(a,b){var c,d,e=(null===(c=b.options)||void 0===c?void 0:c.owner)||Ma;if(!(null===(d=b.options)||void 0===d?void 0:d.skipErrorHandlers))for(var f,g,h=e.errorHandler.concat(Ga),i=h.length;i--;)if(f=h[i],b.is(f.status)&&(g=f.process(b,e)))return a.preventDefault(),b.retry(g,!0)}),Oa.apply=function(a){return a.extend=a.extend||function(a){return Oa(this,a)},a},Ra.version="0.1.4",Ra.notEqual=Pa,Ra.createIterator=Qa;var Sa=[],Ta=Sa.sort,Ua=Sa.slice,Va=Sa.splice,Wa=Sa.indexOf,Xa=Sa.some,Ya=Sa.every,Za=Sa.reduce,$a="sync change remove destroy",_a=JSON.stringify,ab=function(a,b,c,d){var e=a.get(c),f=b.get(c);return(e&&e.localeCompare?e.localeCompare(f):e===f?0:e>f?1:-1)*(d?-1:1)};function bb(a,b,c){var d;this._index={},this._safedStore={},this.length=0,c&&(d=c.rev),this._debounceTriggerUpdate=A.debounce(function(){this.trigger("update",this)},0),a instanceof Array||a instanceof bb?this.set(a,{silent:!0,rev:d}):b&&(this.on=this._lazyOn,this.get=this._lazyGet)}bb.fn=bb.prototype={constructor:bb,comparator:null,Model:null,length:0,local:!1,_indexes:null,_lazyOn:function(a,b){var c=C.fn.on,d=this.length;for(this.on=c;d--;)this[d].on($a,this);return c.call(this,a,b)},_lazyGet:function(a){var b,c=bb.fn.get,d=this.length,e=this._index;for(this.get=c;d--;)e[(b=this[d]).id]=e[b.cid]=b,void 0!==this._addToIndex&&this._addToIndex(b);return c.call(this,a)},_prepareModel:function(a,b){var c,d=this.Model,e=a,f=d.all;return a instanceof d||(c=a.cid||a[d.fn.idAttr],(e=this.get(c)||!this.local&&f.get(c))?e.set(a,b):(e=new d(a,b),!this.local&&f.set([e],b))),e},handleEvent:function(a,b){var c=a.type;"remove"===c||"destroy"===c?this.remove(b):(null!==b.id&&(this._index[b.id]=b),a.list=this,this.trigger(a,b)),this._changed="change"===c,!0!==this._changing&&this._debounceTriggerUpdate()},each:function(a,b){for(var c=0,d=this.length;c<d;c++)a.call(b,this[c],c,this);return this},map:function(a,b){for(var c=[],d=0,e=this.length;d<e;d++)c.push(a.call(b,this[d],d,this));return c},some:function(a,b){return Xa.call(this,a,b||this)},every:function(a,b){return Ya.call(this,a,b||this)},reduce:function(a,b){return Za.apply(this,arguments)},sum:function(a){var b=0;return this.each(function(c){b+=c.get(a)}),b},avg:function(a){return this.sum(a)/this.length},filter:function(a,b,c){var d,e,f=new this.constructor(null,!0),g=0,h=this.length,i=0;for(e=(a=Ra.createIterator(a,b)).isWhere;g<h;g++)if(d=this[g],!0===e?a(d.attributes,d)&&(f[i++]=d):a(d,g,this)&&(f[i++]=d),1===i&&c)return f[0];if(!c)return f.length=i,f},first:function(){return this[0]},last:function(){return this[this.length-1]},find:function(a,b){return this.filter(a,b,!0)},pluck:function(a){return this.map(function(b){return b.get(a)})},contains:function(a){return!!this.get(a)},indexOf:function(a){a instanceof Object||(a={id:a,cid:a});for(var b,c=this.length;c--;)if((b=this[c]).id===a.id||b.cid===a.cid)return c;return-1},sort:function(a,b){a||(a=this.comparator||this.Model.fn.idAttr);var c,e,f,g=this,h=d(a);if(b&&(e=!0===b||b.silent,f=b.reverse,b.clone&&(g=g.clone())),"string"===h)c=function(b,c){return ab(b,c,a,f)};else if("object"===h){var i=Object.keys(a),j=i.length;c=function(b,c){for(var d=0,e=0;d<j;d++)if(0!==(e=ab(b,c,i[d],a[i[d]]^f)))return e;return e}}else c=function(b,c){return a.call(this,b,c)*(f?-1:1)};return Ta.call(g,c),!e&&g.trigger("sort",g),g},eq:function(a){return this[a]},get:function(a){return null==a?void 0:this._index[a.cid||a[this.Model.fn.idAttr]||a]},getSafe:function(a){var b=this.get(a),c=this.Model.all._safedStore;return void 0===b&&void 0===(b=c[a=a&&(a[this.Model.fn.idAttr]||a)])&&(b=new this.Model({id:a}),c[a]=b),b},create:function(a,b){var c=this._prepareModel(a);return this.set([c],b),c},set:function(a,b){var c,d,e,f,g,h,i,j=new C.Event("add"),k=this._index,l=this.length,m=!1,n=!0,o=!1,p=!1,q=!1,r={},s=!!this.comparator,t=!1;if(h=(a=a&&a.slice?a.slice():[]).length,b&&(i=b.rev,m=b.clone,n=!1!==b.merge,o=b.reset,p=b.silent||!0===b,void 0!==b.sort&&(s=b.sort),r.rev=i,r.sync=b.sync,r.clean=b.clean),o){for(g=Va.call(this,0,l),c=l,q=o=l>0||h>0;c--;)g[c].off($a,this);l=0,k=this._index={}}for(c=0,d=h;c<d;c++)this._changed=!1,this._changing=!0,e=(f=this._prepareModel(a[c],r)).cid,q=q||this._changed,a[c]=f,void 0===k[e]&&(k[e]=f,null!==f.id&&(k[f.id]=f),void 0!==this._addToIndex&&this._addToIndex(f),q=!0,this[l]=f,this.length=++l,f.on($a,this),p||(j.list=this,j.target=f,this.trigger(j,f))),"preset"===s&&this[c]!==f&&(t=!0,this[this.indexOf(f)]=this[c],this[c]=f);if(!1===n)for(c=l;c--;)-1===a.indexOf(this[c])&&(q=!0,this.remove(this[c]));return q&&!0===s&&!t&&(t=!0,this.sort(null,{silent:!0})),this._changing=!1,p||(t&&this.trigger("sort",this),o&&this.trigger({type:"reset",models:this,previousModels:g},this),(t||q)&&(this._debounceTriggerUpdate.cancel(),this.trigger("update",this))),m?new this.constructor(a):this},toArray:function(){return Ua.call(this)},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},slice:function(a,b){for(var c=void 0===a?this:Ua.call(this,a,void 0===b?this.length:b),d=c.length,e=new this.constructor(null,!0);d--;)e[d]=c[d];return e.length=c.length,e},reset:function(a,b){return!0===(b=b||{})&&(b={silent:!0}),b.reset=!0,b.clone=!1,this.set(a,b)},remove:function(a){var b,c=Wa.call(this,a);return-1!==c&&(a.off($a,this),Va.call(this,c,1),delete this._index[a.id],delete this._index[a.cid],(b=new C.Event("remove")).list=this,b.target=a,this.trigger(b,a),!0!==this._changing&&this._debounceTriggerUpdate()),this},save:function(a,b,c){return Ma.batch(function(){this.each(function(d){d.save(a,b,c)})}.bind(this))},drop:function(a){return Ma.batch(function(){this.each(function(b){b.remove(a)})}.bind(this))},destroy:function(){for(var a=this.length;a--;)this[a]&&this[a].destroy();return this},fetch:function(a,b){b=b||{};var c=this,d=c.Model,e=d.all,f={},g=d.fetchData(a,null,b.force,f).then(function(a){return b||(b={}),b.rev=f.rev,!c.local&&e.set(a,{rev:f.rev}),c[b.reset?"reset":"set"](a,b),c}).catch(Q.fail(function(a){c.emit("error",a)}));return g.list=c,g},clone:function(){return this.slice()}},bb.fn.forEach=bb.fn.each,bb.fn.where=bb.fn.filter,bb.fn.findWhere=bb.fn.find,C.apply(bb.fn),Oa.apply(bb),bb.addIndex=function(a,b){var c=this.fn._indexes;c||(c=this.fn._indexes=[]),c.push({attr:a,uniq:b}),this.fn._addToIndex=Function("model",c.map(function(a){var b=_a(a.attr),c=b.indexOf(".")>-1?"model.get("+b+")":"model.attributes["+b+"]";if(a.uniq)return"this._index["+c+"] = model;";throw"todo: Нужно думать"}).join("\n"))},bb.pluck=function(a,b){return bb.fn.pluck.call(a,b)},bb.version="0.14.0";var cb=C.Event,db={}.toString,eb=JSON.stringify,fb=function(a){return null===a?"null":db.call(a).toLowerCase().slice(8,-1)},gb=1;function hb(a,b){var c,d,e=a;if(!0!==b&&a instanceof Array)for(c=a.length,e=[];c--;)e[c]=hb(a[c]);else if(!0===b||a instanceof Object)if(void 0!==a.toJSON)e=a.toJSON();else for(d in e={},a)e[d]=hb(a[d]);return e}var ib=function a(b,c,d,e,f,g,h){var i=b.scheme[e];if("set"===i)for(var j in d[f]=hb(c,!0),g)a(b,c[f],d[f],e+"."+f,j,g[j],h);else"model"===i?d[f]=b.nested[e].all._prepareModel(g,{rev:h}):"model.list"===i?d[f]=new b.nested[e](g,!1,{rev:h}):(d[f]=g,null!=h&&(b.revs[e]=h))},jb={reset:!0},kb=function a(b,c,d,e,f,g,h){var i=!1,j=c.lastIndexOf("."),k=b.attributes,l=b._attributes,m=k[d];if(-1!==j&&(d=c.substr(j+1),m=b.get(c)),void 0!==b.nested[c]){var n=jb;b.nestedMergeStrategy.hasOwnProperty(c)&&(n=b.nestedMergeStrategy[c]),n.rev=h,b.get(c).set(e,n)}else if("set"===b.scheme[c])for(var o in e)a(b,c+"."+o,o,e[o],f,g,h);else if(mb(m,e)){if(c!==d)for(var p,q,r=c.split("."),s=0,t=r.length-1;s<t;s++){if(void 0===k[p=r[s]]&&(k[p]={}),void 0===l[p]&&(l[p]={}),void 0===f[p]&&(f[p]={}),k=k[p],l=l[p],f=f[p],void 0!==k.set)return void k.set(r.slice(s+1).join("."),e,{reset:!0,rev:h});q=void 0===q?p:q+"."+p,void 0===g.byKey[q]&&(g.byKey[q]=k,g.push(q))}var u=null==h||pb(b.revs,c,h);(i=null!=h&&qa.active&&qa.contains(b,c))?u&&(void 0===b.shadowRevs&&(b.shadowRevs={},b.shadowChanges={}),pb(b.shadowRevs,c,h)&&(b.shadowRevs[c]=h,b.shadowChanges[c]=e)):u&&(l[d]=m,k[d]=e,f[d]=e,g.push(c),g.byKey[c]=e,qa.active&&qa.touch(b,c))}null!=h&&!i&&pb(b.revs,c,h)&&(b.revs[c]=h)};function lb(a,b,c){for(var d=a.length;d--;){var e=a[d],f=e.attr;if(b.push(f),b.byKey[f]=e.changes,f.indexOf(".")>-1){for(var g=f.split("."),h=g.length-1,i=c,j=0;j<h;j++)i=void 0===i[g[j]]?i[g[j]]={}:i[g[j]];i[g[h]]=e.changed}else c[f]=e.changed;for(var k=e.changes,l=0,m=k.length;l<m;l++){var n=f+"."+k[l];b.push(n),b.byKey[n]=k.byKey[k[l]]}}}function mb(a,b){if(a===b)return!1;var c,e=d(b);if("string"===e||"number"===e||"boolean"===e)return a!=b;if(d(a)===e){if(null===a)return!0;if(b instanceof Array){if(c=b.length,a.length!==c)return!0;for(;c--;)if(mb(a[c],b[c]))return!0}else if(b instanceof Object){var f,g=Object.keys(b);if(c=g.length,Object.keys(a).length!==c)return!0;for(;c--;)if(mb(a[f=g[c]],b[f]))return!0}return!1}return!0}function nb(a,b){return function(c){var d,e,f=this[a],g=this.scheme,h=this.nested,i=f[c=this.shortcuts[c]||c];if(null!==this.__beforeGet__&&this.__beforeGet__(this,c),void 0===i&&-1!==c.indexOf("."))if(d=(c=c.split("."))[0],e=c.length,void 0!==h[d])i=f[d],i="model.list"===g[d]?2===e?i[c[1]]:i[c[1]].get(c.slice(2).join(".")):i.get(2===e?c[1]:c.slice(1).join("."));else if(2===e)i=f[d]&&f[d][c[1]];else{for(var j=0,k=e-1;j<k;j++){if(null==(f=f[d=c[j]]))return!b&&void 0;if(void 0!==f.get)return void 0!==f.Model?(i=f[c[j+1]],j+2<=k&&(i=i.get(c.slice(j+2).join("."))),b?!!i:i):(i=f.get(c.slice(j+1).join(".")),b?!!i:i)}i=f[c[k]]}return b?!!i:i}}function ob(a,b,c,d){var e=c.length,f=new cb(a);for(f.target=b,f.changes=c,f.allChanged=d;e--;){var g=c[e];f.attr=g,f.type=a+":"+g,f.changed=c.byKey[g],b.emit(f.type,[f,b])}f.type=a,f.attr=void 0,f.changed=d,b.emit(f.type,[f,b])}function pb(a,b,c){return!a.hasOwnProperty(b)||c>a[b]}function qb(a,b){var c,e,f,g=this.valueValidator,h=this.attributes={},i=this.defaults;if(void 0!==b&&(f=b.rev),this.revs={},this.cid="c"+gb++,this.changed={},this._attributes={},a)for(c in a)e=a[c],null!==g&&(e=g(e,c,a,this)),ib(this,i[c],h,c,c,e,f);for(c in i)h.hasOwnProperty(c)||(null!==(e=i[c])&&"object"===d(e)&&(e=hb(e)),h[c]=e);if(void 0!==h[this.idAttr]&&(this.id=h[this.idAttr]),void 0!==this._activateNested&&this._activateNested(h),void 0!==this._updateGetters&&this._updateGetters(h,h),this.getters){var j=this,k=function(a){var b=j[a];return{configurable:!1,enumerable:void 0!==j.defaults[a],get:function(){return b},set:function(a){b=a}}};Object.defineProperties(this,this.__propertyDescriptorMap__),Object.defineProperties(this,{id:k("id"),cid:k("cid"),revs:k("revs"),attributes:k("attributes"),_attributes:k("_attributes"),changed:k("changed"),__emList:k("__emList"),_changing:k("_changing"),_nestedChanges:k("_nestedChanges")})}}qb.fn=qb.prototype={constructor:qb,__beforeGet__:null,className:"Model",cid:null,id:null,idAttr:"id",nested:{},nestedMergeStrategy:{},scheme:{},defaults:{},required:[],getters:!1,triggers:{},valueValidator:null,changed:{},alwaysSendAllAttributes:!1,_attributes:{},shortcuts:{},request:da,storage:null,url:"",findUrl:"",findOneUrl:"",addUrl:"",saveUrl:"",removeUrl:"",_changing:!1,is:nb("attributes",!0),get:nb("attributes"),previous:nb("_attributes"),_callTrigger:function(a,b){var c=this.triggers[a];c&&c.call(this,b)},_nestedHandleEvent:function(a,b){var c=b.type,d=b.changed||b.target,e=b.changes;if("update"===c&&(c="change"),void 0===e&&((e=[a]).byKey={},e.byKey[a]=d),this._changing&&"change"===c)void 0===this._nestedChanges&&(this._nestedChanges=[]),this._nestedChanges.push({attr:a,changed:d,changes:e});else if("add"===c||"remove"===c){var f=new cb({type:c+":"+a,attr:a,list:b.list,target:b.target});this.emit(f.type,[f,this])}else{var g={},h=[];h.byKey={},lb([{attr:a,changed:d,changes:e}],h,g),ob(c,this,h,g)}},set:function(a,b,c){var e,f,g,h,i=[],j=this.changed,k=this.valueValidator,l=!1;for(a in this._changing=!0,"object"===d(a)?(e=a,c=c||b):(e={})[a]=b,c instanceof Object?(g=c.sync,f=c.silent,h=c.rev,i=c.changes||i,l=c.resetChanged,c.clean&&(j={})):f=!0===c,i.byKey={},void 0!==e[this.idAttr]&&(this.id=e[this.idAttr]),g&&this._setRequired&&this._setRequired(e),e)b=e[a],a=this.shortcuts[a]||a,null!==k&&(b=k(b,a,e,this)),kb(this,a,a,b,j,i,h);return void 0!==this._nestedChanges&&lb(this._nestedChanges,i,j),void 0!==this._updateGetters&&i.length>0&&this._updateGetters(j,e),i.length>0&&!f&&ob("change",this,i,j),this._changing=!1,this._nestedChanges=void 0,l&&(this.changed=j),this},increment:function(a,b,c){return(1==arguments.length||b instanceof Object)&&(c=b,b=1),b=parseInt(b,10),Number.isNaN(b)?this:this.set(a,this.get(a)+b,c)},toJSON:function(a){var b=this.attributes;return a?b:hb(b,!0)},isNew:function(){return null===this.id},queue:function(a){var b=O.meta(-2),c=this,d=function(){if(c.removed){var d=new Error("MODEL_REMOVED");return d.model=c,Promise.reject(d)}return a(c,b)};return this._queue||(this._queue=new Promise(function(a){a()})),this._queue=this._queue.then(d,d),this._queue},isDataFully:function(){return!0},hasChanged:function(a){if(a)return this.changed[a];for(var b in this.changed)if(this.changed.hasOwnProperty(b))return!0;return this.isNew()},fetch:function(a){return(a=a||{})[this.idAttr]=this.id,this.constructor.findOne(a)},parse:function(a,b,c){return a},prepareSendData:function(a,b){return b},save:function(a,b,c){return a&&this.set(a,b,c),this.queue(function(a,b){if(a.hasChanged()){var c=a.isNew(),d=a[c||a.alwaysSendAllAttributes?"attributes":"changed"],e=a.addUrl&&c?"add":"save",f=a.constructor.url(e,a.attributes),g=a.changed;return a._callTrigger(c?"beforeadd":"beforeupdate",d),a._callTrigger("beforesave",d),c||(d[a.idAttr]=a.id),d=a.prepareSendData(e,d),a.changed={},a.storage&&a.storage.update(a.toJSON()),a.request.post(f,d,{logger:a.className+".save",loggerMeta:b}).then(function(b){var e=a.parse(b.body,b);return e&&a.set(e,{clean:!0,sync:!0}),a.constructor.all.set([a]),a.trigger("sync",a),a._callTrigger(c?"add":"update",d),a._callTrigger("save",d),a}).catch(Q.fail(function(){a.changed=g}))}return a})},remove:function(a){return this.queue(function(b,c){return(a=a||{})[b.idAttr]=b.id,a=b.prepareSendData("remove",a),b._callTrigger("beforeremove",a),b.request.call(b.constructor.url("remove",b),a,{logger:b.className+".remove",loggerMeta:c,type:"DELETE"}).then(Q.done(function(){b.removed=!0,b.trigger({type:"remove",model:b},b),b.destroy(),b._callTrigger("remove",a)}))})},destroy:function(){var a=this;a.destroyed||(a.destroyed=!0,a.storage&&a.storage.remove(a.id),a.trigger({type:"destroy",model:a},a),a.off(),void 0!==a._deactivateNested&&a._deactivateNested(a._nestedList),a._nestedList=[])},meta:function(a,b){var c=this._meta,e=arguments.length;if(void 0!==c&&null!==a||(this._meta=c=P({})),0===e)return c;if(2===e)c.set(a,b);else if(1===e){if("object"!==d(a))return c.get(a);c.set(a)}return this},expire:function(){return this.expired=!0,this}},qb.extend=function(a){var b=Oa(this,a),c=b.fn,d=c.scheme={},e=c.nested={},f=c.defaults,g=c.required,h=c.getters;a.List?(b.List=a.List,b.List.prototype.Model=b):b.List=b.List.extend({Model:b}),b.all=new b.List,b.all.local=!0,f&&function a(b,c){var f=Object.keys(b);f.length?(c=c?c+".":"",f.forEach(function(f){var g=b[f];f=c+f,g instanceof Object?g instanceof qb?(e[f]=g.constructor,d[f]="model"):g instanceof bb?(e[f]=g.constructor,d[f]="model.list"):g instanceof Array?d[f]="array":(d[f]="set",a(g,f)):d[f]=fb(g)})):d[c]=fb(b)}(f),g.length&&(c._setRequired=function(a){var b=a.length,c=a.map(function(a){var b=a.split(".");return{key:b[0],key2:b[1],path:b,len:b.length}});return function(a){for(var d=b,e=this.defaults;d--;){var f,g=c[d];switch(g.len){case 1:void 0===a[f=g.key]&&(a[f]=hb(e[f]));break;case 2:f=g.key;var h=g.key2;void 0===a[f]&&(a[f]={}),void 0===a[f][h]&&(a[f][h]=hb(e[f][h]));break;default:for(var i=g.path,j=a,k=e,l=0,m=g.len-1;l<m;l++)void 0===j[f=i[l]]&&(j[f]={}),j=j[f],k=k[f];void 0===j[f=i[l]]&&(j[f]=hb(k[f]))}}}}(g));var i=Object.keys(e);if(i.length){var j=function(a,b){var c=[];return{list:c,activate:function(d){var e=this,f=b.reduce(function(b,f){for(var g=("model"===a[f]?"change":"update")+" add remove destroy reset",h=e.nested[f],i=function(a){e._nestedHandleEvent(f,a)},j=d,k=f.split("."),l=0,m=k.length-1;l<m;l++)j=j[k[l]];var n=k[l];return j[n]=(h.map?h.map(j[n]):new h(j[n])).on(g,i),c.push(function(){j[n].off(g,e["_nested:"+f])}),b["_nested:"+f]={configurable:!1,writable:!1,enumerable:!1,value:i},b},{});Object.defineProperties(e,f)},deactivate:function(a){for(var c=b.length;c--;)a[c]();a=[]}}}(d,i);c._activateNested=j.activate,c._deactivateNested=j.deactivate,c._nestedList=j.list}else c._activateNested=void 0,c._deactivateNested=void 0;return h&&(!0===h&&(h={},Object.keys(f).forEach(function(a){h[a]=null})),c.__propertyDescriptorMap__=Object.keys(h).reduce(function(a,b){if(c.hasOwnProperty(b))throw"Unable to create a getter `"+b+"`, this key is already in use";var d=h[b],e="function"==typeof d,f="function"==typeof c[d];return a[b]={configurable:!0,enumerable:!0,get:function(){return e?d.call(this):f?this[d]():this.get(d||b)},set:function(a){}},a},{})),b},qb.List=bb,qb.List.fn.Model=qb,qb.all=new bb,qb.all.local=!0,qb.create=function(a){return this.all.create(a)},qb.set=function(a,b){return this.all.set(a,b)},qb.get=function(a){return this.all.get(a)},qb.getSafe=function(a){return this.all.getSafe(a)},qb.mock=function(a){for(var b in a)for(var c,d,e=[].concat(a[b]),f=0,g=e.length;f<g;f++)c=this.url(b,e[f].query||{}),d="add"==b?new this(e[f].query).toJSON():e[f].query,this.fn.request.mock({url:c,once:e[f].once,type:/^find/.test(b)?"GET":/remove/.test(b)&&!this.fn.request.setup("emulateHTTP")?"DELETE":"POST",data:/^(add|save|remove)$/.test(b)?this.fn.prepareSendData(b,d):d,status:e[f].status,body:e[f].body,headers:e[f].headers,responseTime:e[f].responseTime,responseText:e[f].result})},qb.url=function(a,b){var c=this.fn[a+"Url"]||this.fn.url;return"function"==typeof c&&(c=c.call(this.fn,b)),String(c).replace(/:([a-z_]+)/g,function(a,c){return b[c]||""}).replace(/([^$\/])\/+/g,"$1/")},qb.fetchData=function(a,b,c,d){var e,f=O.meta(-2),g=this,h=g.fn.storage,i=b?"findOne":"find",j=function(){var b=g.url(i,a);return g.fn.request.get(b,a,{logger:g.fn.className+"."+i,loggerMeta:f,dataType:"json"}).then(function(b){d&&(d.rev=b.rev);var c=g.fn.parse(b.body,b,i);return h&&h.save(i,a,c),c})};return a=a||{},(e=h&&!c?O.wrap("[["+g.fn.className+".storage."+i+"]]",a,h[i](a)).catch(j):j()).__logger__&&(e.__logger__.meta=f),e.__noLog=!0,e},qb.find=function(a,b){return(new this.List).fetch(a,b)},qb.findOne=function(a){var b,c,d,e=this,f=e.fn.idAttr,g=!(!e.fn.findOneUrl&&!e.fn.url);if(null==a||a instanceof Object?a=a||{}:(c=a,(a={})[f]=c),c=a[f],eb(a),(b=e.all.get(c))&&!b.expired&&b.isDataFully(a))d=Promise.resolve(b);else{var h={};d=this.fetchData(g?a:{},g,!1,h).then(function(d){return g&&null!=c||(d=null==c?d instanceof Array?d[0]:d:d.filter(function(a){return a[f]==c})[0]),d?((b=e.all.getSafe(d[f])).expired=!1,b.set(d,{clean:!0,query:a,sync:!0,rev:h.rev}),e.all.set([b],{rev:h.rev}),b):Promise.reject(new Error("MODEL_NOT_FOUND"))})}return d},qb.save=function(a){return new this(a).save()},qb.map=function(a){var b=this.all.set([].concat(a),{clone:!0});return a instanceof Array?b:b[0]},qb.observe=function(a,b,c){c||(b instanceof Function&&(c=b),b=this.all),b instanceof Array||b instanceof bb||(b=[b]),a=a||"log";var d=function(b,d){d.forEach(function(c){var d=c.name,e=""===b?this[d]:this.get((b.indexOf(".")>0?b.substr(b.indexOf(".")+1)+".":"")+d);console[a](this.className+"("+this.id+")"+(b?"."+b:"")+".{"+d+"} is "+("add"===c.type?"added":"updated")+": {"+c.oldValue+"} → {"+e+"}")},this),c&&c(this,a,type,d)};b.forEach(function(a){Object.observe(a,d.bind(a,"")),function b(c,e){e instanceof Object&&!e.set&&(Object.observe(e,d.bind(a,c.join("."))),Object.keys(e).forEach(function(a){b(c.concat(a),e[a])}))}(["attributes"],a.attributes)})},C.apply(qb.fn),qb.notEqual=mb,qb.version="0.15.0";var rb=qb.extend({request:Ma}),sb=function a(b){var c,e=b;if(b&&"object"===d(b))if(b.toLogJSON)e=b.toLogJSON();else if(b instanceof qb)e=b.id;else if(b instanceof bb)e=b.pluck("id");else if(b&&b.nodeType)e="FORM"===b.nodeName?A.serializeArray(b):b.value||b.textContent;else if(Array.isArray(b))for(c=b.length,e=[];c--;)e[c]=a(b[c]);else e={},Object.keys(b).forEach(function(c){e[c]=a(b[c])});return e},tb=Oa(C,{name:"abstract",constructor:function(a,b){return this.params=a,this.options=b,this._data,this.pending=!1,this.status,this.error=null,this.result=null,this.active=0,b.logScope.call(this._execute.bind(this))},_execute:function(){var a=this,b=a.params,c=a.options,d=c.logScope;a.pending=!0,c.silent||(tb.active++,tb.trigger("start",[a,b,c]));var e=qa.start();return new Promise(function(d){d(a.prepare(b,c))}.logger(a.name+".prepare")).then(function(f){return null===f?(d.add("operation:exit"),a._resolve("done",f),a):(void 0===f&&(f=b),a._data=f,new Promise(function(d){a.trigger("operation",[f,b,c]),d(a.operation(f,b,c))}.logger(a.name+".operation")).then(function(b){return e.commit(),d.add("operation:done"),a._resolve("done",b),a},function(b){return e.rollback(),d.add("operation:fail",b),a.rollback(),a._resolve("fail",b),Promise.reject(a)}))},function(b){return d.add("prepare:fail",b),a._resolve("fail",b),Promise.reject(a)})},undo:function(){var a,b=this,c=[b._data,b.params,b.options],d=b._undoPromise;return d||(a=O.scope("[["+b.name+".undo]]"),b._undoPromise=d=new Promise(a.wrap(function(a){b.trigger.apply(b,["undo"].concat(c)),!b.options.silent&&tb.trigger.apply(b,["undo",b].concat(c)),a(b.undoOperation.apply(b,c))})),d.then(b._resolveUndo.bind(b,a,!0),b._resolveUndo.bind(b,a,!1))),d},prepare:function(a,b){},operation:function(a,b,c){},undoOperation:function(a,b,c){throw O.add("NOT_IMPLEMENTED"),"NOT_IMPLEMENTED"},rollbackOperation:function(a,b,c){O.add("NOT_IMPLEMENTED")},rollback:function(){var a=this,b=a.options;b.logScope.call("[["+a.name+".rollback]]",function(){try{a.rollbackOperation(a._data,a.params,b)}catch(a){O.add("error",a)}})},_resolve:function(a,b){var c=this.options;c.silent||tb.active--,this.pending=!1,this.status=a,this["done"==a?"result":"error"]=b,this.trigger(a,b),this.trigger("complete",[this,a,b]),c.silent||(tb.trigger(a,[this,b]),tb.trigger("complete",[this,a,b]))},_resolveUndo:function(a,b,c){var d=[this,b,c];a.add("undo:"+(b?"done":"fail"),b?void 0:c),this.trigger("undo:complete",d),!this.options.silent&&tb.trigger("undo:complete",d)},emit:function(a,b){var c=this.options;return c["on"+a]&&c["on"+a].apply(this,b),C.fn.emit.apply(this,arguments)}});C.apply(tb),tb.register=function(a,b){return this[a]=b,b.prototype.name=a,b.execute=function(b,c){return tb.execute(a,b,c)},b},tb.execute=function(a,b,c){var d=this[a],e=O.scope("[[Action:"+a+"]]",sb(b)),f="ACTION_NOT_FOUND:"+a;return d||e.add(f),(c=c||{}).logScope=e,d?new d(b,c):Promise.reject(f)},tb.waitFor=function(a,b){var c=new C.Event(a);return tb.trigger(c,[].concat(this,b)),null!=c.result?c.result.then?c.result:Q.cast(c.result):Promise.reject()},tb.active=0,tb.version="0.2.0";var ub={mk3d:"mkv",mka:"mkv",mks:"mkv",matroska:"mkv",hpp:"h",hh:"h",cc:"c",cxx:"c",ru:"rb",djvu:"djv",xlsb:"xlsx",xlsm:"xlsx",cbz:"cbr",cbt:"cbr",cba:"cbr",cb7:"cbr",mml:"mathml",mht:"mhtml",odi:"odg",oti:"odg",odf:"odg",otf:"odg",odm:"odg",oth:"odg",odg:"odg",otg:"odg"},vb={htm:"html",html:"html",mhtml:"html",mathml:"html",webp:"picture",jpg:"picture",jpeg:"picture",jpe:"picture",heic:"picture",gif:"picture",bmp:"picture",tif:"picture",tiff:"picture",png:"picture",psd:"picture",tga:"picture",flv:"video",wmv:"video",wmx:"video",mpg:"video",mpeg:"video",ogv:"video",webm:"video","3gp":"video",mov:"video",asf:"video",asx:"video",mp4:"video",mp4v:"video",avi:"video",mkv:"video",m4v:"video",mng:"video",qt:"video",ogg:"audio",ram:"audio",midi:"audio",wav:"audio",oga:"audio",aiff:"audio",flac:"audio",m4a:"audio",wma:"audio",mp3:"audio",arj:"archive",zipz:"archive",bz2:"archive",dmg:"archive",gz:"archive","7z":"archive",rar:"archive",tar:"archive",tgz:"archive",zip:"archive",c:"source",h:"source",cpp:"source",hpp:"source",pl:"source",pm:"source",t:"source",py:"source",php:"source",xml:"source",js:"source",vbs:"source",p:"source",pas:"source",rake:"source",rb:"source",asm:"source",masm:"source",css:"source",log:"text",txt:"text",lng:"text",msg:"email",eml:"email",exe:"exec",com:"exec",msi:"exec",pdf:"pdf",pages:"text",doc:"document",docx:"document",rtf:"document",wps:"text",wpd:"text",odt:"text",ott:"text",numbers:"spreadsheet",xls:"spreadsheet",xlsx:"spreadsheet",xlsm:"spreadsheet",csv:"spreadsheet",ods:"spreadsheet",ots:"spreadsheet",keynote:"presentation",key:"presentation",ppt:"presentation",pptx:"presentation",pps:"presentation",ppsx:"presentation",odp:"presentation",otp:"presentation",odc:"chart",otc:"chart",epub:"ebook",fb2:"ebook",djv:"ebook",cbr:"ebook",md:"markdown",json:"json",apk:"android-package",ics:"calendar",vcf:"vcard",pls:"playlist",m3u:"playlist",wpl:"playlist",xspf:"playlist",qtl:"playlist",rss:"web-feed"},wb={pdf:"pdf",source:"source","plain-text":"document",text:"document",chart:"document",spreadsheet:"document",presentation:"document",picture:"image",markdown:"light-markup",json:"light-markup"},xb={extensionAliases:ub,extToPrimitiveKind:vb,primitiveKindToKind:wb,extTypes:g.simpleExtensions,getExtByName:function(a){var b=null==a?[]:(a+"").split(".");return b[b.length-1]||""},getKinds:function(a,b){var c=(a+"").toLowerCase(),e=vb[a=ub[c]||c]||"unknown",f=wb[e]||"file";if("file"!=f&&"object"===d(b)&&b&&(b=b[f],Array.isArray(b))){for(var g=!1,h=b.length;h--;)if(b[h]==c){g=!0;break}g||(f="file")}return{primitiveKind:e,kind:f}},getContentType:function(a){return g.getContentType(a)},version:"0.4.0"},yb={parse:function(a){var b={url:a,query:{},base:null};if(!a||"string"!=typeof a)return b;var c=a.split("?"),d=c[1];if(b.base=c[0],!d)return b;var e=d.split("&"),f={};return e.forEach(function(a){var b=a.split("="),c=b[0],d=b[1];c&&(f[c]=d||1)}),b.query=f,b},serialize:function(a){if(!a.url||"string"!=typeof a.url)return a.url;if(!a.query||!a.base)return a.url;var b=Object.keys(a.query).map(function(b){return b+"="+a.query[b]}).join("&");return b?[a.base,b].join("?"):a.base},version:"0.1.0"},zb=/^(folder|storage|camera-upload|shared|mounted|domain-folder)$/,Ab=rb.extend({className:"cloud.Entry",findUrl:"cloud/folder",findOneUrl:"cloud/file",defaults:{id:null,folder:"",name:"",mimetype:"",kind:"",size:0,count:{sub_folders:0,files:0},mtime:0,hash:"",thumbnails:{"26x26":"","52x52":"","160x120":"","320x240":"","1200x1200":"",original:""},url:{web:"",get:"",view:""},virus_scan:""},parse:function(a,b,c){if("findOne"===c){if(a[0])return a[0];throw new Error("Неверный формат ответа")}return this.meta=Object.assign({},a),a.list},getExtension:function(){var a=xb.getExtByName(this.get("name"));return a?a.toLowerCase():"unknown"},getParentId:function(){return this.get("folder")},isFolder:function(){return zb.test(this.get("kind"))},isFile:function(){return!this.isFolder()},isArchive:function(){return this.isFile()&&this.getKind().primitiveKind===Ab.KIND_ARCHIVE},isEmpty:function(){return this.isFile()?0===this.get("size"):!(this.is("count.sub_folders")||this.is("count.files"))},isVirus:function(){return this.get("virus_scan")===Ab.VIRUS_SCAN_FAIL},isNotVirus:function(){return this.get("virus_scan")===Ab.VIRUS_SCAN_PASS},isCameraFolder:function(){return this.get("kind")===Ab.KIND_CAMERA_UPLOAD},isMounted:function(){return this.get("kind")===Ab.KIND_MOUNTED},isRoot:function(){return this.id===Ab.PATH_DIVIDER},isHome:function(){return this.get("storage")===Ab.STORAGE_HOME},isLinks:function(){return this.get("storage")===Ab.STORAGE_LINKS},isShared:function(){return this.get("storage")===Ab.STORAGE_SHARED},isSharedFolder:function(){return this.isFolder()&&this.isShared()},isMountedFolder:function(){return this.isFolder()&&this.isMounted()},getIcon:function(){return this.isVirus()?this.isFolder()?Ab.ICON_FOLDER_VIRUS:Ab.ICON_VIRUS:this.isFolder()?this.isMountedFolder()||this.isSharedFolder()?Ab.ICON_FOLDER_SHARED:Ab.ICON_FOLDER:this.getKind().primitiveKind},getKind:function(){return xb.getKinds(this.getExtension())},getPreview:function(a){return a=a||"52x52",this.get("thumbnails."+a)||""}});Ab.VIRUS_SCAN_PASS="pass",Ab.url=function(a,b){var c=rb.url.call(this,a,b);return"findOne"===a&&(c+="?ids="+encodeURIComponent(JSON.stringify([b.id]))),c},Ab.VIRUS_SCAN_FAIL="fail",Ab.VIRUS_SCAN_NOT_YET="not_yet",Ab.VIRUS_SCAN_SKIP="skip",Ab.KIND_CAMERA_UPLOAD="camera-upload",Ab.KIND_FOLDER="folder",Ab.KIND_STORAGE="storage",Ab.KIND_SHARED="shared",Ab.KIND_MOUNTED="mounted",Ab.KIND_ARCHIVE="archive",Ab.STORAGE_HOME="home",Ab.STORAGE_LINKS="links",Ab.STORAGE_SHARED="shared",Ab.ICON_FOLDER="folder",Ab.ICON_VIRUS="virus",Ab.ICON_FOLDER_VIRUS="folder-virus",Ab.ICON_FOLDER_SHARED="folder-shared",Ab.PATH_DIVIDER="/",Ab.STORAGE_HOME="home",Ab.STORAGE_LINKS="links",Ab.STORAGE_PUBLIC="public",Ab.STORAGE_FILES="files",Ab.version="0.3.0";var Bb=rb.extend({className:"mail.AttachSearch",findUrl:"/cgi-bin/filesearch_ajax",parse:function(a){return this.meta=a,a.list},isFileSearch:!0,getExtension:function(){var a=xb.getExtByName(this.get("name"));return a?a.toLowerCase():"unknown"}});Bb.version="0.1.0";var Cb=rb.extend({className:"mail.Attachment",findTemporaryUrl:"messages/attaches/temporary",defaults:{id:null,type:"attach",content_type:"",editors:{ms:{url:"",capabilities:[]}},flags:{image:!1,tnef:!1,mp3:!1,eml:!1,document:!1,archive:!1,stored:!1,unsafe:!1},name:"",formName:{value:"",color:[]},thumbnails:{image:{"160x120":"","206x154":"",default:""},text:{snippet:"",snippet_size:0},mp3:{player:""},html:"",eml:{subject:""}},href:{view:"",preview:"",download:"",video:""},size:0,scan:"",duedate:0,exif:{}},getName:function(){return this.get("name").split(".").slice(0,-1).join(".")},getExtension:function(){return xb.getExtByName(this.get("name")).toLowerCase()},getPrimitiveType:function(){var a=this.getExtension();return xb.extToPrimitiveKind[a]||a},getDownloadUrl:function(){var a=Ma.addXEmail(this.get("href.download"));return this.isCloud()&&(a="//cloud.mail.ru"+a),a},getPreviewUrl:function(){this.getExtension();var a=this.get("href.view");return a||(a=this.get("href.download").replace("&notype=1","")),!a||this.isLink()||this.isCloud()?"":a=Ma.addXEmail(a)},getBlobPreview:function(a,b){var c=this;return a=a||200,b=b||200,Cb.IMAGE_STOPTYPE_RE.test(c.get("content_type"))?Promise.reject("Skip blacklist images preview"):Cb.IMAGE_TYPE_RE.test(c.get("content_type"))?new Promise(function(d,e){f.Image(c.getBlob()).preview(a,b).get(function(a,b){a?e(a):d(b.toDataURL())})}):Promise.reject("No blob preview for non-image attachment")},getThumbnailUrl:function(a){var b="",c=this.get("href.download");if(Cb.THUMBNAIL_SIZES.includes(a)||a===Cb.THUMBNAIL_SIZE_ORIGINAL||a===Cb.THUMBNAIL_SIZE_DEFAULT||(a=Cb.THUMBNAIL_SIZE_L),this.isImage()&&(b=this.get("thumbnails.image")[a]||this.get("thumbnails.image.default")||this.get("thumbnails.image.original")),this.isImage()&&a===Cb.THUMBNAIL_SIZE_ORIGINAL){var d=yb.parse(this.get("thumbnails.image.default"));delete d.query.af_preview,d.query.full=1,b=yb.serialize(d)||b}if(this.isFromDocs()&&c){var e=a===Cb.THUMBNAIL_SIZE_DEFAULT?Cb.THUMBNAIL_SIZE_MM:a;b=this.get("thumbnails.image")[e]||Cb.DOCS_URL+e+"/?src="+encodeURIComponent(c)}return(this.isLink()||this.isCloud())&&(b=""),b&&(b=Ma.addXEmail(b)),b},getFileSearchAttachId:function(){return this.isFromAttachSearch()?this.get("part_id")?this.get("message_id")+";"+this.get("part_id"):this.get("message_id"):""},getRotateDegree:function(){var a=this.get("exif.Orientation");return a&&Cb.exifOrientationToDegrees[a]||null},getBlob:function(){return this._blob},setBlob:function(a){return this._blob=a,this},isBlob:function(){return this.get("type")===Cb.TYPE_FILE&&!!this._blob},isWinmail:function(){return!0===this.get("flags.tnef")},isUnsafe:function(){return!0===this.get("flags.unsafe")},isInline:function(){return this.get("content_id")&&(this.get("type")===Cb.TYPE_INLINE||this.get("type")===Cb.TYPE_FILE)},isLink:function(){return this.get("type")===Cb.TYPE_LINK},isCloud:function(){return this.get("type")===Cb.TYPE_CLOUD},isForward:function(){return this.get("type")===Cb.TYPE_FORWARD},isCloudStock:function(){return this.get("type")===Cb.TYPE_CLOUD_STOCK},isFromCloud:function(){return!!this.get("cloud_id")},isFromAttachSearch:function(){return!!this.get("message_id")},isFromDocs:function(){return Cb.DOCS_TYPES.includes(this.getExtension())},isPreviewFromDocs:function(){return Cb.DOCS_PREVIEW_TYPES.includes(this.getExtension())},isImage:function(){return"picture"===this.getPrimitiveType()},isOverMaxSize:function(){return this.get("size")>Cb.MAX_SIZE},isOverMaxLinkSize:function(){return this.get("size")>Cb.MAX_AS_LINK_SIZE},save:function(){return Promise.reject({message:'Save an attachment can only using "MessageFormData#addAttachment"'})},remove:function(){return Promise.reject({message:'Remove an attachment can only using "MessageFormData#removeAttachment"'})},isInfected:function(){return this.get("scan")===Cb.SCAN_TYPES.INFECTED}});A.extend(Cb,{TYPE_FILE:"attach",TYPE_LINK:"link",TYPE_CLOUD:"cloud",TYPE_FORWARD:"forward",TYPE_CLOUD_STOCK:"cloud_stock",TYPE_INLINE:"inline",R_INLINE_PART_ID:/(?:\?|&)id=([^&]+)/,R_NOTYPE:/notype(=1)?$/,MAX_SIZE:26214400,MAX_AS_LINK_SIZE:2147483648,THUMBNAIL_SIZE_ORIGINAL:"original",THUMBNAIL_SIZE_XS:"90x90",THUMBNAIL_SIZE_S:"160x120",THUMBNAIL_SIZE_M:"206x154",THUMBNAIL_SIZE_MM:"206x206",THUMBNAIL_SIZE_L:"305x230",THUMBNAIL_SIZE_DEFAULT:"default",THUMBNAIL_SIZES:["90x90","160x120","206x154","305x230"],DOCS_TYPES:["tga","psd","ai","eps","rtf","txt","csv","doc","docx","xls","xlsx","ppt","pptx","pdf"],DOCS_PREVIEW_TYPES:["tga","tif","tiff","psd","ai","eps"],DOCS_URL:"//docs.mail.ru/preview/",IMAGE_TYPE_RE:/^image\/(?!(x-)?(tif|bmp))/i,IMAGE_STOPTYPE_RE:/^image\/(vnd\.adobe\.photoshop|svg\+xml)/i,exifOrientationToDegrees:{1:0,3:180,6:90,8:270},SCAN_TYPES:{HEALTHY:"healthy",INFECTED:"infected",NOT_YET:"not_yet",ERROR:"error",TOOBIG:"toobig"}}),Cb.getMetaInfo=function(a,b){return a instanceof Ab||a instanceof Bb?b(null,{}):void f.getInfo(a,function(a,c){a?b(a,null):c&&c.exif?b(null,c):b(null,{})})},Cb._from=function(a){var b=new Cb;return a instanceof Ab?b.set({cloud_id:a.id,type:Cb.TYPE_CLOUD,name:a.get("name"),size:a.get("size"),content_type:a.get("mimetype")}):a instanceof Bb?b.set({type:Cb.TYPE_FORWARD,name:a.get("name"),size:a.get("size"),message_id:a.get("id"),folder_id:a.get("folder"),part_id:a.get("n").join(";")}):b.set({type:Cb.TYPE_FILE,name:a.name,size:a.size||0,content_type:a.type}).setBlob(a),b},Cb.from=function(a){var b=Cb._from(a);return Cb.getMetaInfo(a,function(a,c){a||b.set(c)}),b},Cb.fromAsync=function(a){return new Promise(function(b){var c=Cb._from(a);Cb.getMetaInfo(a,function(a,d){a||c.set(d),b(c)})})},Cb.findTemporary=function(a){return Ma.call(Cb.url("findTemporary"),a).then(function(a){return Cb.map(a.body)})},Cb.getMaxAttachSize=function(){return Math.max(Cb.MAX_SIZE,Cb.MAX_AS_LINK_SIZE)},Cb.List.Local=Cb.List.extend({local:!0}),Cb.version="0.4.1";var Db=rb.extend({className:"mail.Alias",defaults:{alias:""},findUrl:"aliases",addUrl:"aliases/add",removeUrl:"aliases/remove",saveUrl:"aliases/edit",alwaysSendAllAttributes:!0,canSendLetters:function(){return!0},getEmail:function(){return this.get("alias")},getOwnerFullName:function(){return null},isShared:function(){return!1},isAnonymous:function(){return!this.meta("isPDD")&&!this.is("permanent")},isPermanent:function(){return this.is("permanent")}});Db.version="0.2.0";var Eb=/^(extra_auth|pause|auth_error)$/,Fb=qb.extend({className:"mail.Collector",defaults:{email:"",state:"",type:"",owner:null},canSendLetters:function(){return!Eb.test(this.get("state"))},getEmail:function(){return this.get("email")},getOwnerFullName:function(){var a=this.get("owner");return a?A.calculateFullName({first:a.first_name,last:a.last_name}):null},isShared:function(){return"shared"===this.get("type")},isAnonymous:function(){return!1},isPermanent:function(){return!1}});Fb.version="0.2.0";var Gb,Hb=rb.extend({findOneUrl:"messages/replies/smart",defaults:{replies:null}});Hb.version="0.1.0";try{Gb=window.localStorage}catch(a){}var Ib=Oa({disabled:!1,constructor:function(a,b){this.name=a,this.idAttr=b||"id",this.inited=!1,window.addEventListener("beforeunload",this._store.bind(this))},_initStorage:function(){this.inited||(this.inited=!0,this.clear(),this._restore())},_key:function(a,b){return a+":"+("string"==typeof b?b:JSON.stringify(b))},_addToIndex:function(a,b){var c=b[this.idAttr],d=this._index[c];void 0===d&&(d=this._index[c]={}),d[a]=!0},_restore:function(){return{}},_store:function(){},fetch:function(a,b){this._initStorage();var c=this._data[this._key(a,b)];return Promise[this.disabled||void 0===c?"reject":"resolve"](c)},find:function(a){return this.fetch("find",a)},findOne:function(a){return this.fetch("findOne",a).then(function(a){return a[0]})},save:function(a,b,c){if(!this.disabled){var d,e=this._key(a,b);for(this._initStorage(),this._data[e]=c=[].concat(c),d=c.length;d--;)this._addToIndex(e,c[d])}},update:function(a){this.remove(a[this.idAttr])},remove:function(a){this._initStorage();var b,c=this._index[a];if(c){for(b in c)delete this._data[b];delete this._index[a]}},setData:function(a,b){this.save("find",b||{},a)},clear:function(){this._data={},this._index={}}});Ib.Local=Ib.extend({_restore:function(){try{var a=Gb.getItem(this.name+"|"+Ma.setup().email);this._data=Object(JSON.parse(a))}catch(a){}},_store:function(){try{Gb.setItem(this.name+"|"+Ma.setup().email,JSON.stringify(this._data))}catch(a){}}}),Ib.version="0.1.3";var Jb=JSON.stringify,Kb=rb.extend({className:"mail.Folder",storage:new Ib("mail.folders"),findUrl:"folders",addUrl:"folders/add",saveUrl:"folders/edit",removeUrl:"folders/remove",openUrl:"folders/open",closeUrl:"folders/close",clearUrl:"folders/clear",collapseUrl:"folders/collapse",expandUrl:"folders/expand",shareInfoUrl:"folders/share/info",shareUrl:"folders/share",unshareUrl:"folders/unshare",defaults:{id:null,system:!1,type:"",name:"",parent:-1,open:!0,security:!1,messages_total:0,messages_unread:0,child:!1,children:!1,archive:!1,collapse:!1,only_web:!1},shortcuts:{unread:"messages_unread",messages:"messages_total"},triggers:{update:function(){this.meta("level",void 0)},save:function(){this.meta("level",void 0)}},isRoot:function(){return-1==this.get("parent")},isSubfolder:function(){return!this.isRoot()},isParent:function(){return this.is("children")},isEmpty:function(){return!this.get("messages")},isSecure:function(){return this.is("security")},isSecureOpen:function(){return this.is("open")},isSystem:function(){return this.is("system")},isArchive:function(){return this.is("archive")},isOnlyWeb:function(){return this.is("only_web")},isCollapse:function(){return this.is("collapse")},isRemovable:function(a,b){var c;void 0===a&&(a=!1),void 0===b&&(b={ignoreSharedPermissions:!1});var d=b.ignoreSharedPermissions,e=!this.isParent(),f=!a||this.isSecureOpen(),g=!this.isSystem()||this.isArchive(),h=!0;return!d&&this.isShareTake()&&(h=(null===(c=this.get("owner"))||void 0===c?void 0:c.can_remove)&&this.checkGrant(Kb.SHARE_GRANTS.remove_folder)),Boolean(f&&e&&g&&h)},isClearable:function(a){void 0===a&&(a={ignoreSharedPermissions:!1,ignoreSecure:!1});var b=a.ignoreSharedPermissions,c=a.ignoreSecure,d=this.get("messages_total")>0,e=c||this.isSecureOpen(),f=!0;return!b&&this.isShareTake()&&(f=this.checkGrant(Kb.SHARE_GRANTS.remove)),d&&e&&f},isMovable:function(a){var b;void 0===a&&(a={ignoreSharedPermissions:!1});var c=a.ignoreSharedPermissions,d=!this.isParent(),e=!this.isSystem(),f=!0;return!c&&this.isShareTake()&&(f=(null===(b=this.get("owner"))||void 0===b?void 0:b.can_move)&&this.checkGrant(Kb.SHARE_GRANTS.edit_folder)),Boolean(d&&e&&f)},isEditable:function(a){void 0===a&&(a={ignoreSharedPermissions:!1});var b=a.ignoreSharedPermissions,c=[Kb.TYPE_SPAM,Kb.TYPE_TRASH,Kb.TYPE_CHILD_TRASH],d=!this.checkInFolderTypes(c,!0),e=!0;return!b&&this.isShareTake()&&(e=this.canChangeName({ignoreSharedPermissions:b})||this.isMovable({ignoreSharedPermissions:b})),d&&e},isFlaggable:function(){return!this.isShareTake()||this.checkGrant(Kb.SHARE_GRANTS.mark_as_important)},canMoveLetters:function(){return!this.isShareTake()||this.checkGrant(Kb.SHARE_GRANTS.move)},canRemoveLetters:function(){return!this.isShareTake()||this.checkGrant(Kb.SHARE_GRANTS.remove)},canAddFilter:function(){return!this.isShareTake()||this.checkGrant(Kb.SHARE_GRANTS.add_filter)},isSharable:function(){return!(this.isShareTake()||this.isSecure()||this.isMetathread()||this.isOutbox())},canChangeName:function(a){void 0===a&&(a={ignoreSharedPermissions:!1});var b=a.ignoreSharedPermissions,c=!this.isSystem(),d=!0;return!b&&this.isShareTake()&&(d=this.checkGrant(Kb.SHARE_GRANTS.edit_folder)),c&&d},canAddSubfolder:function(a){var b;void 0===a&&(a=!1);var c=[Kb.TYPE_SPAM,Kb.TYPE_TRASH,Kb.TYPE_OUTBOX,Kb.TYPE_PARENTAL_CONTROL,Kb.TYPE_CHILD_TRASH],d=!this.checkInFolderTypes(c,!0),e=!0;if(this.isShareTake()){var f=!0;a||(f=this.checkGrant(Kb.SHARE_GRANTS.add_subfolder)&&(null===(b=this.get("owner"))||void 0===b?void 0:b.can_add_subfolder)),e=!this.isServiceShared()&&f}var g=this.getChildLevel()<this.getMaxChildLevel();return Boolean(d&&e&&g)},isInbox:function(){return this.get("type")==Kb.TYPE_INBOX},isSent:function(){return this.get("type")==Kb.TYPE_SENT},isDrafts:function(){return this.get("type")==Kb.TYPE_DRAFTS||this.get("type")==Kb.TYPE_TEMPLATES},isSpam:function(){return this.get("type")==Kb.TYPE_SPAM},isTrash:function(){return this.get("type")==Kb.TYPE_TRASH},isChildTrash:function(){return this.get("type")==Kb.TYPE_CHILD_TRASH},isTrashLike:function(){return this.isTrash()||this.isChildTrash()},isTemplates:function(){return this.get("type")==Kb.TYPE_TEMPLATES},isParentalControl:function(){return this.get("type")==Kb.TYPE_PARENTAL_CONTROL},isUser:function(){return this.get("type")==Kb.TYPE_USER},isSorted:function(){return this.isPromotions()||this.isSocial()||this.isNewsletters()||this.isNews()||this.isOfficial()},isPromotions:function(){return this.get("type")==Kb.TYPE_PROMOTIONS},isSocial:function(){return this.get("type")==Kb.TYPE_SOCIAL},isNewsletters:function(){return this.get("type")==Kb.TYPE_NEWSLETTERS},isToMyself:function(){return this.get("type")==Kb.TYPE_TOMYSELF},isNews:function(){return this.get("type")==Kb.TYPE_NEWS},isOfficial:function(){return this.get("type")==Kb.TYPE_OFFICIAL},isMetathread:function(){return Kb.isMetathread(this)},isCollector:function(){return this.is("collect")},isDeleted:function(){return this.get("type")===Kb.TYPE_DELETED},isOutbox:function(){return this.get("type")===Kb.TYPE_OUTBOX},isShareGive:function(){return this.get("share")===Kb.SHARE_GIVE},isShareTake:function(){return this.get("share")===Kb.SHARE_TAKE},isShared:function(){return this.is("share")},isServiceShared:function(){return this.isShareTake()&&this.isRoot()},isOwn:function(){return!this.isShareTake()},checkGrant:function(a){var b,c=this.get("owner");return!c||Boolean(null===(b=c.grants)||void 0===b?void 0:b[a])},transaction:function(a){return a?this.__copy=this.toJSON():delete this.__copy,this},rollback:function(){return this.__copy&&this.set(this.__copy),this.transaction(!1)},prepareSendData:function(a,b){return b="remove"==a?{ids:Jb([b.id]),ajax_call:1,api:1}:{folders:Jb([b])}},parse:function(a,b){return/folders\/(edit|add)/.test(b.url)&&a.length&&(a={id:a[0]}),/messages\/status/.test(b.url)&&(a=a.folders),a},toggleCollapse:function(a){return this.queue(function(b){return b.request.post(b.constructor.url(a?"collapse":"expand"),{ids:Jb([b.id])}).then(function(){return b.set("collapse",a,{clean:!0})})})},loadShareInfo:function(){return this.queue(function(a){return a.request.get(a.constructor.url("shareInfo"),{folder_id:a.id}).then(function(b){var c=(b.body.folders||[]).filter(function(b){return b.folder_id==a.id});if(1===c.length){var d=c[0];a.set("shareInfo",d)}else a.set({shareInfo:null,share:null})})})},share:function(a){return this.queue(function(b){return b.request.post(b.constructor.url("share"),{shared_email:a.shared_email,folder_id:b.id}).then(function(a){return b.set("share",Kb.SHARE_GIVE),a})})},unshare:function(a){return this.queue(function(b){return b.request.post(b.constructor.url("unshare"),{unshared_email:a.unshared_email,folder_id:b.id})})},cleanup:function(){return this.queue(function(a){return a.request.post(a.constructor.url("clear"),{ids:Jb([a.id])}).then(function(){return a.set({messages_unread:0,messages_total:0},{clean:!0})})})},secureOpen:function(a){return this.queue(function(b){return b.request.post(b.constructor.url("open"),{folders:Jb([{id:b.id,secret:{folder_password:(a+"").trim()}}])}).then(function(){return b.set("open",!0,{clean:!0})})})},secureClose:function(){return this.queue(function(a){return a.request.post(a.constructor.url("close"),{ids:Jb([a.id])}).then(function(){return a.set("open",!1,{clean:!0})})})},valueValidator:function(a,b,c,d){return-1!==Kb.NON_NEGATIVE_FIELDS.indexOf(b)?a>0?a:0:a},getMaxChildLevel:function(){var a=Kb.MAX_CHILD_LEVEL;return this.isShareTake()&&(a+=1),a},getChildLevel:function(a){if(void 0===a&&(a={reduceSharedFoldersOffset:!1}),this.isRoot()){return this.meta("level",0),0}var b=Kb.all.get(this.get("parent")),c=a.reduceSharedFoldersOffset,d=this.isShareTake()&&c&&b.isServiceShared()?-1:0,e=this.meta("level");if(void 0!==e)return e+d;for(var f=+this.get("parent"),g=0;-1!==f;){var h=Kb.all.get(f),i=h.meta("level");if(void 0!==i){g+=i+1;break}f=+h.get("parent"),g+=1}var j=Math.min(g,this.getMaxChildLevel());return this.meta("level",j),j+d},checkPropertySatisfiesPredicate:function(a){var b=this,c=a.property,d=a.predicate,e=a.checkParents,f=void 0!==e&&e,g=a.folders,h=void 0===g?Kb.all:g;if(d(this.get(c)))return!0;if(!f)return!1;if(this.isRoot())return!1;var i=h.find(function(a){return a.get("id")===b.get("parent")});return Boolean(null==i?void 0:i.checkPropertySatisfiesPredicate({property:c,predicate:d,checkParents:f,folders:h}))},checkInFolderIds:function(a,b,c){void 0===c&&(c=Kb.all);var d=a.map(function(a){return String(a)});return this.checkPropertySatisfiesPredicate({property:"id",predicate:function(a){return d.includes(a)},checkParents:b,folders:c})},checkInFolderTypes:function(a,b,c){return void 0===c&&(c=Kb.all),this.checkPropertySatisfiesPredicate({property:"type",predicate:function(b){return a.includes(b)},checkParents:b,folders:c})},getServiceSharedParent:function(a){var b=this;return void 0===a&&(a=Kb.all),this.isShareTake()?this.isServiceShared()?this:a.find(function(a){var c,d;return a.isServiceShared()&&(null===(c=a.get("owner"))||void 0===c?void 0:c.email)===(null===(d=b.get("owner"))||void 0===d?void 0:d.email)})||null:null}});A.extend(Kb,{INBOX:0,SPAM:950,SENT:5e5,DRAFTS:500001,TRASH:500002,MRIM:500003,MRIM_ARCH:500005,TEMPLATES:500006,DELETED:500008,ARCHIVE:500010,SOCIAL:500011,PROMOTIONS:500012,NEWSLETTERS:500013,OUTBOX:500014,TOMYSELF:500015,NEWS:500016,OFFICIAL:500019,PARENTAL_CONTROL:500017,CHILD_TRASH:500018,TYPE_INBOX:"inbox",TYPE_SPAM:"spam",TYPE_SENT:"sent",TYPE_DRAFTS:"drafts",TYPE_TEMPLATES:"templates",TYPE_DELETED:"deleted",TYPE_TRASH:"trash",TYPE_ARCHIVE:"archive",TYPE_USER:"user",TYPE_SOCIAL:"social",TYPE_PROMOTIONS:"promotions",TYPE_NEWSLETTERS:"newsletters",TYPE_OUTBOX:"outbox",TYPE_TOMYSELF:"tomyself",TYPE_NEWS:"news",TYPE_OFFICIAL:"official",TYPE_PARENTAL_CONTROL:"parental_control",TYPE_CHILD_TRASH:"child_trash",UNREAD:600006,FLAGGED:600007,ATTACH:600008,FILESEARCH:-2,SHARE_TAKE:"take",SHARE_GIVE:"give",TYPES:{0:"Inbox",950:"Spam",5e5:"Sent",500001:"Drafts",500002:"Trash",500003:"MRIM",500006:"Templates",500008:"Deleted",500010:"Archive",USER:"user"},NON_NEGATIVE_FIELDS:["messages_total","messages_unread","messages_flagged","messages_pinned","messages_with_attachments","messages_snoozed"],MAX_CHILD_LEVEL:1,SHARE_GRANTS:{read:"read",reply:"reply",forward:"forward",redirect_inside:"redirect_inside",redirect_everywhere:"redirect_everywhere",forward_as_attachment:"forward_as_attachment",move:"move",remove:"remove",download:"download",create_event:"create_event",mark_as_important:"mark_as_important",mark_as_read_unread:"mark_as_read_unread",move_to_spam:"move_to_spam",move_to_archive:"move_to_archive",print:"print",view_attachment:"view_attachment",add_subfolder:"add_subfolder",edit_folder:"edit_folder",remove_folder:"remove_folder",add_filter:"add_filter",edit_filter:"edit_filter",remove_filter:"remove_filter",accept_meeting:"accept_meeting",refuse_meeting:"refuse_meeting",maybe_meeting:"maybe_meeting",receipt_confirmation:"receipt_confirmation"},ARCHIVE_ENSURE_URL:"folders/archive/ensure"}),Kb.List.fn.hasSubfolders=function(){for(var a=this.length;a--;)if(this[a].isSubfolder())return!0;return!1},Kb.List.fn.hasSharedTake=function(){for(var a=this.length;a--;)if(this[a].isShareTake())return!0;return!1},Kb.unsafeFindAll=function(){return Kb.all.length?Promise.resolve(Kb.all.clone()):Kb.find()},Kb.OWN_METATHREADS_IDS=[Kb.SOCIAL,Kb.PROMOTIONS,Kb.NEWSLETTERS,Kb.TOMYSELF,Kb.NEWS,Kb.OFFICIAL],Kb.METATHREADS_TYPES=[Kb.TYPE_SOCIAL,Kb.TYPE_PROMOTIONS,Kb.TYPE_NEWSLETTERS,Kb.TYPE_TOMYSELF,Kb.TYPE_NEWS,Kb.TYPE_OFFICIAL],Kb.isMetathread=function(a,b){if(void 0===b&&(b=Kb.all),void 0===a)return!1;var c;if(a instanceof Kb)c=a;else if(!(c=b.get(a)))return Kb.OWN_METATHREADS_IDS.some(function(b){return a==b});return c.checkInFolderTypes(Kb.METATHREADS_TYPES)},Kb.ensureArchive=function(a){return void 0===a&&(a=Kb.INBOX),Kb.unsafeFindAll().then(function(b){var c=null,d=b.find(function(b){return b.get("id")==a}),e=null==d?void 0:d.isShareTake();if(e||(c=b.find(function(a){return a.isArchive()&&!a.isShareTake()})),!c){var f=e?{folder:a}:{};return Ma.call(Kb.ARCHIVE_ENSURE_URL,f).then(function(){var a=Kb.ARCHIVE;return new Kb({id:a,type:Kb.TYPE_ARCHIVE,archive:!0})})}return c})},Kb.version="1.1.0";var Lb=tb.extend({url:"utils/translate",operation:function(a){return Ma.call(this.url,{fromlang:a.fromlang,tolang:a.tolang,query:a.translate_query})}});function Mb(a,b,c){return"translation"+(a=a?"."+a:"")+(b=b?"."+b:"")+(c=c?"."+c:"")}function Nb(a,b){var c=a.map(function(a){return a.split(".")}),d={};return c.forEach(function(a,c){a.reduce(function(a,d,e,f){return e===f.length-1?(a[d]=b[c],a):(a[d]={},a[d])},d)}),d}A.extend(Lb,{RUSSIAN:"ru",ENGLISH:"en",GERMAN:"ge",FRENCH:"fr",SPANISH:"sp",AVAILABLE_LANGUAGES:["ru","en","ge","fr","sp"]}),tb.register("mail.Translate",Lb),Lb.version="0.1.0";var Ob={apply:function(a,b){var c=Object.assign({},Ob);for(var e in c)c.hasOwnProperty(e)&&!a.prototype.hasOwnProperty(e)&&"apply"!==e&&(a.prototype[e]=c[e]);if("object"===d(b))for(var f in b)b.hasOwnProperty(f)&&(a.prototype[f]=b[f])},cacheTranslations:!1,mutableTranslatableFields:!0,getTranslation:function(a,b,c){if(this.cacheTranslations&&!this.mutableTranslatableFields){var d=Mb(a,b,c);return this.meta(d)}if(this.cacheTranslations&&this.mutableTranslatableFields)throw new Error("Not Implemented");throw new Error("Невозможно получить перевод из модели с некэшируемым переводом")},resetTranslation:function(a,b,c){if(this.cacheTranslations&&!this.mutableTranslatableFields){var d=Mb(a,b,c);this.meta(d,void 0)}},getTranslationLast:function(){return this.meta("translation.last")},_translateAttr:function(a,b){var c=a.fromlang,d=a.tolang,e=this.get(b)||"",f="";if(this.cacheTranslations&&!this.mutableTranslatableFields&&(f=this.getTranslation(c,d,b)||""),this.cacheTranslations&&this.mutableTranslatableFields)throw new Error("Not Implemented");var g=Promise.resolve(f);return e&&!f&&(g=Lb.execute({translate_query:e,fromlang:c,tolang:d}).then(function(a){return a.result.body})),g},translateAttrs:function(a,b){var c=a.fromlang,d=a.tolang,e=Date.now();return Promise.all(b.map(function(b){return this._translateAttr(a,b)},this)).then(function(a){var f=Nb(b,a);this.cacheTranslations&&!this.mutableTranslatableFields&&this.meta(Mb(c,d),f);var g=this.meta("translation.last");return(!g||e>g.startTime)&&this.meta("translation.last",{startTime:e,fromlang:c,tolang:d,from:Nb(b,b.map(this.get,this)),to:f}),f}.bind(this))}},Pb=" folder next prev attaches subject snippet length_unread length_flagged drafts attaches AttachList snooze_date transaction_category ";function Qb(a){return(a+"").includes('<div class="mail-quote-collapse"></div>')}var Rb=rb.extend({className:"mail.Message",findUrl:"messages/status",fetch:function(a){return void 0===(a=a||{}).folder_id&&(a.folder_id=this.get("folder")),rb.fn.fetch.call(this,a)},findOneUrl:function(a){void 0===a.folder_id&&(a.folder_id=0);var b=a.quotesVersion||Rb.QUOTES_VERSION,c=a.withoutQuote?this.messageShortUrl:this.messageUrl;return!a.withoutQuote&&b&&(c+="?quotes_version="+b),c},messageUrl:"messages/message",messageShortUrl:"messages/message/short",markAsUrl:"messages/marks",markAsAllUrl:"messages/marks/all",moveToUrl:"messages/move",moveToAllUrl:"messages/move/all",deleteUrl:"messages/remove",spamUrl:"messages/services/spam",unspamUrl:"messages/services/unspam",redirectUrl:"messages/services/bounce",snoozeUrl:"messages/snoozes/update",unsnoozeUrl:"messages/snoozes/remove",findAttachesUrl:"messages/attaches",metaUrl:"messages/meta",metathread:null,defaults:{prev:null,next:null,subject:"",priority:3,remind:0,date:0,size:0,folder:Kb.INBOX,folders:[],rd_slot:"",snippet:"",send_date:0,transaction_category:null,dates_metadata:{priority_date:{timestamp:void 0,find_re:""},dates:[]},body:{html:null,text:null},flags:{spf:!0,dkim:!0,unread:!1,read_set:!1,flagged:!1,reply:!1,forward:!1,attach:!1,safe:!0,hide_fast_answers:!1,receipt:!1,blacklist_spam:!1,probable_spam:!1,dmarc_spf_pass:!1,dmarc_fail:!1,stored:!1,rfc822:!1,dont_cache:!1},images:{exists:!1,hidden:!1,banned:!1,attaches2cid:{}},drafts:{last_type:null,reply:"",replyall:"",forward:""},attaches:{total:{href:"",name:""},tnef:"",list:new Cb.List.Local},correspondents:{from:[],to:[],recipient:{avatars:{},email:"",name:""},cc:[],bcc:[]},replies:{to:[],all:[],cc:[]},resend:{to:[],from:[],date:0,comment:""},templates:{replay:null,forward:null},collector:{id:"-1",type:""},headers:{},parser_version:""},required:["transaction_category"],parse:function(a){return!a.id&&a.messages||a},valueValidator:function(a,b,c,d){return"body"===b?!d.is("body.html")||(a.html+"").includes('<div class="mail-quote-collapse">')&&!Qb(a.html)||c.images?a:d.get(b):!d.attributes._load_by_message||Pb.indexOf(" "+b+" ")>-1||0===b.indexOf("flags")?a:d.get(b)},isAttachmentsLoaded:function(){return this.isDataFully()},isDataFully:function(a){var b=this.getFolder();if(b.isShareTake()&&a&&void 0!==a.folder_id&&b.get("id")!=a.folder_id)return!1;var c=this.get("body.html");return null!==c&&(a&&a.withoutQuote||!Qb(c))},getSmartReply:function(){return Hb.all.get(this.id)},fetchSmartReply:function(){return Hb.findOne({id:this.id})},translate:function(a){return this.isDataFully()?this.translateAttrs(a,["subject","body.html"]):Promise.resolve({subject:"",body:{html:""}})},getFolder:function(){return Kb.getSafe(this.get("folder"))},getJsonLdInfo:function(){var a=this.get("meta");if(!a||!a.length){var b=this.get("messages"),c=this.get("folder");if(!b||!b.length)return;if(!b.some(function(b){if(b.get("folder")==c){var d=b.get("meta");return d&&d.length?(a=d,!0):void 0}}))return}var e=Rb.PAYMENT_TYPE,f=a.filter(function(a){if("object"!==d(a))return!1;var b=Object.keys(e).map(function(a){return e[a]}).includes(a["@type"]),c=a["@context"]===Rb.PAYMENT_CONTEXT.Schema;return(b||c||a.skin===Rb.PAYMENT_META_SKINS.UNIVERSAL)&&!1!==a.show});return f.length&&f},getCachedBody:function(){return this.meta("cache.body")},setCachedBody:function(a){this.meta("cache.body",a)},getPaymentMeta:function(){var a=this.getJsonLdInfo();if(a)return a.find(Rb.checkPaymentMeta)},setPaymentMeta:function(a){var b=this.get("meta");if(b){var c=A.findIndex(b,Rb.checkPaymentMeta);Rb.checkPaymentMeta(a)&&-1!==c?this.set("meta."+c,a):console.warn("meta not updated")}},checkPaymentMeta:function(a){return Rb.checkPaymentMeta(a)},getJsonLdEvent:function(){var a=this.getJsonLdInfo();if(a){var b=a.filter(function(a){return"EventReservation"===a["@type"]&&!1!==a.show});return b.length&&b}},isLow:function(){return Rb.PRIORITY_LOW==this.get("priority")},isNormal:function(){return Rb.PRIORITY_NORMAL==this.get("priority")},isHigh:function(){return Rb.PRIORITY_HIGH==this.get("priority")},isEditable:function(){return!/\d{20};\d;\d/.test(this.id)},isSchedule:function(){return this.get("send_date")},canListUnsubscribe:function(){return this.is("headers.List-Unsubscribe")},hasInlineAttachments:function(){return this.is("images.exists")},hasAttachments:function(){return this.get("attaches.list.length")>0},getInlineAttachments:function(){var a=this.get("images.attaches2cid"),b={list:{},count:0};return this.hasInlineAttachments()&&Object.keys(a).forEach(function(c){var d=c.match(Cb.R_INLINE_PART_ID),e=d&&d[1];e?(b.list[e]={url:c,type:Cb.TYPE_INLINE,content_id:a[c]},b.count++):O.add("Message.getInlineAttachments parse error: ",c)}),b},getAttachmentPartID:function(a){if(a.isLink())return null;var b=this.get("id").split(";")[0]+";"+a.get("id");return a.isWinmail()&&(b=b.substring(0,b.lastIndexOf(";"))),b},getAttachmentsDowloadLink:function(){var a=this.get("attaches.total.href");return a&&(a=Ma.addXEmail(a)),a},getAttachmentsList:function(){return this.get("attaches.list")},getAttachmentsTotalSize:function(){return this.get("attaches.list").reduce(function(a,b){var c=b.get("size");return(b.isCloud()||b.isLink())&&(c=0),a+c},0)},getCalendarFromAttach:function(){var a=this.getAttachmentsList();if(!a.length)return[];var b=[];return a.forEach(function(a){var c=a.get("content_type");if(Rb.CALENDAR_CONTENT_TYPE.hasOwnProperty(c)){var d=a.get("thumbnails.html"),e=a.get("id");d&&e&&b.push({id:e,html:d})}}),b},setContainingMetathread:function(a){this.metathread=a},getContainingMetathread:function(){return this.metathread},isInMetathread:function(){return!!this.metathread},isToMyself:function(){var a=Ma.setup().email,b=this.get("correspondents.from"),c=this.get("correspondents.to"),e=this.get("correspondents.cc"),f=this.get("correspondents.bcc");if(!(a&&Array.isArray(b)&&Array.isArray(c)&&b[0]&&c[0]))return!1;var g=1===b.length&&1===c.length&&b[0].email===c[0].email&&b[0].email===a;return![].concat(e,f).some(function(b){return"object"===d(b)&&b.email!==a})&&g},checkGrant:function(a){return this.getFolder().checkGrant(a)},setFormAttaches:function(a,b){var c=b.body;if(!c||!c.length)return null;var d=c.map(function(b){var c,d,e=b.name,f=b.id,g=b.type,h=Cb.from(b);return e&&(c={value:e,color:[]}),a&&f&&(d=a+";"+f),h.set({id:f,formName:c,snippet:{value:"",color:[]},part_id:d,type:g}),h}.bind(this));return this.set("attaches.list",d),d}});Ob.apply(Rb,{cacheTranslations:!0,mutableTranslatableFields:!1}),Rb.PRIORITY_LOW=5,Rb.PRIORITY_NORMAL=3,Rb.PRIORITY_HIGH=1,Rb.QUOTES_VERSION=void 0,Rb.PAYMENT_META_SKINS={PROMO:"promo",DATASET:"dataset",GIBDD:"gibdd",MOBILES_PAYMENT:"mobiles_payment",SIMPLE:"simple",MONETA:"moneta",MOS_RU:"mos_ru",UNIVERSAL:"universal"},Rb.List.Sorted=Rb.List.extend({comparator:{date:!0}}),Rb.CALENDAR_CONTENT_TYPE={"text/calendar":!0,"application/ics":!0},Rb.PAYMENT_TYPE={MailRuBill:"MailRuBill",Invoice:"Invoice",Order:"Order"},Rb.PAYMENT_CONTEXT={BillJsonLd:"https://jsonld.mail.ru/bill.jsonld",Schema:"http://schema.org"},Rb.CATEGORY_META={context:"MailMessage",type:"Category"},Rb.findAttaches=function(a){return Ma.get(Rb.url("findAttaches"),{id:a})},Rb.checkPaymentMeta=function(a){var b,c;if("object"!==d(a)||!a)return!1;var e=Rb.PAYMENT_META_SKINS,f=Rb.PAYMENT_TYPE,g=Rb.PAYMENT_CONTEXT,h=Object.keys(f).map(function(a){return f[a]}).includes(a["@type"]),i=Object.keys(g).map(function(a){return g[a]}).includes(a["@context"]),j="string"==typeof a.skin,k=h&&i&&"string"==typeof a.payment_url&&a.payment_url,l=a.skin===e.UNIVERSAL&&"string"==typeof(null===(c=null===(b=a.buttons)||void 0===b?void 0:b.payment)||void 0===c?void 0:c.url),m=!0===a.show&&j&&(k||l)&&e[a.skin.toUpperCase()];return[e.PROMO,e.DATASET,e.GIBDD].includes(a.skin)&&(m=m&&A.isPositiveNumber(a.amount)),!!m},Rb.version="0.11.0";var Sb=rb.extend({className:"mail.SharedMailbox",findUrl:"user/shared-mailboxes",defaults:{owner:{},permissions:{},system_folders:{}},checkGrant:function(a){return Boolean(this.get("permissions")[a])},getRootFolder:function(){var a=this.get("system_folders").root;return a?String(a):null},getOwnerEmail:function(){return this.get("owner").email}});Sb.List.fn.getMailboxesByGrant=function(a){for(var b=[],c=this.length;c--;)this[c].checkGrant(a)&&b.push(this[c]);return b},Sb.List.fn.getMailboxByEmail=function(a){for(var b=this.length;b--;)if(this[b].get("owner").email===a)return this[b];return null},A.extend(Sb,{GRANTS:{create_toplvl_flds:"create_toplvl_flds",write:"write"}}),Sb.version="1.0.0";var Tb=rb.extend({findUrl:"user",bindUrl:"user/phones/bind",saveUrl:"user/phones/edit",removeUrl:"user/phones/remove",enable2FactorUrl:"user/2-step-auth/enable",disable2FactorUrl:"user/2-step-auth/disable",defaults:{id:null,temporaryId:null,phone:"",visibility:"visible",country:"",mobile:!0,status:"nonverified",noticeable:"",two_factor:!1},prepareSendData:function(a,b){if("add"===a)b={phones:JSON.stringify([{id:b.id,phone:b.phone,visibility:b.visibility,mobile:b.mobile,status:b.status}])};return b},getFormattedNumber:function(){var a=/^(7|8)(9..|499|495|812)(...)(..)(..)$/,b=this.get("phone");return b=a.test(b)?b.replace(a,"+$1 ($2) $3-**-**"):b.replace(/\d{5}(\d{2})/,"*****$1")},parse:function(a,b){var c={};return/user$/.test(b.url)?c=a.phones:/user\/phones\/add/.test(b.url)&&(c={id:a[0]}),c},_call2FactorsMethod:function(a,b,c,d){return d=Object(d),this.queue(function(e){var f=e.constructor.url(a);return c&&(d.password=c),b&&(d.reg_token=b),e.request.post(f,d)}.bind(this))},bind:function(a,b){var c={phone:{phone:this.get("phone"),visibility:this.get("visibility"),mobile:!0}};return this._call2FactorsMethod("bind",a,b,c)}});Tb.filterPotentialSecondFactor=function(a){a instanceof Tb.List||(a=Tb.map(a));var b=a.filter({status:"ok",two_factor:!1}),c=a.filter({status:"too_young",two_factor:!1}),d=a.filter({status:"in_remove_queue"});return b.length?b:c.length&&!d.length?c:new Tb.List},Tb.getPotentialSecondFactor=function(){return Tb.find().then(function(a){return Tb.filterPotentialSecondFactor(a)})},Tb.version="0.4.1";var Ub=qb.extend({defaults:{enabled:!1,application:"",platform:""}});Ub.version="0.1.1";var Vb=rb.extend({className:"mail.User",loginUrl:"user/short",findUrl:"user",removeUrl:"user/remove",saveUrl:"user/edit",findBillsCountUrl:"user/paymentdata",editMetathreadsSettingsUrl:"golang/user/edit/metathreads",defaults:{signs:[],addressbook:{sort:{}},phones:null,notifications:{},security:{},messages:{},name:{},birthday:{},restore:{},totp:{enabled:!1},agent:{visible:{},history:{}}},isNew:function(){return!this.is("common_purpose_flags")},isDataFully:function(){return this.is("phones")},getEmail:function(){return this.get("login")+"@"+this.get("domain")},getFullName:function(a){var b=(void 0===a?{}:a).strict,c=void 0!==b&&b,d=this.get("nick");if(d)return d;var e=this.get("name")||{},f=e.first,g=e.middle,h=e.last;return f||g||h?A.calculateFullName({first:f,middle:g,last:h}):c?void 0:this.getEmail()},isTwoFactorEnable:function(){var a=(this.get("phones")||[]).some(function(a){return!!a.two_factor});return a||(a=this.get("totp").enabled),!!a},isPDD:function(){return"pdd"===this.get("account_type")},getMainPhone:function(){if(!this.isDataFully())return null;var a=this.get("phones").find(function(a){return!!a.main_phone});return new Tb(a)},getTwoFactor:function(){var a;return this.isTwoFactorEnable()?(a=(this.get("phones")||[]).filter(function(a){return a.two_factor})).length?new Tb(a[0]):Vb.TOTPCode.map(this.get("totp")):null}});Vb.TOTPCode=Ub,Vb.login=function(){var a=this.url("login"),b=this.fn.request;return b.post(a).then(function(a){return b.setup("token",a.get("body.token")),b.setup("email",a.get("email")),a.map(Vb)})},Vb.findBillsCount=function(){return Ma.get(Vb.url("findBillsCount")).then(function(a){var b=a.body.unpaid_fines,c=a.body.unpaid_bills;return{unpaidFines:b,unpaidBills:c,total:(b||0)+(c||0)}})},Vb.getMetathreadsSettingsFromVisibility=function(a){if(!Array.isArray(a))return{};var b={};return a.forEach(function(a){var c=a.folder_id,d=a.state;b[c]=d}),b},Vb.METATHREADS_STATES={ON:0,HIDDEN:1,OFF:2},Vb.version="0.3.0";var Wb=rb.extend({className:"mail.UserSecurity",url:"golang/user/security",defaults:{id:null,password_changed:0,password_required:!1,need_change_password:!1,restore:null,phones:null},isDataFully:function(){return this.is("restore")},okPhones:function(){var a=this.get("phones");return new Tb.List(a?a.filter(function(a){return"ok"===a.status}):[])}}),Xb=function(){},Yb=window.performance,Zb=function(a,b){var c="task_"+b+"_"+a;Yb.mark(c+"_end");try{Yb.measure(c,c+"_start",c+"_end")}catch(a){console.warn("Failed to measure "+c,a)}},$b=qb.extend({constructor:function(a){qb.apply(this),this.context=A.cloneObject(a),Object.freeze&&Object.freeze(this.context),this._promise=new Promise(function(a,b){this.resolve=a,this.reject=b}.bind(this)),this._promise=this._promise.then(function(a){return this.set("status",$b.STATUS_RESOLVED),this.emit($b.EVENT_RESOLVE,[this,a]),this.emit($b.EVENT_END,[this,a]),Zb(this.cid,this.type+"@"+this.className),this.emit($b.EVENT_INTERNAL_SCHEDULER_NEXT,[this,a]),a}.bind(this)),this._promise=this._promise.catch(function(a){throw this.set("status",$b.STATUS_REJECTED),this.emit($b.EVENT_REJECT,[this,a]),this.emit($b.EVENT_END,[this,a]),Zb(this.cid,this.type+"@"+this.className),this.emit($b.EVENT_INTERNAL_SCHEDULER_NEXT,[this,a]),a}.bind(this))},className:"Task",type:"generic",context:{},defaults:{status:"awaiting",cancelled:!1},_promise:null,resolve:null,reject:null,didStart:Xb,willCancel:Xb,start:function(){!function(a,b){Yb.mark("task_"+b+"_"+a+"_start")}(this.cid,this.type+"@"+this.className),this.set("status",$b.STATUS_RUNNING),this.emit($b.EVENT_START,[this]);try{this.didStart()}catch(a){this.reject(a)}},cancel:function(a){this.set({status:$b.STATUS_REJECTED,cancelled:!0}),this.emit($b.EVENT_CANCEL,[this,a]);try{this.willCancel(a)}catch(a){return void this.reject(a)}this.reject(a)},asPromise:function(){return this._promise},then:function(){return this._promise=this._promise.then.apply(this._promise,arguments),this._promise},catch:function(){return this._promise=this._promise.catch.apply(this._promise,arguments),this._promise},isCancelled:function(){return this.is("cancelled")}});A.extend($b,{fromCallback:function(a,b,c){var d=$b.extend({type:b,didStart:function(){var b=a();b&&b.then?b.then(this.resolve,this.reject):this.resolve(b)}});return new d(c)},EVENT_PROGRESS:"progress",EVENT_START:"start",EVENT_END:"end",EVENT_RESOLVE:"resolve",EVENT_REJECT:"reject",EVENT_INTERNAL_SCHEDULER_NEXT:"internal_scheduler_next",EVENT_CANCEL:"cancel",STATUS_AWAITING:"awaiting",STATUS_RUNNING:"running",STATUS_REJECTED:"rejected",STATUS_RESOLVED:"resolved"}),$b.version="0.2.0";var _b="immediate",ac="queued",bc=ac,cc=qb.extend({className:"TaskScheduler",_queuesConfig:null,_queues:null,_running:null,constructor:function(a){qb.apply(this),this._queuesConfig={},this._queues={},this._running={},this._onTaskInternalNext=this._onTaskInternalNext.bind(this),this._removeTask=this._removeTask.bind(this),"object"===d(a)&&this._configureQueues(a)},start:function(a,b){switch(("object"===d(b)?b:{}).execution||bc){case _b:this._scheduleImmediate(a);break;case ac:this._scheduleQueued(a)}},cancel:function(a,b){Array.isArray(a)?this._cancelTaskArray(a,b):this._cancel(a,b,!1)},findFirst:function(a,b){var c;return void 0!==b?((c=this._arrayFindFirstTask(a,this._running[b]))||(c=this._arrayFindFirstTask(a,this._queues[b])),c):(c=this._mapFindFirstTask(a,this._running))?c:c=this._mapFindFirstTask(a,this._queues)},cancelAll:function(a){var b;[this._queues,this._running].forEach(function(c){for(b in c)c.hasOwnProperty(b)&&(this._cancelTaskArray(c[b],a),c[b].length=0)}.bind(this))},cancelOfType:function(a,b){this._cancelTaskArray(this._queues[a],b),this._cancelTaskArray(this._running[a],b)},isRunning:function(a){return this._arrayHasTask(this._running[a.type],a)},isQueued:function(a){return this._arrayHasTask(this._queues[a.type],a)},hasRunningTasks:function(){return this._arrayMapHasTasks(this._running)},hasQueuedTasks:function(){return this._arrayMapHasTasks(this._queues)},hasRunningTasksOfType:function(a){var b=this._running[a];return!(!b||!b.length)},hasQueuedTasksOfType:function(a){var b=this._queues[a];return!(!b||!b.length)},map:function(a){var b,c=this._queues,d=this._running,e=[],f=function(a){return a.get("status")!==$b.STATUS_RESOLVED}.bind(this);return[c,d].forEach(function(c){for(b in c)c.hasOwnProperty(b)&&(e=[].concat(c[b].filter(f).map(a),e))}),e},waitForAll:function(){return new Promise(function(a,b){Promise.all(this.map(function(a){return new Promise(function(b){a.on($b.EVENT_INTERNAL_SCHEDULER_NEXT,function(c,d){b({result:d,status_error:a.get("status")!==$b.STATUS_RESOLVED&&a.get("status")!==$b.EVENT_CANCEL})})})})).then(function(c){if(c.some(function(a){return a.status_error}))return b(c);a(c)})}.bind(this))},_configureQueues:function(a){var b;for(var c in a)a.hasOwnProperty(c)&&(b=a[c],this._queuesConfig[c]={maxConcurrent:b.maxConcurrent||1},this._queues[c]=[],this._running[c]=[])},_scheduleImmediate:function(a){var b=this._running[a.type];b||(b=this._running[a.type]=[]),b.push(a),this._scheduleNextAfter(a),a.start()},_scheduleQueued:function(a){var b=this._queuesConfig[a.type],c=this._queues[a.type],d=this._running[a.type];b&&c&&d&&!(d.length<b.maxConcurrent)?c.unshift(a):this._scheduleImmediate(a)},_scheduleNextAfter:function(a){a.on($b.EVENT_INTERNAL_SCHEDULER_NEXT,this._onTaskInternalNext)},_onTaskInternalNext:function(a,b){var c=this._queuesConfig[a.type],d=this._queues[a.type],e=this._running[a.type];if(this._removeTask(a,b),c&&e.length<c.maxConcurrent){var f=d.pop();f&&this._scheduleImmediate(f)}},_removeTask:function(a,b){var c,d=this._running[a.type],e=this._queues[a.type];(c=d&&d.indexOf(a))>=0&&d.splice(c,1),(c=e&&e.indexOf(a))>=0&&e.splice(c,1)},_cancelTaskArray:function(a,b){var c,d;if(a&&a.length)for(var e=0;e<a.length;e++)c=a[e],d=e+1===a.length,this._cancel(c,b,!d)},_arrayHasTask:function(a,b){return!!a&&a.indexOf(b)>=0},_arrayMapHasTasks:function(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b].length)return!0;return!1},_arrayFindFirstTask:function(a,b){for(var c,d=0;d<b.length;d++)if(a(c=b[d]))return c},_mapFindFirstTask:function(a,b){var c;for(var d in b)if(b.hasOwnProperty(d)&&(c=this.findFirst(a,d)))return c},_cancel:function(a,b,c){c&&(a.off($b.EVENT_INTERNAL_SCHEDULER_NEXT,this._onTaskInternalNext),a.on($b.EVENT_INTERNAL_SCHEDULER_NEXT,this._removeTask)),a.cancel(b),a.catch(function(){}),this._removeTask(a)}});cc.version="0.2.1",A.extend(cc,{EXECUTION_IMMEDIATE:_b,EXECUTION_QUEUED:ac,EXECUTION_DEFAULT:bc,MAX_CONCURRENT_DEFAULT:1});var dc=rb.extend({className:"mail.UserSignatureAttachesAdd.Transport",addAttachmentUrl:"user/signature/attaches/add",getUrl:function(a){return this.constructor.url(a)},getRPC:function(){return this.request}});dc.version="0.0.4";var ec=$b.extend({className:"mail.UserSignatureAttachesAdd.SignUploadTask",type:"sign_upload_attachment",xhr:null,transport:null,didStart:function(){this.transport=this.context.transport;var a=this.context.attachment,b=this.context.logScope,c=this.transport.getRPC(),d={email:c.setup("email"),token:c.setup("token"),signature_index:this.context.signId};c.workflow({url:this.transport.getUrl("addAttachment"),data:d,files:{file:a.getBlob()},loggerMeta:b.meta},function(a,c){b.add("upload",d),a.fileprogress=function(a){this.emit($b.EVENT_PROGRESS,[this,a])}.bind(this),a.filecomplete=function(a,d){b.add("onfilecomplete",{error:a}),c({status:d.status,responseText:d.responseText})}.bind(this),this.xhr=f.upload(a)}.bind(this)).then(this.resolve,this.reject)}});ec.version="0.0.0";var fc=tb.extend({className:"mail.UserSignatureAttachesAdd",operation:function(a){var b=a.signId,c=a.attach,d=a.options,e=new dc,f=new cc({upload_attachment:{maxConcurrent:1}}),g=this.options.logScope.scope("addAttachment",{cid:c.cid,size:c.get("size"),type:c.get("type"),content_id:c.get("content_id"),blob:c.getBlob()});d=A.extend({onupload:function(){},onprogress:function(){},oncomplete:function(){}},d);var h=new ec({transport:e,attachment:c,signId:b,callbacks:d,logScope:g});return this._subscribeOnAttachmentTask(h),f.start(h,{execution:"queued"}),h.asPromise().then(function(){return c})},_onAttachmentTaskResolve:function(a,b){var c=a.context.attachment,d=a.context.logScope,e=a.context.callbacks;d.add("success",b.get("body")),c.set(b.get("body.attach"),{clean:!0}),e.oncomplete(null,c,b)},_onAttachmentTaskReject:function(a,b){var c=a.context.attachment,d=a.context.logScope,e=a.context.callbacks;d.add("fail",b),e.oncomplete(b,c,b instanceof Error?null:b)},_subscribeOnAttachmentTask:function(a){var b=a.context.attachment,c=a.context.callbacks;a.on($b.EVENT_REJECT,this._onAttachmentTaskReject.bind(this)),a.on($b.EVENT_RESOLVE,this._onAttachmentTaskResolve.bind(this)),a.on($b.EVENT_START,function(){c.onupload(b)}),a.on($b.EVENT_PROGRESS,function(a,d){c.onprogress(d,b)})}});tb.register("mail.UserSignatureAttachesAdd",fc);var gc=qb.extend({valueValidator:function(a,b,c,d){return"status"===b&&Array.isArray(a)?(d.set("status_history",a),d.get("status")):"items"===b&&Array.isArray(a)?(d.set("item_list",a),null):a},getAttributes:function(){return 0===Object.keys(this.attributes).length?null:Object.assign({},this.attributes)}});gc.version="0.1.0";var hc=Rb.extend({className:"mail.Thread",findUrl:"threads",findOneUrl:function(a){var b=a.quotesVersion||Rb.QUOTES_VERSION,c=a.withoutQuote?this.threadShortUrl:this.threadUrl;return!a.withoutQuote&&b&&(c+="?quotes_version="+b),c},threadUrl:"threads/thread",threadShortUrl:"threads/thread/short",markAsUrl:"threads/marks",moveToUrl:"threads/move",deleteUrl:"threads/remove",spamUrl:"threads/services/spam",unspamUrl:"threads/services/unspam",defaults:A.extend({},Rb.fn.defaults,{messages:new Rb.List.Sorted,length:0,length_unread:0,length_flagged:0,transaction_category:null,transaction_metadata:new gc}),nestedMergeStrategy:{messages:{sort:"preset",merge:!1}},required:["transaction_category"],getAttachmentsList:function(){var a=this.getExpandMessage();return a?a.getAttachmentsList():new Cb.List},getExpandMessage:function(){var a=this.get("expand");return Rb.get(a)},isDataFully:function(a){var b=(a=a||{}).limit||0,c=a.offset||0,d=this.get("messages").length,e=Math.max(this.get("length"),d),f=c+b;return!(1===a.last_modified||!d)&&(d>=e||d>=f)},isAttachmentsLoaded:function(){var a=this.getExpandMessage();return!!a&&a.isAttachmentsLoaded()},canUnfoldMessage:function(a){return a instanceof Rb&&(this.get("expand")==a.id||this.get("folder")==a.get("folder")&&a.is("flags.unread")&&a.isDataFully())},getReplies:function(){var a=this.get("expand"),b=this.get("messages").get(a);return b&&b.get("replies")||{to:[],all:[],cc:[]}}}),ic={},jc=function(a,b){a.get("messages").forEach(function(c){b?ic[c.id]&&ic[c.id].remove(a):(!ic[c.id]&&(ic[c.id]=new hc.List),ic[c.id].set([a]))})};hc.all.on("add remove",function(a,b){b.on("change:messages",function(){jc(b)}),jc(b,"remove"===a.type)}),hc.getByMessageId=function(a){return this.getListByMessageId(a)[0]},hc.getListByMessageId=function(a){var b=ic[a];if(void 0===b)return new hc.List;for(var c=b.length,d=null;c--;)(d=b.eq(c)).get("messages").contains(a)||(ic[a].remove(d),b.remove(d));return b},hc.version="0.6";var kc=tb.extend({models:[],folderTo:null,_findFolders:function(a){var b=Promise.resolve(),c=[];return a.forEach(function(a,d){b=b.then(function(){return Kb.findOne(a).then(function(a){if(!a.isSecureOpen())return tb.waitFor("folderSecure",[a]).then(function(){c[d]=a});c[d]=a})})}),b.then(function(){return c})},prepare:function(a){var b=a.folderTo,c=(a.models||[]).filter(function(a){return a.get("folder")!=b});return 0===c.length?null:(this._rollbackFolders={},this.models=c,this.folderTo?Promise.resolve(c):this._findFolders([b]).then(function(a){return this.folderTo=a[0],c}.bind(this)))},operation:function(a,b){var c=this._calculateMoveToParams(a,!1);return this._applyChanges(a,b.folderTo),this._moveTo(a,b.folderTo,!1,c)},undoOperation:function(a){var b={};return this.rollbackOperation(),a.forEach(function(a){var c=a.get("folder");void 0===b[c]&&(b[c]=[]),b[c].push(a)}),Promise.all(Object.keys(b).map(function(a){return this._moveTo(b[a],a,!0)},this))},_applyChanges:function(a,b,c){var d,e,f,g,h={clean:!0},i={},j={},k=this._rollbackFolders,l=this;function m(a,b,c){void 0===i[a]&&(i[a]={total:0,unread:0}),i[a].total+=b,i[a].unread+=b*c}function n(a,b,d){var e=d.is("flags.unread");d.set("folder",b,h),!c&&(k[d.id]=a),m(b,1,e),m(a,-1,e)}function o(a,b,d){var e,f,g=d.get("folder")==b,h=d.get("folder")==a;(g||h)&&(f=g?1:-1,j[d.id]={total:0,unread:0,flagged:0},c?l._undoData&&l._undoData[d.id]&&(e=l._undoData[d.id],j[d.id].unread=f*e.unread,j[d.id].flagged=f*e.flagged):(j[d.id].unread=f*d.get("length_unread"),j[d.id].flagged=f*d.get("length_flagged")))}for(g=0;g<a.length;g++)f=a[g],d=f.get("folder"),f instanceof hc?(e=f.get("messages"),c&&(b=f.get("folder"),d=k[f.id]),!c&&(k[f.id]=b),o(d,b,f),e.length&&(e.forEach(function(a){(!c&&a.get("folder")==d||void 0!==k[a.id])&&n(d,b,a)}),hc.getListByMessageId(e.eq(0).id).filter({folder:c?d:b}).forEach(function(a){o(d,b,a)}))):(c&&(b=k[f.id]),n(d,b,f),hc.getListByMessageId(f.id).forEach(function(a){o(d,b,a)}));this._applyChangesFolder(i,c),this._applyChangesThread(j,c),this.rollbackOperation=A.bindWithoutArgs(this._applyChanges,[a,b,!0])},_applyChangesFolder:function(a,b){Object.keys(a).forEach(function(b){var c=Kb.get(b),d=a[b];c&&(c.increment("messages_unread",d.unread,{clean:!0}),c.increment("messages_total",d.total,{clean:!0}))})},_applyChangesThread:function(a,b){Object.keys(a).forEach(function(c){var d,e,f=hc.get(c),g=a[c],h={clean:!0};f&&(b||(this._undoData||(this._undoData={}),this._undoData[c]={last:f.get("last"),unread:f.get("length_unread"),flagged:f.get("length_flagged")}),(this.folderTo.isSpam()||this.folderTo.isTrash())&&f.increment("length",g.total,h),f.increment("length_unread",g.unread,h),f.increment("length_flagged",g.flagged,h),!(d=(e=f.get("messages").filter({folder:f.get("folder")}).eq(0))?e.id:null)&&b&&this._undoData&&this._undoData[c]&&this._undoData[c].last&&(d=this._undoData[c].last),f.set("last",d,h))},this)},_undoData:null,_calculateMoveToParams:function(a,b){var c=a[0].constructor,d=c.List.pluck(a,"id"),e=c.List.fn.map.call(a,function(a){return{id:a.id,folder:String(a.get("folder"))}});return b&&(d=d.map(function(a){return this[a]},this._undoParams.ids),e=e.map(function(a){return a.id=this[a.id],a},this._undoParams.ids)),{ids:d,msg_ids:e}},_moveTo:function(a,b,c,d){var e,f,g=a[0],h=g.constructor,i=(d=d||this._calculateMoveToParams(a,c)).msg_ids,j=d.ids;return f={ids:JSON.stringify(j),msg_ids:JSON.stringify(i),folder:b},g instanceof hc&&(e=c?this._undoParams.last:j.reduce(function(a,b){return a.push(this._undoData[b].last),a}.bind(this),[]),f.message_id_last=JSON.stringify(A.object(j,e))),Ma.call(this._getRequestUrl(h,this.params,c),this._getRequestData(f,this.params,c)).then(function(a){return c||(this._undoParams={ids:a.get("body").reduce(function(a,b,c){return a[j[c]]=b,a},{}),last:e},h===hc&&Object.keys(this._undoParams.ids).forEach(function(a){var c=hc.get(a),d=this._undoParams.ids[a];hc.map({id:d,folder:b,messages:c.get("messages").toArray()})},this)),a}.bind(this))},_getRequestUrl:function(a,b,c){return a.url("moveTo")},_getRequestData:function(a,b,c){return a}});tb.register("mail.MoveTo",kc),kc.version="0.2.0";var lc=kc.extend({folderFrom:null,prepare:function(a){var b=a.folderTo,c=a.folderFrom;return b==c?null:(this._rollbackCounters={},this._rollbackFolders={},this._findFolders([b,c]).then(function(a){var b=hc.all.filter({folder:c});return 0===b.length&&(b=Rb.all.filter({folder:c})),this.models=b,this.folderTo=a[0],this.folderFrom=a[1],b}.bind(this)))},operation:function(a,b){return this._applyChanges(a,b.folderTo),Ma.call(Rb.url("moveToAll"),{folder:b.folderTo,folder_from:b.folderFrom})},undoOperation:function(){throw"Undo is not possible"},_applyChangesFolder:function(a,b){var c=Kb.get(this.params.folderTo),d=Kb.get(this.params.folderFrom),e=this._rollbackCounters;a={},b?(a[c.id]=e[c.id],a[d.id]=e[d.id]):(e[d.id]={unread:d.get("messages_unread"),total:d.get("messages_total")},e[c.id]={unread:-d.get("messages_unread"),total:-d.get("messages_total")},a[c.id]=e[d.id],a[d.id]=e[c.id]),kc.fn._applyChangesFolder.call(this,a)}});tb.register("mail.MoveToAll",lc),lc.version="0.1.1";var mc=tb.extend({folderFrom:null,prepare:function(a){return Kb.findOne(a.folderFrom).then(function(a){return this.folderFrom=a,a.isSecureOpen()?a:tb.waitFor("folderSecure",[a]).then(function(){return a})}.bind(this))},operation:function(a){return a.cleanup().then(function(){var b={folder:a.id};hc.all.filter(b).destroy(),Rb.all.filter(b).destroy()})}});tb.register("mail.DeleteAll",mc),mc.version="0.1.0";var nc=tb.extend({className:"mail.UserEditMetathreads",_isMetathreadsError:function(a){return"error"in a},prepare:function(a){if("object"!==d(a)||!a)return{error:!0,message:"invalid_params"};var b=Object.keys(Vb.METATHREADS_STATES).map(function(a){return Vb.METATHREADS_STATES[a]});return Object.keys(a).every(function(c){return Kb.OWN_METATHREADS_IDS.includes(+c)&&b.includes(a[c])})?Object.keys(a).map(function(b){return{folder_id:+b,state:a[b]}}):{error:!0,message:"invalid_metathread"}},operation:function(a){return this._isMetathreadsError(a)?Promise.reject(a):Ma.call(Vb.url("editMetathreadsSettings"),{metathread_visible:a})}});tb.register("mail.UserEditMetathreads",nc),nc.version="0.1.0";var oc={bodyObjectErrors:{to:{too_many_recipients:"too_many_recipients",invalid_addresses:"invalid_addresses"},capcha:{invalid:"captcha_invalid"}},bodyStringErrors:{mrim_disabled:"mrim_disabled",internal_error:"internal_error",possible_bad_guy:"possible_bad_guy",cant_get_msg:"cant_get_msg"},customErrors:{no_correspondents:"no_correspondents",invalid_params:"invalid_params",unknown_error:"unknown_error"}},pc=tb.extend({className:"mail.Redirect",_hasError:function(a){return"error"in a},prepare:function(a){return function(a){var b=a;return!!a&&"object"===d(b)&&void 0!==b.to&&Array.isArray(b.to)&&b.to.every(function(a){return"string"==typeof a})&&void 0!==b.folderId&&"number"==typeof b.folderId&&void 0!==b.id&&"string"==typeof b.id&&(void 0===b.captcha||"string"==typeof b.captcha)}(a)?0===a.to.length?{error:!0,message:oc.customErrors.no_correspondents}:{id:a.id,folder_id:a.folderId,to:a.to.join(", "),capcha:a.captcha}:{error:!0,message:oc.customErrors.invalid_params}},operation:function(a){var b=this;return this._hasError(a)?Promise.reject(a):Ma.post(Rb.url("redirect"),a,{}).catch(function(a){var c=JSON.parse(a.responseText);throw ua(ua({},c),b._postProcessError(a))})},_postProcessError:function(a){var b=oc.customErrors.unknown_error;return a.body&&"object"===d(a.body)&&Object.keys(a.body).forEach(function(c){var d=a.body[c].error;c in oc.bodyObjectErrors&&d in oc.bodyObjectErrors[c]&&(b=oc.bodyObjectErrors[c][d])}),"string"==typeof a.body&&a.body in oc.bodyStringErrors&&(b=a.body),{error:!0,message:b}}});tb.register("mail.Redirect",pc),pc.version="0.1.0";var qc=tb.extend({urls:{suggest:"ab/smart/suggest",default:"ab/smart"},fields:["id","emails","display_name","priority","nick","name"],operation:function(a){var b=a.search;if(void 0===b)return Promise.reject({search:"required"});var c={search:b},d=this.urls.suggest;return""===b&&(c={fields:this.fields,simple:!0},d=this.urls.default),a.limit&&(c.limit=a.limit),Ma.get(d,c).then(this._processResponse.bind(this,d))},_processResponse:function(a,b){var c=b.body||{},d=c.contacts||[];return a===this.urls.default&&(d=d.reduce(function(a,b){return b.emails?(b.emails.forEach(function(c){var d=Object.assign({},b);d.email=c,a.push(d)}),a):a},[])),{contacts:d,labels:c.labels||[]}}});tb.register("mail.ContactSuggests",qc),qc.version="1.0.0";var rc=tb.extend({className:"mail.CleanmasterUnreadManage",_isCleanmasterError:function(a){return"error"in a},prepare:function(a){if("object"!==d(a)||!a)return{error:!0,message:"invalid_params"};var b=Object.keys(rc.Methods).map(function(a){return rc.Methods[a]}),c=a.method;return b.includes(c)?c===rc.Methods.Unsubscribe?this._prepareUnsubscribe(a):a:{error:!0,message:"invalid_method"}},operation:function(a){return this._isCleanmasterError(a)?Promise.reject(a):a.method===rc.Methods.Unread?this._unread():this._unsubscribe(a)},_prepareUnsubscribe:function(a){return Array.isArray(a.emails)?a:{error:!0,message:"invalid_emails"}},_unread:function(){return Ma.get("golang/messages/services/cleanmaster/unread")},_unsubscribe:function(a){return Ma.call("golang/messages/services/cleanmaster/unsubscribe",{emails:a.emails})}});rc.Methods={Unsubscribe:"unsubscribe",Unread:"unread"},tb.register("mail.Cleanmaster",rc),rc.version="0.1.0";var sc=tb.extend({className:"mail.MessagesMeta",prepare:function(a){return"string"==typeof a&&a?a:{error:!0,message:"invalid_params"}},operation:function(a){return"string"!=typeof a?Promise.reject(a):Ma.call(Rb.url("meta"),{uidl:a})}});tb.register("mail.MessagesMeta",sc),sc.version="0.1.0";var tc=tb.extend({url:{signup:"utils/password/strength",change:"user/password/strength",restore:"user/password/restore/strength"},reasons:["like_current_password","like_dictionary_word","like_username","like_firstname","like_lastname","like_nickname","like_birthdate","like_city","like_phone","like_secret_question","weak","invalid","only_digits"],grades:4,gradesName:{INITIAL:1,LOW:2,MIDDLE:3,HIGH:4},operation:function(a){if(!a.password)return Promise.reject({password:"required"});var b=a.type,c=this.url[b];return c||(c=this.url.signup),Ma.call(c,a).then(this._processResponse.bind(this))},_processResponse:function(a){var b=a.body||{};return{reasons:b.reasons||[],warningReasons:b.warning_reasons||[]}}});tb.register("mail.PasswordStrength",tc),tc.version="0.4.0";var uc=tb.extend({regToken:{target:"user/password/restore",format:"default"},urls:{options:"user/password/restore",send:"tokens/send",check:"tokens/check",changePassword:"user/password/restore/confirm"},required:{getOptions:["email"],sendToken:["by","token"],checkToken:["token","value"],changePassword:["restoreToken","password"]},_processResponse:function(a){return a.body},_getOptions:function(a){return Ma.call(this.urls.options,{email:a.email}).then(this._processResponse.bind(this))},_sendToken:function(a){var b=this.regToken;b.transport=a.by,b.id=a.token,b.previous_id=a.previousToken,b.address=a.address,b.index=a.index,delete b.value,a.redirectUri&&(b.redirect_uri=a.redirectUri);var c={email:a.email,capcha:a.captcha,reg_token:JSON.stringify(b)};return a.callui&&(c.callui=a.callui),Ma.call(this.urls.send,c).then(this._processResponse.bind(this))},_checkToken:function(a){var b=this.regToken;return b.transport=a.by,b.id=a.token,b.value=a.value,a.captcha&&(b.captcha=a.captcha),Ma.call(this.urls.check,{email:a.email,reg_token:JSON.stringify(b)}).then(this._processResponse.bind(this))},_changePassword:function(a){var b={email:a.email,reg_token_check:a.restoreToken,password:a.password};return a.redirectUri&&(b.redirect_uri=a.redirectUri),a.morePasswordStrength&&(b.more_password_strength="1"),a.webView&&(b.webview=!0),Ma.call(this.urls.changePassword,b).then(this._processResponse.bind(this))},_validate:function(a){var b={},c=JSON.parse(JSON.stringify(this.required[a.method]))||[];return(c=c.filter(function(b){return!a.hasOwnProperty(b)})).length?(c.forEach(function(a){b[a]="required"}),b):null},operation:function(a){var b,c;return a.method?"function"!=typeof(c=this["_".concat(a.method)])?Promise.reject({method:"invalid"}):(b=this._validate(a))?Promise.reject(b):c.call(this,a):Promise.reject({method:"required"})}});uc.methods={OPTIONS:"getOptions",SEND:"sendToken",CHECK:"checkToken",CHANGE_PASSWORD:"changePassword"},uc.transports={PHONE:"phone",EMAIL:"email",PUSH:"push"},tb.register("mail.PasswordRecovery",uc),uc.version="0.3.0";var vc=rb.extend({className:"filters.Filter",findUrl:"filters",addSeveralUrl:"filters/add",changeOrderUrl:"/cgi-bin/settings/ajax_filters_order?func_name=move",switchEnabledUrl:"/cgi-bin/settings/ajax_settings?ajax_call=1&func_name=switch_filter",confirmForwardUrl:"/cgi-bin/settings/ajax_settings?ajax_call=1&func_name=confirm_filter_email",resendConfirmUrl:"/cgi-bin/settings/ajax_settings?ajax_call=1&func_name=confirm_filter_email_resend",editUrl:"filters/edit",removeUrl:"filters/remove",searchUrl:"filters/search",messagesMatchUrl:"filters/messages/match",defaults:{id:null,enabled:!0,applyToSpam:!1,continue:!1,conditionsOr:!1,isAutoFilter:!1,isForAlias:!1,maillistId:0,conditions:[],actions:{remove:!1,move:0,read:!1,flag:!1,forward:[],notify:[],reply:"",reject:!1,replace_category:null},apply_folders:[]},isShareGive:function(){return"give"===this.get("share")},isShareTake:function(){return"take"===this.get("share")},isOwn:function(){return!this.isShareTake()},checkGrant:function(a){var b,c=this.get("owner");return!c||Boolean(null===(b=c.filters_grants)||void 0===b?void 0:b[a])},isOwner:function(a){var b=this.get("owner");return b&&b.email===a},isAuthor:function(a){var b=this.get("author");return b&&b.email===a},isForward:function(){var a,b,c=this.get("actions");return!!(null===(a=null==c?void 0:c.forward)||void 0===a?void 0:a.length)&&!c.reply&&!c.remove&&!c.flag&&!c.read&&!c.reject&&0==+c.move&&0===(null===(b=this.get("conditions"))||void 0===b?void 0:b.length)&&this.get("continue")},isEditable:function(a){var b,c,d,e,f,g,h;void 0===a&&(a={});var i=a.email,j=!0;return this.isShareTake()&&(j=this.checkGrant(vc.SHARE_GRANTS.edit_filter),i&&this.isAuthor(i)&&(j=this.checkGrant(vc.SHARE_GRANTS.add_filter)),((null===(c=null===(b=this.get("actions"))||void 0===b?void 0:b.forward)||void 0===c?void 0:c.length)||(null===(e=null===(d=this.get("actions"))||void 0===d?void 0:d.notify)||void 0===e?void 0:e.length)||(null===(f=this.get("actions"))||void 0===f?void 0:f.reply)||(null===(g=this.get("actions"))||void 0===g?void 0:g.reject)||(null===(h=this.get("actions"))||void 0===h?void 0:h.remove))&&(j=!1)),j},isRemovable:function(a){void 0===a&&(a={});var b=a.email,c=!0;return this.isShareTake()&&(c=this.checkGrant(vc.SHARE_GRANTS.remove_filter),b&&this.isAuthor(b)&&(c=this.checkGrant(vc.SHARE_GRANTS.add_filter))),c}});vc.fetchMessagesMatch=function(a){return Ma.call(vc.url("messagesMatch"),a)},A.extend(vc,{SHARE_TAKE:"take",SHARE_GIVE:"give",SHARE_GRANTS:{add_filter:"add_filter",edit_filter:"edit_filter",remove_filter:"remove_filter"}}),vc.version="1.0.0";var wc=tb.extend({url:vc.url("changeOrder"),operation:function(a){var b=a.ids,c=Ma.setup(),d=c.email,e=(""+c.token).split(":");return b?(this._requestData={"x-email":d,form_sign:e[0],form_token:e[1],filter_ids:b.join(","),ajax_call:1},da(this.url,this._requestData,{type:"POST"}).then(function(a){var c=a.body;if(!c)return Promise.reject({body:"parse_error"});if("OK"!==c[1])return Promise.reject({body:"status"});var d=c[2];if(d.hasOwnProperty("Error"))return Promise.reject({bodyError:d.Error});var e=b.map(function(a){return vc.all.get(a)});return new vc.List(e)})):Promise.reject({ids:"required"})}});tb.register("filters.ChangeOrder",wc),wc.version="0.1.0";var xc=tb.extend({url:vc.url("confirmForward"),operation:function(a){var b=Ma.setup(),c=b.email,d=(""+b.token).split(":");return a.model?a.id?a.code?a.password?(this._requestData={"x-email":c,form_sign:d[0],form_token:d[1],id:a.id,code:a.code,password:a.password,ajax_call:1},da(this.url,this._requestData,{type:"POST"}).then(function(b){var c=b.body;if(!c)return Promise.reject({body:"parse_error"});if("OK"!==c[1])return Promise.reject({body:"status"});var d=c[2];return d.hasOwnProperty("Error")?Promise.reject({bodyError:d.What||"error"}):(a.model.get("actions.forward").some(function(b,c){b.id===a.id&&a.model.set("actions.forward."+c+".verified",!0)}),a.model.get("actions.notify").some(function(b,c){b.id===a.id&&a.model.set("actions.notify."+c+".verified",!0)}),a.model)})):Promise.reject({password:"required"}):Promise.reject({code:"required"}):Promise.reject({id:"required"}):Promise.reject({model:"required"})}});tb.register("filters.ConfirmForward",xc),xc.version="0.1.0";var yc=tb.extend({url:vc.url("edit"),prepare:function(a){return this._removeEmptyParams(a)},_removeEmptyParams:function(a){return a.filters.forEach(function(a){a.actions.notify&&!a.actions.notify.length&&delete a.actions.notify,null===a.actions.replace_category&&delete a.actions.replace_category}),a},operation:function(a){var b={};return a.filters.forEach(function(a,c){a.id||(b["filters."+c+".id"]="required")}),Object.keys(b).length?Promise.reject(b):Ma.call(this.url,a).then(function(b){return yc.processResult(a,b)})}});yc.processResult=function(a,b){return vc.map(a.filters.map(function(a,c){return a.id=b.get("body."+c),a.apply_folders=b.get("data.apply_folders"),a.conditions||(a.conditions=[]),a}))},tb.register("filters.Edit",yc),yc.version="0.1.0";var zc=tb.extend({url:vc.url("resendConfirm"),operation:function(a){var b=Ma.setup(),c=b.email,d=(""+b.token).split(":");return a?(this._requestData={"x-email":c,form_sign:d[0],form_token:d[1],id:a,ajax_call:1},da(this.url,this._requestData,{type:"POST"}).then(function(a){var b=a.body;if(!b)return Promise.reject({body:"parse_error"});if("OK"!==b[1])return Promise.reject({body:"status"});var c=b[2];return"OK"!==c.Result?Promise.reject({bodyError:c.What||"error"}):a})):Promise.reject({id:"required"})}});tb.register("filters.ResendConfirm",zc),zc.version="0.1.0";var Ac=tb.extend({prepare:function(a){return this._removeEmptyParams(a)},_removeEmptyParams:function(a){return a.filters.forEach(function(a){a.actions.notify&&!a.actions.notify.length&&delete a.actions.notify,null===a.actions.replace_category&&delete a.actions.replace_category}),a},operation:function(a){return Ma.call(vc.url("addSeveral"),a).then(function(b){return Ac.processResult(a,b)})}});Ac.processResult=function(a,b){return vc.map(a.filters.map(function(a,c){return a.id=b.get("body."+c),a.apply_folders=b.get("data.apply_folders"),a}))},tb.register("filters.SaveSeveral",Ac),Ac.version="0.1.0";var Bc=tb.extend({url:vc.url("switchEnabled"),operation:function(a){var b=a.model;if(!b.id)return Promise.reject({id:"required"});var c=Ma.setup(),d=c.email,e=(""+c.token).split(":");return this._requestData={"x-email":d,form_sign:e[0],form_token:e[1],id:b.get("id"),on:a.enabled?1:0,ajax_call:1},da(this.url,this._requestData,{type:"POST"}).then(function(a){var c=a.body;if(!c)return Promise.reject({body:"parse_error"});if("OK"!==c[1])return Promise.reject({body:"status"});var d=c[2];if(d.hasOwnProperty("Error"))return Promise.reject({bodyError:d.Error});var e=!!parseInt(d.Enabled,10);return b.set("enabled",e),{model:b,enabled:e}})}});tb.register("filters.SwitchEnabled",Bc),Bc.version="0.1.0";var Cc,Dc=rb.extend({className:"oauth.Application",findUrl:"oauth/applications",removeUrl:"oauth/applications/revoke",defaults:{title:"",icons:{},scopes:[]}});Dc.version="0.2.0";var Ec,Fc={status:"denied:nosdc",process:function(a,b){if(!Cc){var c=A.urlToAbsolute(a.get("url")),d=(b||Ma).setup("sdcUrl");Cc=da.get(d,{from:c},window.IS_TESTS?{}:{jsonp:"JSONP_call",dataType:"jsonp",force:!0}).then(function(a){return a}).catch(function(a){return a}).then(function(a){return Cc=null,a}).then(function(a){return!!a.body||Promise.reject()})}return Cc}};Ma.attachBaseErrorHandler(Fc);var Gc={status:"denied:token",process:function(a,b){if(!Ec){var c=function(){Ec=null,O.add("remove persistent promise")};Ec=(b||Ma).call("tokens",{},{force:!0}).then(Q.done(c),Q.fail(c))}return Ec.then(Q.done(function(c){var d=c.get("body.token");O.add("RPC.newToken",d),a.data.token=d,(b||Ma).setup("token",d)}))}};Ma.attachBaseErrorHandler(Gc);var Hc={status:"processing",process:function(a){var b=a.get("body.retry_after");return O.add("processing.retry_after",b),a.options.retries++,function(a){setTimeout(function(){O.add("processing.retry_after.resolve",b),a()},b)}}};Ma.attachBaseErrorHandler(Hc);var Ic={status:"invalid",process:function(a){var b=function(a){for(var b,c,d,e=a.body,f=void 0===e?{}:e,g=0,h=Object.keys(f);g<h.length;g++){var i=h[g];if("not_open"===(null==(d=f[i])?void 0:d.error)){c=i,b=f[i];break}}return b?{errorField:b,errorKey:c}:{}}(a);if("errorField"in b)return O.add("invalid.folder.error",b),Kb.findOne(b.errorField.value).then(function(a){return tb.waitFor("folderSecure",[a])})}};Ma.attachBaseErrorHandler(Ic);var Jc={uuid:o,utils:{url:yb,util:A,extension:xb},request:da,RPC:Ma,RPCModel:rb,Action:tb,Emitter:C,logger:O,Model:qb,ModelList:bb,Transaction:qa,mail:{actions:{UserSignatureAttachesAdd:fc,DeleteAll:mc,MoveToAll:lc,UserEditMetathreads:nc,ContactSuggests:qc,Redirect:pc,CleanmasterUnreadManage:rc,MessagesMeta:sc,PasswordStrength:tc,PasswordRecovery:uc},getters:{MessageMeta:Object.freeze({__proto__:null,getCategoriesFromMeta:function(a){var b=a.get("meta"),c=null==b?void 0:b.find(function(a){return a["@context"]===Rb.CATEGORY_META.context&&a["@type"]===Rb.CATEGORY_META.type});return"object"===d(c)&&Array.isArray(c.categories)?c.categories:null}})},Attachment:Cb,Alias:Db,Collector:Fb,Message:Rb,Folder:Kb,SharedMailbox:Sb,User:Vb,UserSecurity:Wb},filters:{Filter:vc,actions:{ChangeOrder:wc,ConfirmForward:xc,Edit:yc,ResendConfirm:zc,SaveSeveral:Ac,SwitchEnabled:Bc}},oauth:{Application:Dc}};a.exports=Jc},7371:function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.checkFeedback=void 0;var d=c(9562);function e(a,b){return void 0===b&&(b=null),(d.RPC.hasToken()?Promise.resolve():d.RPC.token()).then(function(){return d.RPC.call(a,b)})}b.checkFeedback=function(a){return e("feedback/nps/check",{id:a})}},4434:function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.setupRpc=void 0;var d=c(9562);b.setupRpc=function(a){d.RPC.setup({email:a.userId,timeout:0,baseUrl:"/api/",sdcUrl:a.sdcUrl||"https://auth.mail.ru/sdc"})}},1326:function(a,b){"use strict";var c=this&&this.__assign||function(){return c=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},c.apply(this,arguments)};Object.defineProperty(b,"__esModule",{value:!0}),b.FrameLoader=void 0;var d={surveyId:"",domain:"e.mail.ru",iframeScrolling:"auto"},e=function(){function a(a){this.frame=null,this.params=c(c({},d),a),this.handlePostMessage=this.handlePostMessage.bind(this)}return a.prototype.open=function(){var a,b,c=this.createSrc(),d=this.params,e=d.iframeScrolling,f=d.styles,g=document.createElement("iframe");g.frameBorder="0",g.scrolling=e,g.src=c,g.width="336px",g.height="146px",g.style.border="none",g.style.display="block",g.style.position="fixed",g.style.zIndex=String((null==f?void 0:f.zIndex)||500),g.style.bottom=(null==f?void 0:f.bottom)||"0px",g.style.left=(null==f?void 0:f.left)||"0px",window.addEventListener("message",this.handlePostMessage),null===(b=null===(a=window.document)||void 0===a?void 0:a.body)||void 0===b||b.appendChild(g),this.frame=g},a.prototype.getFrameOrigin=function(){return"https://"+(this.params.domain||d.domain)},a.prototype.createSrc=function(){var a=this.params,b=a.surveyId,c=a.darkTheme;return this.getFrameOrigin()+"/feedback/nps?id="+b+"&mode=popup&type=csat&origin="+location.origin+"&darkTheme="+(c?"1":"0")},a.prototype.setDarkTheme=function(a){this.params.darkTheme=!!a,this.sendMessage({action:"setTheme",params:{darkTheme:!!a}})},a.prototype.setSize=function(a){var b=a.width,c=a.height;this.frame&&(b&&(this.frame.width=b+"px"),c&&(this.frame.height=c+"px"))},a.prototype.sendMessage=function(a){var b,d=null===(b=this.frame)||void 0===b?void 0:b.contentWindow,e=this.getFrameOrigin();d&&d.postMessage(c(c({},a),{type:"feedback-evt"}),e)},a.prototype.handlePostMessage=function(a){var b=a.origin,c=a.source,d=a.data;if(this.frame&&b===this.getFrameOrigin()&&c===this.frame.contentWindow&&d&&"feedback-evt"===d.type)switch(d.action){case"close":return this.close();case"setSize":return this.setSize(d.params)}},a.prototype.close=function(){var a,b,c;window.removeEventListener("message",this.handlePostMessage),null===(a=this.frame)||void 0===a||a.remove(),this.frame=null,null===(c=(b=this.params).onClose)||void 0===c||c.call(b)},a}();b.FrameLoader=e},1324:function(a,b,c){"use strict";var d=this&&this.__assign||function(){return d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},d.apply(this,arguments)};Object.defineProperty(b,"__esModule",{value:!0}),b.FeedbackLoader=void 0;var e=c(7371),f=c(4434),g=c(1326),h=c(5950),i=c(7738),j=c(2532),k=function(){function a(a){this.frameLoader=null,this.config=d({},a),this.storage=i.createStorage(this.config.userId),f.setupRpc(this.config),this.onClose=this.onClose.bind(this)}return a.prototype.getSaltedUser=function(){var a=this.config;return""+a.userId+a.surveyId+j.getUtcToday()},a.prototype.update=function(){var a=this,b=j.getUtcToday(),c=this.storage.get("lastCheck");if(this.config.forced)return this.show(),Promise.resolve();if(b===c)return Promise.reject();if(this.storage.set("lastCheck",b),!this.checkLastShow())return Promise.reject();var d=this.config,e=d.userId,f=d.permille,g=d.dryRun,h=d.radar,i=d.surveyId;return null==h||h("feedback-loader_update",{userId:e,permille:f,surveyId:i,dryRun:g}),this.checkJigurda()?(null==h||h("feedback-loader_jigurda-pass",{userId:e,permille:f,surveyId:i,dryRun:g}),g?Promise.resolve():this.checkApi().then(function(b){if(null==h||h("feedback-loader_api-"+(b?"pass":"fail"),{userId:e,permille:f,surveyId:i,dryRun:g}),!b)throw!1;a.show()})):Promise.reject()},a.prototype.checkLastShow=function(){var a=this.storage.get("lastShow"),b=this.config.repeatInterval;return!b||!a||j.isDateOlderThan(a,b)},a.prototype.checkJigurda=function(){var a=this.config.permille,b=this.getSaltedUser();return h.jigurda(b)<a},a.prototype.checkApi=function(){var a=this.config.surveyId;return e.checkFeedback(a).then(function(a){return!(a&&a.get&&a.get("body.voted"))})},a.prototype.show=function(){if(!this.frameLoader){var a=this.config,b=a.surveyId,c=a.userId,d=a.domain,e=a.styles,f=a.darkTheme,h=a.radar;this.frameLoader=new g.FrameLoader({surveyId:b,domain:d,styles:e,darkTheme:f,onClose:this.onClose}),this.frameLoader.open(),this.storage.set("lastShow",j.getUtcToday()),null==h||h("feedback-loader_show",{userId:c,surveyId:b})}},a.prototype.close=function(){if(this.frameLoader){this.frameLoader.close();var a=this.config,b=a.surveyId,c=a.userId,d=a.radar;null==d||d("feedback-loader_close",{userId:c,surveyId:b})}},a.prototype.setDarkTheme=function(a){var b;this.config.darkTheme=!!a,null===(b=this.frameLoader)||void 0===b||b.setDarkTheme(a);var c=this.config,d=c.surveyId,e=c.userId,f=c.radar;null==f||f("feedback-loader_set-dark_"+(a?"on":"off"),{userId:e,surveyId:d})},a.prototype.onClose=function(){this.frameLoader=null},a.prototype._getStorage=function(){return this.storage},a}();b.FeedbackLoader=k},5950:function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.jigurda=void 0,b.jigurda=function(a){var b=0,c=0;b^=-1;for(var d=0,e=a.length;d<e;d++)c=255&(b^a.charCodeAt(d)),b=b>>>8^"0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*c,8);return b=(-1^b)>>>0,b%=1e3}},7738:function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createStorage=b.Storage=void 0;var c=function(){function a(a){void 0===a&&(a=""),this.userId="",this.userId=a;try{this.storage=window.localStorage}catch(a){this.storage={}}}return a.prototype.getExpandedKey=function(a){return(this.userId||"")+":feedback:"+a},a.prototype.set=function(a,b){var c=this.getExpandedKey(a);try{this.storage[c]=JSON.stringify(b)}catch(a){}},a.prototype.get=function(a){var b=this.getExpandedKey(a);try{return JSON.parse(this.storage[b])}catch(a){return null}},a}();b.Storage=c,b.createStorage=function(a){return void 0===a&&(a=""),new c(a)}},2532:function(a,b){"use strict";function c(){var a=new Date;return a.setUTCHours(0,0,0,0),a.getTime()}Object.defineProperty(b,"__esModule",{value:!0}),b.isDateOlderThan=b.getUtcToday=b.DAY=void 0,b.DAY=864e5,b.getUtcToday=c,b.isDateOlderThan=function(a,d){return c()-d*b.DAY>=a}},293:function(a,b){var c;!function(a){"use strict";var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c=a.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),d=c&&a.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(a){return!1}}(),e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=(c||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,f,g,h,i,j;for(b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]),f=new ArrayBuffer(b.length),g=new Uint8Array(f),h=0;h<b.length;h+=1)g[h]=b.charCodeAt(h);return i=a.split(",")[0].split(":")[1].split(";")[0],c?new Blob([d?g:f],{type:i}):((j=new e).append(f),j.getBlob(i))};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,c,d){d&&b.toDataURL&&f?a(f(this.toDataURL(c,d))):a(this.mozGetAsFile("blob",c))}:b.toDataURL&&f&&(b.toBlob=function(a,b,c){a(f(this.toDataURL(b,c)))})),a.dataURLtoBlob=f}(window),function(a,b){"use strict";var c,d,e=1,f=function(){},g=a.document,h=g.doctype||{},i=a.navigator.userAgent,j=/safari\//i.test(i)&&!/chrome\//i.test(i),k=/iemobile\//i.test(i),l=!j&&/chrome\//i.test(i)&&"http:"===a.location.protocol,m=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,n=a.Blob,o=a.File,p=a.FileReader,q=a.FormData,r=a.XMLHttpRequest,s=a.jQuery,t=!(!(o&&p&&(a.Uint8Array||q||r.prototype.sendAsBinary))||j&&/windows/i.test(i)&&!k),u=t&&"withCredentials"in new r,v=t&&!!n&&!!(n.prototype.webkitSlice||n.prototype.mozSlice||n.prototype.slice),w=(""+"".normalize).indexOf("[native code]")>0,x=a.dataURLtoBlob,y=/img/i,z=/canvas/i,A=/img|canvas/i,B=/input/i,C=/^data:[^,]+,/,D={}.toString,E=a.Math,F=function(b){return(b=new a.Number(E.pow(1024,b))).from=function(a){return E.round(a*this)},b},G={},H=[],I="abort progress error load loadend",J="status statusText readyState response responseXML responseText responseBody".split(" "),K=function(a){return a&&"length"in a},L=function(a,b,c){if(a)if(K(a))for(var d=0,e=a.length;d<e;d++)d in a&&b.call(c,a[d],d,a);else for(var f in a)a.hasOwnProperty(f)&&b.call(c,a[f],f,a)},M=function(a){for(var b=arguments,c=1,d=function(b,c){a[c]=b};c<b.length;c++)L(b[c],d);return a},N=function(a,b,c){if(a){var d=S.uid(a);G[d]||(G[d]={});var e=p&&a&&a instanceof p;L(b.split(/\s+/),function(b){s&&!e?s.event.add(a,b,c):(G[d][b]||(G[d][b]=[]),G[d][b].push(c),a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c)})}},O=function(a,b,c){if(a){var d=S.uid(a),e=G[d]||{},f=p&&a&&a instanceof p;L(b.split(/\s+/),function(b){if(s&&!f)s.event.remove(a,b,c);else{for(var d=e[b]||[],g=d.length;g--;)if(d[g]===c){d.splice(g,1);break}a.addEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null}})}},P=function(a,b,c){N(a,b,function d(e){O(a,b,d),c(e)})},Q=function(b){return b.target||(b.target=a.event&&a.event.srcElement||g),3===b.target.nodeType&&(b.target=b.target.parentNode),b},R=function(a){var b=g.createElement("input");return b.setAttribute("type","file"),a in b},S={version:"2.1.1",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,insecureChrome:l,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(a,b){return a+(null!=b?"["+b+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:F(1),MB:F(2),GB:F(3),TB:F(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(a){return a?a[S.expando]=a[S.expando]||S.uid():(++e,S.expando+e)},log:function(){S.debug&&c&&(d?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(a,b){var c=g.createElement("img");return b&&S.event.one(c,"error load",function(a){b("error"==a.type,c),c=null}),c.src=a,c},getXHR:function(){var b;if(r)b=new r;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(a){b=new ActiveXObject("Microsoft.XMLHTTP")}return b},isArray:K,support:{dnd:u&&"ondrop"in g.createElement("div"),cors:u,html5:t,chunked:v,dataURI:!0,accept:R("accept"),multiple:R("multiple")},event:{on:N,off:O,one:P,fix:Q},throttle:function(b,c){var d,e;return function(){e=arguments,d||(b.apply(a,e),d=setTimeout(function(){d=0,b.apply(a,e)},c))}},F:function(){},parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(a){return(a=String(a)).trim?a.trim():a.replace(/^\s+|\s+$/g,"")},defer:function(){var a,c,d=[],e={resolve:function(b,g){for(e.resolve=f,c=b||!1,a=g;g=d.shift();)g(c,a)},then:function(e){c!==b?e(c,a):d.push(e)}};return e},queue:function(a){var b=0,c=0,d=!1,e=!1,f={inc:function(){c++},next:function(){b++,setTimeout(f.check,0)},check:function(){b>=c&&!d&&f.end()},isFail:function(){return d},fail:function(){!d&&a(d=!0)},end:function(){e||(e=!0,a())}};return f},each:L,afor:function(a,b){var c=0,d=a.length;K(a)&&d--?function e(){b(d!=c&&e,a[c],c++)}():b(!1)},extend:M,isFile:function(a){return"[object File]"===D.call(a)},isBlob:function(a){return this.isFile(a)||"[object Blob]"===D.call(a)},isCanvas:function(a){return a&&z.test(a.nodeName)},getFilesFilter:function(a){return(a="string"==typeof a?a:a.getAttribute&&a.getAttribute("accept")||"")?new RegExp("("+a.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(a,b){S.isCanvas(a)?T(a,b,"load",S.toDataURL(a)):V(a,b,"DataURL")},readAsBinaryString:function(a,b){U("BinaryString")?V(a,b,"BinaryString"):V(a,function(a){if("load"==a.type)try{a.result=S.toBinaryString(a.result)}catch(b){a.type="error",a.message=b.toString()}b(a)},"DataURL")},readAsArrayBuffer:function(a,b){V(a,b,"ArrayBuffer")},readAsText:function(a,b,c){c||(c=b,b="utf-8"),V(a,c,"Text",b)},toDataURL:function(a,b){return"string"==typeof a?a:a.toDataURL?a.toDataURL(b||"image/png"):void 0},toBinaryString:function(b){return a.atob(S.toDataURL(b).replace(C,""))},readAsImage:function(a,c,d){if(S.isBlob(a))if(m){var e=m.createObjectURL(a);e===b?T(a,c,"error"):S.readAsImage(e,c,d)}else S.readAsDataURL(a,function(b){"load"==b.type?S.readAsImage(b.result,c,d):(d||"error"==b.type)&&T(a,c,b,null,{loaded:b.loaded,total:b.total})});else if(S.isCanvas(a))T(a,c,"load",a);else if(y.test(a.nodeName))if(a.complete)T(a,c,"load",a);else{var f="error abort load";P(a,f,function b(d){"load"==d.type&&m&&m.revokeObjectURL(a.src),O(a,f,b),T(a,c,d,a)})}else if(a.iframe)T(a,c,{type:"error"});else{var g=S.newImage(a.dataURL||a);S.readAsImage(g,c,d)}},checkFileObj:function(a){var b={},c=S.accept;return"object"==typeof a?b=a:b.name=(a+"").split(/\\|\//g).pop(),null==b.type&&(b.type=b.name.split(".").pop()),L(c,function(a,c){((a=new RegExp(a.replace(/\s/g,"|"),"i")).test(b.type)||S.ext2mime[b.type])&&(b.type=S.ext2mime[b.type]||c.split("/")[0]+"/"+b.type)}),b},getDropFiles:function(a,b){var c,d=[],e=[],f=Z(a),g=f.files,h=f.items,i=K(h)&&h[0]&&X(h[0]),k=S.queue(function(){b(d,e)});if(i)if(w&&g){var l,m,n=g.length;for(c=new Array(n);n--;){l=g[n];try{m=X(h[n])}catch(a){S.log("[err] getDropFiles: ",a),m=null}W(m)&&(m.isDirectory||m.isFile&&l.name==l.name.normalize("NFC"))?c[n]=m:c[n]=l}}else c=h;else c=g;L(c||[],function(a){k.inc();try{i&&W(a)?Y(a,function(a,b,c){a?S.log("[err] getDropFiles:",a):d.push.apply(d,b),e.push.apply(e,c),k.next()}):function(a,b){if(!a.type&&(j||a.size%4096==0&&a.size<=102400))if(p)try{var c=new p;P(c,I,function(a){var d="error"!=a.type;d?(null!=c.readyState&&c.readyState!==c.LOADING||c.abort(),b(d)):b(!1,c.error)}),c.readAsDataURL(a)}catch(a){b(!1,a)}else b(null,new Error("FileReader is not supported"));else b(!0)}(a,function(b,c){b?d.push(a):a.error=c,e.push(a),k.next()})}catch(a){k.next(),S.log("[err] getDropFiles: ",a)}}),k.check()},getFiles:function(a,b,c){var d=[];return c?(S.filterFiles(S.getFiles(a),b,c),null):(a.jquery&&(a.each(function(){d=d.concat(S.getFiles(this))}),a=d,d=[]),"string"==typeof b&&(b=S.getFilesFilter(b)),a.originalEvent?a=Q(a.originalEvent):a.srcElement&&(a=Q(a)),a.dataTransfer?a=a.dataTransfer:a.target&&(a=a.target),a.files?(d=a.files,t||(d[0].blob=a,d[0].iframe=!0)):!t&&$(a)?S.trim(a.value)&&((d=[S.checkFileObj(a.value)])[0].blob=a,d[0].iframe=!0):K(a)&&(d=a),S.filter(d,function(a){return!b||b.test(a.name)}))},getTotalSize:function(a){for(var b=0,c=a&&a.length;c--;)b+=a[c].size;return b},getInfo:function(a,b){var c={},d=H.concat();S.isBlob(a)?function e(){var f=d.shift();f?f.test(a.type)?f(a,function(a,d){a?b(a):(M(c,d),e())}):e():b(!1,c)}():b("not_support_info",c)},addInfoReader:function(a,b){b.test=function(b){return a.test(b)},H.push(b)},filter:function(a,b){for(var c,d=[],e=0,f=a.length;e<f;e++)e in a&&(c=a[e],b.call(c,c,e,a)&&d.push(c));return d},filterFiles:function(a,b,c){if(a.length){var d,e=a.concat(),f=[],g=[];!function a(){e.length?(d=e.shift(),S.getInfo(d,function(c,e){(b(d,!c&&e)?f:g).push(d),a()})):c(f,g)}()}else c([],a)},upload:function(a){(a=M({jsonp:"callback",prepare:S.F,beforeupload:S.F,upload:S.F,fileupload:S.F,fileprogress:S.F,filecomplete:S.F,progress:S.F,complete:S.F,pause:S.F,imageOriginal:!0,chunkSize:S.chunkSize,chunkUploadRetry:S.chunkUploadRetry,uploadRetry:S.uploadRetry},a)).imageAutoOrientation&&!a.imageTransform&&(a.imageTransform={rotate:"auto"});var b,c=new S.XHR(a),d=this._getFilesDataArray(a.files),e=this,g=0,h=0,i=!1;return L(d,function(a){g+=a.size}),c.files=[],L(d,function(a){c.files.push(a.file)}),c.total=g,c.loaded=0,c.filesLeft=d.length,a.beforeupload(c,a),b=function(){var j,k=d.shift(),l=k&&k.file,m=!1,n=(j={},L(a,function(a,b){a&&"object"==typeof a&&void 0===a.nodeType&&(a=M({},a)),j[b]=a}),j);if(c.filesLeft=d.length,l&&l.name===S.expando&&(l=null,S.log("[warn] FileAPI.upload() — called without files")),("abort"!=c.statusText||c.current)&&k){if(i=!1,c.currentFile=l,l&&!1===a.prepare(l,n))return void b.call(e);n.file=l,e._getFormData(n,k,function(i){h||a.upload(c,a);var j=new S.XHR(M({},n,{upload:l?function(){a.fileupload(l,j,n)}:f,progress:l?function(b){m||(m=b.loaded===b.total,a.fileprogress({type:"progress",total:k.total=b.total,loaded:k.loaded=b.loaded},l,j,n),a.progress({type:"progress",total:g,loaded:c.loaded=h+k.size*(b.loaded/b.total)||0},l,j,n))}:f,complete:function(d){L(J,function(a){c[a]=j[a]}),l&&(k.total=k.total||k.size,k.loaded=k.total,d||(this.progress(k),m=!0,h+=k.size,c.loaded=h),a.filecomplete(d,j,l,n)),setTimeout(function(){b.call(e)},0)}}));c.abort=function(a){a||(d.length=0),this.current=a,j.abort()},j.send(i)})}else{var o=200==c.status||201==c.status||204==c.status;a.complete(!o&&(c.statusText||"error"),c,a),i=!0}},setTimeout(b,0),c.append=function(a,f){a=S._getFilesDataArray([].concat(a)),L(a,function(a){g+=a.size,c.files.push(a.file),f?d.unshift(a):d.push(a)}),c.statusText="",i&&b.call(e)},c.remove=function(a){for(var b,c=d.length;c--;)d[c].file==a&&(b=d.splice(c,1),g-=b.size);return b},c},_getFilesDataArray:function(a){var b=[],c={};if($(a)){var d=S.getFiles(a);c[a.name||"file"]=null!==a.getAttribute("multiple")?d:d[0]}else K(a)&&$(a[0])?L(a,function(a){c[a.name||"file"]=S.getFiles(a)}):c=a;return L(c,function a(c,d){K(c)?L(c,function(b){a(b,d)}):c&&(c.name||c.image)&&b.push({name:d,file:c,size:c.size,total:c.size,loaded:0})}),b.length||b.push({file:{name:S.expando}}),b},_getFormData:function(a,b,c){var d=b.file,e=b.name,f=d.name,g=d.type,h=S.support.transform&&a.imageTransform,i=new S.Form,j=S.queue(function(){c(i)}),k=h&&function(a){var b;for(b in a)if(a.hasOwnProperty(b)&&!(a[b]instanceof Object||"overlay"===b||"filter"===b))return!0;return!1}(h),l=S.postNameConcat;L(a.data,function a(b,c){"object"==typeof b?L(b,function(b,d){a(b,l(c,d))}):i.append(c,b)}),function b(c){c.image?(j.inc(),c.toData(function(a,d){c.file&&(d.type=c.file.type,d.quality=c.matrix.quality,f=c.file&&c.file.name),f=f||(new Date).getTime()+".png",b(d),j.next()})):S.Image&&h&&(/^image/.test(c.type)||A.test(c.nodeName))?(j.inc(),k&&(h=[h]),S.Image.transform(c,h,a.imageAutoOrientation,function(b,d){if(k&&!b)x||S.flashEngine||(i.multipart=!0),i.append(e,d[0],f,h[0].type||g);else{var m=0;b||L(d,function(a,b){x||S.flashEngine||(i.multipart=!0),h[b].postName||(m=1),i.append(h[b].postName||l(e,b),a,f,h[b].type||g)}),(b||a.imageOriginal)&&i.append(l(e,m?"original":null),c,f,g)}j.next()})):f!==S.expando&&i.append(e,c,f)}(d),j.check()},reset:function(a,b){var c,d;return s?(d=s(a).clone(!0).insertBefore(a).val("")[0],b||s(a).remove()):(c=a.parentNode,(d=c.insertBefore(a.cloneNode(!0),a)).value="",b||c.removeChild(a),L(G[S.uid(a)],function(b,c){L(b,function(b){O(a,c,b),N(d,c,b)})})),d},load:function(a,b){var c=S.getXHR();return c?(c.open("GET",a,!0),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),N(c,"progress",function(a){a.lengthComputable&&b({type:a.type,loaded:a.loaded,total:a.total},c)}),c.onreadystatechange=function(){if(4==c.readyState)if(c.onreadystatechange=null,200==c.status){var d={name:(a=a.split("/"))[a.length-1],size:c.getResponseHeader("Content-Length"),type:c.getResponseHeader("Content-Type")};d.dataURL="data:"+d.type+";base64,"+S.encode64(c.responseBody||c.responseText),b({type:"load",result:d},c)}else b({type:"error"},c)},c.send(null)):b({type:"error"}),c},encode64:function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",d=0;for("string"!=typeof a&&(a=String(a));d<a.length;){var e,f,g=255&a.charCodeAt(d++),h=255&a.charCodeAt(d++),i=255&a.charCodeAt(d++),j=g>>2,k=(3&g)<<4|h>>4;isNaN(h)?e=f=64:(e=(15&h)<<2|i>>6,f=isNaN(i)?64:63&i),c+=b.charAt(j)+b.charAt(k)+b.charAt(e)+b.charAt(f)}return c}};function T(a,b,c,d,e){var f={type:c.type||c,target:a,result:d};M(f,e),b(f)}function U(a){return p&&!!p.prototype["readAs"+a]}function V(a,c,d,e){if(S.isBlob(a)&&U(d)){var f=new p;N(f,I,function b(d){var e=d.type;"progress"==e?T(a,c,d,d.target.result,{loaded:d.loaded,total:d.total}):"loadend"==e?(O(f,I,b),f=null):T(a,c,d,d.target.result)});try{e?f["readAs"+d](a,e):f["readAs"+d](a)}catch(d){T(a,c,"error",b,{error:d.toString()})}}else T(a,c,"error",b,{error:"filreader_not_support_"+d})}function W(a){return a&&(a.isFile||a.isDirectory)}function X(a){var b;return a.getAsEntry?b=a.getAsEntry():a.webkitGetAsEntry&&(b=a.webkitGetAsEntry()),b}function Y(a,b){if(a)if(a.isFile)a.file(function(c){c.fullPath=a.fullPath,b(!1,[c],[c])},function(c){a.error=c,b("FileError.code: "+c.code,[],[a])});else if(a.isDirectory){var c=a.createReader(),d=!0,e=[],f=[a],g=function(c){a.error=c,b("DirectoryError.code: "+c.code,e,f)};c.readEntries(function h(i){d&&(d=!1,i.length||(a.error=new Error("directory is empty"))),i.length?S.afor(i,function(a,b){Y(b,function(b,d,i){b||(e=e.concat(d)),f=f.concat(i),a?a():c.readEntries(h,g)})}):b(!1,e,f)},g)}else Y(X(a),b);else{var h=new Error("invalid entry");(a=new Object(a)).error=h,b(h.message,[],[a])}}function $(a){return B.test(a&&a.tagName)}function Z(a){return(a.originalEvent||a||"").dataTransfer||{}}S.addInfoReader(/^image/,function(a,b){if(!a.__dimensions){var c=a.__dimensions=S.defer();S.readAsImage(a,function(a){var b=a.target;c.resolve("load"!=a.type&&"error",{width:b.width,height:b.height}),b.src=S.EMPTY_PNG,b=null})}a.__dimensions.then(b)}),S.event.dnd=function(a,b,c){var d,e;c||(c=b,b=S.F),p?(N(a,"dragenter dragleave dragover",b.ff=b.ff||function(a){for(var c=Z(a).types,f=c&&c.length,g=!1;f--;)if(~c[f].indexOf("File")){a.preventDefault(),e!==a.type&&("dragleave"!=(e=a.type)&&b.call(a.currentTarget,!0,a),g=!0);break}g&&(clearTimeout(d),d=setTimeout(function(){b.call(a.currentTarget,"dragleave"!=e,a)},50))}),N(a,"drop",c.ff=c.ff||function(a){a.preventDefault(),e=0,S.getDropFiles(a,function(b,d){c.call(a.currentTarget,b,d,a)}),b.call(a.currentTarget,!1,a)})):S.log("Drag'n'Drop -- not supported")},S.event.dnd.off=function(a,b,c){O(a,"dragenter dragleave dragover",b.ff),O(a,"drop",c.ff)},s&&!s.fn.dnd&&(s.fn.dnd=function(a,b){return this.each(function(){S.event.dnd(this,a,b)})},s.fn.offdnd=function(a,b){return this.each(function(){S.event.dnd.off(this,a,b)})}),a.FileAPI=M(S,a.FileAPI),S.log("FileAPI: "+S.version),S.log("protocol: "+a.location.protocol),S.log("doctype: ["+h.name+"] "+h.publicId+" "+h.systemId),L(g.getElementsByTagName("meta"),function(a){/x-ua-compatible/i.test(a.getAttribute("http-equiv"))&&S.log("meta.http-equiv: "+a.getAttribute("content"))});try{c=!!console.log,d=!!console.log.apply}catch(a){}S.flashUrl||(S.flashUrl=S.staticPath+"FileAPI.flash.swf"),S.flashImageUrl||(S.flashImageUrl=S.staticPath+"FileAPI.flash.image.swf"),S.flashWebcamUrl||(S.flashWebcamUrl=S.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(a,b,c){"use strict";var d=Math.min,e=Math.round,f=function(){return b.createElement("canvas")},g=!1,h={8:270,3:180,6:90,7:270,4:180,5:90};try{g=f().toDataURL("image/png").indexOf("data:image/png")>-1}catch(a){}function i(b){if(b instanceof i){var c=new i(b.file);return a.extend(c.matrix,b.matrix),c}if(!(this instanceof i))return new i(b);this.file=b,this.size=b.size||100,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0}}i.prototype={image:!0,constructor:i,set:function(b){return a.extend(this.matrix,b),this},crop:function(a,b,d,e){return d===c&&(d=a,e=b,a=b=0),this.set({sx:a,sy:b,sw:d,sh:e||d})},resize:function(a,b,c){return/min|max|height|width/.test(b)&&(c=b,b=a),this.set({dw:a,dh:b||a,resize:c})},preview:function(a,b){return this.resize(a,b||a,"preview")},rotate:function(a){return this.set({deg:a})},filter:function(a){return this.set({filter:a})},overlay:function(a){return this.set({overlay:a})},clone:function(){return new i(this)},_load:function(b,c){var d=this;/img|video/i.test(b.nodeName)?c.call(d,null,b):a.readAsImage(b,function(a){c.call(d,"load"!=a.type,a.result)})},_apply:function(b,c){var e,g=f(),h=this.getMatrix(b),j=g.getContext("2d"),k=b.videoWidth||b.width,l=b.videoHeight||b.height,m=h.deg,n=h.dw,o=h.dh,p=k,q=l,r=h.filter,s=b,t=h.overlay,u=a.queue(function(){b.src=a.EMPTY_PNG,c(!1,g)}),v=a.renderImageToCanvas;for(m-=360*Math.floor(m/360),b._type=this.file.type;h.multipass&&d(p/n,q/o)>2;)p=p/2+.5|0,q=q/2+.5|0,(e=f()).width=p,e.height=q,s!==b?(v(e,s,0,0,s.width,s.height,0,0,p,q),s=e):(v(s=e,b,h.sx,h.sy,h.sw,h.sh,0,0,p,q),h.sx=h.sy=h.sw=h.sh=0);g.width=m%180?o:n,g.height=m%180?n:o,g.type=h.type,g.quality=h.quality,j.rotate(m*Math.PI/180),v(j.canvas,s,h.sx,h.sy,h.sw||s.width,h.sh||s.height,180==m||270==m?-n:0,90==m||180==m?-o:0,n,o),j.setTransform(1,0,0,1,0,0),n=g.width,o=g.height,t&&a.each([].concat(t),function(b){u.inc();var c=new window.Image,d=function(){var e=0|b.x,f=0|b.y,g=b.w||c.width,h=b.h||c.height,i=b.rel;e=1==i||4==i||7==i?(n-g+e)/2:2==i||5==i||8==i?n-(g+e):e,f=3==i||4==i||5==i?(o-h+f)/2:i>=6?o-(h+f):f,a.event.off(c,"error load abort",d);try{j.globalAlpha=b.opacity||1,j.drawImage(c,e,f,g,h)}catch(a){}u.next()};a.event.on(c,"error load abort",d),c.src=b.src,c.complete&&d()}),r&&(u.inc(),i.applyFilter(g,r,u.next)),u.check()},getMatrix:function(b){var c,f,g=a.extend({},this.matrix),h=g.sw=g.sw||b.videoWidth||b.naturalWidth||b.width,i=g.sh=g.sh||b.videoHeight||b.naturalHeight||b.height,j=g.dw=g.dw||h,k=g.dh=g.dh||i,l=h/i,m=j/k,n=g.resize;"preview"==n?j==h&&k==i||(m>=l?f=(c=h)/m:c=(f=i)*m,c==h&&f==i||(g.sx=~~((h-c)/2),g.sy=~~((i-f)/2),h=c,i=f)):"height"==n?j=k*l:"width"==n?k=j/l:n&&(h>j||i>k?"min"==n?(j=e(l<m?d(h,j):k*l),k=e(l<m?j/l:d(i,k))):(j=e(l>=m?d(h,j):k*l),k=e(l>=m?j/l:d(i,k))):(j=h,k=i));return g.sw=h,g.sh=i,g.dw=j,g.dh=k,g.multipass=a.multiPassResize,g},_trans:function(b){this._load(this.file,function(c,d){if(c)b(c);else try{this._apply(d,b)}catch(c){a.log("[err] FileAPI.Image.fn._apply:",c),b(c)}})},get:function(b){if(a.support.transform){var c=this,d=c.matrix;"auto"==d.deg?a.getInfo(c.file,function(a,e){d.deg=h[e&&e.exif&&e.exif.Orientation]||0,c._trans(b)}):c._trans(b)}else b("not_support_transform");return this},toData:function(a){return this.get(a)}},i.exifOrientation=h,i.transform=function(b,d,e,f){function g(g,h){var j={},k=a.queue(function(a){f(a,j)});g?k.fail():a.each(d,function(a,d){if(!k.isFail()){var f=new i(h.nodeType?h:b),g="function"==typeof a;if(g?a(h,f):a.width?f[a.preview?"preview":"resize"](a.width,a.height,a.strategy):a.maxWidth&&(h.width>a.maxWidth||h.height>a.maxHeight)&&f.resize(a.maxWidth,a.maxHeight,"max"),a.crop){var l=a.crop;f.crop(0|l.x,0|l.y,l.w||l.width,l.h||l.height)}a.rotate===c&&e&&(a.rotate="auto"),f.set({type:f.matrix.type||a.type||b.type||"image/png"}),g||f.set({deg:a.rotate,overlay:a.overlay,filter:a.filter,quality:a.quality||1}),k.inc(),f.toData(function(a,b){a?k.fail():(j[d]=b,k.next())})}})}b.width?g(!1,b):a.getInfo(b,g)},a.each(["TOP","CENTER","BOTTOM"],function(b,c){a.each(["LEFT","CENTER","RIGHT"],function(a,d){i[b+"_"+a]=3*c+d,i[a+"_"+b]=3*c+d})}),i.toCanvas=function(a){var c=b.createElement("canvas");return c.width=a.videoWidth||a.width,c.height=a.videoHeight||a.height,c.getContext("2d").drawImage(a,0,0),c},i.fromDataURL=function(b,c,d){var e=a.newImage(b);a.extend(e,c),d(e)},i.applyFilter=function(b,c,d){"function"==typeof c?c(b,d):window.Caman&&window.Caman("IMG"==b.tagName?i.toCanvas(b):b,function(){"string"==typeof c?this[c]():a.each(c,function(a,b){this[b](a)},this),this.render(d)})},a.renderImageToCanvas=function(b,c,d,e,f,g,h,i,j,k){try{return b.getContext("2d").drawImage(c,d,e,f,g,h,i,j,k)}catch(b){throw a.log("renderImageToCanvas failed"),b}},a.support.canvas=a.support.transform=g,a.Image=i}(FileAPI,document),function(a){"use strict";!function(a){if(!window.navigator||!window.navigator.platform||!/iP(hone|od|ad)/.test(window.navigator.platform))return;var b=a.renderImageToCanvas;a.detectSubsampling=function(a){var b,c;return a.width*a.height>1048576&&((b=document.createElement("canvas")).width=b.height=1,(c=b.getContext("2d")).drawImage(a,1-a.width,0),0===c.getImageData(0,0,1,1).data[3])},a.detectVerticalSquash=function(a,b){var c,d,e,f,g=a.naturalHeight||a.height,h=document.createElement("canvas"),i=h.getContext("2d");for(b&&(g/=2),h.width=1,h.height=g,i.drawImage(a,0,0),c=i.getImageData(0,0,1,g).data,d=0,e=g,f=g;f>d;)0===c[4*(f-1)+3]?e=f:d=f,f=e+d>>1;return f/g||1},a.renderImageToCanvas=function(c,d,e,f,g,h,i,j,k,l){if("image/jpeg"===d._type){var m,n,o,p,q=c.getContext("2d"),r=document.createElement("canvas"),s=1024,t=r.getContext("2d");if(r.width=s,r.height=s,q.save(),(m=a.detectSubsampling(d))&&(e/=2,f/=2,g/=2,h/=2),n=a.detectVerticalSquash(d,m),m||1!==n){for(f*=n,k=Math.ceil(s*k/g),l=Math.ceil(s*l/h/n),j=0,p=0;p<h;){for(i=0,o=0;o<g;)t.clearRect(0,0,s,s),t.drawImage(d,e,f,g,h,-o,-p,g,h),q.drawImage(r,0,0,s,s,i,j,k,l),o+=s,i+=k;p+=s,j+=l}return q.restore(),c}}return b(c,d,e,f,g,h,i,j,k,l)}}(FileAPI)}(),function(a,b){"use strict";var c=b.document,d=b.FormData,e=function(){this.items=[]},f=b.encodeURIComponent;function g(b,c,d){var e=b.blob,f=b.file;if(f){if(!e.toDataURL)return void a.readAsBinaryString(e,function(a){"load"==a.type&&c(b,a.result)});var g={"image/jpeg":".jpe?g","image/png":".png"},h=g[b.type]?b.type:"image/png",i=g[h]||".png",j=e.quality||1;f.match(new RegExp(i+"$","i"))||(f+=i.replace("?","")),b.file=f,b.type=h,!d&&e.toBlob?e.toBlob(function(a){c(b,a)},h,j):c(b,a.toBinaryString(e.toDataURL(h,j)))}else c(b,e)}e.prototype={append:function(a,b,c,d){this.items.push({name:a,blob:b&&b.blob||(null==b?"":b),file:b&&(c||b.name),type:b&&(d||b.type)})},each:function(a){for(var b=0,c=this.items.length;b<c;b++)a.call(this,this.items[b])},toData:function(b,c){c._chunked=a.support.chunked&&c.chunkSize>0&&1==a.filter(this.items,function(a){return a.file}).length,a.support.html5?a.formData&&!this.multipart&&d?c._chunked?(a.log("FileAPI.Form.toPlainData"),this.toPlainData(b)):(a.log("FileAPI.Form.toFormData"),this.toFormData(b)):(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(b)):(a.log("FileAPI.Form.toHtmlData"),this.toHtmlData(b))},_to:function(b,c,d,e){var f=a.queue(function(){c(b)});this.each(function(g){try{d(g,b,f,e)}catch(b){a.log("FileAPI.Form._to: "+b.message),c(b)}}),f.check()},toHtmlData:function(b){this._to(c.createDocumentFragment(),b,function(b,d){var e,f=b.blob;b.file?(a.reset(f,!0),f.name=b.name,f.disabled=!1,d.appendChild(f)):((e=c.createElement("input")).name=b.name,e.type="hidden",e.value=f,d.appendChild(e))})},toPlainData:function(a){this._to({},a,function(a,b,c){a.file&&(b.type=a.file),a.blob.toBlob?(c.inc(),g(a,function(a,d){b.name=a.name,b.file=d,b.size=d.length,b.type=a.type,c.next()})):a.file?(b.name=a.blob.name,b.file=a.blob,b.size=a.blob.size,b.type=a.type):(b.params||(b.params=[]),b.params.push(f(a.name)+"="+f(a.blob))),b.start=-1,b.end=b.file&&b.file.FileAPIReadPosition||-1,b.retry=0})},toFormData:function(a){this._to(new d,a,function(a,b,c){a.blob&&a.blob.toBlob?(c.inc(),g(a,function(a,d){b.append(a.name,d,a.file),c.next()})):a.file?b.append(a.name,a.blob,a.file):b.append(a.name,a.blob),a.file&&b.append("_"+a.name,a.file)})},toMultipartData:function(b){this._to([],b,function(a,b,c,d){c.inc(),g(a,function(a,e){b.push("--_"+d+'\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+f(a.file)+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+(a.file?e:f(e))+"\r\n"),c.next()},!0)},a.expando)}},a.Form=e}(FileAPI,window),function(a,b){"use strict";var c=function(){},d=a.document,e=function(a){this.uid=b.uid(),this.xhr={abort:c,getResponseHeader:c,getAllResponseHeaders:c},this.options=a},f={"":1,XML:1,Text:1,Body:1};e.prototype={status:0,statusText:"",constructor:e,getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(d,e){var f=this,g=f.options;f.end=f.abort=c,f.status=d,e&&(f.statusText=e),b.log("xhr.end:",d,e),g.complete(200!=d&&201!=d&&(f.statusText||"unknown"),f),f.xhr&&f.xhr.node&&setTimeout(function(){var b=f.xhr.node;try{b.parentNode.removeChild(b)}catch(a){}try{delete a[f.uid]}catch(a){}a[f.uid]=f.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(a){var b=this,c=this.options;a.toData(function(a){a instanceof Error?b.end(0,a.message):(c.upload(c,b),b._send.call(b,c,a))},c)},_send:function(c,e){var g,h=this,i=h.uid,j=h.uid+"Load",k=c.url;if(b.log("XHR._send:",e),c.cache||(k+=(~k.indexOf("?")?"&":"?")+b.uid()),e.nodeName){var l=c.jsonp;k=k.replace(/([a-z]+)=(\?)/i,"$1="+i),c.upload(c,h);var m=function(a){if(~k.indexOf(a.origin))try{var c=b.parseJSON(a.data);c.id==i&&n(c.status,c.statusText,c.response)}catch(a){n(0,a.message)}},n=a[i]=function(c,d,e){h.readyState=4,h.responseText=e,h.end(c,d),b.event.off(a,"message",m),a[i]=g=p=a[j]=null};h.xhr.abort=function(){try{p.stop?p.stop():p.contentWindow.stop?p.contentWindow.stop():p.contentWindow.document.execCommand("Stop")}catch(a){}n(0,"abort")},b.event.on(a,"message",m),a[j]=function(){try{var a=p.contentWindow,c=a.document,d=a.result||b.parseJSON(c.body.innerHTML);n(d.status,d.statusText,d.response)}catch(a){b.log("[transport.onload]",a)}},(g=d.createElement("div")).innerHTML='<form target="'+i+'" action="'+k+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+i+'" src="javascript:false;" onload="window.'+j+" && "+j+'();"></iframe>'+(l&&c.url.indexOf("=?")<0?'<input value="'+i+'" name="'+l+'" type="hidden"/>':"")+"</form>";var o=g.getElementsByTagName("form")[0],p=g.getElementsByTagName("iframe")[0];o.appendChild(e),b.log(o.parentNode.innerHTML),d.body.appendChild(g),h.xhr.node=g,h.readyState=2;try{o.submit()}catch(a){b.log("iframe.error: "+a)}o=null}else{if(k=k.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted)return void b.log("Error: already aborted");if(g=h.xhr=b.getXHR(),e.params&&(k+=(k.indexOf("?")<0?"?":"&")+e.params.join("&")),g.open(c.uploadMethod||"POST",k,!0),"boolean"==typeof c.uploadCredentials?g.withCredentials=c.uploadCredentials?"true":null:b.withCredentials&&(g.withCredentials="true"),c.headers&&c.headers["X-Requested-With"]||g.setRequestHeader("X-Requested-With","XMLHttpRequest"),b.each(c.headers,function(a,b){g.setRequestHeader(b,a)}),c._chunked){g.upload&&g.upload.addEventListener("progress",b.throttle(function(a){e.retry||c.progress({type:a.type,total:e.size,loaded:e.start+a.loaded,totalSize:e.size},h,c)},100),!1),g.onreadystatechange=function(){var a=parseInt(g.getResponseHeader("X-Last-Known-Byte"),10);if(h.status=g.status,h.statusText=g.statusText,h.readyState=g.readyState,4==g.readyState){for(var d in f)h["response"+d]=g["response"+d];if(g.onreadystatechange=null,!g.status||g.status-201>0)if(b.log("Error: "+g.status),(!g.status&&!g.aborted||500==g.status||416==g.status)&&++e.retry<=c.chunkUploadRetry){var i=g.status?0:b.chunkNetworkDownRetryTimeout;c.pause(e.file,c),b.log("X-Last-Known-Byte: "+a),a?e.end=a:(e.end=e.start-1,416==g.status&&(e.end=e.end-c.chunkSize)),setTimeout(function(){h._send(c,e)},i)}else h.end(g.status);else e.retry=0,e.end==e.size-1?h.end(g.status):(b.log("X-Last-Known-Byte: "+a),a&&(e.end=a),e.file.FileAPIReadPosition=e.end,setTimeout(function(){h._send(c,e)},0));g=null}},e.start=e.end+1,e.end=Math.max(Math.min(e.start+c.chunkSize,e.size)-1,e.start);var q=e.file,r=(q.slice||q.mozSlice||q.webkitSlice).call(q,e.start,e.end+1);e.size&&!r.size?setTimeout(function(){h.end(-1)}):(g.setRequestHeader("Content-Range","bytes "+e.start+"-"+e.end+"/"+e.size),g.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(e.name)),g.setRequestHeader("Content-Type",e.type||"application/octet-stream"),g.send(r)),q=r=null}else if(g.upload&&g.upload.addEventListener("progress",b.throttle(function(a){c.progress(a,h,c)},100),!1),g.onreadystatechange=function(){if(h.status=g.status,h.statusText=g.statusText,h.readyState=g.readyState,4==g.readyState){for(var a in f)h["response"+a]=g["response"+a];if(g.onreadystatechange=null,!g.status||g.status>201)if(b.log("Error: "+g.status),(!g.status&&!g.aborted||500==g.status)&&(c.retry||0)<c.uploadRetry){c.retry=(c.retry||0)+1;var d=b.networkDownRetryTimeout;c.pause(c.file,c),setTimeout(function(){h._send(c,e)},d)}else h.end(g.status);else h.end(g.status);g=null}},b.isArray(e)){g.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+b.expando);var s=e.join("")+"--_"+b.expando+"--";if(g.sendAsBinary)g.sendAsBinary(s);else{var t=Array.prototype.map.call(s,function(a){return 255&a.charCodeAt(0)});g.send(new Uint8Array(t).buffer)}}else g.send(e)}}},b.XHR=e}(window,FileAPI),function(a,b){"use strict";var c=a.URL||a.webkitURL,d=a.document,e=a.navigator,f=e.getUserMedia||e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia,g=!!f;b.support.media=g;var h,i,j,k,l=function(a){this.video=a};l.prototype={isActive:function(){return!!this._active},start:function(a){var g,h,i=this,j=i.video,k=function(b){i._active=!b,clearTimeout(h),clearTimeout(g),a&&a(b,i)};f.call(e,{video:!0},function(a){i.stream=a;try{j.src=c.createObjectURL(a)}catch(b){j.srcObject=a}g=setInterval(function(){(function(a){var c,e=d.createElement("canvas"),f=!1;try{(c=e.getContext("2d")).drawImage(a,0,0,1,1),f=255!=c.getImageData(0,0,1,1).data[4]}catch(a){b.log("[FileAPI.Camera] detectVideoSignal:",a)}return f})(j)&&k(null)},1e3),h=setTimeout(function(){k("timeout")},5e3),j.play()},k)},stop:function(){try{this._active=!1,this.video.pause();try{this.stream.stop()}catch(a){b.each(this.stream.getTracks(),function(a){a.stop()})}this.stream=null}catch(a){b.log("[FileAPI.Camera] stop:",a)}},shot:function(){return new m(this.video)}},l.get=function(a){return new l(a.firstChild)},l.publish=function(c,e,f){"function"==typeof e&&(f=e,e={}),e=b.extend({},{width:"100%",height:"100%",start:!0},e),c.jquery&&(c=c[0]);var h=function(a){if(a)f(a);else{var b=l.get(c);e.start?b.start(f):f(null,b)}};if(c.style.width=n(e.width),c.style.height=n(e.height),b.html5&&g&&!b.insecureChrome){var i=d.createElement("video");i.style.width=n(e.width),i.style.height=n(e.height),a.jQuery?jQuery(c).empty():c.innerHTML="",c.appendChild(i),h()}else l.fallback(c,e,h)},l.fallback=function(a,b,c){c("not_support_camera")},l.checkAlreadyCaptured=(i=e.mediaDevices,j=a.MediaStreamTrack,k=e.enumerateDevices,h=i&&i.enumerateDevices?function(a){i.enumerateDevices().then(a)}:j&&j.getSources?j.getSources.bind(j):k?k.bind(e):function(a){a([])},function(a){h(function(b){var c=b.some(function(a){return("videoinput"===a.kind||"video"===a.kind)&&a.label});a(c)})});var m=function(a){var c=a.nodeName?b.Image.toCanvas(a):a,d=b.Image(c);return d.type="image/png",d.width=c.width,d.height=c.height,d.size=c.width*c.height*4,d};function n(a){return a>=0?a+"px":a}l.Shot=m,b.Camera=l}(window,FileAPI),function(a,b,c){"use strict";var d=a.document,e=a.location,f=a.navigator,g=c.each;c.support.flash=function(){var b=f.mimeTypes,d=!1;if(f.plugins&&"object"==typeof f.plugins["Shockwave Flash"])d=f.plugins["Shockwave Flash"].description&&!(b&&b["application/x-shockwave-flash"]&&!b["application/x-shockwave-flash"].enabledPlugin);else try{d=!(!a.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(a){c.log("Flash -- does not supported.")}return d&&/^file:/i.test(e)&&c.log("[warn] Flash does not work on `file:` protocol."),d}(),c.support.flash&&(!c.html5||!c.support.html5||c.cors&&!c.support.cors||c.media&&!c.support.media||c.insecureChrome)&&function(){var h=c.uid(),i=0,j={},k=/^https?:/i,l={_fn:{},init:function(){var a=d.body&&d.body.firstChild;if(a)do{if(1==a.nodeType){c.log("FlashAPI.state: awaiting");var b=d.createElement("div");return b.id="_"+h,n(b,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:"2147483647"}),a.parentNode.insertBefore(b,a),void l.publish(b,h)}}while(a=a.nextSibling);i<10&&setTimeout(l.init,50*++i)},publish:function(a,b,d){d=d||{},a.innerHTML=m({id:b,src:s(c.flashUrl,"r="+c.version),wmode:d.camera?"":"transparent",flashvars:"callback="+(d.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+b+"&storeKey="+f.userAgent.match(/\d/gi).join("")+"_"+c.version+(l.isReady||(c.pingUrl?"&ping="+c.pingUrl:""))+"&timeout="+c.flashAbortTimeout+(d.camera?"&useCamera="+s(c.flashWebcamUrl):"")+"&debug="+(c.debug?"1":"")})},ready:function(){c.log("FlashAPI.state: ready"),l.ready=c.F,l.isReady=!0,l.patch(),l.patchCamera&&l.patchCamera(),c.event.on(d,"mouseover",l.mouseover),c.event.on(d,"click",function(a){l.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getEl:function(){return d.getElementById("_"+h)},getWrapper:function(a){do{if(/js-fileapi-wrapper/.test(a.className))return a}while((a=a.parentNode)&&a!==d.body)},mouseover:function(b){var e=c.event.fix(b).target;if(/input/i.test(e.nodeName)&&"file"==e.type&&!e.disabled){var f=e.getAttribute(h),g=l.getWrapper(e);if(c.multiFlash){if("i"==f||"r"==f)return!1;if("p"!=f){e.setAttribute(h,"i");var i=d.createElement("div");if(!g)return void c.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");n(i,{top:0,left:0,width:e.offsetWidth,height:e.offsetHeight,zIndex:"2147483647",position:"absolute"}),g.appendChild(i),l.publish(i,c.uid()),e.setAttribute(h,"p")}return!0}if(g){var j=function(b){var c=b.getBoundingClientRect(),e=d.body,f=(b&&b.ownerDocument).documentElement;return{top:c.top+(a.pageYOffset||f.scrollTop)-(f.clientTop||e.clientTop||0),left:c.left+(a.pageXOffset||f.scrollLeft)-(f.clientLeft||e.clientLeft||0),width:c.right-c.left,height:c.bottom-c.top}}(g);n(l.getEl(),j),l.curInp=e}}else/object|embed/i.test(e.nodeName)||n(l.getEl(),{top:1,left:1,width:5,height:5})},onEvent:function(a){var b=a.type;if("ready"==b){try{l.getInput(a.flashId).setAttribute(h,"r")}catch(a){}return l.ready(),setTimeout(function(){l.mouseenter(a)},50),!0}"ping"===b?c.log("(flash -> js).ping:",[a.status,a.savedStatus],a.error):"log"===b?c.log("(flash -> js).log:",a.target):b in l&&setTimeout(function(){c.log("FlashAPI.event."+a.type+":",a),l[b](a)},1)},mouseenter:function(a){var b=l.getInput(a.flashId);if(b){l.cmd(a,"multiple",null!=b.getAttribute("multiple"));var d=[],e={};g((b.getAttribute("accept")||"").split(/,\s*/),function(a){c.accept[a]&&g(c.accept[a].split(" "),function(a){e[a]=1})}),g(e,function(a,b){d.push(b)}),l.cmd(a,"accept",d.length?d.join(",")+","+d.join(",").toUpperCase():"*")}},get:function(b){return d[b]||a[b]||d.embeds[b]},getInput:function(a){if(!c.multiFlash)return l.curInp;try{var b=l.getWrapper(l.get(a));if(b)return b.getElementsByTagName("input")[0]}catch(b){c.log('[err] Can not find "input" by flashId:',a,b)}},select:function(a){var e,f=l.getInput(a.flashId),h=c.uid(f),i=a.target.files;g(i,function(a){c.checkFileObj(a)}),j[h]=i,d.createEvent?((e=d.createEvent("Event")).files=i,e.initEvent("change",!0,!0),f.dispatchEvent(e)):b?b(f).trigger({type:"change",files:i}):((e=d.createEventObject()).files=i,f.fireEvent("onchange",e))},cmd:function(a,b,d,e){try{return c.log("(js -> flash)."+b+":",d),l.get(a.flashId||a).cmd(b,d)}catch(f){c.log("(js -> flash).onError:",f.toString()),e||setTimeout(function(){l.cmd(a,b,d,!0)},50)}},patch:function(){c.flashEngine=!0,o(c,{getFiles:function(a,b,d){if(d)return c.filterFiles(c.getFiles(a),b,d),null;var e=c.isArray(a)?a:j[c.uid(a.target||a.srcElement||a)];return e?(b&&(b=c.getFilesFilter(b),e=c.filter(e,function(a){return b.test(a.name)})),e):this.parent.apply(this,arguments)},getInfo:function(a,b){if(p(a))this.parent.apply(this,arguments);else if(a.isShot)b(null,a.info={width:a.width,height:a.height});else{if(!a.__info){var d=a.__info=c.defer();l.cmd(a,"getFileInfo",{id:a.id,callback:q(function b(c,e){r(b),d.resolve(c,a.info=e)})})}a.__info.then(b)}}}),c.support.transform=!0,c.Image&&o(c.Image.prototype,{get:function(a,b){return this.set({scaleMode:b||"noScale"}),this.parent(a)},_load:function(a,b){if(c.log("FlashAPI.Image._load:",a),p(a))this.parent.apply(this,arguments);else{var d=this;c.getInfo(a,function(c){b.call(d,c,a)})}},_apply:function(a,b){if(c.log("FlashAPI.Image._apply:",a),p(a))this.parent.apply(this,arguments);else{var d=this.getMatrix(a.info),e=b;l.cmd(a,"imageTransform",{id:a.id,matrix:d,callback:q(function f(g,h){c.log("FlashAPI.Image._apply.callback:",g),r(f),g?e(g):c.support.html5||c.support.dataURI&&!(h.length>3e4)?(d.filter&&(e=function(a,e){a?b(a):c.Image.applyFilter(e,d.filter,function(){b(a,this.canvas)})}),c.newImage("data:"+a.type+";base64,"+h,e)):t({width:d.deg%180?d.dh:d.dw,height:d.deg%180?d.dw:d.dh,scale:d.scaleMode},h,e)})})}},toData:function(a){var b=this.file,d=b.info,e=this.getMatrix(d);c.log("FlashAPI.Image.toData"),p(b)?this.parent.apply(this,arguments):("auto"==e.deg&&(e.deg=c.Image.exifOrientation[d&&d.exif&&d.exif.Orientation]||0),a.call(this,!b.info,{id:b.id,flashId:b.flashId,name:b.name,type:b.type,matrix:e}))}}),c.Image&&o(c.Image,{fromDataURL:function(a,b,d){!c.support.dataURI||a.length>3e4?t(c.extend({scale:"exactFit"},b),a.replace(/^data:[^,]+,/,""),function(a,b){d(b)}):this.parent(a,b,d)}}),o(c.Form.prototype,{toData:function(a){for(var b=this.items,d=b.length;d--;)if(b[d].file&&p(b[d].blob))return this.parent.apply(this,arguments);c.log("FlashAPI.Form.toData"),a(b)}}),o(c.XHR.prototype,{_send:function(a,b){if(b.nodeName||b.append&&c.support.html5||c.isArray(b)&&"string"==typeof b[0])return this.parent.apply(this,arguments);var d,e,f={},i={},j=this;if(g(b,function(a){a.file?(i[a.name]=a=u(a.blob),e=a.id,d=a.flashId):f[a.name]=a.blob}),e||(d=h),!d)return c.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments);c.log("FlashAPI.XHR._send: "+d+" -> "+e),j.xhr={headers:{},abort:function(){l.cmd(d,"abort",{id:e})},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};var k=c.queue(function(){l.cmd(d,"upload",{url:s(a.url.replace(/([a-z]+)=(\?)&?/i,"")),data:f,files:e?i:null,headers:a.headers||{},callback:q(function b(d){var e=d.type,f=d.result;c.log("FlashAPI.upload."+e),"progress"==e?(d.loaded=Math.min(d.loaded,d.total),d.lengthComputable=!0,a.progress(d)):"complete"==e?(r(b),"string"==typeof f&&(j.responseText=f.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),j.end(d.status||200)):"abort"!=e&&"error"!=e||(j.end(d.status||0,d.message),r(b))})})});g(i,function(a){k.inc(),c.getInfo(a,k.next)}),k.check()}})}};function m(a){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(a.width||"100%")+'" height="'+(a.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(a.width||"100%")+'" height="'+(a.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(b,c){return a[c]})}function n(a,b){var c,d;if(a&&a.style)for(c in b){"number"==typeof(d=b[c])&&(d+="px");try{a.style[c]=d}catch(a){}}}function o(a,b){g(b,function(b,c){var d=a[c];a[c]=function(){return this.parent=d,b.apply(this,arguments)}})}function p(a){return a&&!a.flashId}function q(a){var b=a.wid=c.uid();return l._fn[b]=a,"FileAPI.Flash._fn."+b}function r(a){try{l._fn[a.wid]=null,delete l._fn[a.wid]}catch(a){}}function s(a,b){if(!k.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0)){var c=e.pathname;a=((c=c.substr(0,c.lastIndexOf("/")))+"/"+a).replace("/./","/")}"//"!=a.substr(0,2)&&(a="//"+e.host+a),k.test(a)||(a=e.protocol+a)}return b&&(a+=(/\?/.test(a)?"&":"?")+b),a}function t(a,b,e){var f,g=c.uid(),h=d.createElement("div"),i=10;for(f in a)h.setAttribute(f,a[f]),h[f]=a[f];n(h,a),a.width="100%",a.height="100%",h.innerHTML=m(c.extend({id:g,src:s(c.flashImageUrl,"r="+c.uid()),wmode:"opaque",flashvars:"scale="+a.scale+"&callback="+q(function a(){return r(a),--i>0&&function(){try{l.get(g).setImage(b)}catch(a){c.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',a)}}(),!0})},a)),e(!1,h),h=null}function u(a){return{id:a.id,name:a.name,matrix:a.matrix,flashId:a.flashId}}c.Flash=l,c.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(a,b){c.support.dataURI=!(1!=b.width||1!=b.height),l.init()})}()}(window,window.jQuery,FileAPI),function(a,b,c){"use strict";var d=c.each,e=[];!c.support.flash||!c.media||c.support.media&&c.html5&&!c.insecureChrome||function(){function a(a){var b=a.wid=c.uid();return c.Flash._fn[b]=a,"FileAPI.Flash._fn."+b}function b(a){try{c.Flash._fn[a.wid]=null,delete c.Flash._fn[a.wid]}catch(a){}}var f=c.Flash;c.extend(c.Flash,{patchCamera:function(){c.Camera.fallback=function(d,e,g){var h=c.uid();c.log("FlashAPI.Camera.publish: "+h),f.publish(d,h,c.extend(e,{camera:!0,onEvent:a(function a(d){"camera"===d.type&&(b(a),d.error?(c.log("FlashAPI.Camera.publish.error: "+d.error),g(d.error)):(c.log("FlashAPI.Camera.publish.success: "+h),g(null)))})}))},d(e,function(a){c.Camera.fallback.apply(c.Camera,a)}),e=[],c.extend(c.Camera.prototype,{_id:function(){return this.video.id},start:function(d){var e=this;f.cmd(this._id(),"camera.on",{callback:a(function a(f){b(a),f.error?(c.log("FlashAPI.camera.on.error: "+f.error),d(f.error,e)):(c.log("FlashAPI.camera.on.success: "+e._id()),e._active=!0,d(null,e))})})},stop:function(){this._active=!1,f.cmd(this._id(),"camera.off")},shot:function(){c.log("FlashAPI.Camera.shot:",this._id());var a=c.Flash.cmd(this._id(),"shot",{});return a.type="image/png",a.flashId=this._id(),a.isShot=!0,new c.Camera.Shot(a)}})}}),c.Camera.fallback=function(){e.push(arguments)}}()}(window,window.jQuery,FileAPI),void 0===(c=function(){return FileAPI}.apply(b,[]))||(a.exports=c)}},b={};function c(d){var e=b[d];if(void 0!==e)return e.exports;var f=b[d]={exports:{}};return a[d].call(f.exports,f,f.exports,c),f.exports}return c.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"==typeof window)return window}}(),c(1324)}()});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/feedback",["require","exports","@mail/e.mail.ru.feedback","@mail/xray","default-values","service/auth","service/themes.setup"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);var f;var g;exports.default={update:function(){var h;if(c.CSAT_DISABLED||!c.CSAT_POLL_ID){return}if(!f){f=new a.FeedbackLoader({userId:d.default.user.getEmail(),surveyId:c.CSAT_POLL_ID,permille:c.CSAT_DAILY_PERMILLE,radar:b.default.send,dryRun:c.CSAT_DRY_RUN,domain:c.CSAT_DOMAIN,darkTheme:g!==null&&g!==void 0?g:((h=e.default===null||e.default===void 0?void 0:e.default.getSelectedModel())===null||h===void 0?void 0:h.isDarkMode())||false,repeatInterval:c.CSAT_REPEAT_INTERVAL,styles:{zIndex:9001}})}f.update().catch(function(){})},show:function(){f===null||f===void 0?void 0:f.show()},setDarkMode:function(a){if(g===a){return}g=a;if(f){f.setDarkTheme(a)}}}});